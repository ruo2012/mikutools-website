(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{2476:function(t,e,n){"use strict";n.r(e);n(373),n(380),n(49),n(31),n(118),n(800),n(169),n(224),n(56);var r,o,c,l=n(13),h=n(166),d=n.n(h),m={name:"StarHistory",components:{VeLine:n(2208)},head:function(){return this.$store.state.currentTool.head},data:function(){return{repo:"",token:"",loading:!1,sampleNum:15,chartData:{columns:["date","starNum"],rows:[]},chartExtend:{legend:{show:!1}},chartSettings:{legend:{show:!1},xAxisType:"time"}}},methods:{query:(c=Object(l.a)(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.loading=!0,this.chartData.rows=[],this.repo.includes("github.com")?(this.repo+="/",this.repo=/github\.com\/(\S*?\/\S*?)[/#?]/.exec(this.repo)[1]):this.repo=""==this.repo?"Ice-Hazymoon/MikuTools":this.repo,!(e=this.$db.get('tool.star_history["'.concat(this.repo,'"]')).value())){t.next=9;break}this.loading=!1,this.chartData.rows=e,t.next=22;break;case 9:return t.prev=9,t.next=12,this.getStarHistory(this.repo,this.token?this.token:void 0);case 12:n=t.sent,this.loading=!1,this.chartData.rows=n,this.$db.set('tool.star_history["'.concat(this.repo,'"]'),n).write(),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(9),this.loading=!1,t.t0.message.indexOf("403")>=0?this.$notify.error({title:"统计失败",message:"请求次数过多，请填写 Token 以获取更多配额"}):this.$notify.error({title:"统计失败",message:t.t0});case 22:case"end":return t.stop()}}),t,this,[[9,18]])}))),function(){return c.apply(this,arguments)}),range:function(t){return Array.apply(null,{length:t}).map((function(t,i){return i+1}))},generateUrls:(o=Object(l.a)(regeneratorRuntime.mark((function t(e,n){var r,o,c,link,l,h,m,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.a.create({headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}}),o="https://api.github.com/repos/".concat(e,"/stargazers"),t.next=4,r.get(o,{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}});case 4:return c=t.sent,link=c.headers.link,l=link?/next.*?page=(\d*).*?last/.exec(link)[1]:1,h=l<=this.sampleNum?this.range(l).slice(1,l):this.range(this.sampleNum).map((function(t){return Math.round(t/f.sampleNum*l)-1})),m=h.map((function(t){return"".concat(o,"?page=").concat(t)})),t.abrupt("return",{firstPage:c,sampleUrls:m,pageIndexes:h});case 10:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)}),getStarHistory:(r=Object(l.a)(regeneratorRuntime.mark((function t(e,n){var r,o,c,l,h,m,f,v,y,k,w,x,_,D,A,S,j;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.a.create({headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}}),t.next=3,this.generateUrls(e,n);case 3:return o=t.sent,c=o.sampleUrls,l=o.pageIndexes,h=o.firstPage,m=[h].concat(c.map((function(t){return r.get(t,{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}})}))),t.next=10,Promise.all(m);case 10:return f=t.sent,v=null,l[l.length-1]>this.sampleNum?v=l.map((function(p,i){return{date:f[i+1].data[0].starred_at.slice(0,10),starNum:30*(p-1)}})):(y=f.reduce((function(t,e){return t.concat(e.data)}),[]),k=new Date(y[0].starred_at),w=Math.round(new Date-k)/864e5,x=Array.from(new Array(50)).map((function(t,i){var e=new Date(k);return e.setDate(e.getDate()+Math.floor(w/50*(i+1))),e.toISOString().slice(0,10)}),[]),v=x.map((function(t){var e=0,n=y.find((function(n,i){return n.starred_at.slice(0,10)>=t&&(e=i+1,!0)}));return n&&{date:n.starred_at.slice(0,10),starNum:e}})).filter((function(t){return t}))),t.next=15,r.get("https://api.github.com/repos/".concat(e),{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}});case 15:return _=t.sent,D=_.data.stargazers_count,A=new Date,S=A.getMonth()+1>10?A.getMonth()+1:"0".concat(A.getMonth()+1),j=A.getDate()>10?A.getDate():"0".concat(A.getDate()),v.push({date:"".concat(A.getFullYear(),"-").concat(S,"-").concat(j),starNum:D}),t.abrupt("return",v);case 22:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})}},f=n(5),component=Object(f.a)(m,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"star_history"},[n("nya-container",{attrs:{title:"Star 历史查询"}},[n("div",{staticClass:"nya-subtitle"},[t._v("\n            请输入GitHub项目地址\n        ")]),t._v(" "),n("el-input",{staticClass:"mb-15",attrs:{autofocus:"",disabled:t.loading,placeholder:"https://github.com/Ice-Hazymoon/MikuTools"},model:{value:t.repo,callback:function(e){t.repo="string"==typeof e?e.trim():e},expression:"repo"}}),t._v(" "),n("div",{staticClass:"nya-subtitle"},[t._v("\n            Access Token\n        ")]),t._v(" "),n("el-input",{staticClass:"mb-15",attrs:{autofocus:"",disabled:t.loading,placeholder:"私有仓库或访问超过限制则必填"},model:{value:t.token,callback:function(e){t.token="string"==typeof e?e.trim():e},expression:"token"}}),t._v(" "),n("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.query}},[t._v("\n            "+t._s(t.loading?"统计中":"开始统计")+"\n        ")])],1),t._v(" "),t.chartData.rows.length?n("nya-container",{attrs:{title:"查询结果"}},[n("client-only",[n("ve-line",{attrs:{data:t.chartData,settings:t.chartSettings,extend:t.chartExtend}})],1)],1):t._e()],1)}),[],!1,null,null,null);e.default=component.exports}}]);