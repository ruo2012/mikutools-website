/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{2007:function(t,e,n){var r;window,t.exports=(r=n(2008),function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){t.exports=r},function(t,e,n){"use strict";n.r(e);var r=function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"tuiImageEditor",staticStyle:{width:"100%",height:"100%"}})};r._withStripped=!0;var o=n(0),i=n.n(o);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s=["addText","mousedown","objectActivated","objectMoved","objectScaled","redoStackChanged","textEditing","undoStackChanged"],a={includeUI:{initMenu:"filter"}},c={cssMaxWidth:700,cssMaxHeight:500},l=function(t,e,n,r,o,i,u,s){var a,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=[],c._compiled=!0),a)if(c.functional){c._injectStyles=a;var l=c.render;c.render=function(t,e){return a.call(e),l(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,a):[a]}return{exports:t,options:c}}({name:"TuiImageEditor",props:{includeUi:{type:Boolean,default:!0},options:{type:Object,default:function(){return c}}},data:function(){return{editorInstance:null}},mounted:function(){var t=c;this.includeUi&&(t=Object.assign(a,this.options)),this.editorInstance=new i.a(this.$refs.tuiImageEditor,t),this.addEventListener()},destroyed:function(){var t=this;s.forEach((function(e){return t.editorInstance.off(e)})),this.editorInstance.destroy()},methods:{addEventListener:function(){var t=this;s.forEach((function(e){t.editorInstance.on(e,(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.$emit.apply(t,[e].concat(r))}))}))},getRootElement:function(){return this.$refs.tuiImageEditor},invoke:function(t){for(var e,n=null,r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];if(this.editorInstance[t])n=(e=this.editorInstance)[t].apply(e,o);else if(t.indexOf(".")>-1){var u=this.getMethod(this.editorInstance,t);"function"==typeof u&&(n=u.apply(void 0,o))}return n},getMethod:function(t,e){var n,r=this.parseDotMethodName(e),o=r.first,i=r.rest,s="Object"!==t.constructor.name,a=u(t[o]);return n=s&&"function"===a?t[o].bind(t):t[o],i.length>0?this.getMethod(n,i):n},parseDotMethodName:function(t){var e=t.indexOf("."),n=t,r="";return e>-1&&(n=t.substring(0,e),r=t.substring(e+1,t.length)),{first:n,rest:r}}}},r);l.options.__file="src/ImageEditor.vue";var h=l.exports;n.d(e,"ImageEditor",(function(){return h}))}]))},2008:function(t,e,n){var r;r=function(t,e){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}return n.m=t,n.c=e,n.p="dist",n(0)}([function(t,e,n){"use strict";n(1);var r,o=n(2),c=(r=o)&&r.__esModule?r:{default:r};n(131),n(133),n(134),n(135),n(136),n(137),n(138),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),t.exports=c.default},function(t,e){"use strict";Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Element.prototype.closest||(Element.prototype.closest=function(s){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(s))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(view){if("Element"in view){var t=view.Element.prototype,e=Object,n=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array.prototype.indexOf||function(t){for(var i=0,e=this.length;i<e;i++)if(i in this&&this[i]===t)return i;return-1},o=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},c=function(t,e){if(""===e)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(t,e)},l=function(t){for(var e=n.call(t.getAttribute("class")||""),r=e?e.split(/\s+/):[],i=0,o=r.length;i<o;i++)this.push(r[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},h=l.prototype=[],f=function(){return new l(this)};if(o.prototype=Error.prototype,h.item=function(i){return this[i]||null},h.contains=function(t){return-1!==c(this,t+="")},h.add=function(){var t,e=arguments,i=0,n=e.length,r=!1;do{t=e[i]+"",-1===c(this,t)&&(this.push(t),r=!0)}while(++i<n);r&&this._updateClassName()},h.remove=function(){var t,e,n=arguments,i=0,r=n.length,o=!1;do{for(t=n[i]+"",e=c(this,t);-1!==e;)this.splice(e,1),o=!0,e=c(this,t)}while(++i<r);o&&this._updateClassName()},h.toggle=function(t,e){t+="";var n=this.contains(t),r=n?!0!==e&&"remove":!1!==e&&"add";return r&&this[r](t),!0===e||!1===e?e:!n},h.toString=function(){return this.join(" ")},e.defineProperty){var d={get:f,enumerable:!0,configurable:!0};try{e.defineProperty(t,"classList",d)}catch(n){void 0!==n.number&&-2146823252!==n.number||(d.enumerable=!1,e.defineProperty(t,"classList",d))}}else e.prototype.__defineGetter__&&t.__defineGetter__("classList",f)}}(window.self),function(){var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var i,n=arguments.length;for(i=0;i<n;i++)t=arguments[i],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}t=null}()),function(){if("undefined"!=typeof window&&window.addEventListener){var t,e,n,r=Object.create(null),o=function(){clearTimeout(e),e=setTimeout(t,100)},c=function(){},l=function(){var t;window.addEventListener("resize",o,!1),window.addEventListener("orientationchange",o,!1),window.MutationObserver?((t=new MutationObserver(o)).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}),c=function(){try{t.disconnect(),window.removeEventListener("resize",o,!1),window.removeEventListener("orientationchange",o,!1)}catch(t){}}):(document.documentElement.addEventListener("DOMSubtreeModified",o,!1),c=function(){document.documentElement.removeEventListener("DOMSubtreeModified",o,!1),window.removeEventListener("resize",o,!1),window.removeEventListener("orientationchange",o,!1)})},h=function(t){function e(t){var a;return void 0!==t.protocol?a=t:(a=document.createElement("a")).href=t,a.protocol.replace(/:/g,"")+a.host}var n,r,o;return window.XMLHttpRequest&&(n=new XMLHttpRequest,r=e(location),o=e(t),n=void 0===n.withCredentials&&""!==o&&o!==r?XDomainRequest||void 0:XMLHttpRequest),n},f="http://www.w3.org/1999/xlink";t=function(){var base,t,e,n,i,o,d,v,m,y,_=0;function x(){0==(_-=1)&&(c(),l())}function w(t){return function(){!0!==r[t.base]&&(t.useEl.setAttributeNS(f,"xlink:href","#"+t.hash),t.useEl.hasAttribute("href")&&t.useEl.setAttribute("href","#"+t.hash))}}function C(t){return function(){var svg,body=document.body,e=document.createElement("x");t.onload=null,e.innerHTML=t.responseText,(svg=e.getElementsByTagName("svg")[0])&&(svg.setAttribute("aria-hidden","true"),svg.style.position="absolute",svg.style.width=0,svg.style.height=0,svg.style.overflow="hidden",body.insertBefore(svg,body.firstChild)),x()}}function S(t){return function(){t.onerror=null,t.ontimeout=null,x()}}for(c(),m=document.getElementsByTagName("use"),i=0;i<m.length;i+=1){try{t=m[i].getBoundingClientRect()}catch(e){t=!1}base=(v=(n=m[i].getAttribute("href")||m[i].getAttributeNS(f,"href")||m[i].getAttribute("xlink:href"))&&n.split?n.split("#"):["",""])[0],e=v[1],o=t&&0===t.left&&0===t.right&&0===t.top&&0===t.bottom,t&&0===t.width&&0===t.height&&!o?(m[i].hasAttribute("href")&&m[i].setAttributeNS(f,"xlink:href",n),base.length&&(!0!==(y=r[base])&&setTimeout(w({useEl:m[i],base:base,hash:e}),0),void 0===y&&void 0!==(d=h(base))&&(y=new d,r[base]=y,y.onload=C(y),y.onerror=S(y),y.ontimeout=S(y),y.open("GET",base),y.send(),_+=1))):o?base.length&&r[base]&&setTimeout(w({useEl:m[i],base:base,hash:e}),0):void 0===r[base]?r[base]=!0:r[base].onload&&(r[base].abort(),delete r[base].onload,r[base]=!0)}m="",_+=1,x()},n=function(){window.removeEventListener("load",n,!1),e=setTimeout(t,0)},"complete"!==document.readyState?window.addEventListener("load",n,!1):n()}}()},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=_(n(3)),c=_(n(4)),l=_(n(68)),h=_(n(74)),f=_(n(103)),d=_(n(69)),v=_(n(105)),m=_(n(73)),y=n(72);function _(t){return t&&t.__esModule?t:{default:t}}var x=m.default.eventNames,w=m.default.commandNames,C=m.default.keyCodes,S=m.default.rejectMessages,k=o.default.isUndefined,O=o.default.forEach,E=o.default.CustomEvents,T=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=o.default.extend({includeUI:!1,usageStatistics:!0},n),this.mode=null,this.activeObjectId=null,n.includeUI&&(this.ui=new h.default(e,n.includeUI,this.getActions()),n=this.ui.setUiDefaultSelectionStyle(n)),this._invoker=new l.default,this._graphics=new v.default(this.ui?this.ui.getEditorArea():e,{cssMaxWidth:n.cssMaxWidth,cssMaxHeight:n.cssMaxHeight,useItext:!!this.ui,useDragAddIcon:!!this.ui}),this._handlers={keydown:this._onKeyDown.bind(this),mousedown:this._onMouseDown.bind(this),objectActivated:this._onObjectActivated.bind(this),objectMoved:this._onObjectMoved.bind(this),objectScaled:this._onObjectScaled.bind(this),createdPath:this._onCreatedPath,addText:this._onAddText.bind(this),addObject:this._onAddObject.bind(this),addObjectAfter:this._onAddObjectAfter.bind(this),textEditing:this._onTextEditing.bind(this),textChanged:this._onTextChanged.bind(this),iconCreateResize:this._onIconCreateResize.bind(this),iconCreateEnd:this._onIconCreateEnd.bind(this),selectionCleared:this._selectionCleared.bind(this),selectionCreated:this._selectionCreated.bind(this)},this._attachInvokerEvents(),this._attachGraphicsEvents(),this._attachDomEvents(),this._setSelectionStyle(n.selectionStyle,{applyCropSelectionStyle:n.applyCropSelectionStyle,applyGroupSelectionStyle:n.applyGroupSelectionStyle}),n.usageStatistics&&(0,y.sendHostName)(),this.ui&&(this.ui.initCanvas(),this.setReAction())}return r(t,[{key:"_setSelectionStyle",value:function(t,e){var n=e.applyCropSelectionStyle,r=e.applyGroupSelectionStyle;t&&this._graphics.setSelectionStyle(t),n&&this._graphics.setCropSelectionStyle(t),r&&this.on("selectionCreated",(function(e){"group"===e.type&&e.set(t)}))}},{key:"_attachInvokerEvents",value:function(){var t=x.UNDO_STACK_CHANGED,e=x.REDO_STACK_CHANGED;this._invoker.on(t,this.fire.bind(this,t)),this._invoker.on(e,this.fire.bind(this,e))}},{key:"_attachGraphicsEvents",value:function(){this._graphics.on({mousedown:this._handlers.mousedown,objectMoved:this._handlers.objectMoved,objectScaled:this._handlers.objectScaled,objectActivated:this._handlers.objectActivated,addText:this._handlers.addText,addObject:this._handlers.addObject,textEditing:this._handlers.textEditing,textChanged:this._handlers.textChanged,iconCreateResize:this._handlers.iconCreateResize,iconCreateEnd:this._handlers.iconCreateEnd,selectionCleared:this._handlers.selectionCleared,selectionCreated:this._handlers.selectionCreated,addObjectAfter:this._handlers.addObjectAfter})}},{key:"_attachDomEvents",value:function(){document.addEventListener("keydown",this._handlers.keydown)}},{key:"_detachDomEvents",value:function(){document.removeEventListener("keydown",this._handlers.keydown)}},{key:"_onKeyDown",value:function(t){var e=this._graphics.getActiveObject(),n=this._graphics.getActiveGroupObject(),r=e||n;(t.ctrlKey||t.metaKey)&&t.keyCode===C.Z&&this.undo().catch((function(){})),(t.ctrlKey||t.metaKey)&&t.keyCode===C.Y&&this.redo().catch((function(){})),t.keyCode!==C.BACKSPACE&&t.keyCode!==C.DEL||!r||(t.preventDefault(),this.removeActiveObject())}},{key:"removeActiveObject",value:function(){var t=this._graphics.getActiveObject(),e=this._graphics.getActiveGroupObject();if(e){var n=e.getObjects();this.discardSelection(),this._removeObjectStream(n)}else if(t){var r=this._graphics.getObjectId(t);this.removeObject(r)}}},{key:"_removeObjectStream",value:function(t){var e=this;if(!t.length)return!0;var n=t.pop();return this.removeObject(this._graphics.getObjectId(n)).then((function(){return e._removeObjectStream(t)}))}},{key:"_onMouseDown",value:function(t,e){this.fire(x.MOUSE_DOWN,t,e)}},{key:"_pushAddObjectCommand",value:function(t){var e=d.default.create(w.ADD_OBJECT,this._graphics,t);this._invoker.pushUndoStack(e)}},{key:"_onObjectActivated",value:function(t){this.fire(x.OBJECT_ACTIVATED,t)}},{key:"_onObjectMoved",value:function(t){this.fire(x.OBJECT_MOVED,t)}},{key:"_onObjectScaled",value:function(t){this.fire(x.OBJECT_SCALED,t)}},{key:"getDrawingMode",value:function(){return this._graphics.getDrawingMode()}},{key:"clearObjects",value:function(){return this.execute(w.CLEAR_OBJECTS)}},{key:"deactivateAll",value:function(){this._graphics.deactivateAll(),this._graphics.renderAll()}},{key:"discardSelection",value:function(){this._graphics.discardSelection()}},{key:"changeSelectableAll",value:function(t){this._graphics.changeSelectableAll(t)}},{key:"execute",value:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var c=[this._graphics].concat(r);return(e=this._invoker).execute.apply(e,[t].concat(c))}},{key:"undo",value:function(){return this._invoker.undo()}},{key:"redo",value:function(){return this._invoker.redo()}},{key:"loadImageFromFile",value:function(t,e){if(!t)return c.default.reject(S.invalidParameters);var n=URL.createObjectURL(t);return e=e||t.name,this.loadImageFromURL(n,e).then((function(e){return URL.revokeObjectURL(t),e}))}},{key:"loadImageFromURL",value:function(t,e){return e&&t?this.execute(w.LOAD_IMAGE,e,t):c.default.reject(S.invalidParameters)}},{key:"addImageObject",value:function(t){return t?this.execute(w.ADD_IMAGE_OBJECT,t):c.default.reject(S.invalidParameters)}},{key:"startDrawingMode",value:function(t,option){return this._graphics.startDrawingMode(t,option)}},{key:"stopDrawingMode",value:function(){this._graphics.stopDrawingMode()}},{key:"crop",value:function(rect){var data=this._graphics.getCroppedImageData(rect);return data?this.loadImageFromURL(data.url,data.imageName):c.default.reject(S.invalidParameters)}},{key:"getCropzoneRect",value:function(){return this._graphics.getCropzoneRect()}},{key:"setCropzoneRect",value:function(t){this._graphics.setCropzoneRect(t)}},{key:"_flip",value:function(t){return this.execute(w.FLIP_IMAGE,t)}},{key:"flipX",value:function(){return this._flip("flipX")}},{key:"flipY",value:function(){return this._flip("flipY")}},{key:"resetFlip",value:function(){return this._flip("reset")}},{key:"_rotate",value:function(t,e){return this.execute(w.ROTATE_IMAGE,t,e)}},{key:"rotate",value:function(t){return this._rotate("rotate",t)}},{key:"setAngle",value:function(t){return this._rotate("setAngle",t)}},{key:"setBrush",value:function(option){this._graphics.setBrush(option)}},{key:"setDrawingShape",value:function(t,e){this._graphics.setDrawingShape(t,e)}},{key:"addShape",value:function(t,e){return e=e||{},this._setPositions(e),this.execute(w.ADD_SHAPE,t,e)}},{key:"changeShape",value:function(t,e){return this.execute(w.CHANGE_SHAPE,t,e)}},{key:"addText",value:function(text,t){return text=text||"",t=t||{},this.execute(w.ADD_TEXT,text,t)}},{key:"changeText",value:function(t,text){return text=text||"",this.execute(w.CHANGE_TEXT,t,text)}},{key:"changeTextStyle",value:function(t,e){return this.execute(w.CHANGE_TEXT_STYLE,t,e)}},{key:"_changeActivateMode",value:function(t){"ICON"!==t&&this.getDrawingMode()!==t&&this.startDrawingMode(t)}},{key:"_onTextChanged",value:function(t){this.changeText(t.id,t.text)}},{key:"_onIconCreateResize",value:function(t){this.fire(x.ICON_CREATE_RESIZE,t)}},{key:"_onIconCreateEnd",value:function(t){this.fire(x.ICON_CREATE_END,t)}},{key:"_onTextEditing",value:function(){this.fire(x.TEXT_EDITING)}},{key:"_onAddText",value:function(t){this.fire(x.ADD_TEXT,{originPosition:t.originPosition,clientPosition:t.clientPosition})}},{key:"_onAddObject",value:function(t){var e=this._graphics.getObject(t.id);this._pushAddObjectCommand(e)}},{key:"_onAddObjectAfter",value:function(t){this.fire(x.ADD_OBJECT_AFTER,t)}},{key:"_selectionCleared",value:function(){this.fire(x.SELECTION_CLEARED)}},{key:"_selectionCreated",value:function(t){this.fire(x.SELECTION_CREATED,t)}},{key:"registerIcons",value:function(t){this._graphics.registerPaths(t)}},{key:"changeCursor",value:function(t){this._graphics.changeCursor(t)}},{key:"addIcon",value:function(t,e){return e=e||{},this._setPositions(e),this.execute(w.ADD_ICON,t,e)}},{key:"changeIconColor",value:function(t,e){return this.execute(w.CHANGE_ICON_COLOR,t,e)}},{key:"removeObject",value:function(t){return this.execute(w.REMOVE_OBJECT,t)}},{key:"hasFilter",value:function(t){return this._graphics.hasFilter(t)}},{key:"removeFilter",value:function(t){return this.execute(w.REMOVE_FILTER,t)}},{key:"applyFilter",value:function(t,e){return this.execute(w.APPLY_FILTER,t,e)}},{key:"toDataURL",value:function(t){return this._graphics.toDataURL(t)}},{key:"getImageName",value:function(){return this._graphics.getImageName()}},{key:"clearUndoStack",value:function(){this._invoker.clearUndoStack()}},{key:"clearRedoStack",value:function(){this._invoker.clearRedoStack()}},{key:"isEmptyUndoStack",value:function(){return this._invoker.isEmptyUndoStack()}},{key:"isEmptyRedoStack",value:function(){return this._invoker.isEmptyRedoStack()}},{key:"resizeCanvasDimension",value:function(t){return t?this.execute(w.RESIZE_CANVAS_DIMENSION,t):c.default.reject(S.invalidParameters)}},{key:"destroy",value:function(){var t=this;this.stopDrawingMode(),this._detachDomEvents(),this._graphics.destroy(),this._graphics=null,O(this,(function(e,n){t[n]=null}),this)}},{key:"_setPositions",value:function(t){var e=this._graphics.getCenter();k(t.left)&&(t.left=e.left),k(t.top)&&(t.top=e.top)}},{key:"setObjectProperties",value:function(t,e){return this.execute(w.SET_OBJECT_PROPERTIES,t,e)}},{key:"setObjectPropertiesQuietly",value:function(t,e){this._graphics.setObjectProperties(t,e)}},{key:"getObjectProperties",value:function(t,e){return this._graphics.getObject(t)?this._graphics.getObjectProperties(t,e):null}},{key:"getCanvasSize",value:function(){return this._graphics.getCanvasSize()}},{key:"getObjectPosition",value:function(t,e,n){return this._graphics.getObjectPosition(t,e,n)}},{key:"setObjectPosition",value:function(t,e){return this.execute(w.SET_OBJECT_POSITION,t,e)}}]),t}();f.default.mixin(T),E.mixin(T),t.exports=T},function(e,n){e.exports=t},function(t,e,n){n(5),n(6),n(50),n(54),t.exports=n(14).Promise},function(t,e){},function(t,e,n){"use strict";var r=n(7)(!0);n(10)(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=r(e,n),this._i+=t.length,{value:t,done:!1})}))},function(t,e,n){var r=n(8),o=n(9);t.exports=function(t){return function(e,n){var a,b,s=String(o(e)),i=r(n),c=s.length;return i<0||i>=c?t?"":void 0:(a=s.charCodeAt(i))<55296||a>56319||i+1===c||(b=s.charCodeAt(i+1))<56320||b>57343?t?s.charAt(i):a:t?s.slice(i,i+2):b-56320+(a-55296<<10)+65536}}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){"use strict";var r=n(11),o=n(12),c=n(27),l=n(17),h=n(28),f=n(29),d=n(30),v=n(46),m=n(48),y=n(47)("iterator"),_=!([].keys&&"next"in[].keys()),x=function(){return this};t.exports=function(t,e,n,w,C,S,k){d(n,e,w);var O,E,T,j=function(t){if(!_&&t in I)return I[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},M=e+" Iterator",P="values"==C,A=!1,I=t.prototype,D=I[y]||I["@@iterator"]||C&&I[C],L=D||j(C),R=C?P?j("entries"):L:void 0,B="Array"==e&&I.entries||D;if(B&&(T=m(B.call(new t)))!==Object.prototype&&(v(T,M,!0),r||h(T,y)||l(T,y,x)),P&&D&&"values"!==D.name&&(A=!0,L=function(){return D.call(this)}),r&&!k||!_&&!A&&I[y]||l(I,y,L),f[e]=L,f[M]=x,C)if(O={values:P?L:j("values"),keys:S?L:j("keys"),entries:R},k)for(E in O)E in I||c(I,E,O[E]);else o(o.P+o.F*(_||A),e,O);return O}},function(t,e){t.exports=!0},function(t,e,n){var r=n(13),o=n(14),c=n(15),l=n(17),h=function(t,e,source){var n,f,d,v=t&h.F,m=t&h.G,y=t&h.S,_=t&h.P,x=t&h.B,w=t&h.W,C=m?o:o[e]||(o[e]={}),S=C.prototype,k=m?r:y?r[e]:(r[e]||{}).prototype;for(n in m&&(source=e),source)(f=!v&&k&&void 0!==k[n])&&n in C||(d=f?k[n]:source[n],C[n]=m&&"function"!=typeof k[n]?source[n]:x&&f?c(d,r):w&&k[n]==d?function(t){var e=function(a,b,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,b)}return new t(a,b,e)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(d):_&&"function"==typeof d?c(Function.call,d):d,_&&((C.virtual||(C.virtual={}))[n]=d,t&h.R&&S&&!S[n]&&l(S,n,d)))};h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){var n=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(t,e,n){var r=n(16);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(a){return t.call(e,a)};case 2:return function(a,b){return t.call(e,a,b)};case 3:return function(a,b,n){return t.call(e,a,b,n)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var r=n(18),o=n(26);t.exports=n(22)?function(object,t,e){return r.f(object,t,o(1,e))}:function(object,t,e){return object[t]=e,object}},function(t,e,n){var r=n(19),o=n(21),c=n(25),l=Object.defineProperty;e.f=n(22)?Object.defineProperty:function(t,e,n){if(r(t),e=c(e,!0),r(n),o)try{return l(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var r=n(20);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){t.exports=!n(22)&&!n(23)((function(){return 7!=Object.defineProperty(n(24)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){t.exports=!n(23)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var r=n(20),o=n(13).document,c=r(o)&&r(o.createElement);t.exports=function(t){return c?o.createElement(t):{}}},function(t,e,n){var r=n(20);t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){t.exports=n(17)},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e){t.exports={}},function(t,e,n){"use strict";var r=n(31),o=n(26),c=n(46),l={};n(17)(l,n(47)("iterator"),(function(){return this})),t.exports=function(t,e,n){t.prototype=r(l,{next:o(1,n)}),c(t,e+" Iterator")}},function(t,e,n){var r=n(19),o=n(32),c=n(44),l=n(41)("IE_PROTO"),h=function(){},f=function(){var t,iframe=n(24)("iframe"),i=c.length;for(iframe.style.display="none",n(45).appendChild(iframe),iframe.src="javascript:",(t=iframe.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),f=t.F;i--;)delete f.prototype[c[i]];return f()};t.exports=Object.create||function(t,e){var n;return null!==t?(h.prototype=r(t),n=new h,h.prototype=null,n[l]=t):n=f(),void 0===e?n:o(n,e)}},function(t,e,n){var r=n(18),o=n(19),c=n(33);t.exports=n(22)?Object.defineProperties:function(t,e){o(t);for(var n,l=c(e),h=l.length,i=0;h>i;)r.f(t,n=l[i++],e[n]);return t}},function(t,e,n){var r=n(34),o=n(44);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e,n){var r=n(28),o=n(35),c=n(38)(!1),l=n(41)("IE_PROTO");t.exports=function(object,t){var e,n=o(object),i=0,h=[];for(e in n)e!=l&&r(n,e)&&h.push(e);for(;t.length>i;)r(n,e=t[i++])&&(~c(h,e)||h.push(e));return h}},function(t,e,n){var r=n(36),o=n(9);t.exports=function(t){return r(o(t))}},function(t,e,n){var r=n(37);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var r=n(35),o=n(39),c=n(40);t.exports=function(t){return function(e,n,l){var h,f=r(e),d=o(f.length),v=c(l,d);if(t&&n!=n){for(;d>v;)if((h=f[v++])!=h)return!0}else for(;d>v;v++)if((t||v in f)&&f[v]===n)return t||v||0;return!t&&-1}}},function(t,e,n){var r=n(8),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,n){var r=n(8),o=Math.max,c=Math.min;t.exports=function(t,e){return(t=r(t))<0?o(t+e,0):c(t,e)}},function(t,e,n){var r=n(42)("keys"),o=n(43);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,e,n){var r=n(13),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){t.exports=n(13).document&&document.documentElement},function(t,e,n){var r=n(18).f,o=n(28),c=n(47)("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,c)&&r(t,c,{configurable:!0,value:e})}},function(t,e,n){var r=n(42)("wks"),o=n(43),c=n(13).Symbol,l="function"==typeof c;(t.exports=function(t){return r[t]||(r[t]=l&&c[t]||(l?c:o)("Symbol."+t))}).store=r},function(t,e,n){var r=n(28),o=n(49),c=n(41)("IE_PROTO"),l=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,c)?t[c]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?l:null}},function(t,e,n){var r=n(9);t.exports=function(t){return Object(r(t))}},function(t,e,n){n(51);for(var r=n(13),o=n(17),c=n(29),l=n(47)("toStringTag"),h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var f=h[i],d=r[f],v=d&&d.prototype;v&&!v[l]&&o(v,l,f),c[f]=c.Array}},function(t,e,n){"use strict";var r=n(52),o=n(53),c=n(29),l=n(35);t.exports=n(10)(Array,"Array",(function(t,e){this._t=l(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):o(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])}),"values"),c.Arguments=c.Array,r("keys"),r("values"),r("entries")},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){"use strict";var r,o,c,l=n(11),h=n(13),f=n(15),d=n(55),v=n(12),m=n(20),y=n(16),_=n(56),x=n(57),w=n(61),C=n(62).set,S=n(64)(),k=h.TypeError,O=h.process,E=h.Promise,T="process"==d(O=h.process),j=function(){},M=!!function(){try{var t=E.resolve(1),e=(t.constructor={})[n(47)("species")]=function(t){t(j,j)};return(T||"function"==typeof PromiseRejectionEvent)&&t.then(j)instanceof e}catch(t){}}(),P=function(a,b){return a===b||a===E&&b===c},A=function(t){var e;return!(!m(t)||"function"!=typeof(e=t.then))&&e},I=function(t){return P(E,t)?new D(t):new o(t)},D=o=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw k("Bad Promise constructor");e=t,n=r})),this.resolve=y(e),this.reject=y(n)},L=function(t){try{t()}catch(t){return{error:t}}},R=function(t,e){if(!t._n){t._n=!0;var n=t._c;S((function(){for(var r=t._v,o=1==t._s,i=0,c=function(e){var n,c,l=o?e.ok:e.fail,h=e.resolve,f=e.reject,d=e.domain;try{l?(o||(2==t._h&&N(t),t._h=1),!0===l?n=r:(d&&d.enter(),n=l(r),d&&d.exit()),n===e.promise?f(k("Promise-chain cycle")):(c=A(n))?c.call(n,h,f):h(n)):f(r)}catch(t){f(t)}};n.length>i;)c(n[i++]);t._c=[],t._n=!1,e&&!t._h&&B(t)}))}},B=function(t){C.call(h,(function(){var e,n,r,o=t._v;if(F(t)&&(e=L((function(){T?O.emit("unhandledRejection",o,t):(n=h.onunhandledrejection)?n({promise:t,reason:o}):(r=h.console)&&r.error&&r.error("Unhandled promise rejection",o)})),t._h=T||F(t)?2:1),t._a=void 0,e)throw e.error}))},F=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,i=0;n.length>i;)if((e=n[i++]).fail||!F(e.promise))return!1;return!0},N=function(t){C.call(h,(function(){var e;T?O.emit("rejectionHandled",t):(e=h.onrejectionhandled)&&e({promise:t,reason:t._v})}))},z=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),R(e,!0))},X=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw k("Promise can't be resolved itself");(e=A(t))?S((function(){var r={_w:n,_d:!1};try{e.call(t,f(X,r,1),f(z,r,1))}catch(t){z.call(r,t)}})):(n._v=t,n._s=1,R(n,!1))}catch(t){z.call({_w:n,_d:!1},t)}}};M||(E=function(t){_(this,E,"Promise","_h"),y(t),r.call(this);try{t(f(X,this,1),f(z,this,1))}catch(t){z.call(this,t)}},(r=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(65)(E.prototype,{then:function(t,e){var n=I(w(this,E));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=T?O.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&R(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),D=function(){var t=new r;this.promise=t,this.resolve=f(X,t,1),this.reject=f(z,t,1)}),v(v.G+v.W+v.F*!M,{Promise:E}),n(46)(E,"Promise"),n(66)("Promise"),c=n(14).Promise,v(v.S+v.F*!M,"Promise",{reject:function(t){var e=I(this);return(0,e.reject)(t),e.promise}}),v(v.S+v.F*(l||!M),"Promise",{resolve:function(t){if(t instanceof E&&P(t.constructor,this))return t;var e=I(this);return(0,e.resolve)(t),e.promise}}),v(v.S+v.F*!(M&&n(67)((function(t){E.all(t).catch(j)}))),"Promise",{all:function(t){var e=this,n=I(e),r=n.resolve,o=n.reject,c=L((function(){var n=[],c=0,l=1;x(t,!1,(function(t){var h=c++,f=!1;n.push(void 0),l++,e.resolve(t).then((function(t){f||(f=!0,n[h]=t,--l||r(n))}),o)})),--l||r(n)}));return c&&o(c.error),n.promise},race:function(t){var e=this,n=I(e),r=n.reject,o=L((function(){x(t,!1,(function(t){e.resolve(t).then(n.resolve,r)}))}));return o&&r(o.error),n.promise}})},function(t,e,n){var r=n(37),o=n(47)("toStringTag"),c="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,n,l;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?n:c?r(e):"Object"==(l=r(e))&&"function"==typeof e.callee?"Arguments":l}},function(t,e){t.exports=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,e,n){var r=n(15),o=n(58),c=n(59),l=n(19),h=n(39),f=n(60),d={},v={};(e=t.exports=function(t,e,n,m,y){var _,x,w,C,S=y?function(){return t}:f(t),k=r(n,m,e?2:1),O=0;if("function"!=typeof S)throw TypeError(t+" is not iterable!");if(c(S)){for(_=h(t.length);_>O;O++)if((C=e?k(l(x=t[O])[0],x[1]):k(t[O]))===d||C===v)return C}else for(w=S.call(t);!(x=w.next()).done;)if((C=o(w,k,x.value,e))===d||C===v)return C}).BREAK=d,e.RETURN=v},function(t,e,n){var r=n(19);t.exports=function(t,e,n,o){try{return o?e(r(n)[0],n[1]):e(n)}catch(e){var c=t.return;throw void 0!==c&&r(c.call(t)),e}}},function(t,e,n){var r=n(29),o=n(47)("iterator"),c=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||c[o]===t)}},function(t,e,n){var r=n(55),o=n(47)("iterator"),c=n(29);t.exports=n(14).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||c[r(t)]}},function(t,e,n){var r=n(19),o=n(16),c=n(47)("species");t.exports=function(t,e){var n,l=r(t).constructor;return void 0===l||null==(n=r(l)[c])?e:o(n)}},function(t,e,n){var r,o,c,l=n(15),h=n(63),html=n(45),f=n(24),d=n(13),v=d.process,m=d.setImmediate,y=d.clearImmediate,_=d.MessageChannel,x=0,w={},C=function(){var t=+this;if(w.hasOwnProperty(t)){var e=w[t];delete w[t],e()}},S=function(t){C.call(t.data)};m&&y||(m=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return w[++x]=function(){h("function"==typeof t?t:Function(t),e)},r(x),x},y=function(t){delete w[t]},"process"==n(37)(v)?r=function(t){v.nextTick(l(C,t,1))}:_?(c=(o=new _).port2,o.port1.onmessage=S,r=l(c.postMessage,c,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(r=function(t){d.postMessage(t+"","*")},d.addEventListener("message",S,!1)):r="onreadystatechange"in f("script")?function(t){html.appendChild(f("script")).onreadystatechange=function(){html.removeChild(this),C.call(t)}}:function(t){setTimeout(l(C,t,1),0)}),t.exports={set:m,clear:y}},function(t,e){t.exports=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},function(t,e,n){var r=n(13),o=n(62).set,c=r.MutationObserver||r.WebKitMutationObserver,l=r.process,h=r.Promise,f="process"==n(37)(l);t.exports=function(){var head,t,e,n=function(){var n,r;for(f&&(n=l.domain)&&n.exit();head;){r=head.fn,head=head.next;try{r()}catch(n){throw head?e():t=void 0,n}}t=void 0,n&&n.enter()};if(f)e=function(){l.nextTick(n)};else if(c){var d=!0,v=document.createTextNode("");new c(n).observe(v,{characterData:!0}),e=function(){v.data=d=!d}}else if(h&&h.resolve){var m=h.resolve();e=function(){m.then(n)}}else e=function(){o.call(r,n)};return function(n){var r={fn:n,next:void 0};t&&(t.next=r),head||(head=r,e()),t=r}}},function(t,e,n){var r=n(17);t.exports=function(t,e,n){for(var o in e)n&&t[o]?t[o]=e[o]:r(t,o,e[o]);return t}},function(t,e,n){"use strict";var r=n(13),o=n(14),c=n(18),l=n(22),h=n(47)("species");t.exports=function(t){var e="function"==typeof o[t]?o[t]:r[t];l&&e&&!e[h]&&c.f(e,h,{configurable:!0,get:function(){return this}})}},function(t,e,n){var r=n(47)("iterator"),o=!1;try{var c=[7][r]();c.return=function(){o=!0},Array.from(c,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var n=!1;try{var c=[7],l=c[r]();l.next=function(){return{done:n=!0}},c[r]=function(){return l},t(c)}catch(t){}return n}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=f(n(3)),c=f(n(4)),l=f(n(69)),h=f(n(73));function f(t){return t&&t.__esModule?t:{default:t}}var d=h.default.eventNames,v=h.default.rejectMessages,m=o.default.isFunction,y=o.default.isString,_=o.default.CustomEvents,x=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._undoStack=[],this._redoStack=[],this._isLocked=!1}return r(t,[{key:"_invokeExecution",value:function(t){var e=this;this.lock();var n=t.args;return n||(n=[]),t.execute.apply(t,n).then((function(n){return e.pushUndoStack(t),e.unlock(),m(t.executeCallback)&&t.executeCallback(n),n})).catch((function(t){return e.unlock(),c.default.reject(t)}))}},{key:"_invokeUndo",value:function(t){var e=this;this.lock();var n=t.args;return n||(n=[]),t.undo.apply(t,n).then((function(n){return e.pushRedoStack(t),e.unlock(),m(t.undoCallback)&&t.undoCallback(n),n})).catch((function(t){return e.unlock(),c.default.reject(t)}))}},{key:"_fireRedoStackChanged",value:function(){this.fire(d.REDO_STACK_CHANGED,this._redoStack.length)}},{key:"_fireUndoStackChanged",value:function(){this.fire(d.UNDO_STACK_CHANGED,this._undoStack.length)}},{key:"lock",value:function(){this._isLocked=!0}},{key:"unlock",value:function(){this._isLocked=!1}},{key:"execute",value:function(){var t=this;if(this._isLocked)return c.default.reject(v.isLock);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=n[0];return y(o)&&(o=l.default.create.apply(l.default,n)),this._invokeExecution(o).then((function(e){return t.clearRedoStack(),e}))}},{key:"undo",value:function(){var t=this._undoStack.pop(),e=void 0,n="";return t&&this._isLocked&&(this.pushUndoStack(t,!0),t=null),t?(this.isEmptyUndoStack()&&this._fireUndoStackChanged(),e=this._invokeUndo(t)):(n=v.undo,this._isLocked&&(n=n+" Because "+v.isLock),e=c.default.reject(n)),e}},{key:"redo",value:function(){var t=this._redoStack.pop(),e=void 0,n="";return t&&this._isLocked&&(this.pushRedoStack(t,!0),t=null),t?(this.isEmptyRedoStack()&&this._fireRedoStackChanged(),e=this._invokeExecution(t)):(n=v.redo,this._isLocked&&(n=n+" Because "+v.isLock),e=c.default.reject(n)),e}},{key:"pushUndoStack",value:function(t,e){this._undoStack.push(t),e||this._fireUndoStackChanged()}},{key:"pushRedoStack",value:function(t,e){this._redoStack.push(t),e||this._fireRedoStackChanged()}},{key:"isEmptyRedoStack",value:function(){return 0===this._redoStack.length}},{key:"isEmptyUndoStack",value:function(){return 0===this._undoStack.length}},{key:"clearUndoStack",value:function(){this.isEmptyUndoStack()||(this._undoStack=[],this._fireUndoStackChanged())}},{key:"clearRedoStack",value:function(){this.isEmptyRedoStack()||(this._redoStack=[],this._fireRedoStackChanged())}}]),t}();_.mixin(x),t.exports=x},function(t,e,n){"use strict";var r,o=n(70),c=(r=o)&&r.__esModule?r:{default:r},l={};t.exports={create:function(t){var e=l[t];if(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new c.default(e,r)}return null},register:function(t){l[t.name]=t}}},function(t,e,n){"use strict";var r,o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(71),l=(r=c)&&r.__esModule?r:{default:r},h=l.default.create,f=l.default.types,d=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e.name,this.args=n,this.execute=e.execute,this.undo=e.undo,this.executeCallback=e.executeCallback||null,this.undoCallback=e.undoCallback||null,this.undoData={}}return o(t,[{key:"execute",value:function(){throw new Error(h(f.UN_IMPLEMENTATION,"execute"))}},{key:"undo",value:function(){throw new Error(h(f.UN_IMPLEMENTATION,"undo"))}},{key:"setExecuteCallback",value:function(t){return this.executeCallback=t,this}},{key:"setUndoCallback",value:function(t){return this.undoCallback=t,this}}]),t}();t.exports=d},function(t,e,n){"use strict";var r,o=n(3),c=(r=o)&&r.__esModule?r:{default:r},l=(0,n(72).keyMirror)("UN_IMPLEMENTATION","NO_COMPONENT_NAME"),h="Should implement a method: ",f="Should set a component name",map={UN_IMPLEMENTATION:function(t){return h+t},NO_COMPONENT_NAME:function(){return f}};t.exports={types:c.default.extend({},l),create:function(t){t=t.toLowerCase();for(var e=map[t],n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return e.apply(void 0,r)}}},function(t,e,n){"use strict";var r=n(3),o=Math.min,c=Math.max,l=!1;t.exports={clamp:function(t,e,n){var r=void 0;return e>n&&(r=e,e=n,n=r),c(e,o(t,n))},keyMirror:function(){for(var t={},e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return(0,r.forEach)(n,(function(e){t[e]=e})),t},makeStyleText:function(t){var e="";return(0,r.forEach)(t,(function(t,n){e+=n+": "+t+";"})),e},getProperties:function(t,e){var n={},r=e.length,i=0,o=void 0;for(i=0;i<r;i+=1)n[o=e[i]]=t[o];return n},toInteger:function(t){return parseInt(t,10)},toCamelCase:function(t){return t.replace(/-([a-z])/g,(function(t,e){return e.toUpperCase()}))},isSupportFileApi:function(){return!!(window.File&&window.FileList&&window.FileReader)},getRgb:function(t,e){return 4===t.length&&(t=""+t+t.slice(1,4)),"rgba("+parseInt(t.slice(1,3),16)+", "+parseInt(t.slice(3,5),16)+", "+parseInt(t.slice(5,7),16)+", "+(e||1)+")"},sendHostName:function(){l||(l=!0,(0,r.sendHostname)("image-editor","UA-129999381-1"))},styleLoad:function(t,e){var head=document.getElementsByTagName("head")[0],n=document.createElement("link"),r=encodeURIComponent(t);e&&(n.id=e),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","data:text/css;charset=UTF-8,"+r),head.appendChild(n)},getSelector:function(t){return function(e){return t.querySelector(e)}},base64ToBlob:function(data){var t="",e=void 0,n=void 0,i=void 0;e=data.replace(/data:(image\/.+);base64,/,(function(header,e){return t=e,""}));var r=(e=atob(e)).length;for(n=new Uint8Array(r),i=0;i<r;i+=1)n[i]=e.charCodeAt(i);return new Blob([n],{type:t})}}},function(t,e,n){"use strict";var r,o=n(72),c=(r=o)&&r.__esModule?r:{default:r};t.exports={componentNames:c.default.keyMirror("IMAGE_LOADER","CROPPER","FLIP","ROTATION","FREE_DRAWING","LINE","TEXT","ICON","FILTER","SHAPE"),commandNames:{CLEAR_OBJECTS:"clearObjects",LOAD_IMAGE:"loadImage",FLIP_IMAGE:"flip",ROTATE_IMAGE:"rotate",ADD_OBJECT:"addObject",REMOVE_OBJECT:"removeObject",APPLY_FILTER:"applyFilter",REMOVE_FILTER:"removeFilter",ADD_ICON:"addIcon",CHANGE_ICON_COLOR:"changeIconColor",ADD_SHAPE:"addShape",CHANGE_SHAPE:"changeShape",ADD_TEXT:"addText",CHANGE_TEXT:"changeText",CHANGE_TEXT_STYLE:"changeTextStyle",ADD_IMAGE_OBJECT:"addImageObject",RESIZE_CANVAS_DIMENSION:"resizeCanvasDimension",SET_OBJECT_PROPERTIES:"setObjectProperties",SET_OBJECT_POSITION:"setObjectPosition"},eventNames:{OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated"},drawingModes:c.default.keyMirror("NORMAL","CROPPER","FREE_DRAWING","LINE_DRAWING","TEXT","SHAPE"),keyCodes:{Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},fObjectOptions:{SELECTION_STYLE:{borderColor:"red",cornerColor:"green",cornerSize:10,originX:"center",originY:"center",transparentCorners:!1}},rejectMessages:{flip:"The flipX and flipY setting values are not changed.",rotation:"The current angle is same the old angle.",loadImage:"The background image is empty.",isLock:"The executing command state is locked.",undo:"The promise of undo command is reject.",redo:"The promise of redo command is reject.",invalidDrawingMode:"This operation is not supported in the drawing mode",invalidParameters:"Invalid parameters",noActiveObject:"There is no active object.",unsupportedType:"Unsupported object type",noObject:"The object is not in canvas.",addedObject:"The object is already added."},defaultIconPath:{"icon-arrow":"M40 12V0l24 24-24 24V36H0V12h40z","icon-arrow-2":"M49,32 H3 V22 h46 l-18,-18 h12 l23,23 L43,50 h-12 l18,-18  z ","icon-arrow-3":"M43.349998,27 L17.354,53 H1.949999 l25.996,-26 L1.949999,1 h15.404 L43.349998,27  z ","icon-star":"M35,54.557999 l-19.912001,10.468 l3.804,-22.172001 l-16.108,-15.7 l22.26,-3.236 L35,3.746 l9.956,20.172001 l22.26,3.236 l-16.108,15.7 l3.804,22.172001  z ","icon-star-2":"M17,31.212 l-7.194,4.08 l-4.728,-6.83 l-8.234,0.524 l-1.328,-8.226 l-7.644,-3.14 l2.338,-7.992 l-5.54,-6.18 l5.54,-6.176 l-2.338,-7.994 l7.644,-3.138 l1.328,-8.226 l8.234,0.522 l4.728,-6.83 L17,-24.312 l7.194,-4.08 l4.728,6.83 l8.234,-0.522 l1.328,8.226 l7.644,3.14 l-2.338,7.992 l5.54,6.178 l-5.54,6.178 l2.338,7.992 l-7.644,3.14 l-1.328,8.226 l-8.234,-0.524 l-4.728,6.83  z ","icon-polygon":"M3,31 L19,3 h32 l16,28 l-16,28 H19  z ","icon-location":"M24 62C8 45.503 0 32.837 0 24 0 10.745 10.745 0 24 0s24 10.745 24 24c0 8.837-8 21.503-24 38zm0-28c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z","icon-heart":"M49.994999,91.349998 l-6.96,-6.333 C18.324001,62.606995 2.01,47.829002 2.01,29.690998 C2.01,14.912998 13.619999,3.299999 28.401001,3.299999 c8.349,0 16.362,5.859 21.594,12 c5.229,-6.141 13.242001,-12 21.591,-12 c14.778,0 26.390999,11.61 26.390999,26.390999 c0,18.138 -16.314001,32.916 -41.025002,55.374001 l-6.96,6.285  z ","icon-bubble":"M44 48L34 58V48H12C5.373 48 0 42.627 0 36V12C0 5.373 5.373 0 12 0h40c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12h-8z"},defaultRotateRangeValus:{realTimeEvent:!0,min:-360,max:360,value:0},defaultDrawRangeValus:{min:5,max:30,value:12},defaultShapeStrokeValus:{realTimeEvent:!1,min:2,max:300,value:3},defaultTextRangeValus:{realTimeEvent:!0,min:10,max:100,value:50},defaultFilterRangeValus:{tintOpacityRange:{min:0,max:1,value:.7},removewhiteThresholdRange:{min:0,max:255,value:60},removewhiteDistanceRange:{min:0,max:255,value:10},gradientTransparencyRange:{min:0,max:255,value:100},brightnessRange:{min:-255,max:255,value:100},noiseRange:{min:0,max:1e3,value:100},pixelateRange:{min:2,max:20,value:4},colorfilterThresholeRange:{min:0,max:255,value:45}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=O(n(3)),c=O(n(72)),l=O(n(75)),h=O(n(76)),f=O(n(77)),d=O(n(80)),v=O(n(86)),m=O(n(88)),y=O(n(90)),_=O(n(92)),x=O(n(94)),w=O(n(96)),C=O(n(98)),S=O(n(100)),k=O(n(102));function O(t){return t&&t.__esModule?t:{default:t}}var E={Shape:d.default,Crop:v.default,Flip:m.default,Rotate:y.default,Text:_.default,Mask:x.default,Icon:w.default,Draw:C.default,Filter:S.default},T=function(){function t(element,e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=this._initializeOption(e),this._actions=n,this.submenu=!1,this.imageSize={},this.uiSize={},this._locale=new k.default(this.options.locale),this.theme=new f.default(this.options.theme),this._submenuChangeTransection=!1,this._selectedElement=null,this._mainElement=null,this._editorElementWrap=null,this._editorElement=null,this._menuElement=null,this._subMenuElement=null,this._makeUiElement(element),this._setUiSize(),this._initMenuEvent=!1,this._els={undo:this._menuElement.querySelector("#tie-btn-undo"),redo:this._menuElement.querySelector("#tie-btn-redo"),reset:this._menuElement.querySelector("#tie-btn-reset"),delete:this._menuElement.querySelector("#tie-btn-delete"),deleteAll:this._menuElement.querySelector("#tie-btn-delete-all"),download:this._selectedElement.querySelectorAll(".tui-image-editor-download-btn"),load:this._selectedElement.querySelectorAll(".tui-image-editor-load-btn")},this._makeSubMenu()}return r(t,[{key:"setUiDefaultSelectionStyle",value:function(option){return o.default.extend({applyCropSelectionStyle:!0,applyGroupSelectionStyle:!0,selectionStyle:{cornerStyle:"circle",cornerSize:16,cornerColor:"#fff",cornerStrokeColor:"#fff",transparentCorners:!1,lineWidth:2,borderColor:"#fff"}},option)}},{key:"resizeEditor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.uiSize,n=t.imageSize,r=void 0===n?this.imageSize:n;r!==this.imageSize&&(this.imageSize=r),e&&this._setUiSize(e);var o=this._getEditorDimension(),c=o.width,l=o.height,h=this._editorElement.style,f=this.options.menuBarPosition;h.height=l+"px",h.width=c+"px",this._setEditorPosition(f),this._editorElementWrap.style.bottom="0px",this._editorElementWrap.style.top="0px",this._editorElementWrap.style.left="0px",this._editorElementWrap.style.width="100%";var d=this._selectedElement.classList;"top"===f&&this._selectedElement.offsetWidth<"1300"?d.add("tui-image-editor-top-optimization"):d.remove("tui-image-editor-top-optimization")}},{key:"changeUndoButtonStatus",value:function(t){t?this._els.undo.classList.add("enabled"):this._els.undo.classList.remove("enabled")}},{key:"changeRedoButtonStatus",value:function(t){t?this._els.redo.classList.add("enabled"):this._els.redo.classList.remove("enabled")}},{key:"changeResetButtonStatus",value:function(t){t?this._els.reset.classList.add("enabled"):this._els.reset.classList.remove("enabled")}},{key:"changeDeleteAllButtonEnabled",value:function(t){t?this._els.deleteAll.classList.add("enabled"):this._els.deleteAll.classList.remove("enabled")}},{key:"changeDeleteButtonEnabled",value:function(t){t?this._els.delete.classList.add("enabled"):this._els.delete.classList.remove("enabled")}},{key:"_initializeOption",value:function(t){return o.default.extend({loadImage:{path:"",name:""},locale:{},menuIconPath:"",menu:["crop","flip","rotate","draw","shape","icon","text","mask","filter"],initMenu:!1,uiSize:{width:"100%",height:"100%"},menuBarPosition:"bottom"},t)}},{key:"_setUiSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.uiSize,e=this._selectedElement.style;e.width=t.width,e.height=t.height}},{key:"_makeSubMenu",value:function(){var t=this;o.default.forEach(this.options.menu,(function(e){var n=E[e.replace(/^[a-z]/,(function(t){return t.toUpperCase()}))];t._makeMenuElement(e),t._els[e]=t._menuElement.querySelector("#tie-btn-"+e),t[e]=new n(t._subMenuElement,{locale:t._locale,iconStyle:t.theme.getStyle("submenu.icon"),menuBarPosition:t.options.menuBarPosition})}))}},{key:"_makeUiElement",value:function(element){var t=void 0;window.snippet=o.default,t=element.jquery?element[0]:element.nodeType?element:document.querySelector(element);var e=c.default.getSelector(t);t.classList.add("tui-image-editor-container"),t.innerHTML=(0,h.default)({locale:this._locale,biImage:this.theme.getStyle("common.bi"),iconStyle:this.theme.getStyle("menu.icon"),loadButtonStyle:this.theme.getStyle("loadButton"),downloadButtonStyle:this.theme.getStyle("downloadButton")})+(0,l.default)({locale:this._locale,biImage:this.theme.getStyle("common.bi"),commonStyle:this.theme.getStyle("common"),headerStyle:this.theme.getStyle("header"),loadButtonStyle:this.theme.getStyle("loadButton"),downloadButtonStyle:this.theme.getStyle("downloadButton"),submenuStyle:this.theme.getStyle("submenu")}),this._selectedElement=t,this._selectedElement.classList.add(this.options.menuBarPosition),this._mainElement=e(".tui-image-editor-main"),this._editorElementWrap=e(".tui-image-editor-wrap"),this._editorElement=e(".tui-image-editor"),this._menuElement=e(".tui-image-editor-menu"),this._subMenuElement=e(".tui-image-editor-submenu")}},{key:"_makeMenuElement",value:function(t){var e=document.createElement("li"),n=this.theme.getStyle("menu.icon"),r=n.normal,o=n.active,c=n.hover,l='\n            <svg class="svg_ic-menu">\n                <use xlink:href="'+r.path+"#"+r.name+"-ic-"+t+'" class="normal"/>\n                <use xlink:href="'+o.path+"#"+o.name+"-ic-"+t+'" class="active"/>\n                <use xlink:href="'+c.path+"#"+c.name+"-ic-"+t+'" class="hover"/>\n            </svg>\n        ';e.id="tie-btn-"+t,e.className="tui-image-editor-item normal",e.title=this._locale.localize(t.replace(/^[a-z]/g,(function(t){return t.toUpperCase()}))),e.innerHTML=l,this._menuElement.appendChild(e)}},{key:"_addHelpActionEvent",value:function(t){var e=this;this._els[t].addEventListener("click",(function(){e._actions.main[t]()}))}},{key:"_addDownloadEvent",value:function(){var t=this;o.default.forEach(this._els.download,(function(element){element.addEventListener("click",(function(){t._actions.main.download()}))}))}},{key:"_addLoadEvent",value:function(){var t=this;o.default.forEach(this._els.load,(function(element){element.addEventListener("change",(function(e){t._actions.main.load(e.target.files[0])}))}))}},{key:"_addMenuEvent",value:function(t){var e=this;this._els[t].addEventListener("click",(function(){e.changeMenu(t)}))}},{key:"_addSubMenuEvent",value:function(t){this[t].addEvent(this._actions[t])}},{key:"getEditorArea",value:function(){return this._editorElement}},{key:"activeMenuEvent",value:function(){var t=this;this._initMenuEvent||(this._addHelpActionEvent("undo"),this._addHelpActionEvent("redo"),this._addHelpActionEvent("reset"),this._addHelpActionEvent("delete"),this._addHelpActionEvent("deleteAll"),this._addDownloadEvent(),o.default.forEach(this.options.menu,(function(e){t._addMenuEvent(e),t._addSubMenuEvent(e)})),this._initMenu(),this._initMenuEvent=!0)}},{key:"initCanvas",value:function(){var t=this,e=this._getLoadImage();e.path&&this._actions.main.initLoadImage(e.path,e.name).then((function(){t.activeMenuEvent()})),this._addLoadEvent();var n=document.createElement("div");n.className="tui-image-editor-grid-visual",n.innerHTML='<table>\n           <tr><td class="dot left-top"></td><td></td><td class="dot right-top"></td></tr>\n           <tr><td></td><td></td><td></td></tr>\n           <tr><td class="dot left-bottom"></td><td></td><td class="dot right-bottom"></td></tr>\n         </table>',this._editorContainerElement=this._editorElement.querySelector(".tui-image-editor-canvas-container"),this._editorContainerElement.appendChild(n)}},{key:"_getLoadImage",value:function(){return this.options.loadImage}},{key:"changeMenu",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._submenuChangeTransection||(this._submenuChangeTransection=!0,this._changeMenu(t,e,n),this._submenuChangeTransection=!1)}},{key:"_changeMenu",value:function(t,e,n){this.submenu&&(this._els[this.submenu].classList.remove("active"),this._mainElement.classList.remove("tui-image-editor-menu-"+this.submenu),n&&this._actions.main.discardSelection(),this._actions.main.changeSelectableAll(!0),this[this.submenu].changeStandbyMode()),this.submenu===t&&e?this.submenu=null:(this._els[t].classList.add("active"),this._mainElement.classList.add("tui-image-editor-menu-"+t),this.submenu=t,this[this.submenu].changeStartMode()),this.resizeEditor()}},{key:"_initMenu",value:function(){if(this.options.initMenu){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),this._els[this.options.initMenu].dispatchEvent(t),this.icon&&this.icon.registDefaultIcon()}}},{key:"_getEditorDimension",value:function(){var t=parseFloat(this._editorContainerElement.style.maxHeight),e=this.imageSize.newHeight>t?t:this.imageSize.newHeight,n=parseFloat(this._editorContainerElement.style.maxWidth);return{width:this.imageSize.newWidth>n?n:this.imageSize.newWidth,height:e}}},{key:"_setEditorPosition",value:function(t){var e=this._getEditorDimension(),n=e.width,r=e.height,o=this._editorElement.style,c=0,l=0;this.submenu&&("bottom"===t?c=r>this._editorElementWrap.scrollHeight-150?(r-this._editorElementWrap.scrollHeight)/2:-75:"top"===t?c=r>this._editorElementWrap.offsetHeight-150?75-(r-(this._editorElementWrap.offsetHeight-150))/2:75:"left"===t?l=n>this._editorElementWrap.offsetWidth-248?124-(n-(this._editorElementWrap.offsetWidth-248))/2:124:"right"===t&&(l=n>this._editorElementWrap.scrollWidth-248?(n-this._editorElementWrap.scrollWidth)/2:-124)),o.top=c+"px",o.left=l+"px"}}]),t}();e.default=T},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.biImage,r=t.commonStyle,o=t.headerStyle,c=t.loadButtonStyle,l=t.downloadButtonStyle,h=t.submenuStyle;return'\n    <div class="tui-image-editor-main-container" style="'+r+'">\n        <div class="tui-image-editor-header" style="'+o+'">\n            <div class="tui-image-editor-header-logo">\n                <img src="'+n+'" />\n            </div>\n            <div class="tui-image-editor-header-buttons">\n                <button style="'+c+'">\n                    '+e.localize("Load")+'\n                    <input type="file" class="tui-image-editor-load-btn" />\n                </button>\n                <button class="tui-image-editor-download-btn" style="'+l+'">\n                    '+e.localize("Download")+'\n                </button>\n            </div>\n        </div>\n        <div class="tui-image-editor-main">\n            <div class="tui-image-editor-submenu">\n                <div class="tui-image-editor-submenu-style" style="'+h+'"></div>\n            </div>\n            <div class="tui-image-editor-wrap">\n                <div class="tui-image-editor-size-wrap">\n                    <div class="tui-image-editor-align-wrap">\n                        <div class="tui-image-editor"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n'}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.biImage,r=t.iconStyle,o=r.normal,c=r.hover,l=r.disabled,h=t.loadButtonStyle,f=t.downloadButtonStyle;return'\n    <div class="tui-image-editor-controls">\n        <div class="tui-image-editor-controls-logo">\n            <img src="'+n+'" />\n        </div>\n        <ul class="tui-image-editor-menu">\n            <li id="tie-btn-undo" class="tui-image-editor-item" title="'+e.localize("Undo")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-undo" class="enabled"/>\n                    <use xlink:href="'+l.path+"#"+l.name+'-ic-undo" class="normal"/>\n                    <use xlink:href="'+c.path+"#"+c.name+'-ic-undo" class="hover"/>\n                </svg>\n            </li>\n            <li id="tie-btn-redo" class="tui-image-editor-item" title="'+e.localize("Redo")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-redo" class="enabled"/>\n                    <use xlink:href="'+l.path+"#"+l.name+'-ic-redo" class="normal"/>\n                    <use xlink:href="'+c.path+"#"+c.name+'-ic-redo" class="hover"/>\n                </svg>\n            </li>\n            <li id="tie-btn-reset" class="tui-image-editor-item" title="'+e.localize("Reset")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-reset" class="enabled"/>\n                    <use xlink:href="'+l.path+"#"+l.name+'-ic-reset" class="normal"/>\n                    <use xlink:href="'+c.path+"#"+c.name+'-ic-reset" class="hover"/>\n                </svg>\n            </li>\n            <li class="tui-image-editor-item">\n                <div class="tui-image-editor-icpartition"></div>\n            </li>\n            <li id="tie-btn-delete" class="tui-image-editor-item" title="'+e.localize("Delete")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-delete" class="enabled"/>\n                    <use xlink:href="'+l.path+"#"+l.name+'-ic-delete" class="normal"/>\n                    <use xlink:href="'+c.path+"#"+c.name+'-ic-delete" class="hover"/>\n                </svg>\n            </li>\n            <li id="tie-btn-delete-all" class="tui-image-editor-item" title="'+e.localize("Delete-all")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-delete-all" class="enabled"/>\n                    <use xlink:href="'+l.path+"#"+l.name+'-ic-delete-all" class="normal"/>\n                    <use xlink:href="'+c.path+"#"+c.name+'-ic-delete-all" class="hover"/>\n                </svg>\n            </li>\n            <li class="tui-image-editor-item">\n                <div class="tui-image-editor-icpartition"></div>\n            </li>\n        </ul>\n\n        <div class="tui-image-editor-controls-buttons">\n            <button style="'+h+'">\n                '+e.localize("Load")+'\n                <input type="file" class="tui-image-editor-load-btn" />\n            </button>\n            <button class="tui-image-editor-download-btn" style="'+f+'">\n                '+e.localize("Download")+"\n            </button>\n        </div>\n    </div>\n"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(3),c=n(72),l=f(n(78)),h=f(n(79));function f(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.styles=this._changeToObject((0,o.extend)(h.default,e)),(0,c.styleLoad)(this._styleMaker())}return r(t,[{key:"getStyle",value:function(t){var e=null,n=t.replace(/\..+$/,""),option=this.styles[t];switch(t){case"common.bi":e=this.styles[t].image;break;case"menu.icon":case"submenu.icon":e={active:this.styles[n+".activeIcon"],normal:this.styles[n+".normalIcon"],hover:this.styles[n+".hoverIcon"],disabled:this.styles[n+".disabledIcon"]};break;case"submenu.label":e={active:this._makeCssText(this.styles[n+".activeLabel"]),normal:this._makeCssText(this.styles[n+".normalLabel"])};break;case"submenu.partition":e={vertical:this._makeCssText((0,o.extend)({},option,{borderLeft:"1px solid "+option.color})),horizontal:this._makeCssText((0,o.extend)({},option,{borderBottom:"1px solid "+option.color}))};break;case"range.disabledPointer":case"range.disabledBar":case"range.disabledSubbar":case"range.pointer":case"range.bar":case"range.subbar":option.backgroundColor=option.color,e=this._makeCssText(option);break;default:e=this._makeCssText(option)}return e}},{key:"_styleMaker",value:function(){var t=this.getStyle("submenu.label"),e=this.getStyle("submenu.partition");return(0,l.default)({subMenuLabelActive:t.active,subMenuLabelNormal:t.normal,submenuPartitionVertical:e.vertical,submenuPartitionHorizontal:e.horizontal,biSize:this.getStyle("common.bisize"),subMenuRangeTitle:this.getStyle("range.title"),submenuRangePointer:this.getStyle("range.pointer"),submenuRangeBar:this.getStyle("range.bar"),submenuRangeSubbar:this.getStyle("range.subbar"),submenuDisabledRangePointer:this.getStyle("range.disabledPointer"),submenuDisabledRangeBar:this.getStyle("range.disabledBar"),submenuDisabledRangeSubbar:this.getStyle("range.disabledSubbar"),submenuRangeValue:this.getStyle("range.value"),submenuColorpickerTitle:this.getStyle("colorpicker.title"),submenuColorpickerButton:this.getStyle("colorpicker.button"),submenuCheckbox:this.getStyle("checkbox"),menuIconSize:this.getStyle("menu.iconSize"),submenuIconSize:this.getStyle("submenu.iconSize")})}},{key:"_changeToObject",value:function(t){var e={};return(0,o.forEach)(t,(function(t,n){var r=n.match(/^(.+)\.([a-z]+)$/i),o=r[1],c=r[2];e[o]||(e[o]={}),e[o][c]=t})),e}},{key:"_makeCssText",value:function(t){var e=this,n=[];return(0,o.forEach)(t,(function(t,r){["backgroundImage"].indexOf(r)>-1&&"none"!==t&&(t="url("+t+")"),n.push(e._toUnderScore(r)+": "+t)})),n.join(";")}},{key:"_toUnderScore",value:function(t){return t.replace(/([A-Z])/g,(function(t,e){return"-"+e.toLowerCase()}))}}]),t}();e.default=d},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.subMenuLabelActive,n=t.subMenuLabelNormal,r=t.subMenuRangeTitle,o=t.submenuPartitionVertical,c=t.submenuPartitionHorizontal,l=t.submenuCheckbox,h=t.submenuRangePointer,f=t.submenuRangeValue,d=t.submenuColorpickerTitle,v=t.submenuColorpickerButton,m=t.submenuRangeBar,y=t.submenuRangeSubbar,_=t.submenuDisabledRangePointer,x=t.submenuDisabledRangeBar,w=t.submenuDisabledRangeSubbar,C=t.submenuIconSize;return'\n    #tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype="icon-bubble"] label,\n    #tie-icon-add-button.icon-heart .tui-image-editor-button[data-icontype="icon-heart"] label,\n    #tie-icon-add-button.icon-location .tui-image-editor-button[data-icontype="icon-location"] label,\n    #tie-icon-add-button.icon-polygon .tui-image-editor-button[data-icontype="icon-polygon"] label,\n    #tie-icon-add-button.icon-star .tui-image-editor-button[data-icontype="icon-star"] label,\n    #tie-icon-add-button.icon-arrow-3 .tui-image-editor-button[data-icontype="icon-arrow-3"] label,\n    #tie-icon-add-button.icon-arrow-2 .tui-image-editor-button[data-icontype="icon-arrow-2"] label,\n    #tie-icon-add-button.icon-arrow .tui-image-editor-button[data-icontype="icon-arrow"] label,\n    #tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype="icon-bubble"] label,\n    #tie-draw-line-select-button.line .tui-image-editor-button.line label,\n    #tie-draw-line-select-button.free .tui-image-editor-button.free label,\n    #tie-flip-button.flipX .tui-image-editor-button.flipX label,\n    #tie-flip-button.flipY .tui-image-editor-button.flipY label,\n    #tie-flip-button.resetFlip .tui-image-editor-button.resetFlip label,\n    #tie-crop-button .tui-image-editor-button.apply.active label,\n    #tie-crop-preset-button .tui-image-editor-button.preset.active label,\n    #tie-shape-button.rect .tui-image-editor-button.rect label,\n    #tie-shape-button.circle .tui-image-editor-button.circle label,\n    #tie-shape-button.triangle .tui-image-editor-button.triangle label,\n    #tie-text-effect-button .tui-image-editor-button.active label,\n    #tie-text-align-button.left .tui-image-editor-button.left label,\n    #tie-text-align-button.center .tui-image-editor-button.center label,\n    #tie-text-align-button.right .tui-image-editor-button.right label,\n    #tie-mask-apply.apply.active .tui-image-editor-button.apply label,\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button:hover > label,\n    .tui-image-editor-container .tui-image-editor-checkbox input + label {\n        '+e+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button > label,\n    .tui-image-editor-container .tui-image-editor-range-wrap.tui-image-editor-newline.short label {\n        "+n+"\n    }\n    .tui-image-editor-container .tui-image-editor-range-wrap label {\n        "+r+"\n    }\n    .tui-image-editor-container .tui-image-editor-partition > div {\n        "+o+"\n    }\n    .tui-image-editor-container.left .tui-image-editor-submenu .tui-image-editor-partition > div,\n    .tui-image-editor-container.right .tui-image-editor-submenu .tui-image-editor-partition > div {\n        "+c+"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox input + label:before {\n        "+l+"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox input:checked + label:before {\n        border: 0;\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-pointer {\n        "+h+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-bar {\n        "+m+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-subbar {\n        "+y+"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-pointer {\n        "+_+"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-subbar {\n        "+w+"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-bar {\n        "+x+"\n    }\n    .tui-image-editor-container .tui-image-editor-range-value {\n        "+f+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value + label {\n        "+d+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value {\n        "+v+"\n    }\n    .tui-image-editor-container .svg_ic-menu {\n        "+t.menuIconSize+"\n    }\n    .tui-image-editor-container .svg_ic-submenu {\n        "+C+"\n    }\n    .tui-image-editor-container .tui-image-editor-controls-logo > img,\n    .tui-image-editor-container .tui-image-editor-header-logo > img {\n        "+t.biSize+"\n    }\n\n"}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={"common.bi.image":"https://uicdn.toast.com/toastui/img/tui-image-editor-bi.png","common.bisize.width":"251px","common.bisize.height":"21px","common.backgroundImage":"none","common.backgroundColor":"#1e1e1e","common.border":"0px","header.backgroundImage":"none","header.backgroundColor":"transparent","header.border":"0px","loadButton.backgroundColor":"#fff","loadButton.border":"1px solid #ddd","loadButton.color":"#222","loadButton.fontFamily":"'Noto Sans', sans-serif","loadButton.fontSize":"12px","downloadButton.backgroundColor":"#fdba3b","downloadButton.border":"1px solid #fdba3b","downloadButton.color":"#fff","downloadButton.fontFamily":"'Noto Sans', sans-serif","downloadButton.fontSize":"12px","menu.normalIcon.path":"icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":"icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":"icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":"icon-c.svg","menu.hoverIcon.name":"icon-c","menu.iconSize.width":"24px","menu.iconSize.height":"24px","submenu.backgroundColor":"#1e1e1e","submenu.partition.color":"#3c3c3c","submenu.normalIcon.path":"icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":"icon-c.svg","submenu.activeIcon.name":"icon-c","submenu.iconSize.width":"32px","submenu.iconSize.height":"32px","submenu.normalLabel.color":"#8a8a8a","submenu.normalLabel.fontWeight":"lighter","submenu.activeLabel.color":"#fff","submenu.activeLabel.fontWeight":"lighter","checkbox.border":"0px","checkbox.backgroundColor":"#fff","range.pointer.color":"#fff","range.bar.color":"#666","range.subbar.color":"#d1d1d1","range.disabledPointer.color":"#414141","range.disabledBar.color":"#282828","range.disabledSubbar.color":"#414141","range.value.color":"#fff","range.value.fontWeight":"lighter","range.value.fontSize":"11px","range.value.border":"1px solid #353535","range.value.backgroundColor":"#151515","range.title.color":"#fff","range.title.fontWeight":"lighter","colorpicker.button.border":"1px solid #1e1e1e","colorpicker.title.color":"#fff"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(81)),c=v(n(83)),l=v(n(84)),h=v(n(85)),f=n(72),d=n(73);function v(t){return t&&t.__esModule?t:{default:t}}var m={stroke:"#ffbb3b",fill:"",strokeWidth:3},y=function(t){function e(t,n){var r=n.locale,l=n.iconStyle,f=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var v=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"shape",iconStyle:l,menuBarPosition:f,templateHtml:h.default}));return v.type=null,v.options=m,v._els={shapeSelectButton:v.selector("#tie-shape-button"),shapeColorButton:v.selector("#tie-shape-color-button"),strokeRange:new c.default(v.selector("#tie-stroke-range"),d.defaultShapeStrokeValus),strokeRangeValue:v.selector("#tie-stroke-range-value"),fillColorpicker:new o.default(v.selector("#tie-color-fill"),"",v.toggleDirection),strokeColorpicker:new o.default(v.selector("#tie-color-stroke"),"#ffbb3b",v.toggleDirection)},v.colorPickerControls.push(v._els.fillColorpicker),v.colorPickerControls.push(v._els.strokeColorpicker),v}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.shapeSelectButton.addEventListener("click",this._changeShapeHandler.bind(this)),this._els.strokeRange.on("change",this._changeStrokeRangeHandler.bind(this)),this._els.fillColorpicker.on("change",this._changeFillColorHandler.bind(this)),this._els.strokeColorpicker.on("change",this._changeStrokeColorHandler.bind(this)),this._els.fillColorpicker.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.strokeColorpicker.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.strokeRangeValue.value=this._els.strokeRange.value,this._els.strokeRangeValue.setAttribute("readonly",!0)}},{key:"setShapeStatus",value:function(t){var e=t.strokeWidth,n=t.strokeColor,r=t.fillColor;this._els.strokeRange.value=e,this._els.strokeRange.trigger("change"),this._els.strokeColorpicker.color=n,this._els.fillColorpicker.color=r,this.options.stroke=n,this.options.fill=r,this.options.strokeWidth=e}},{key:"changeStartMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeStandbyMode",value:function(){this.type=null,this.actions.changeSelectableAll(!0),this._els.shapeSelectButton.classList.remove("circle"),this._els.shapeSelectButton.classList.remove("triangle"),this._els.shapeSelectButton.classList.remove("rect")}},{key:"setMaxStrokeValue",value:function(t){var e=t;e<=0&&(e=d.defaultShapeStrokeValus.max),this._els.strokeRange.max=e}},{key:"setStrokeValue",value:function(t){this._els.strokeRange.value=t,this._els.strokeRange.trigger("change")}},{key:"getStrokeValue",value:function(){return this._els.strokeRange.value}},{key:"_changeShapeHandler",value:function(t){var button=t.target.closest(".tui-image-editor-button");if(button){this.actions.stopDrawingMode(),this.actions.discardSelection();var e=this.getButtonType(button,["circle","triangle","rect"]);if(this.type===e)return void this.changeStandbyMode();this.changeStandbyMode(),this.type=e,t.currentTarget.classList.add(e),this.actions.changeSelectableAll(!1),this.actions.modeChange("shape")}}},{key:"_changeStrokeRangeHandler",value:function(t){this.options.strokeWidth=(0,f.toInteger)(t),this._els.strokeRangeValue.value=(0,f.toInteger)(t),this.actions.changeShape({strokeWidth:t}),this.actions.setDrawingShape(this.type,this.options)}},{key:"_changeFillColorHandler",value:function(t){t=t||"transparent",this.options.fill=t,this.actions.changeShape({fill:t})}},{key:"_changeStrokeColorHandler",value:function(t){t=t||"transparent",this.options.stroke=t,this.actions.changeShape({stroke:t})}}]),e}(l.default);e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=l(n(3)),c=l(n(82));function l(t){return t&&t.__esModule?t:{default:t}}var h=["#000000","#2a2a2a","#545454","#7e7e7e","#a8a8a8","#d2d2d2","#ffffff","","#ff4040","#ff6518","#ffbb3b","#03bd9e","#00a9ff","#515ce6","#9e5fff","#ff5583"],f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#7e7e7e",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var title=e.getAttribute("title");this._show=!1,this._colorpickerElement=e,this._toggleDirection=r,this._makePickerButtonElement(e,n),this._makePickerLayerElement(e,title),this._color=n,this.picker=c.default.create({container:this.pickerElement,preset:h,color:n}),this._addEvent(e)}return r(t,[{key:"_changeColorElement",value:function(t){t?(this.colorElement.classList.remove("transparent"),this.colorElement.style.backgroundColor=t):(this.colorElement.style.backgroundColor="#fff",this.colorElement.classList.add("transparent"))}},{key:"_makePickerButtonElement",value:function(t,e){t.classList.add("tui-image-editor-button"),this.colorElement=document.createElement("div"),this.colorElement.className="color-picker-value",e?this.colorElement.style.backgroundColor=e:this.colorElement.classList.add("transparent")}},{key:"_makePickerLayerElement",value:function(t,title){var label=document.createElement("label"),e=document.createElement("div");this.pickerControl=document.createElement("div"),this.pickerControl.className="color-picker-control",this.pickerElement=document.createElement("div"),this.pickerElement.className="color-picker",label.innerHTML=title,e.className="triangle",this.pickerControl.appendChild(this.pickerElement),this.pickerControl.appendChild(e),t.appendChild(this.pickerControl),t.appendChild(this.colorElement),t.appendChild(label)}},{key:"_addEvent",value:function(t){var e=this;this.picker.on("selectColor",(function(t){e._changeColorElement(t.color),e._color=t.color,e.fire("change",t.color)})),t.addEventListener("click",(function(t){e._show=!e._show,e.pickerControl.style.display=e._show?"block":"none",e._setPickerControlPosition(),e.fire("changeShow",e),t.stopPropagation()})),document.body.addEventListener("click",(function(){e.hide()}))}},{key:"hide",value:function(){this._show=!1,this.pickerControl.style.display="none"}},{key:"_setPickerControlPosition",value:function(){var t=this.pickerControl.style,e=this._colorpickerElement.clientWidth/2+2,n=this.pickerControl.offsetWidth/2-e,r=-1*(this.pickerControl.offsetHeight+10);"down"===this._toggleDirection&&(r=30),t.top=r+"px",t.left="-"+n+"px"}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._changeColorElement(t)}}]),t}();o.default.CustomEvents.mixin(f),e.default=f},function(t,e,n){var r;r=function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}return n.m=t,n.c=e,n.p="dist",n(0)}([function(t,e,n){n(1),t.exports=n(6)},function(t,e){},,,,,function(t,e,n){"use strict";var r={domutil:n(7),domevent:n(9),Collection:n(10),View:n(11),Drag:n(12),create:n(13),Palette:n(16),Slider:n(18),colorutil:n(14),svgvml:n(19)};t.exports=r},function(t,e,n){"use strict";var r,o,c=n(8),l=n(9),h=n(10),f=c,d="onselectstart"in document,v="",m=/^auto$|^$|%/;o=(r={appendHTMLElement:function(t,e,n){var r;return n=n||"",(r=document.createElement(t)).className=n,e?e.appendChild(r):document.body.appendChild(r),r},remove:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},get:function(t){return document.getElementById(t)},_matcher:function(t,e){return/^\./.test(e)?r.hasClass(t,e.replace(".","")):/^#/.test(e)?t.id===e.replace("#",""):t.nodeName.toLowerCase()===e.toLowerCase()},find:function(t,e,n){var o=[],c=!1,l=f.isUndefined(n)||!1===n,h=f.isFunction(n);return f.isString(e)&&(e=r.get(e)),function t(e,f){for(var cursor,d=e.childNodes,i=0,v=d.length;i<v;i+=1)if("#text"!==(cursor=d[i]).nodeName)if(r._matcher(cursor,f)){if((h&&n(cursor)||!h)&&o.push(cursor),l){c=!0;break}}else if(cursor.childNodes.length>0&&(t(cursor,f),c))break}(e=e||window.document.body,t),l?o[0]||null:o},closest:function(t,e){var n=t.parentNode;if(r._matcher(t,e))return t;for(;n&&n!==window.document.body;){if(r._matcher(n,e))return n;n=n.parentNode}},text:function(t){var e="",i=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)e+=r.text(t)}else if(3===n||4===n)return t.nodeValue}else for(;t[i];i+=1)e+=r.text(t[i]);return e},setData:function(t,e,data){"dataset"in t?t.dataset[e]=data:t.setAttribute("data-"+e,data)},getData:function(t,e){return"dataset"in t?t.dataset[e]:t.getAttribute("data-"+e)},hasClass:function(t,e){var n;return f.isUndefined(t.classList)?(n=r.getClass(t)).length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n):t.classList.contains(e)},addClass:function(t,e){var n;f.isUndefined(t.classList)?r.hasClass(t,e)||(n=r.getClass(t),r.setClass(t,(n?n+" ":"")+e)):f.forEachArray(e.split(" "),(function(e){t.classList.add(e)}))},setClass:function(t,e){f.isUndefined(t.className.baseVal)?t.className=e:t.className.baseVal=e},removeClass:function(t,e){var n="";f.isUndefined(t.classList)?(n=(" "+r.getClass(t)+" ").replace(" "+e+" "," "),r.setClass(t,n.replace(/^\s\s*/,"").replace(/\s\s*$/,""))):t.classList.remove(e)},getClass:function(t){return t&&t.className?f.isUndefined(t.className.baseVal)?t.className:t.className.baseVal:""},getStyle:function(t,style){var e,n=t.style[style]||t.currentStyle&&t.currentStyle[style];return n&&"auto"!==n||!document.defaultView||(n=(e=document.defaultView.getComputedStyle(t,null))?e[style]:null),"auto"===n?null:n},getComputedStyle:function(t){var e=document.defaultView;return e&&e.getComputedStyle?document.defaultView.getComputedStyle(t):{getPropertyValue:function(e){var n=/(\-([a-z]){1})/g;return"float"===e&&(e="styleFloat"),n.test(e)&&(e=e.replace(n,(function(){return arguments[2].toUpperCase()}))),t.currentStyle[e]?t.currentStyle[e]:null}}},setPosition:function(t,e,n){e=f.isUndefined(e)?0:e,n=f.isUndefined(n)?0:n,t._pos=[e,n],t.style.left=e+"px",t.style.top=n+"px"},getPosition:function(t,e){var n,r,o;return e&&(t._pos=null),t._pos?t._pos:(n=0,r=0,(m.test(t.style.left)||m.test(t.style.top))&&"getBoundingClientRect"in t?(n=(o=t.getBoundingClientRect()).left,r=o.top):(n=parseFloat(t.style.left||0),r=parseFloat(t.style.top||0)),[n,r])},getSize:function(t){var e,n=r.getStyle(t,"width"),o=r.getStyle(t,"height");return(m.test(n)||m.test(o))&&"getBoundingClientRect"in t?(n=(e=t.getBoundingClientRect()).width,o=e.height):(n=parseFloat(n||0),o=parseFloat(o||0)),[n,o]},testProp:function(t){for(var style=document.documentElement.style,i=0,e=t.length;i<e;i+=1)if(t[i]in style)return t[i];return!1},getFormData:function(t){var e=new h((function(){return this.length})),n=function(t){return!t.disabled},output={};return e.add.apply(e,r.find("input",t,n).concat(r.find("select",t,n)).concat(r.find("textarea",t,n))),e=e.groupBy((function(t){return t&&t.getAttribute("name")||"_other"})),f.forEach(e,(function(t,e){"_other"!==e&&t.each((function(n){var o=n.nodeName.toLowerCase(),c=n.type,l=[];"radio"===c?l=[t.find((function(t){return t.checked})).toArray().pop()]:"checkbox"===c?l=t.find((function(t){return t.checked})).toArray():"select"===o?t.find((function(t){return!!t.childNodes.length})).each((function(t){l=l.concat(r.find("option",t,(function(t){return t.selected})))})):l=t.find((function(t){return""!==t.value})).toArray(),(l=f.map(l,(function(t){return t.value}))).length?1===l.length&&(l=l[0]):l="",output[e]=l}))})),output}}).testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),r.disableTextSelection=d?function(){l.on(window,"selectstart",l.preventDefault)}:function(){var style=document.documentElement.style;v=style[o],style[o]="none"},r.enableTextSelection=d?function(){l.off(window,"selectstart",l.preventDefault)}:function(){document.documentElement.style[o]=v},r.disableImageDrag=function(){l.on(window,"dragstart",l.preventDefault)},r.enableImageDrag=function(){l.off(window,"dragstart",l.preventDefault)},r.applyTemplate=function(template,t){return template.replace(/\{\{(\w*)\}\}/g,(function(e,n){return t.hasOwnProperty(n)?t[n]:""}))},t.exports=r},function(e,n){e.exports=t},function(t,e,n){"use strict";var r=n(8),o=r.browser,c={START:["touchstart","mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},l={on:function(t,e,n,o){r.isString(e)?r.forEach(e.split(" "),(function(e){l._on(t,e,n,o)})):r.forEachOwnProperties(e,(function(e,r){l._on(t,r,e,n)}))},_on:function(t,e,n,o){var c,h,f;c=e+r.stamp(n)+(o?"_"+r.stamp(o):""),t._evt&&t._evt[c]||(f=h=function(e){n.call(o||t,e||window.event)},"addEventListener"in t?"mouseenter"===e||"mouseleave"===e?(h=function(e){e=e||window.event,l._checkMouse(t,e)&&f(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",h,!1)):("mousewheel"===e&&t.addEventListener("DOMMouseScroll",h,!1),t.addEventListener(e,h,!1)):"attachEvent"in t&&t.attachEvent("on"+e,h),t._evt=t._evt||{},t._evt[c]=h)},off:function(t,e,n,o){r.isString(e)?r.forEach(e.split(" "),(function(e){l._off(t,e,n,o)})):r.forEachOwnProperties(e,(function(e,r){l._off(t,r,e,n)}))},_off:function(t,e,n,o){var c=e+r.stamp(n)+(o?"_"+r.stamp(o):""),l=t._evt&&t._evt[c];if(l){if("removeEventListener"in t)"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",l,!1):("mousewheel"===e&&t.removeEventListener("DOMMouseScroll",l,!1),t.removeEventListener(e,l,!1));else if("detachEvent"in t)try{t.detachEvent("on"+e,l)}catch(t){}delete t._evt[c],r.keys(t._evt).length||(r.browser.msie&&r.browser.version<9?t._evt=null:delete t._evt)}},once:function(t,e,n,o){var c=this;r.isObject(e)?r.forEachOwnProperties(e,(function(e,r){l.once(t,r,e,n)})):l.on(t,e,(function r(){n.apply(o||t,arguments),c._off(t,e,r,o)}),o)},stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stop:function(t){l.preventDefault(t),l.stopPropagation(t)},disableScrollPropagation:function(t){l.on(t,"mousewheel MozMousePixelScroll",l.stopPropagation)},disableClickPropagation:function(t){l.on(t,c.START.join(" ")+" click dblclick",l.stopPropagation)},getMousePosition:function(t,e){var rect;return e?(rect=e.getBoundingClientRect(),[t.clientX-rect.left-e.clientLeft,t.clientY-rect.top-e.clientTop]):[t.clientX,t.clientY]},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_checkMouse:function(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(t){return!1}return n!==t},trigger:function(t,e,n){r.isUndefined(n)&&/(mouse|click)/.exec(e)&&(n=l.mouseEvent(e)),t.dispatchEvent?t.dispatchEvent(n):t.fireEvent&&t.fireEvent("on"+e,n)},mouseEvent:function(t,e){var n,c;return c=r.extend({bubbles:!0,cancelable:"mousemove"!==t,view:window,wheelDelta:0,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},e),o.msie&&o.version<9&&delete c.wheelDelta,"function"==typeof document.createEvent?(n=document.createEvent("MouseEvents")).initMouseEvent(t,c.bubbles,c.cancelable,c.view,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.button,document.body.parentNode):document.createEventObject&&(n=document.createEventObject(),r.forEach(c,(function(t,e){n[e]=t}),this),n.button={0:1,1:4,2:2}[n.button]||n.button),n},getMouseButton:function(t){var button;return document.implementation.hasFeature("MouseEvents","2.0")?t.button:(button=t.button+"",~"0,1,3,5,7".indexOf(button)?0:~"2,6".indexOf(button)?2:~"4".indexOf(button)?1:void 0)}};t.exports=l},function(t,e,n){"use strict";var r=n(8),o=r.forEachOwnProperties,c=r.forEachArray,l=r.isFunction,h=r.isObject,f=Array.prototype.slice;function d(t){this.items={},this.length=0,l(t)&&(this.getItemID=t)}d.and=function(t){var e;return t=f.call(arguments),e=t.length,function(n){for(var i=0;i<e;i+=1)if(!t[i].call(null,n))return!1;return!0}},d.or=function(t){var e;return t=f.call(arguments),e=t.length,function(n){for(var i=1,r=t[0].call(null,n);i<e;i+=1)r=r||t[i].call(null,n);return r}},d.merge=function(t){var e=f.call(arguments),n={},o=new d(e[0].getItemID),l=r.extend;return c(e,(function(col){l(n,col.items)})),o.items=n,o.length=r.keys(o.items).length,o},d.prototype.getItemID=function(t){return t._id+""},d.prototype.add=function(t){var e,n;arguments.length>1?c(f.call(arguments),(function(t){this.add(t)}),this):(e=this.getItemID(t),(n=this.items)[e]||(this.length+=1),n[e]=t)},d.prototype.remove=function(t){var e,n,o=[];return this.length?arguments.length>1?o=r.map(f.call(arguments),(function(t){return this.remove(t)}),this):(e=this.items,h(t)&&(t=this.getItemID(t)),e[t]?(this.length-=1,n=e[t],delete e[t],n):o):o},d.prototype.clear=function(){this.items={},this.length=0},d.prototype.has=function(t){var e,n;return!!this.length&&(e=l(t),n=!1,e?this.each((function(e){return!0!==t(e)||(n=!0,!1)})):(t=h(t)?this.getItemID(t):t,n=r.isExisty(this.items[t])),n)},d.prototype.doWhenHas=function(t,e,n){var o=this.items[t];r.isExisty(o)&&e.call(n||this,o)},d.prototype.find=function(filter){var t=new d;return this.hasOwnProperty("getItemID")&&(t.getItemID=this.getItemID),this.each((function(e){!0===filter(e)&&t.add(e)})),t},d.prototype.groupBy=function(t,e){var n,o,c={},h=l(t),f=this.getItemID;if(r.isArray(t)){if(r.forEachArray(t,(function(t){c[t+""]=new d(f)})),!e)return c;t=e,h=!0}return this.each((function(e){h?o=t(e):(o=e[t],l(o)&&(o=o.apply(e))),(n=c[o])||(n=c[o]=new d(f)),n.add(e)})),c},d.prototype.single=function(){var t;return this.each((function(e){return t=e,!1}),this),t},d.prototype.sort=function(t){var e=[];return this.each((function(t){e.push(t)})),l(t)&&(e=e.sort(t)),e},d.prototype.each=function(t,e){o(this.items,t,e||this)},d.prototype.toArray=function(){return this.length?r.map(this.items,(function(t){return t})):[]},t.exports=d},function(t,e,n){"use strict";var r=n(8),o=n(7),c=n(10);function l(t,e){var n=r.stamp(this);t=t||{},r.isUndefined(e)&&(e=o.appendHTMLElement("div")),o.addClass(e,"tui-view-"+n),this.id=n,this.container=e,this.childs=new c((function(view){return r.stamp(view)})),this.parent=null}l.prototype.addChild=function(view,t){t&&t.call(view,this),view.parent=this,this.childs.add(view)},l.prototype.removeChild=function(t,e){var view=r.isNumber(t)?this.childs.items[t]:t;t=r.stamp(view),e&&e.call(view,this),this.childs.remove(t)},l.prototype.render=function(){this.childs.each((function(t){t.render()}))},l.prototype.recursive=function(t,e){r.isFunction(t)&&(e||t(this),this.childs.each((function(e){e.recursive(t)})))},l.prototype.resize=function(){for(var t=Array.prototype.slice.call(arguments),e=this.parent;e;)r.isFunction(e._onResize)&&e._onResize.apply(e,t),e=e.parent},l.prototype._beforeDestroy=function(){},l.prototype._destroy=function(){this._beforeDestroy(),this.childs.clear(),this.container.innerHTML="",this.id=this.parent=this.childs=this.container=null},l.prototype.destroy=function(t){this.childs.each((function(t){t.destroy(!0),t._destroy()})),t||this._destroy()},l.prototype.getViewBound=function(){var t=this.container,e=o.getPosition(t),n=o.getSize(t);return{x:e[0],y:e[1],width:n[0],height:n[1]}},t.exports=l},function(t,e,n){(function(e){"use strict";var r=n(8),o=n(7),c=n(9);function l(t,e){c.on(e,"mousedown",this._onMouseDown,this),this.options=r.extend({distance:10},t),this.container=e,this._isMoved=!1,this._distance=0,this._dragStartFired=!1,this._dragStartEventData=null}l.prototype.destroy=function(){c.off(this.container,"mousedown",this._onMouseDown,this),this.options=this.container=this._isMoved=this._distance=this._dragStartFired=this._dragStartEventData=null},l.prototype._toggleDragEvent=function(t){var n,r,l=this.container;t?(n="on",r="disable"):(n="off",r="enable"),o[r+"TextSelection"](l),o[r+"ImageDrag"](l),c[n](e.document,{mousemove:this._onMouseMove,mouseup:this._onMouseUp},this)},l.prototype._getEventData=function(t){return{target:t.target||t.srcElement,originEvent:t}},l.prototype._onMouseDown=function(t){0===c.getMouseButton(t)&&(this._distance=0,this._dragStartFired=!1,this._dragStartEventData=this._getEventData(t),this._toggleDragEvent(!0))},l.prototype._onMouseMove=function(t){var e=this.options.distance;c.preventDefault(t),this._isMoved=!0,this._distance<e?this._distance+=1:this._dragStartFired||(this._dragStartFired=!0,this.invoke("dragStart",this._dragStartEventData))?this.fire("drag",this._getEventData(t)):this._toggleDragEvent(!1)},l.prototype._onMouseUp=function(t){if(this._toggleDragEvent(!1),this._isMoved)return this._isMoved=!1,void this.fire("dragEnd",this._getEventData(t));this.fire("click",this._getEventData(t))},r.CustomEvents.mixin(l),t.exports=l}).call(e,function(){return this}())},function(t,e,n){"use strict";var r=n(8),o=n(14),c=n(15),l=n(16),h=n(18),f=!1;function d(t){var e,n;if(!(this instanceof d))return new d(t);if(!(t=this.options=r.extend({container:null,color:"#f8f8f8",preset:["#181818","#282828","#383838","#585858","#b8b8b8","#d8d8d8","#e8e8e8","#f8f8f8","#ab4642","#dc9656","#f7ca88","#a1b56c","#86c1b9","#7cafc2","#ba8baf","#a16946"],cssPrefix:"tui-colorpicker-",detailTxt:"Detail",usageStatistics:!0},t)).container)throw new Error("ColorPicker(): need container option.");e=this.layout=new c(t,t.container),this.palette=new l(t,e.container),this.palette.on({_selectColor:this._onSelectColorInPalette,_toggleSlider:this._onToggleSlider},this),this.slider=new h(t,e.container),this.slider.on("_selectColor",this._onSelectColorInSlider,this),e.addChild(this.palette),e.addChild(this.slider),this.render(t.color),t.usageStatistics&&(n=location.hostname,f||(f=!0,r.imagePing("https://www.google-analytics.com/collect",{v:1,t:"event",tid:"UA-115377265-9",cid:n,dp:n,dh:"color-picker"})))}d.prototype._onSelectColorInPalette=function(t){var e=t.color,n=this.options;o.isValidRGB(e)||""===e?(this.fire("selectColor",{color:e,origin:"palette"}),n.color!==e&&(n.color=e,this.render(e))):this.render()},d.prototype._onToggleSlider=function(){this.slider.toggle(!this.slider.isVisible())},d.prototype._onSelectColorInSlider=function(t){var e=t.color,n=this.options;this.fire("selectColor",{color:e,origin:"slider"}),n.color!==e&&(n.color=e,this.palette.render(e))},d.prototype.setColor=function(t){if(!o.isValidRGB(t))throw new Error("ColorPicker#setColor(): need valid hex string color value");this.options.color=t,this.render(t)},d.prototype.getColor=function(){return this.options.color},d.prototype.toggle=function(t){this.layout.container.style.display=t?"block":"none"},d.prototype.render=function(t){this.layout.render(t||this.options.color)},d.prototype.destroy=function(){this.layout.destroy(),this.options.container.innerHTML="",this.layout=this.slider=this.palette=this.options=null},r.CustomEvents.mixin(d),t.exports=d},function(t,e){"use strict";var n=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,r={leadingZero:function(t,e){var n="",i=0;if((t+"").length>e)return t+"";for(;i<e-1;i+=1)n+="0";return(n+t).slice(-1*e)},isValidRGB:function(t){return n.test(t)},hexToRGB:function(t){return!!r.isValidRGB(t)&&(t=t.substring(1),[parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)])},rgbToHEX:function(t,g,b){var e="#"+r.leadingZero(t.toString(16),2)+r.leadingZero(g.toString(16),2)+r.leadingZero(b.toString(16),2);return!!r.isValidRGB(e)&&e},rgbToHSV:function(t,g,b){var e,n,r,s,o,c;if(t/=255,g/=255,b/=255,o=e=Math.max(t,g,b),c=e-(n=Math.min(t,g,b)),s=0===e?0:c/e,e===n)r=0;else{switch(e){case t:r=(g-b)/c+(g<b?6:0);break;case g:r=(b-t)/c+2;break;case b:r=(t-g)/c+4}r/=6}return[Math.round(360*r),Math.round(100*s),Math.round(100*o)]},hsvToRGB:function(t,s,e){var n,g,b,i,r,p,q,o;if(t=Math.max(0,Math.min(360,t)),s=Math.max(0,Math.min(100,s)),e=Math.max(0,Math.min(100,e)),e/=100,0==(s/=100))return n=g=b=e,[Math.round(255*n),Math.round(255*g),Math.round(255*b)];switch(p=e*(1-s),q=e*(1-s*(r=(t/=60)-(i=Math.floor(t)))),o=e*(1-s*(1-r)),i){case 0:n=e,g=o,b=p;break;case 1:n=q,g=e,b=p;break;case 2:n=p,g=e,b=o;break;case 3:n=p,g=q,b=e;break;case 4:n=o,g=p,b=e;break;default:n=e,g=p,b=q}return[Math.round(255*n),Math.round(255*g),Math.round(255*b)]}};t.exports=r},function(t,e,n){"use strict";var r=n(8),o=n(7),c=n(11);function l(t,e){this.options=r.extend({cssPrefix:"tui-colorpicker-"},t),e=o.appendHTMLElement("div",e,this.options.cssPrefix+"container"),c.call(this,t,e),this.render()}r.inherit(l,c),l.prototype.render=function(t){this.recursive((function(view){view.render(t)}),!0)},t.exports=l},function(t,e,n){"use strict";var r=n(8),o=n(7),c=n(14),l=n(9),h=n(11),f=n(17);function d(t,e){this.options=r.extend({cssPrefix:"tui-colorpicker-",preset:["#181818","#282828","#383838","#585858","#B8B8B8","#D8D8D8","#E8E8E8","#F8F8F8","#AB4642","#DC9656","#F7CA88","#A1B56C","#86C1B9","#7CAFC2","#BA8BAF","#A16946"],detailTxt:"Detail"},t),e=o.appendHTMLElement("div",e,this.options.cssPrefix+"palette-container"),h.call(this,t,e)}r.inherit(d,h),d.prototype._onClick=function(t){var e=this.options,n=t.srcElement||t.target,r={};if(o.hasClass(n,e.cssPrefix+"palette-button"))return r.color=n.value,void this.fire("_selectColor",r);o.hasClass(n,e.cssPrefix+"palette-toggle-slider")&&this.fire("_toggleSlider")},d.prototype._onChange=function(t){var e=this.options,n=t.srcElement||t.target,r={};o.hasClass(n,e.cssPrefix+"palette-hex")&&(r.color=n.value,this.fire("_selectColor",r))},d.prototype._beforeDestroy=function(){this._toggleEvent(!1)},d.prototype._toggleEvent=function(t){var e,n=this.options,r=this.container,c=l[t?"on":"off"];c(r,"click",this._onClick,this),(e=o.find("."+n.cssPrefix+"palette-hex",r))&&c(e,"change",this._onChange,this)},d.prototype.render=function(t){var e=this.options,html="";this._toggleEvent(!1),html=f.layout.replace("{{colorList}}",r.map(e.preset,(function(n){var style="";return c.isValidRGB(n)&&(style=o.applyTemplate(f.itemStyle,{color:n})),o.applyTemplate(f.item,{itemStyle:style,itemClass:n?"":" "+e.cssPrefix+"color-transparent",color:n,cssPrefix:e.cssPrefix,selected:n===t?" "+e.cssPrefix+"selected":""})})).join("")),html=o.applyTemplate(html,{cssPrefix:e.cssPrefix,detailTxt:e.detailTxt,color:t}),this.container.innerHTML=html,this._toggleEvent(!0)},r.CustomEvents.mixin(d),t.exports=d},function(t,e){"use strict";var n=['<ul class="{{cssPrefix}}clearfix">{{colorList}}</ul>','<div class="{{cssPrefix}}clearfix" style="overflow:hidden">','<input type="button" class="{{cssPrefix}}palette-toggle-slider" value="{{detailTxt}}" />','<input type="text" class="{{cssPrefix}}palette-hex" value="{{color}}" maxlength="7" />','<span class="{{cssPrefix}}palette-preview" style="background-color:{{color}};color:{{color}}">{{color}}</span>',"</div>"].join("\n");t.exports={layout:n,item:'<li><input class="{{cssPrefix}}palette-button{{selected}}{{itemClass}}" type="button" style="{{itemStyle}}" title="{{color}}" value="{{color}}" /></li>',itemStyle:"background-color:{{color}};color:{{color}}"}},function(t,e,n){"use strict";var r=n(8),o=n(7),c=n(9),l=n(19),h=n(14),f=n(11),d=n(12),v=n(20),m=[-7,112],y=[-3,115];function _(t,e){(e=o.appendHTMLElement("div",e,t.cssPrefix+"slider-container")).style.display="none",f.call(this,t,e),this.options=r.extend({color:"#f8f8f8",cssPrefix:"tui-colorpicker-"},t),this._dragDataCache={},this.sliderHandleElement=null,this.huebarHandleElement=null,this.baseColorElement=null,this.drag=new d({distance:0},e),this.drag.on({dragStart:this._onDragStart,drag:this._onDrag,dragEnd:this._onDragEnd,click:this._onClick},this)}r.inherit(_,f),_.prototype._beforeDestroy=function(){this.drag.off(),this.drag=this.options=this._dragDataCache=this.sliderHandleElement=this.huebarHandleElement=this.baseColorElement=null},_.prototype.toggle=function(t){this.container.style.display=t?"block":"none"},_.prototype.isVisible=function(){return"block"===this.container.style.display},_.prototype.render=function(t){var e,n,r=this.container,c=this.options,html=v.layout;h.isValidRGB(t)&&(html=(html=(html=html.replace(/{{slider}}/,v.slider)).replace(/{{huebar}}/,v.huebar)).replace(/{{cssPrefix}}/g,c.cssPrefix),this.container.innerHTML=html,this.sliderHandleElement=o.find("."+c.cssPrefix+"slider-handle",r),this.huebarHandleElement=o.find("."+c.cssPrefix+"huebar-handle",r),this.baseColorElement=o.find("."+c.cssPrefix+"slider-basecolor",r),e=h.hexToRGB(t),n=h.rgbToHSV.apply(null,e),this.moveHue(n[0],!0),this.moveSaturationAndValue(n[1],n[2],!0))},_.prototype._moveColorSliderHandle=function(t,e,n){var r,o=this.sliderHandleElement;e=Math.max(m[0],e),e=Math.min(m[1],e),t=Math.max(m[0],t),t=Math.min(m[1],t),l.setTranslateXY(o,t,e),r=e>50?"white":"black",l.setStrokeColor(o,r),n||this.fire("_selectColor",{color:h.rgbToHEX.apply(null,this.getRGB())})},_.prototype.moveSaturationAndValue=function(t,e,n){var r,o,c,l;t=t||0,e=e||0,r=Math.abs(m[0]),c=t*(o=m[1])/100-r,l=o-e*o/100-r,this._moveColorSliderHandle(c,l,n)},_.prototype._moveColorSliderByPosition=function(t,e){var n=m[0];this._moveColorSliderHandle(t+n,e+n)},_.prototype.getSaturationAndValue=function(){var t=Math.abs(m[0]),e=t+m[1],n=l.getTranslateXY(this.sliderHandleElement);return[(n[1]+t)/e*100,100-(n[0]+t)/e*100]},_.prototype._moveHueHandle=function(t,e){var n,r,o=this.huebarHandleElement,c=this.baseColorElement;t=Math.max(y[0],t),t=Math.min(y[1],t),l.setTranslateY(o,t),n=h.hsvToRGB(this.getHue(),100,100),r=h.rgbToHEX.apply(null,n),l.setGradientColorStop(c,r),e||this.fire("_selectColor",{color:h.rgbToHEX.apply(null,this.getRGB())})},_.prototype.moveHue=function(t,e){var n,r;n=((r=Math.abs(y[0]))+y[1])*(t=t||0)/359.99-r,this._moveHueHandle(n,e)},_.prototype._moveHueByPosition=function(t){var e=y[0];this._moveHueHandle(t+e)},_.prototype.getHue=function(){var t,e,n=this.huebarHandleElement,r=l.getTranslateXY(n);return e=(t=Math.abs(y[0]))+y[1],359.99*(r[0]+t)/e},_.prototype.getHSV=function(){var t=this.getSaturationAndValue();return[this.getHue()].concat(t)},_.prototype.getRGB=function(){return h.hsvToRGB.apply(null,this.getHSV())},_.prototype._prepareColorSliderForMouseEvent=function(t){var e=this.options,n=o.closest(t.target,"."+e.cssPrefix+"slider-part");return this._dragDataCache={isColorSlider:o.hasClass(n,e.cssPrefix+"slider-left"),parentElement:n}},_.prototype._onClick=function(t){var e=this._prepareColorSliderForMouseEvent(t),n=c.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(n[0],n[1]):this._moveHueByPosition(n[1]),this._dragDataCache=null},_.prototype._onDragStart=function(t){this._prepareColorSliderForMouseEvent(t)},_.prototype._onDrag=function(t){var e=this._dragDataCache,n=c.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(n[0],n[1]):this._moveHueByPosition(n[1])},_.prototype._onDragEnd=function(){this._dragDataCache=null},r.CustomEvents.mixin(_),t.exports=_},function(t,e,n){"use strict";var r=n(8),o=/[\.\-0-9]+/g,c={isOldBrowser:function(){var t=c._isOldBrowser;return r.isExisty(t)||(c._isOldBrowser=t=r.browser.msie&&r.browser.version<9),t},getTranslateXY:function(t){var e;return c.isOldBrowser()?(e=t.style,[parseFloat(e.top),parseFloat(e.left)]):(e=t.getAttribute("transform"))?(e=e.match(o),[parseFloat(e[1]),parseFloat(e[0])]):[0,0]},setTranslateXY:function(t,e,n){c.isOldBrowser()?(t.style.left=e+"px",t.style.top=n+"px"):t.setAttribute("transform","translate("+e+","+n+")")},setTranslateY:function(t,e){c.isOldBrowser()?t.style.top=e+"px":t.setAttribute("transform","translate(-6,"+e+")")},setStrokeColor:function(t,e){c.isOldBrowser()?t.strokecolor=e:t.setAttribute("stroke",e)},setGradientColorStop:function(t,e){c.isOldBrowser()?t.color=e:t.setAttribute("stop-color",e)}};t.exports=c},function(t,e,n){(function(e){"use strict";var r=n(8),o=['<div class="{{cssPrefix}}slider-left {{cssPrefix}}slider-part">{{slider}}</div>','<div class="{{cssPrefix}}slider-right {{cssPrefix}}slider-part">{{huebar}}</div>'].join("\n"),c=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-slider">',"<defs>",'<linearGradient id="{{cssPrefix}}svg-fill-color" x1="0%" y1="0%" x2="100%" y2="0%">','<stop offset="0%" stop-color="rgb(255,255,255)" />','<stop class="{{cssPrefix}}slider-basecolor" offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>",'<linearGradient id="{{cssPrefix}}svn-fill-black" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />','<stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:1" />',"</linearGradient>","</defs>",'<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svg-fill-color)"></rect>','<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svn-fill-black)"></rect>','<path transform="translate(0,0)" class="{{cssPrefix}}slider-handle" d="M0 7.5 L15 7.5 M7.5 15 L7.5 0 M2 7 a5.5 5.5 0 1 1 0 1 Z" stroke="black" stroke-width="0.75" fill="none" />',"</svg>"].join("\n"),l=['<div class="{{cssPrefix}}vml-slider">','<v:rect strokecolor="none" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill class="{{cssPrefix}}vml {{cssPrefix}}slider-basecolor" type="gradient" method="none" color="#ff0000" color2="#fff" angle="90" />',"</v:rect>",'<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill type="gradient" method="none" color="black" color2="white" o:opacity2="0%" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}slider-handle" coordsize="1 1" style="width:1px;height:1px;"path="m 0,7 l 14,7 m 7,14 l 7,0 ar 12,12 2,2 z" filled="false" stroked="true" />',"</div>"].join("\n"),h=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-huebar">',"<defs>",'<linearGradient id="g" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" stop-color="rgb(255,0,0)" />','<stop offset="16.666%" stop-color="rgb(255,255,0)" />','<stop offset="33.333%" stop-color="rgb(0,255,0)" />','<stop offset="50%" stop-color="rgb(0,255,255)" />','<stop offset="66.666%" stop-color="rgb(0,0,255)" />','<stop offset="83.333%" stop-color="rgb(255,0,255)" />','<stop offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>","</defs>",'<rect width="18px" height="100%" fill="url(#g)"></rect>','<path transform="translate(-6,-3)" class="{{cssPrefix}}huebar-handle" d="M0 0 L4 4 L0 8 L0 0 Z" fill="black" stroke="none" />',"</svg>"].join("\n"),f=['<div class="{{cssPrefix}}vml-huebar">','<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-huebar-bg">','<v:fill type="gradient" method="none" colors="0% rgb(255,0,0), 16.666% rgb(255,255,0), 33.333% rgb(0,255,0), 50% rgb(0,255,255), 66.666% rgb(0,0,255), 83.333% rgb(255,0,255), 100% rgb(255,0,0)" angle="180" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}huebar-handle" coordsize="1 1" style="width:1px;height:1px;position:absolute;z-index:1;right:22px;top:-3px;"path="m 0,0 l 4,4 l 0,8 l 0,0 z" filled="true" fillcolor="black" stroked="false" />',"</div>"].join("\n"),d=r.browser.msie&&r.browser.version<9;d&&e.document.namespaces.add("v","urn:schemas-microsoft-com:vml"),t.exports={layout:o,slider:d?l:c,huebar:d?f:h}}).call(e,function(){return this}())}])},t.exports=r(n(3))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(3),l=(r=c)&&r.__esModule?r:{default:r},h=n(72),f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._value=n.value||0,this.rangeElement=e,this._drawRangeElement(),this.rangeWidth=(0,h.toInteger)(window.getComputedStyle(e,null).width)-12,this._min=n.min||0,this._max=n.max||100,this._absMax=-1*this._min+this._max,this.realTimeEvent=n.realTimeEvent||!1,this._addClickEvent(),this._addDragEvent(),this.value=n.value,this.trigger("change")}return o(t,[{key:"trigger",value:function(t){this.fire(t,this._value)}},{key:"_drawRangeElement",value:function(){this.rangeElement.classList.add("tui-image-editor-range"),this.bar=document.createElement("div"),this.bar.className="tui-image-editor-virtual-range-bar",this.subbar=document.createElement("div"),this.subbar.className="tui-image-editor-virtual-range-subbar",this.pointer=document.createElement("div"),this.pointer.className="tui-image-editor-virtual-range-pointer",this.bar.appendChild(this.subbar),this.bar.appendChild(this.pointer),this.rangeElement.appendChild(this.bar)}},{key:"_addClickEvent",value:function(){var t=this;this.rangeElement.addEventListener("click",(function(e){if(e.stopPropagation(),"tui-image-editor-range"===e.target.className){var n=e.offsetX/t.rangeWidth,r=t._absMax*n+t._min;t.pointer.style.left=n*t.rangeWidth+"px",t.subbar.style.right=(1-n)*t.rangeWidth+"px",t._value=r,t.fire("change",r)}}))}},{key:"_addDragEvent",value:function(){var t=this;this.pointer.addEventListener("mousedown",(function(e){t.firstPosition=e.screenX,t.firstLeft=(0,h.toInteger)(t.pointer.style.left)||0,t.dragEventHandler={changeAngle:t._changeAngle.bind(t),stopChangingAngle:t._stopChangingAngle.bind(t)},document.addEventListener("mousemove",t.dragEventHandler.changeAngle),document.addEventListener("mouseup",t.dragEventHandler.stopChangingAngle)}))}},{key:"_changeAngle",value:function(t){var e=t.screenX-this.firstPosition,n=this.firstLeft+e;n=(n=n>this.rangeWidth?this.rangeWidth:n)<0?0:n,this.pointer.style.left=n+"px",this.subbar.style.right=this.rangeWidth-n+"px";var r=n/this.rangeWidth,o=this._absMax*r+this._min;this._value=o,this.realTimeEvent&&this.fire("change",o)}},{key:"_stopChangingAngle",value:function(){this.fire("change",this._value),document.removeEventListener("mousemove",this.dragEventHandler.changeAngle),document.removeEventListener("mouseup",this.dragEventHandler.stopChangingAngle)}},{key:"max",set:function(t){this._max=t,this._absMax=-1*this._min+this._max,this.value=this._value},get:function(){return this._max}},{key:"value",get:function(){return this._value},set:function(t){var e=(t-this._min)*this.rangeWidth/this._absMax;this.rangeWidth<e&&(e=this.rangeWidth),this.pointer.style.left=e+"px",this.subbar.style.right=this.rangeWidth-e+"px",this._value=t}}]),t}();l.default.CustomEvents.mixin(f),e.default=f},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(){function t(e,n){var r=n.locale,o=n.name,c=n.iconStyle,l=n.menuBarPosition,h=n.templateHtml;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.selector=function(t){return e.querySelector(t)},this.menuBarPosition=l,this.toggleDirection="top"===l?"down":"up",this.colorPickerControls=[],this._makeSubMenuElement(e,{locale:r,name:o,iconStyle:c,templateHtml:h})}return n(t,[{key:"colorPickerChangeShow",value:function(t){this.colorPickerControls.forEach((function(e){t!==e&&e.hide()}))}},{key:"getButtonType",value:function(button,t){return button.className.match(RegExp("("+t.join("|")+")"))[0]}},{key:"changeClass",value:function(t,e,n){t.classList.remove(e),t.classList.add(n)}},{key:"changeStandbyMode",value:function(){}},{key:"changeStartMode",value:function(){}},{key:"_makeSubMenuElement",value:function(t,e){var n=e.locale,r=e.name,o=e.iconStyle,c=e.templateHtml,l=document.createElement("div");l.className="tui-image-editor-menu-"+r,l.innerHTML=c({locale:n,iconStyle:o}),t.appendChild(l)}}]),t}();e.default=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-shape-button">\n            <div class="tui-image-editor-button rect">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-rectangle"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-shape-rectangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Rectangle")+' </label>\n            </div>\n            <div class="tui-image-editor-button circle">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-circle"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-shape-circle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Circle")+' </label>\n            </div>\n            <div class="tui-image-editor-button triangle">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-triangle"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-shape-triangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Triangle")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-shape-color-button">\n            <div id="tie-color-fill" title="'+e.localize("Fill")+'"></div>\n            <div id="tie-color-stroke" title="'+e.localize("Stroke")+'"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Stroke")+'</label>\n            <div id="tie-stroke-range"></div>\n            <input id="tie-stroke-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(3)),c=h(n(84)),l=h(n(87));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t,n){var r=n.locale,o=n.iconStyle,c=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"crop",iconStyle:o,menuBarPosition:c,templateHtml:l.default}));return h.status="active",h._els={apply:h.selector("#tie-crop-button .apply"),cancel:h.selector("#tie-crop-button .cancel"),preset:h.selector("#tie-crop-preset-button")},h.defaultPresetButton=h._els.preset.querySelector(".preset-none"),h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){var e=this;this.actions=t,this._els.apply.addEventListener("click",(function(){e.actions.crop(),e._els.apply.classList.remove("active")})),this._els.cancel.addEventListener("click",(function(){e.actions.cancel(),e._els.apply.classList.remove("active")})),this._els.preset.addEventListener("click",(function(t){var button=t.target.closest(".tui-image-editor-button.preset");if(button){var n=button.className.match(/preset-[^\s]+/)[0];e._setPresetButtonActive(button),e.actions.preset(n)}}))}},{key:"changeStartMode",value:function(){this.actions.modeChange("crop")}},{key:"changeStandbyMode",value:function(){this.actions.stopDrawingMode(),this._setPresetButtonActive()}},{key:"changeApplyButtonStatus",value:function(t){t?this._els.apply.classList.add("active"):this._els.apply.classList.remove("active")}},{key:"_setPresetButtonActive",value:function(){var button=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultPresetButton;o.default.forEach([].slice.call(this._els.preset.querySelectorAll(".preset")),(function(t){t.classList.remove("active")})),button&&button.classList.add("active")}}]),e}(c.default);e.default=f},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-crop-preset-button">\n            <div class="tui-image-editor-button preset preset-none active">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-rectangle"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-shape-rectangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Custom")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-square">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Square")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-3-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("3:2")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-4-3">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("4:3")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-5-4">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("5:4")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-7-5">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("7:5")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-16-9">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("16:9")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition tui-image-editor-newline">\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li id="tie-crop-button" class="action">\n            <div class="tui-image-editor-button apply">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-apply" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-apply" class="active"/>\n                </svg>\n                <label>\n                    '+e.localize("Apply")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button cancel">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-cancel" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-cancel" class="active"/>\n                </svg>\n                <label>\n                    '+e.localize("Cancel")+"\n                </label>\n            </div>\n        </li>\n    </ul>\n"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(3)),c=h(n(84)),l=h(n(89));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t,n){var r=n.locale,o=n.iconStyle,c=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"flip",iconStyle:o,menuBarPosition:c,templateHtml:l.default}));return h.flipStatus=!1,h._els={flipButton:h.selector("#tie-flip-button")},h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this._actions=t,this._els.flipButton.addEventListener("click",this._changeFlip.bind(this))}},{key:"_changeFlip",value:function(t){var e=this,button=t.target.closest(".tui-image-editor-button");if(button){var n=this.getButtonType(button,["flipX","flipY","resetFlip"]);if(!this.flipStatus&&"resetFlip"===n)return;this._actions.flip(n).then((function(t){var n=e._els.flipButton.classList;e.flipStatus=!1,n.remove("resetFlip"),o.default.forEach(["flipX","flipY"],(function(r){n.remove(r),t[r]&&(n.add(r),n.add("resetFlip"),e.flipStatus=!0)}))}))}}}]),e}(c.default);e.default=f},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul id="tie-flip-button" class="tui-image-editor-submenu-item">\n        <li>\n            <div class="tui-image-editor-button flipX">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-flip-x" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-flip-x" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Flip X")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button flipY">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-flip-y" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-flip-y" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Flip Y")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div class="tui-image-editor-button resetFlip">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-flip-reset"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-flip-reset"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Reset")+"\n                </label>\n            </div>\n        </li>\n    </ul>\n"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=d(n(83)),c=d(n(84)),l=d(n(91)),h=n(72),f=n(73);function d(t){return t&&t.__esModule?t:{default:t}}var v=function(t){function e(t,n){var r=n.locale,c=n.iconStyle,h=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var d=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"rotate",iconStyle:c,menuBarPosition:h,templateHtml:l.default}));return d._els={rotateButton:d.selector("#tie-retate-button"),rotateRange:new o.default(d.selector("#tie-rotate-range"),f.defaultRotateRangeValus),rotateRangeValue:d.selector("#tie-ratate-range-value")},d}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.rotateButton.addEventListener("click",this._changeRotateForButton.bind(this)),this._els.rotateRange.on("change",this._changeRotateForRange.bind(this)),this._els.rotateRangeValue.setAttribute("readonly",!0)}},{key:"_changeRotateForRange",value:function(t){var e=(0,h.toInteger)(t);this._els.rotateRangeValue.value=e,this.actions.setAngle(e)}},{key:"_changeRotateForButton",value:function(t){var button=t.target.closest(".tui-image-editor-button");if(button){var e={clockwise:30,counterclockwise:-30}[this.getButtonType(button,["counterclockwise","clockwise"])];this.actions.rotate(e)}}}]),e}(c.default);e.default=v},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-retate-button">\n            <div class="tui-image-editor-button clockwise">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-rotate-clockwise"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-rotate-clockwise"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> 30 </label>\n            </div>\n            <div class="tui-image-editor-button counterclockwise">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-rotate-counterclockwise"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-rotate-counterclockwise"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> -30 </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Range")+'</label>\n            <div id="tie-rotate-range"></div>\n            <input id="tie-ratate-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(83)),c=v(n(81)),l=v(n(84)),h=v(n(93)),f=n(72),d=n(73);function v(t){return t&&t.__esModule?t:{default:t}}var m=function(t){function e(t,n){var r=n.locale,l=n.iconStyle,f=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var v=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"text",iconStyle:l,menuBarPosition:f,templateHtml:h.default}));return v.effect={bold:!1,italic:!1,underline:!1},v.align="left",v._els={textEffectButton:v.selector("#tie-text-effect-button"),textAlignButton:v.selector("#tie-text-align-button"),textColorpicker:new c.default(v.selector("#tie-text-color"),"#ffbb3b",v.toggleDirection),textRange:new o.default(v.selector("#tie-text-range"),d.defaultTextRangeValus),textRangeValue:v.selector("#tie-text-range-value")},v}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.textEffectButton.addEventListener("click",this._setTextEffectHandler.bind(this)),this._els.textAlignButton.addEventListener("click",this._setTextAlignHandler.bind(this)),this._els.textRange.on("change",this._changeTextRnageHandler.bind(this)),this._els.textRangeValue.value=this._els.textRange.value,this._els.textRangeValue.setAttribute("readonly",!0),this._els.textColorpicker.on("change",this._changeColorHandler.bind(this))}},{key:"changeStandbyMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeStartMode",value:function(){this.actions.modeChange("text")}},{key:"_setTextEffectHandler",value:function(t){var button=t.target.closest(".tui-image-editor-button"),e=button.className.match(/(bold|italic|underline)/)[0],n={bold:{fontWeight:"bold"},italic:{fontStyle:"italic"},underline:{textDecoration:"underline"}}[e];this.effect[e]=!this.effect[e],button.classList.toggle("active"),this.actions.changeTextStyle(n)}},{key:"_setTextAlignHandler",value:function(t){var button=t.target.closest(".tui-image-editor-button");if(button){var e=this.getButtonType(button,["left","center","right"]);t.currentTarget.classList.remove(this.align),this.align!==e&&t.currentTarget.classList.add(e),this.actions.changeTextStyle({textAlign:e}),this.align=e}}},{key:"_changeTextRnageHandler",value:function(t){t=(0,f.toInteger)(t),(0,f.toInteger)(this._els.textRangeValue.value)!==t&&(this.actions.changeTextStyle({fontSize:t}),this._els.textRangeValue.value=t)}},{key:"_changeColorHandler",value:function(t){t=t||"transparent",this.actions.changeTextStyle({fill:t})}},{key:"textColor",get:function(){return this._els.textColorpicker.color}},{key:"fontSize",get:function(){return this._els.textRange.value},set:function(t){this._els.textRange.value=t,this._els.textRangeValue.value=t}}]),e}(l.default);e.default=m},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-text-effect-button">\n            <div class="tui-image-editor-button bold">\n                <div>\n                    <svg class="svg_ic-submenu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-text-bold" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-text-bold" class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Bold")+' </label>\n            </div>\n            <div class="tui-image-editor-button italic">\n                <div>\n                    <svg class="svg_ic-submenu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-text-italic" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-text-italic" class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Italic")+' </label>\n            </div>\n            <div class="tui-image-editor-button underline">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-text-underline"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-text-underline"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Underline")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-text-align-button">\n            <div class="tui-image-editor-button left">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+r.path+"#"+r.name+'-ic-text-align-left"\n                        class="normal"/>\n                     <use xlink:href="'+o.path+"#"+o.name+'-ic-text-align-left"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Left")+' </label>\n            </div>\n            <div class="tui-image-editor-button center">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+r.path+"#"+r.name+'-ic-text-align-center"\n                        class="normal"/>\n                     <use xlink:href="'+o.path+"#"+o.name+'-ic-text-align-center"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Center")+' </label>\n            </div>\n            <div class="tui-image-editor-button right">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+r.path+"#"+r.name+'-ic-text-align-right"\n                        class="normal"/>\n                     <use xlink:href="'+o.path+"#"+o.name+'-ic-text-align-right"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Right")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-text-color" title="'+e.localize("Color")+'"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Text size")+'</label>\n            <div id="tie-text-range"></div>\n            <input id="tie-text-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(84)),c=h(n(72)),l=h(n(95));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t,n){var r=n.locale,o=n.iconStyle,c=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"mask",iconStyle:o,menuBarPosition:c,templateHtml:l.default}));return h._els={applyButton:h.selector("#tie-mask-apply"),maskImageButton:h.selector("#tie-mask-image-file")},h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.maskImageButton.addEventListener("change",this._loadMaskFile.bind(this)),this._els.applyButton.addEventListener("click",this._applyMask.bind(this))}},{key:"_applyMask",value:function(){this.actions.applyFilter(),this._els.applyButton.classList.remove("active")}},{key:"_loadMaskFile",value:function(t){var e=void 0;c.default.isSupportFileApi()||alert("This browser does not support file-api");var n=t.target.files[0];n&&(e=URL.createObjectURL(n),this.actions.loadImageFromURL(e,n),this._els.applyButton.classList.add("active"))}}]),e}(o.default);e.default=f},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li>\n            <div class="tui-image-editor-button">\n                <div>\n                    <input type="file" accept="image/*" id="tie-mask-image-file">\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-mask-load" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-mask-load" class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Load Mask Image")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li id="tie-mask-apply" class="tui-image-editor-newline apply" style="margin-top: 22px;margin-bottom: 5px">\n            <div class="tui-image-editor-button apply">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-apply" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-apply" class="active"/>\n                </svg>\n                <label>\n                    '+e.localize("Apply")+"\n                </label>\n            </div>\n        </li>\n    </ul>\n"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(3)),c=v(n(81)),l=v(n(84)),h=v(n(97)),f=n(72),d=n(73);function v(t){return t&&t.__esModule?t:{default:t}}var m=function(t){function e(t,n){var r=n.locale,o=n.iconStyle,l=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var f=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"icon",iconStyle:o,menuBarPosition:l,templateHtml:h.default}));return f.iconType=null,f._iconMap={},f._els={registIconButton:f.selector("#tie-icon-image-file"),addIconButton:f.selector("#tie-icon-add-button"),iconColorpicker:new c.default(f.selector("#tie-icon-color"),"#ffbb3b",f.toggleDirection)},f}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.iconColorpicker.on("change",this._changeColorHandler.bind(this)),this._els.registIconButton.addEventListener("change",this._registeIconHandler.bind(this)),this._els.addIconButton.addEventListener("click",this._addIconHandler.bind(this))}},{key:"clearIconType",value:function(){this._els.addIconButton.classList.remove(this.iconType),this.iconType=null}},{key:"registDefaultIcon",value:function(){var t=this;o.default.forEach(d.defaultIconPath,(function(path,e){t.actions.registDefalutIcons(e,path)}))}},{key:"setIconPickerColor",value:function(t){this._els.iconColorpicker.color=t}},{key:"changeStandbyMode",value:function(){this.clearIconType(),this.actions.cancelAddIcon()}},{key:"_changeColorHandler",value:function(t){t=t||"transparent",this.actions.changeColor(t)}},{key:"_addIconHandler",value:function(t){var button=t.target.closest(".tui-image-editor-button");if(button){var e=button.getAttribute("data-icontype"),n=this._els.iconColorpicker.color;this.actions.discardSelection(),this.actions.changeSelectableAll(!1),this._els.addIconButton.classList.remove(this.iconType),this._els.addIconButton.classList.add(e),this.iconType===e?this.changeStandbyMode():(this.actions.addIcon(e,n),this.iconType=e)}}},{key:"_registeIconHandler",value:function(t){var e=void 0;f.isSupportFileApi||alert("This browser does not support file-api");var n=t.target.files[0];n&&(e=URL.createObjectURL(n),this.actions.registCustomIcon(e,n))}}]),e}(l.default);e.default=m},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-icon-add-button">\n            <div class="tui-image-editor-button" data-icontype="icon-arrow">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-arrow"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-arrow"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Arrow")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-arrow-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-arrow-2"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-arrow-2"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Arrow-2")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-arrow-3">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-arrow-3"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-arrow-3"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Arrow-3")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-star">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-star" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-star" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Star-1")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-star-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-star-2"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-star-2"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Star-2")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-polygon">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-polygon"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-polygon"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Polygon")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-location">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-location"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-location"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Location")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-heart">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-heart"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-heart"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Heart")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-bubble">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-bubble"\n                            class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-bubble"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Bubble")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-icon-add-button">\n            <div class="tui-image-editor-button" style="margin:0">\n                <div>\n                    <input type="file" accept="image/*" id="tie-icon-image-file">\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-load" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-icon-load" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Custom icon")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-icon-color" title="'+e.localize("Color")+'"></div>\n        </li>\n    </ul>\n'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(72)),c=v(n(81)),l=v(n(83)),h=v(n(84)),f=v(n(99)),d=n(73);function v(t){return t&&t.__esModule?t:{default:t}}var m=function(t){function e(t,n){var r=n.locale,o=n.iconStyle,h=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var v=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"draw",iconStyle:o,menuBarPosition:h,templateHtml:f.default}));return v._els={lineSelectButton:v.selector("#tie-draw-line-select-button"),drawColorpicker:new c.default(v.selector("#tie-draw-color"),"#00a9ff",v.toggleDirection),drawRange:new l.default(v.selector("#tie-draw-range"),d.defaultDrawRangeValus),drawRangeValue:v.selector("#tie-draw-range-value")},v.type=null,v.color=v._els.drawColorpicker.color,v.width=v._els.drawRange.value,v}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){this.actions=t,this._els.lineSelectButton.addEventListener("click",this._changeDrawType.bind(this)),this._els.drawColorpicker.on("change",this._changeDrawColor.bind(this)),this._els.drawRange.on("change",this._changeDrawRange.bind(this)),this._els.drawRangeValue.value=this._els.drawRange.value,this._els.drawRangeValue.setAttribute("readonly",!0)}},{key:"setDrawMode",value:function(){this.actions.setDrawMode(this.type,{width:this.width,color:o.default.getRgb(this.color,.7)})}},{key:"changeStandbyMode",value:function(){this.type=null,this.actions.stopDrawingMode(),this.actions.changeSelectableAll(!0),this._els.lineSelectButton.classList.remove("free"),this._els.lineSelectButton.classList.remove("line")}},{key:"changeStartMode",value:function(){this.type="free",this._els.lineSelectButton.classList.add("free"),this.setDrawMode()}},{key:"_changeDrawType",value:function(t){var button=t.target.closest(".tui-image-editor-button");if(button){var e=this.getButtonType(button,["free","line"]);if(this.actions.discardSelection(),this.type===e)return void this.changeStandbyMode();this.changeStandbyMode(),this.type=e,this._els.lineSelectButton.classList.add(e),this.setDrawMode()}}},{key:"_changeDrawColor",value:function(t){this.color=t||"transparent",this.type?this.setDrawMode():this.changeStartMode()}},{key:"_changeDrawRange",value:function(t){t=o.default.toInteger(t),this._els.drawRangeValue.value=t,this.width=t,this.type?this.setDrawMode():this.changeStartMode()}}]),e}(h.default);e.default=m},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,n=t.iconStyle,r=n.normal,o=n.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-draw-line-select-button">\n            <div class="tui-image-editor-button free">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-draw-free" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-draw-free" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Free")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button line">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-draw-line" class="normal"/>\n                        <use xlink:href="'+o.path+"#"+o.name+'-ic-draw-line" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Straight")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-draw-color" title="'+e.localize("Color")+'"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Range")+'</label>\n            <div id="tie-draw-range"></div>\n            <input id="tie-draw-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=m(n(3)),c=m(n(81)),l=m(n(83)),h=m(n(84)),f=m(n(101)),d=n(72),v=n(73);function m(t){return t&&t.__esModule?t:{default:t}}var y=["add","diff","subtract","multiply","screen","lighten","darken"],_=["grayscale","invert","sepia","sepia2","blur","sharpen","emboss","remove-white","gradient-transparency","brightness","noise","pixelate","color-filter","tint","multiply","blend"],x=function(t){function e(t,n){var r=n.locale,o=n.iconStyle,c=n.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{locale:r,name:"filter",iconStyle:o,menuBarPosition:c,templateHtml:f.default}));return l.selectBoxShow=!1,l.checkedMap={},l._makeControlElement(),l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"addEvent",value:function(t){var e=this,n=t.applyFilter,r=this._changeRangeValue.bind(this,n);o.default.forEach(_,(function(t){var n=e.selector("#tie-"+t),o=(0,d.toCamelCase)(t);e.checkedMap[o]=n,n.addEventListener("change",(function(){return r(o)}))})),this._els.removewhiteThresholdRange.on("change",(function(){return r("removeWhite")})),this._els.removewhiteDistanceRange.on("change",(function(){return r("removeWhite")})),this._els.gradientTransparencyRange.on("change",(function(){return r("gradientTransparency")})),this._els.colorfilterThresholeRange.on("change",(function(){return r("colorFilter")})),this._els.pixelateRange.on("change",(function(){return r("pixelate")})),this._els.noiseRange.on("change",(function(){return r("noise")})),this._els.brightnessRange.on("change",(function(){return r("brightness")})),this._els.blendType.addEventListener("change",(function(){return r("blend")})),this._els.filterBlendColor.on("change",(function(){return r("blend")})),this._els.filterMultiplyColor.on("change",(function(){return r("multiply")})),this._els.tintOpacity.on("change",(function(){return r("tint")})),this._els.filterTintColor.on("change",(function(){return r("tint")})),this._els.blendType.addEventListener("click",(function(t){return t.stopPropagation()})),this._els.filterMultiplyColor.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.filterTintColor.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.filterBlendColor.on("changeShow",this.colorPickerChangeShow.bind(this))}},{key:"_changeRangeValue",value:function(t,e){var n=this.checkedMap[e].checked,r=e,o=this.checkedMap[e].closest(".tui-image-editor-checkbox-group");o&&(n?o.classList.remove("tui-image-editor-disabled"):o.classList.add("tui-image-editor-disabled")),t(n,r,this._getFilterOption(r))}},{key:"_getFilterOption",value:function(t){var option={};switch(t){case"removeWhite":option.threshold=(0,d.toInteger)(this._els.removewhiteThresholdRange.value),option.distance=(0,d.toInteger)(this._els.removewhiteDistanceRange.value);break;case"gradientTransparency":option.threshold=(0,d.toInteger)(this._els.gradientTransparencyRange.value);break;case"colorFilter":option.color="#FFFFFF",option.threshold=this._els.colorfilterThresholeRange.value;break;case"pixelate":option.blocksize=(0,d.toInteger)(this._els.pixelateRange.value);break;case"noise":option.noise=(0,d.toInteger)(this._els.noiseRange.value);break;case"brightness":option.brightness=(0,d.toInteger)(this._els.brightnessRange.value);break;case"blend":option.color=this._els.filterBlendColor.color,option.mode=this._els.blendType.value;break;case"multiply":option.color=this._els.filterMultiplyColor.color;break;case"tint":option.color=this._els.filterTintColor.color,option.opacity=this._els.tintOpacity.value}return option}},{key:"_makeControlElement",value:function(){var t=this.selector;this._els={removewhiteThresholdRange:new l.default(t("#tie-removewhite-threshold-range"),v.defaultFilterRangeValus.removewhiteThresholdRange),removewhiteDistanceRange:new l.default(t("#tie-removewhite-distance-range"),v.defaultFilterRangeValus.removewhiteDistanceRange),gradientTransparencyRange:new l.default(t("#tie-gradient-transparency-range"),v.defaultFilterRangeValus.gradientTransparencyRange),brightnessRange:new l.default(t("#tie-brightness-range"),v.defaultFilterRangeValus.brightnessRange),noiseRange:new l.default(t("#tie-noise-range"),v.defaultFilterRangeValus.noiseRange),pixelateRange:new l.default(t("#tie-pixelate-range"),v.defaultFilterRangeValus.pixelateRange),colorfilterThresholeRange:new l.default(t("#tie-colorfilter-threshole-range"),v.defaultFilterRangeValus.colorfilterThresholeRange),filterTintColor:new c.default(t("#tie-filter-tint-color"),"#03bd9e",this.toggleDirection),filterMultiplyColor:new c.default(t("#tie-filter-multiply-color"),"#515ce6",this.toggleDirection),filterBlendColor:new c.default(t("#tie-filter-blend-color"),"#ffbb3b",this.toggleDirection)},this._els.tintOpacity=this._pickerWithRange(this._els.filterTintColor.pickerControl),this._els.blendType=this._pickerWithSelectbox(this._els.filterBlendColor.pickerControl),this.colorPickerControls.push(this._els.filterTintColor),this.colorPickerControls.push(this._els.filterMultiplyColor),this.colorPickerControls.push(this._els.filterBlendColor)}},{key:"_pickerWithRange",value:function(t){var e=document.createElement("div"),n=document.createElement("label"),r=document.createElement("div");return r.id="tie-filter-tint-opacity",n.innerHTML="Opacity",e.appendChild(n),e.appendChild(r),t.appendChild(e),t.style.height="130px",new l.default(r,v.defaultFilterRangeValus.tintOpacityRange)}},{key:"_pickerWithSelectbox",value:function(t){var e=document.createElement("div"),n=document.createElement("select"),r=document.createElement("ul");return e.className="tui-image-editor-selectlist-wrap",r.className="tui-image-editor-selectlist",e.appendChild(n),e.appendChild(r),this._makeSelectOptionList(n),t.appendChild(e),t.style.height="130px",this._drawSelectOptionList(n,r),this._pickerWithSelectboxForAddEvent(n,r),n}},{key:"_drawSelectOptionList",value:function(t,e){var n=t.querySelectorAll("option");o.default.forEach(n,(function(option){var t=document.createElement("li");t.innerHTML=option.innerHTML,t.setAttribute("data-item",option.value),e.appendChild(t)}))}},{key:"_pickerWithSelectboxForAddEvent",value:function(t,e){var n=this;e.addEventListener("click",(function(r){var o=r.target.getAttribute("data-item"),c=document.createEvent("HTMLEvents");t.querySelector('[value="'+o+'"]').selected=!0,c.initEvent("change",!0,!0),t.dispatchEvent(c),n.selectBoxShow=!1,e.style.display="none"})),t.addEventListener("mousedown",(function(r){r.preventDefault(),n.selectBoxShow=!n.selectBoxShow,e.style.display=n.selectBoxShow?"block":"none",e.setAttribute("data-selectitem",t.value),e.querySelector("[data-item='"+t.value+"']").classList.add("active")}))}},{key:"_makeSelectOptionList",value:function(t){o.default.forEach(y,(function(option){var e=document.createElement("option");e.setAttribute("value",option),e.innerHTML=option.replace(/^[a-z]/,(function(t){return t.toUpperCase()})),t.appendChild(e)}))}}]),e}(h.default);e.default=x},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-wrap fixed-width">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-grayscale">\n                    <label for="tie-grayscale">'+e.localize("Grayscale")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-invert">\n                    <label for="tie-invert">'+e.localize("Invert")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sepia">\n                    <label for="tie-sepia">'+e.localize("Sepia")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sepia2">\n                    <label for="tie-sepia2">'+e.localize("Sepia2")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-blur">\n                    <label for="tie-blur">'+e.localize("Blur")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sharpen">\n                    <label for="tie-sharpen">'+e.localize("Sharpen")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-emboss">\n                    <label for="tie-emboss">'+e.localize("Emboss")+'</label>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled" style="margin-bottom: 7px;">\n                <div class="tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-remove-white">\n                        <label for="tie-remove-white">'+e.localize("Remove White")+'</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Threshold")+'</label>\n                    <div id="tie-removewhite-threshold-range"></div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Distance")+'</label>\n                    <div id="tie-removewhite-distance-range"></div>\n                </div>\n            </div>\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-newline tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-gradient-transparency">\n                        <label for="tie-gradient-transparency">'+e.localize("Grayscale")+'</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Value")+'</label>\n                    <div id="tie-gradient-transparency-range"></div>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-brightness">\n                    <label for="tie-brightness">'+e.localize("Brightness")+'</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-brightness-range"></div>\n                </div>\n            </div>\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-noise">\n                    <label for="tie-noise">'+e.localize("Noise")+'</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-noise-range"></div>\n                </div>\n            </div>\n\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-pixelate">\n                    <label for="tie-pixelate">'+e.localize("Pixelate")+'</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-pixelate-range"></div>\n                </div>\n            </div>\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-newline tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-color-filter">\n                        <label for="tie-color-filter">'+e.localize("Color Filter")+'</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Threshold")+'</label>\n                    <div id="tie-colorfilter-threshole-range"></div>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div class="filter-color-item">\n                <div id="tie-filter-tint-color" title="'+e.localize("Tint")+'"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-tint">\n                    <label for="tie-tint"></label>\n                </div>\n            </div>\n            <div class="filter-color-item">\n                <div id="tie-filter-multiply-color" title="'+e.localize("Multiply")+'"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-multiply">\n                    <label for="tie-multiply"></label>\n                </div>\n            </div>\n            <div class="filter-color-item">\n                <div id="tie-filter-blend-color" title="'+e.localize("Blend")+'"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-blend">\n                    <label for="tie-blend"></label>\n                </div>\n            </div>\n        </li>\n    </ul>\n'}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._locale=e}return n(t,[{key:"localize",value:function(t){return this._locale[t]||t}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=l(n(72)),c=l(n(104));function l(t){return t&&t.__esModule?t:{default:t}}e.default={getActions:function(){return{main:this._mainAction(),shape:this._shapeAction(),crop:this._cropAction(),flip:this._flipAction(),rotate:this._rotateAction(),text:this._textAction(),mask:this._maskAction(),draw:this._drawAction(),icon:this._iconAction(),filter:this._filterAction()}},_mainAction:function(){var t=this,e=function(){"crop"===t.ui.submenu&&(t.stopDrawingMode(),t.ui.changeMenu("crop"))};return(0,r.extend)({initLoadImage:function(n,r){return t.loadImageFromURL(n,r).then((function(r){e(),t.ui.initializeImgUrl=n,t.ui.resizeEditor({imageSize:r}),t.clearUndoStack()}))},undo:function(){t.isEmptyUndoStack()||(e(),t.undo())},redo:function(){t.isEmptyRedoStack()||(e(),t.redo())},reset:function(){e(),t.loadImageFromURL(t.ui.initializeImgUrl,"resetImage").then((function(n){e(),t.ui.resizeEditor({imageSize:n}),t.clearUndoStack()}))},delete:function(){t.ui.changeDeleteButtonEnabled(!1),e(),t.removeActiveObject(),t.activeObjectId=null},deleteAll:function(){e(),t.clearObjects(),t.ui.changeDeleteButtonEnabled(!1),t.ui.changeDeleteAllButtonEnabled(!1)},load:function(n){o.default.isSupportFileApi()||alert("This browser does not support file-api"),t.ui.initializeImgUrl=URL.createObjectURL(n),t.loadImageFromFile(n).then((function(n){e(),t.clearUndoStack(),t.ui.activeMenuEvent(),t.ui.resizeEditor({imageSize:n})})).catch((function(t){return Promise.reject(t)}))},download:function(){var e=t.toDataURL(),n=t.getImageName(),r=void 0,c=void 0;o.default.isSupportFileApi()&&window.saveAs?(c=(r=o.default.base64ToBlob(e)).type.split("/")[1],n.split(".").pop()!==c&&(n+="."+c),saveAs(r,n)):window.open().document.body.innerHTML="<img src='"+e+"'>"}},this._commonAction())},_iconAction:function(){var t=this,e=void 0,n=void 0,o=void 0,l=void 0,h=void 0,f=void 0,d=void 0;this.on({iconCreateResize:function(e){var n=e.moveOriginPointer,r=(n.x-o)/h,c=(n.y-l)/f;t.setObjectPropertiesQuietly(d,{scaleX:Math.abs(2*r),scaleY:Math.abs(2*c)})},iconCreateEnd:function(){t.ui.icon.clearIconType(),t.changeSelectableAll(!0)}});var v=function(r,c){o=c.x,l=c.y,t.addIcon(e,{left:c.x,top:c.y,fill:n}).then((function(t){d=t.id,h=t.width,f=t.height}))};return(0,r.extend)({changeColor:function(e){t.activeObjectId&&t.changeIconColor(t.activeObjectId,e)},addIcon:function(r,o){e=r,n=o,t.changeCursor("crosshair"),t.off("mousedown"),t.once("mousedown",v.bind(t))},cancelAddIcon:function(){t.off("mousedown"),t.ui.icon.clearIconType(),t.changeSelectableAll(!0),t.changeCursor("default")},registDefalutIcons:function(e,path){var n={};n[e]=path,t.registerIcons(n)},registCustomIcon:function(e,n){(new c.default).imageToSVG(e,(function(e){var r=e.match(/path[^>]*d="([^"]*)"/)[1],o={};o[n.name]=r,t.registerIcons(o),t.addIcon(n.name,{left:100,top:100})}),c.default.tracerDefaultOption())}},this._commonAction())},_drawAction:function(){var t=this;return(0,r.extend)({setDrawMode:function(e,n){t.stopDrawingMode(),"free"===e?t.startDrawingMode("FREE_DRAWING",n):t.startDrawingMode("LINE_DRAWING",n)},setColor:function(e){t.setBrush({color:e})}},this._commonAction())},_maskAction:function(){var t=this;return(0,r.extend)({loadImageFromURL:function(e,n){return t.loadImageFromURL(t.toDataURL(),"FilterImage").then((function(){t.addImageObject(e).then((function(){URL.revokeObjectURL(n)}))}))},applyFilter:function(){t.applyFilter("mask",{maskObjId:t.activeObjectId})}},this._commonAction())},_textAction:function(){var t=this;return(0,r.extend)({changeTextStyle:function(e){t.activeObjectId&&t.changeTextStyle(t.activeObjectId,e)}},this._commonAction())},_rotateAction:function(){var t=this;return(0,r.extend)({rotate:function(e){t.rotate(e),t.ui.resizeEditor()},setAngle:function(e){t.setAngle(e),t.ui.resizeEditor()}},this._commonAction())},_shapeAction:function(){var t=this;return(0,r.extend)({changeShape:function(e){t.activeObjectId&&t.changeShape(t.activeObjectId,e)},setDrawingShape:function(e){t.setDrawingShape(e)}},this._commonAction())},_cropAction:function(){var t=this;return(0,r.extend)({crop:function(){var e=t.getCropzoneRect();e&&t.crop(e).then((function(){t.stopDrawingMode(),t.ui.resizeEditor(),t.ui.changeMenu("crop")})).catch((function(t){return Promise.reject(t)}))},cancel:function(){t.stopDrawingMode(),t.ui.changeMenu("crop")},preset:function(e){switch(e){case"preset-square":t.setCropzoneRect(1);break;case"preset-3-2":t.setCropzoneRect(1.5);break;case"preset-4-3":t.setCropzoneRect(4/3);break;case"preset-5-4":t.setCropzoneRect(5/4);break;case"preset-7-5":t.setCropzoneRect(1.4);break;case"preset-16-9":t.setCropzoneRect(16/9);break;default:t.setCropzoneRect(),t.ui.crop.changeApplyButtonStatus(!1)}}},this._commonAction())},_flipAction:function(){var t=this;return(0,r.extend)({flip:function(e){return t[e]()}},this._commonAction())},_filterAction:function(){var t=this;return(0,r.extend)({applyFilter:function(e,n,r){e?t.applyFilter(n,r):t.hasFilter(n)&&t.removeFilter(n)}},this._commonAction())},setReAction:function(){var t=this;this.on({undoStackChanged:function(e){e?(t.ui.changeUndoButtonStatus(!0),t.ui.changeResetButtonStatus(!0)):(t.ui.changeUndoButtonStatus(!1),t.ui.changeResetButtonStatus(!1)),t.ui.resizeEditor()},redoStackChanged:function(e){e?t.ui.changeRedoButtonStatus(!0):t.ui.changeRedoButtonStatus(!1),t.ui.resizeEditor()},objectActivated:function(e){t.activeObjectId=e.id,t.ui.changeDeleteButtonEnabled(!0),t.ui.changeDeleteAllButtonEnabled(!0),"cropzone"===e.type?t.ui.crop.changeApplyButtonStatus(!0):["rect","circle","triangle"].indexOf(e.type)>-1?(t.stopDrawingMode(),"shape"!==t.ui.submenu&&t.ui.changeMenu("shape",!1,!1),t.ui.shape.setShapeStatus({strokeColor:e.stroke,strokeWidth:e.strokeWidth,fillColor:e.fill}),t.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height))):"path"===e.type||"line"===e.type?"draw"!==t.ui.submenu&&(t.ui.changeMenu("draw",!1,!1),t.ui.draw.changeStandbyMode()):["i-text","text"].indexOf(e.type)>-1?"text"!==t.ui.submenu&&t.ui.changeMenu("text",!1,!1):"icon"===e.type&&(t.stopDrawingMode(),"icon"!==t.ui.submenu&&t.ui.changeMenu("icon",!1,!1),t.ui.icon.setIconPickerColor(e.fill))},addText:function(e){t.addText("Double Click",{position:e.originPosition,styles:{fill:t.ui.text.textColor,fontSize:o.default.toInteger(t.ui.text.fontSize),fontFamily:"Noto Sans"}}).then((function(){t.changeCursor("default")}))},addObjectAfter:function(e){["rect","circle","triangle"].indexOf(e.type)>-1&&(t.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height)),t.ui.shape.changeStandbyMode())},objectScaled:function(e){if(["i-text","text"].indexOf(e.type)>-1)t.ui.text.fontSize=o.default.toInteger(e.fontSize);else if(["rect","circle","triangle"].indexOf(e.type)>=0){var n=e.width,r=e.height,c=t.ui.shape.getStrokeValue();n<c&&t.ui.shape.setStrokeValue(n),r<c&&t.ui.shape.setStrokeValue(r)}},selectionCleared:function(){t.activeObjectId=null,"text"===t.ui.submenu?t.changeCursor("text"):"draw"!==t.ui.submenu&&"crop"!==t.ui.submenu&&t.stopDrawingMode()}})},_commonAction:function(){var t=this;return{modeChange:function(menu){switch(menu){case"text":t._changeActivateMode("TEXT");break;case"crop":t.startDrawingMode("CROPPER");break;case"shape":t._changeActivateMode("SHAPE"),t.setDrawingShape(t.ui.shape.type,t.ui.shape.options)}},deactivateAll:this.deactivateAll.bind(this),changeSelectableAll:this.changeSelectableAll.bind(this),discardSelection:this.discardSelection.bind(this),stopDrawingMode:this.stopDrawingMode.bind(this)}},mixin:function(t){(0,r.extend)(t.prototype,this)}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.versionnumber="1.2.4",this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}]}return n(t,null,[{key:"tracerDefaultOption",value:function(){return{pathomit:100,ltres:.1,qtres:1,scale:1,strokewidth:5,viewbox:!1,linefilter:!0,desc:!1,rightangleenhance:!1,pal:[{r:0,g:0,b:0,a:255},{r:255,g:255,b:255,a:255}]}}}]),n(t,[{key:"imageToSVG",value:function(t,e,n){var r=this;n=this.checkoptions(n),this.loadImage(t,(function(canvas){e(r.imagedataToSVG(r.getImgdata(canvas),n))}),n)}},{key:"imagedataToSVG",value:function(t,e){e=this.checkoptions(e);var td=this.imagedataToTracedata(t,e);return this.getsvgstring(td,e)}},{key:"imageToTracedata",value:function(t,e,n){var r=this;n=this.checkoptions(n),this.loadImage(t,(function(canvas){e(r.imagedataToTracedata(r.getImgdata(canvas),n))}),n)}},{key:"imagedataToTracedata",value:function(t,e){e=this.checkoptions(e);var n=this.colorquantization(t,e),r=void 0;if(0===e.layering){r={layers:[],palette:n.palette,width:n.array[0].length-2,height:n.array.length-2};for(var o=0;o<n.palette.length;o+=1){var c=this.batchtracepaths(this.internodes(this.pathscan(this.layeringstep(n,o),e.pathomit),e),e.ltres,e.qtres);r.layers.push(c)}}else{var l=this.layering(n);e.layercontainerid&&this.drawLayers(l,this.specpalette,e.scale,e.layercontainerid);var h=this.batchpathscan(l,e.pathomit),f=this.batchinternodes(h,e);r={layers:this.batchtracelayers(f,e.ltres,e.qtres),palette:n.palette,width:t.width,height:t.height}}return r}},{key:"checkoptions",value:function(t){"string"==typeof(t=t||{})&&(t=t.toLowerCase(),t=this.optionpresets[t]?this.optionpresets[t]:{});for(var e=Object.keys(this.optionpresets.default),n=0;n<e.length;n+=1)t.hasOwnProperty(e[n])||(t[e[n]]=this.optionpresets.default[e[n]]);return t}},{key:"colorquantization",value:function(t,e){var n=[],r=0,o=void 0,c=void 0,l=void 0,h=[],f=t.width*t.height,i=void 0,d=void 0,v=void 0,m=void 0,y=void 0;for(d=0;d<t.height+2;d+=1)for(n[d]=[],i=0;i<t.width+2;i+=1)n[d][i]=-1;for(y=e.pal?e.pal:0===e.colorsampling?this.generatepalette(e.numberofcolors):1===e.colorsampling?this.samplepalette(e.numberofcolors,t):this.samplepalette2(e.numberofcolors,t),e.blurradius>0&&(t=this.blur(t,e.blurradius,e.blurdelta)),m=0;m<e.colorquantcycles;m+=1){if(m>0)for(v=0;v<y.length;v+=1)h[v].n>0&&(y[v]={r:Math.floor(h[v].r/h[v].n),g:Math.floor(h[v].g/h[v].n),b:Math.floor(h[v].b/h[v].n),a:Math.floor(h[v].a/h[v].n)}),h[v].n/f<e.mincolorratio&&m<e.colorquantcycles-1&&(y[v]={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});for(i=0;i<y.length;i+=1)h[i]={r:0,g:0,b:0,a:0,n:0};for(d=0;d<t.height;d+=1)for(i=0;i<t.width;i+=1){for(r=4*(d*t.width+i),l=0,c=1024,v=0;v<y.length;v+=1)(o=Math.abs(y[v].r-t.data[r])+Math.abs(y[v].g-t.data[r+1])+Math.abs(y[v].b-t.data[r+2])+Math.abs(y[v].a-t.data[r+3]))<c&&(c=o,l=v);h[l].r+=t.data[r],h[l].g+=t.data[r+1],h[l].b+=t.data[r+2],h[l].a+=t.data[r+3],h[l].n+=1,n[d+1][i+1]=l}}return{array:n,palette:y}}},{key:"samplepalette",value:function(t,e){for(var n=void 0,r=[],i=0;i<t;i+=1)n=4*Math.floor(Math.random()*e.data.length/4),r.push({r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:e.data[n+3]});return r}},{key:"samplepalette2",value:function(t,e){for(var n=void 0,r=[],o=Math.ceil(Math.sqrt(t)),c=Math.ceil(t/o),l=e.width/(o+1),h=e.height/(c+1),f=0;f<c;f+=1)for(var i=0;i<o&&r.length!==t;i+=1)n=4*Math.floor((f+1)*h*e.width+(i+1)*l),r.push({r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:e.data[n+3]});return r}},{key:"generatepalette",value:function(t){var e=[],n=void 0,r=void 0,o=void 0;if(t<8)for(var c=Math.floor(255/(t-1)),i=0;i<t;i+=1)e.push({r:i*c,g:i*c,b:i*c,a:255});else{var l=Math.floor(Math.pow(t,1/3)),h=Math.floor(255/(l-1)),f=t-l*l*l;for(n=0;n<l;n+=1)for(r=0;r<l;r+=1)for(o=0;o<l;o+=1)e.push({r:n*h,g:r*h,b:o*h,a:255});for(n=0;n<f;n+=1)e.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())})}return e}},{key:"layering",value:function(t){var e=[],n=0,r=t.array.length,o=t.array[0].length,c=void 0,l=void 0,h=void 0,f=void 0,d=void 0,v=void 0,m=void 0,y=void 0,i=void 0,_=void 0,x=void 0;for(x=0;x<t.palette.length;x+=1)for(e[x]=[],_=0;_<r;_+=1)for(e[x][_]=[],i=0;i<o;i+=1)e[x][_][i]=0;for(_=1;_<r-1;_+=1)for(i=1;i<o-1;i+=1)n=t.array[_][i],c=t.array[_-1][i-1]===n?1:0,l=t.array[_-1][i]===n?1:0,h=t.array[_-1][i+1]===n?1:0,f=t.array[_][i-1]===n?1:0,d=t.array[_][i+1]===n?1:0,v=t.array[_+1][i-1]===n?1:0,m=t.array[_+1][i]===n?1:0,y=t.array[_+1][i+1]===n?1:0,e[n][_+1][i+1]=1+2*d+4*y+8*m,f||(e[n][_+1][i]=2+4*m+8*v),l||(e[n][_][i+1]=0+2*h+4*d+8),c||(e[n][_][i]=0+2*l+4+8*f);return e}},{key:"layeringstep",value:function(t,e){var n=[],r=t.array.length,o=t.array[0].length,i=void 0,c=void 0;for(c=0;c<r;c+=1)for(n[c]=[],i=0;i<o;i+=1)n[c][i]=0;for(c=1;c<r;c+=1)for(i=1;i<o;i+=1)n[c][i]=(t.array[c-1][i-1]===e?1:0)+(t.array[c-1][i]===e?2:0)+(t.array[c][i-1]===e?8:0)+(t.array[c][i]===e?4:0);return n}},{key:"pathscan",value:function(t,e){for(var n=[],r=0,o=0,c=0,l=0,h=t[0].length,f=t.length,d=0,v=!0,m=!1,y=void 0,_=0;_<f;_+=1)for(var i=0;i<h;i+=1)if(4===t[_][i]||11===t[_][i])for(c=i,l=_,n[r]={},n[r].points=[],n[r].boundingbox=[c,l,c,l],n[r].holechildren=[],v=!1,o=0,m=11===t[_][i],d=1;!v;){if(n[r].points[o]={},n[r].points[o].x=c-1,n[r].points[o].y=l-1,n[r].points[o].t=t[l][c],c-1<n[r].boundingbox[0]&&(n[r].boundingbox[0]=c-1),c-1>n[r].boundingbox[2]&&(n[r].boundingbox[2]=c-1),l-1<n[r].boundingbox[1]&&(n[r].boundingbox[1]=l-1),l-1>n[r].boundingbox[3]&&(n[r].boundingbox[3]=l-1),y=this.pathscan_combined_lookup[t[l][c]][d],t[l][c]=y[0],d=y[1],c+=y[2],l+=y[3],c-1===n[r].points[0].x&&l-1===n[r].points[0].y)if(v=!0,n[r].points.length<e)n.pop();else{if(n[r].isholepath=!!m,m){for(var x=0,w=[-1,-1,h+1,f+1],C=0;C<r;C++)!n[C].isholepath&&this.boundingboxincludes(n[C].boundingbox,n[r].boundingbox)&&this.boundingboxincludes(w,n[C].boundingbox)&&(x=C,w=n[C].boundingbox);n[x].holechildren.push(r)}r+=1}o+=1}return n}},{key:"boundingboxincludes",value:function(t,e){return t[0]<e[0]&&t[1]<e[1]&&t[2]>e[2]&&t[3]>e[3]}},{key:"batchpathscan",value:function(t,e){var n=[];for(var r in t)t.hasOwnProperty(r)&&(n[r]=this.pathscan(t[r],e));return n}},{key:"internodes",value:function(t,e){var ins=[],n=0,r=0,o=0,c=0,l=0,h=void 0,f=void 0;for(h=0;h<t.length;h+=1)for(ins[h]={},ins[h].points=[],ins[h].boundingbox=t[h].boundingbox,ins[h].holechildren=t[h].holechildren,ins[h].isholepath=t[h].isholepath,n=t[h].points.length,f=0;f<n;f+=1)r=(f+1)%n,o=(f+2)%n,c=(f-1+n)%n,l=(f-2+n)%n,e.rightangleenhance&&this.testrightangle(t[h],l,c,f,r,o)&&(ins[h].points.length>0&&(ins[h].points[ins[h].points.length-1].linesegment=this.getdirection(ins[h].points[ins[h].points.length-1].x,ins[h].points[ins[h].points.length-1].y,t[h].points[f].x,t[h].points[f].y)),ins[h].points.push({x:t[h].points[f].x,y:t[h].points[f].y,linesegment:this.getdirection(t[h].points[f].x,t[h].points[f].y,(t[h].points[f].x+t[h].points[r].x)/2,(t[h].points[f].y+t[h].points[r].y)/2)})),ins[h].points.push({x:(t[h].points[f].x+t[h].points[r].x)/2,y:(t[h].points[f].y+t[h].points[r].y)/2,linesegment:this.getdirection((t[h].points[f].x+t[h].points[r].x)/2,(t[h].points[f].y+t[h].points[r].y)/2,(t[h].points[r].x+t[h].points[o].x)/2,(t[h].points[r].y+t[h].points[o].y)/2)});return ins}},{key:"testrightangle",value:function(path,t,e,n,r,o){return path.points[n].x===path.points[t].x&&path.points[n].x===path.points[e].x&&path.points[n].y===path.points[r].y&&path.points[n].y===path.points[o].y||path.points[n].y===path.points[t].y&&path.points[n].y===path.points[e].y&&path.points[n].x===path.points[r].x&&path.points[n].x===path.points[o].x}},{key:"getdirection",value:function(t,e,n,r){return t<n?e<r?1:e>r?7:0:t>n?e<r?3:e>r?5:4:e<r?2:e>r?6:8}},{key:"batchinternodes",value:function(t,e){var n=[];for(var r in t)t.hasOwnProperty(r)&&(n[r]=this.internodes(t[r],e));return n}},{key:"tracepath",value:function(path,t,e){var n=0,r=void 0,o=void 0,c=void 0,l={segments:[]};for(l.boundingbox=path.boundingbox,l.holechildren=path.holechildren,l.isholepath=path.isholepath;n<path.points.length;){for(r=path.points[n].linesegment,o=-1,c=n+1;(path.points[c].linesegment===r||path.points[c].linesegment===o||-1===o)&&c<path.points.length-1;)path.points[c].linesegment!==r&&-1===o&&(o=path.points[c].linesegment),c+=1;c===path.points.length-1&&(c=0),l.segments=l.segments.concat(this.fitseq(path,t,e,n,c)),n=c>0?c:path.points.length}return l}},{key:"fitseq",value:function(path,t,e,n,r){if(r>path.points.length||r<0)return[];var o=n,c=0,l=!0,h=void 0,f=void 0,d=void 0,v=r-n;v<0&&(v+=path.points.length);for(var m=(path.points[r].x-path.points[n].x)/v,y=(path.points[r].y-path.points[n].y)/v,_=(n+1)%path.points.length,x=void 0;_!=r;)(x=_-n)<0&&(x+=path.points.length),h=path.points[n].x+m*x,f=path.points[n].y+y*x,(d=(path.points[_].x-h)*(path.points[_].x-h)+(path.points[_].y-f)*(path.points[_].y-f))>t&&(l=!1),d>c&&(o=_,c=d),_=(_+1)%path.points.length;if(l)return[{type:"L",x1:path.points[n].x,y1:path.points[n].y,x2:path.points[r].x,y2:path.points[r].y}];var w=o;l=!0,c=0;var C=(w-n)/v,S=(1-C)*(1-C),k=2*(1-C)*C,O=C*C,E=(S*path.points[n].x+O*path.points[r].x-path.points[w].x)/-k,T=(S*path.points[n].y+O*path.points[r].y-path.points[w].y)/-k;for(_=n+1;_!=r;)k=2*(1-(C=(_-n)/v))*C,O=C*C,h=(S=(1-C)*(1-C))*path.points[n].x+k*E+O*path.points[r].x,f=S*path.points[n].y+k*T+O*path.points[r].y,(d=(path.points[_].x-h)*(path.points[_].x-h)+(path.points[_].y-f)*(path.points[_].y-f))>e&&(l=!1),d>c&&(o=_,c=d),_=(_+1)%path.points.length;if(l)return[{type:"Q",x1:path.points[n].x,y1:path.points[n].y,x2:E,y2:T,x3:path.points[r].x,y3:path.points[r].y}];var j=w;return this.fitseq(path,t,e,n,j).concat(this.fitseq(path,t,e,j,r))}},{key:"batchtracepaths",value:function(t,e,n){var r=[];for(var o in t)t.hasOwnProperty(o)&&r.push(this.tracepath(t[o],e,n));return r}},{key:"batchtracelayers",value:function(t,e,n){var r=[];for(var o in t)t.hasOwnProperty(o)&&(r[o]=this.batchtracepaths(t[o],e,n));return r}},{key:"roundtodec",value:function(t,e){return Number(t.toFixed(e))}},{key:"svgpathstring",value:function(t,e,n,r){var o=t.layers[e],c=o[n],l="",h=void 0;if(r.linefilter&&c.segments.length<3)return l;if(l="<path "+(r.desc?'desc="l '+e+" p "+n+'" ':"")+this.tosvgcolorstr(t.palette[e],r)+'d="',-1===r.roundcoords){for(l+="M "+c.segments[0].x1*r.scale+" "+c.segments[0].y1*r.scale+" ",h=0;h<c.segments.length;h++)l+=c.segments[h].type+" "+c.segments[h].x2*r.scale+" "+c.segments[h].y2*r.scale+" ",c.segments[h].hasOwnProperty("x3")&&(l+=c.segments[h].x3*r.scale+" "+c.segments[h].y3*r.scale+" ");l+="Z "}else{for(l+="M "+this.roundtodec(c.segments[0].x1*r.scale,r.roundcoords)+" "+this.roundtodec(c.segments[0].y1*r.scale,r.roundcoords)+" ",h=0;h<c.segments.length;h++)l+=c.segments[h].type+" "+this.roundtodec(c.segments[h].x2*r.scale,r.roundcoords)+" "+this.roundtodec(c.segments[h].y2*r.scale,r.roundcoords)+" ",c.segments[h].hasOwnProperty("x3")&&(l+=this.roundtodec(c.segments[h].x3*r.scale,r.roundcoords)+" "+this.roundtodec(c.segments[h].y3*r.scale,r.roundcoords)+" ");l+="Z "}for(var f=0;f<c.holechildren.length;f++){var d=o[c.holechildren[f]];if(-1===r.roundcoords)for(d.segments[d.segments.length-1].hasOwnProperty("x3")?l+="M "+d.segments[d.segments.length-1].x3*r.scale+" "+d.segments[d.segments.length-1].y3*r.scale+" ":l+="M "+d.segments[d.segments.length-1].x2*r.scale+" "+d.segments[d.segments.length-1].y2*r.scale+" ",h=d.segments.length-1;h>=0;h--)l+=d.segments[h].type+" ",d.segments[h].hasOwnProperty("x3")&&(l+=d.segments[h].x2*r.scale+" "+d.segments[h].y2*r.scale+" "),l+=d.segments[h].x1*r.scale+" "+d.segments[h].y1*r.scale+" ";else for(d.segments[d.segments.length-1].hasOwnProperty("x3")?l+="M "+this.roundtodec(d.segments[d.segments.length-1].x3*r.scale)+" "+this.roundtodec(d.segments[d.segments.length-1].y3*r.scale)+" ":l+="M "+this.roundtodec(d.segments[d.segments.length-1].x2*r.scale)+" "+this.roundtodec(d.segments[d.segments.length-1].y2*r.scale)+" ",h=d.segments.length-1;h>=0;h--)l+=d.segments[h].type+" ",d.segments[h].hasOwnProperty("x3")&&(l+=this.roundtodec(d.segments[h].x2*r.scale)+" "+this.roundtodec(d.segments[h].y2*r.scale)+" "),l+=this.roundtodec(d.segments[h].x1*r.scale)+" "+this.roundtodec(d.segments[h].y1*r.scale)+" ";l+="Z "}if(l+='" />',r.lcpr||r.qcpr){for(h=0;h<c.segments.length;h++)c.segments[h].hasOwnProperty("x3")&&r.qcpr&&(l+='<circle cx="'+c.segments[h].x2*r.scale+'" cy="'+c.segments[h].y2*r.scale+'" r="'+r.qcpr+'" fill="cyan" stroke-width="'+.2*r.qcpr+'" stroke="black" />',l+='<circle cx="'+c.segments[h].x3*r.scale+'" cy="'+c.segments[h].y3*r.scale+'" r="'+r.qcpr+'" fill="white" stroke-width="'+.2*r.qcpr+'" stroke="black" />',l+='<line x1="'+c.segments[h].x1*r.scale+'" y1="'+c.segments[h].y1*r.scale+'" x2="'+c.segments[h].x2*r.scale+'" y2="'+c.segments[h].y2*r.scale+'" stroke-width="'+.2*r.qcpr+'" stroke="cyan" />',l+='<line x1="'+c.segments[h].x2*r.scale+'" y1="'+c.segments[h].y2*r.scale+'" x2="'+c.segments[h].x3*r.scale+'" y2="'+c.segments[h].y3*r.scale+'" stroke-width="'+.2*r.qcpr+'" stroke="cyan" />'),!c.segments[h].hasOwnProperty("x3")&&r.lcpr&&(l+='<circle cx="'+c.segments[h].x2*r.scale+'" cy="'+c.segments[h].y2*r.scale+'" r="'+r.lcpr+'" fill="white" stroke-width="'+.2*r.lcpr+'" stroke="black" />');for(f=0;f<c.holechildren.length;f++)for(d=o[c.holechildren[f]],h=0;h<d.segments.length;h++)d.segments[h].hasOwnProperty("x3")&&r.qcpr&&(l+='<circle cx="'+d.segments[h].x2*r.scale+'" cy="'+d.segments[h].y2*r.scale+'" r="'+r.qcpr+'" fill="cyan" stroke-width="'+.2*r.qcpr+'" stroke="black" />',l+='<circle cx="'+d.segments[h].x3*r.scale+'" cy="'+d.segments[h].y3*r.scale+'" r="'+r.qcpr+'" fill="white" stroke-width="'+.2*r.qcpr+'" stroke="black" />',l+='<line x1="'+d.segments[h].x1*r.scale+'" y1="'+d.segments[h].y1*r.scale+'" x2="'+d.segments[h].x2*r.scale+'" y2="'+d.segments[h].y2*r.scale+'" stroke-width="'+.2*r.qcpr+'" stroke="cyan" />',l+='<line x1="'+d.segments[h].x2*r.scale+'" y1="'+d.segments[h].y2*r.scale+'" x2="'+d.segments[h].x3*r.scale+'" y2="'+d.segments[h].y3*r.scale+'" stroke-width="'+.2*r.qcpr+'" stroke="cyan" />'),!d.segments[h].hasOwnProperty("x3")&&r.lcpr&&(l+='<circle cx="'+d.segments[h].x2*r.scale+'" cy="'+d.segments[h].y2*r.scale+'" r="'+r.lcpr+'" fill="white" stroke-width="'+.2*r.lcpr+'" stroke="black" />')}return l}},{key:"getsvgstring",value:function(t,e){e=this.checkoptions(e);for(var n=t.width*e.scale,r=t.height*e.scale,o="<svg "+(e.viewbox?'viewBox="0 0 '+n+" "+r+'" ':'width="'+n+'" height="'+r+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+this.versionnumber+'" >',c=0;c<t.layers.length;c+=1)for(var l=0;l<t.layers[c].length;l+=1)t.layers[c][l].isholepath||(o+=this.svgpathstring(t,c,l,e));return o+="</svg>"}},{key:"compareNumbers",value:function(a,b){return a-b}},{key:"torgbastr",value:function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}},{key:"tosvgcolorstr",value:function(t,e){return'fill="rgb('+t.r+","+t.g+","+t.b+')" stroke="rgb('+t.r+","+t.g+","+t.b+')" stroke-width="'+e.strokewidth+'" opacity="'+t.a/255+'" '}},{key:"appendSVGString",value:function(t,e){var div=void 0;e?(div=document.getElementById(e))||((div=document.createElement("div")).id=e,document.body.appendChild(div)):(div=document.createElement("div"),document.body.appendChild(div)),div.innerHTML+=t}},{key:"blur",value:function(t,e,n){var i=void 0,r=void 0,o=void 0,c=void 0,l=void 0,h=void 0,f=void 0,d=void 0,v=void 0,m={width:t.width,height:t.height,data:[]};if((e=Math.floor(e))<1)return t;e>5&&(e=5),(n=Math.abs(n))>1024&&(n=1024);var y=this.gks[e-1];for(r=0;r<t.height;r++)for(i=0;i<t.width;i++){for(l=0,h=0,f=0,d=0,v=0,o=-e;o<e+1;o++)i+o>0&&i+o<t.width&&(c=4*(r*t.width+i+o),l+=t.data[c]*y[o+e],h+=t.data[c+1]*y[o+e],f+=t.data[c+2]*y[o+e],d+=t.data[c+3]*y[o+e],v+=y[o+e]);c=4*(r*t.width+i),m.data[c]=Math.floor(l/v),m.data[c+1]=Math.floor(h/v),m.data[c+2]=Math.floor(f/v),m.data[c+3]=Math.floor(d/v)}var _=new Uint8ClampedArray(m.data);for(r=0;r<t.height;r++)for(i=0;i<t.width;i++){for(l=0,h=0,f=0,d=0,v=0,o=-e;o<e+1;o++)r+o>0&&r+o<t.height&&(l+=_[c=4*((r+o)*t.width+i)]*y[o+e],h+=_[c+1]*y[o+e],f+=_[c+2]*y[o+e],d+=_[c+3]*y[o+e],v+=y[o+e]);c=4*(r*t.width+i),m.data[c]=Math.floor(l/v),m.data[c+1]=Math.floor(h/v),m.data[c+2]=Math.floor(f/v),m.data[c+3]=Math.floor(d/v)}for(r=0;r<t.height;r++)for(i=0;i<t.width;i++)c=4*(r*t.width+i),Math.abs(m.data[c]-t.data[c])+Math.abs(m.data[c+1]-t.data[c+1])+Math.abs(m.data[c+2]-t.data[c+2])+Math.abs(m.data[c+3]-t.data[c+3])>n&&(m.data[c]=t.data[c],m.data[c+1]=t.data[c+1],m.data[c+2]=t.data[c+2],m.data[c+3]=t.data[c+3]);return m}},{key:"loadImage",value:function(t,e,n){var img=new Image;n&&n.corsenabled&&(img.crossOrigin="Anonymous"),img.src=t,img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height,canvas.getContext("2d").drawImage(img,0,0),e(canvas)}}},{key:"getImgdata",value:function(canvas){return canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height)}},{key:"drawLayers",value:function(t,e,n,r){n=n||1;var o=void 0,c=void 0,i=void 0,l=void 0,h=void 0,div=void 0;for(h in r?(div=document.getElementById(r))||((div=document.createElement("div")).id=r,document.body.appendChild(div)):(div=document.createElement("div"),document.body.appendChild(div)),t)if(t.hasOwnProperty(h)){o=t[h][0].length,c=t[h].length;var canvas=document.createElement("canvas");canvas.width=o*n,canvas.height=c*n;var f=canvas.getContext("2d");for(l=0;l<c;l+=1)for(i=0;i<o;i+=1)f.fillStyle=this.torgbastr(e[t[h][l][i]%e.length]),f.fillRect(i*n,l*n,n,n);div.appendChild(canvas)}}}]),t}();e.default=r},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=P(n(3)),c=P(n(4)),l=P(n(106)),h=P(n(107)),f=P(n(109)),d=P(n(111)),v=P(n(112)),m=P(n(113)),y=P(n(114)),_=P(n(115)),x=P(n(116)),w=P(n(117)),C=P(n(123)),S=P(n(125)),k=P(n(127)),O=P(n(128)),E=P(n(129)),T=P(n(130)),j=P(n(73)),M=P(n(72));function P(t){return t&&t.__esModule?t:{default:t}}var A=j.default.componentNames,I=j.default.eventNames,D=j.default.drawingModes,L=j.default.fObjectOptions,R=o.default.extend,B=o.default.stamp,F=o.default.isArray,N=o.default.isString,z=o.default.forEachArray,X=o.default.forEachOwnProperties,W=o.default.CustomEvents,H=1e3,Y=800,G={cssOnly:!0},U={backstoreOnly:!0},V=function(){function t(element){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.cssMaxWidth,r=e.cssMaxHeight,o=e.useItext,c=void 0!==o&&o,l=e.useDragAddIcon,h=void 0!==l&&l;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasImage=null,this.cssMaxWidth=n||H,this.cssMaxHeight=r||Y,this.useItext=c,this.useDragAddIcon=h,this.cropSelectionStyle={},this.imageName="",this._objects={},this._canvas=null,this._drawingMode=D.NORMAL,this._drawingModeMap={},this._componentMap={},this._handler={onMouseDown:this._onMouseDown.bind(this),onObjectAdded:this._onObjectAdded.bind(this),onObjectRemoved:this._onObjectRemoved.bind(this),onObjectMoved:this._onObjectMoved.bind(this),onObjectScaled:this._onObjectScaled.bind(this),onObjectSelected:this._onObjectSelected.bind(this),onPathCreated:this._onPathCreated.bind(this),onSelectionCleared:this._onSelectionCleared.bind(this),onSelectionCreated:this._onSelectionCreated.bind(this)},this._setCanvasElement(element),this._createDrawingModeInstances(),this._createComponents(),this._attachCanvasEvents()}return r(t,[{key:"destroy",value:function(){var t=this._canvas.wrapperEl;this._canvas.clear(),t.parentNode.removeChild(t)}},{key:"deactivateAll",value:function(){return this._canvas.deactivateAll(),this}},{key:"renderAll",value:function(){return this._canvas.renderAll(),this}},{key:"add",value:function(t){var e,n=[];F(t)?n=t:n.push(t),(e=this._canvas).add.apply(e,n)}},{key:"contains",value:function(t){return this._canvas.contains(t)}},{key:"getObjects",value:function(){return this._canvas.getObjects().slice()}},{key:"getObject",value:function(t){return this._objects[t]}},{key:"remove",value:function(t){this._canvas.remove(t)}},{key:"removeAll",value:function(t){var canvas=this._canvas,e=canvas.getObjects().slice();return canvas.remove.apply(canvas,this._canvas.getObjects()),t&&canvas.clear(),e}},{key:"removeObjectById",value:function(t){var e=[],canvas=this._canvas,n=this.getObject(t);return n&&n.isType("group")&&!n.isEmpty()?(canvas.discardActiveGroup(),n.forEachObject((function(t){e.push(t),t.remove()}))):canvas.contains(n)&&(e.push(n),n.remove()),e}},{key:"getObjectId",value:function(object){var t=null;for(t in this._objects)if(this._objects.hasOwnProperty(t)&&object===this._objects[t])return t;return null}},{key:"getActiveObject",value:function(){return this._canvas.getActiveObject()}},{key:"getActiveGroupObject",value:function(){return this._canvas.getActiveGroup()}},{key:"setActiveObject",value:function(t){this._canvas.setActiveObject(t)}},{key:"setCropSelectionStyle",value:function(style){this.cropSelectionStyle=style}},{key:"getComponent",value:function(t){return this._componentMap[t]}},{key:"getDrawingMode",value:function(){return this._drawingMode}},{key:"startDrawingMode",value:function(t,option){if(this._isSameDrawingMode(t))return!0;this.stopDrawingMode();var e=this._getDrawingModeInstance(t);return e&&e.start&&(e.start(this,option),this._drawingMode=t),!!e}},{key:"stopDrawingMode",value:function(){if(!this._isSameDrawingMode(D.NORMAL)){var t=this._getDrawingModeInstance(this.getDrawingMode());t&&t.end&&t.end(this),this._drawingMode=D.NORMAL}}},{key:"toDataURL",value:function(t){return this._canvas&&this._canvas.toDataURL(t)}},{key:"setCanvasImage",value:function(t,e){e&&B(e),this.imageName=t,this.canvasImage=e}},{key:"setCssMaxDimension",value:function(t){this.cssMaxWidth=t.width||this.cssMaxWidth,this.cssMaxHeight=t.height||this.cssMaxHeight}},{key:"adjustCanvasDimension",value:function(){var t=this.canvasImage.scale(1),e=t.getBoundingRect(),n=e.width,r=e.height,o=this._calcMaxDimension(n,r);this.setCanvasCssDimension({width:"100%",height:"100%","max-width":o.width+"px","max-height":o.height+"px"}),this.setCanvasBackstoreDimension({width:n,height:r}),this._canvas.centerObject(t)}},{key:"setCanvasCssDimension",value:function(t){this._canvas.setDimensions(t,G)}},{key:"setCanvasBackstoreDimension",value:function(t){this._canvas.setDimensions(t,U)}},{key:"setImageProperties",value:function(t,e){var n=this.canvasImage;n&&(n.set(t).setCoords(),e&&this._canvas.renderAll())}},{key:"getCanvasElement",value:function(){return this._canvas.getElement()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getCanvasImage",value:function(){return this.canvasImage}},{key:"getImageName",value:function(){return this.imageName}},{key:"addImageObject",value:function(t){var e=this,n=this._callbackAfterLoadingImageObject.bind(this);return new c.default((function(r){l.default.Image.fromURL(t,(function(image){n(image),r(e.createObjectProperties(image))}),{crossOrigin:"Anonymous"})}))}},{key:"getCenter",value:function(){return this._canvas.getCenter()}},{key:"getCropzoneRect",value:function(){return this.getComponent(A.CROPPER).getCropzoneRect()}},{key:"setCropzoneRect",value:function(t){this.getComponent(A.CROPPER).setCropzoneRect(t)}},{key:"getCroppedImageData",value:function(t){return this.getComponent(A.CROPPER).getCroppedImageData(t)}},{key:"setBrush",value:function(option){var t=this._drawingMode,e=A.FREE_DRAWING;t===D.LINE&&(e=D.LINE),this.getComponent(e).setBrush(option)}},{key:"setDrawingShape",value:function(t,e){this.getComponent(A.SHAPE).setStates(t,e)}},{key:"registerPaths",value:function(t){this.getComponent(A.ICON).registerPaths(t)}},{key:"changeCursor",value:function(t){var canvas=this.getCanvas();canvas.defaultCursor=t,canvas.renderAll()}},{key:"hasFilter",value:function(t){return this.getComponent(A.FILTER).hasFilter(t)}},{key:"setSelectionStyle",value:function(t){R(L.SELECTION_STYLE,t)}},{key:"setObjectProperties",value:function(t,e){var object=this.getObject(t),n=R({},e);return object.set(n),object.setCoords(),this.getCanvas().renderAll(),n}},{key:"getObjectProperties",value:function(t,e){var object=this.getObject(t),n={};return N(e)?n[e]=object[e]:F(e)?z(e,(function(t){n[t]=object[t]})):X(e,(function(t,e){n[e]=object[e]})),n}},{key:"getObjectPosition",value:function(t,e,n){var r=this.getObject(t);return r?r.getPointByOrigin(e,n):null}},{key:"setObjectPosition",value:function(t,e){var n=this.getObject(t),r=e.x,o=e.y,c=e.originX,l=e.originY;if(!n)return!1;var h=n.getPointByOrigin(c,l),f=n.getPointByOrigin("center","center"),d=f.x-h.x,v=f.y-h.y;return n.set({left:r+d,top:o+v}),n.setCoords(),!0}},{key:"getCanvasSize",value:function(){var image=this.getCanvasImage();return{width:image?image.width:0,height:image?image.height:0}}},{key:"_getDrawingModeInstance",value:function(t){return this._drawingModeMap[t]}},{key:"_setCanvasElement",value:function(element){var t=void 0,e=void 0;"CANVAS"!==(t=element.jquery?element[0]:element.nodeType?element:document.querySelector(element)).nodeName.toUpperCase()&&(e=document.createElement("canvas"),t.appendChild(e)),this._canvas=new l.default.Canvas(e,{containerClass:"tui-image-editor-canvas-container",enableRetinaScaling:!1})}},{key:"_createDrawingModeInstances",value:function(){this._register(this._drawingModeMap,new S.default),this._register(this._drawingModeMap,new k.default),this._register(this._drawingModeMap,new O.default),this._register(this._drawingModeMap,new E.default),this._register(this._drawingModeMap,new T.default)}},{key:"_createComponents",value:function(){this._register(this._componentMap,new h.default(this)),this._register(this._componentMap,new f.default(this)),this._register(this._componentMap,new d.default(this)),this._register(this._componentMap,new v.default(this)),this._register(this._componentMap,new m.default(this)),this._register(this._componentMap,new y.default(this)),this._register(this._componentMap,new _.default(this)),this._register(this._componentMap,new x.default(this)),this._register(this._componentMap,new w.default(this)),this._register(this._componentMap,new C.default(this))}},{key:"_register",value:function(map,t){map[t.getName()]=t}},{key:"_isSameDrawingMode",value:function(t){return this.getDrawingMode()===t}},{key:"_calcMaxDimension",value:function(t,e){var n=this.cssMaxWidth/t,r=this.cssMaxHeight/e,o=Math.min(t,this.cssMaxWidth),c=Math.min(e,this.cssMaxHeight);return n<1&&n<r?(o=t*n,c=e*n):r<1&&r<n&&(o=t*r,c=e*r),{width:Math.floor(o),height:Math.floor(c)}}},{key:"_callbackAfterLoadingImageObject",value:function(t){var e=this.getCanvasImage().getCenterPoint();t.set(j.default.fObjectOptions.SELECTION_STYLE),t.set({left:e.x,top:e.y,crossOrigin:"Anonymous"}),this.getCanvas().add(t).setActiveObject(t)}},{key:"_attachCanvasEvents",value:function(){var canvas=this._canvas,t=this._handler;canvas.on({"mouse:down":t.onMouseDown,"object:added":t.onObjectAdded,"object:removed":t.onObjectRemoved,"object:moving":t.onObjectMoved,"object:scaling":t.onObjectScaled,"object:selected":t.onObjectSelected,"path:created":t.onPathCreated,"selection:cleared":t.onSelectionCleared,"selection:created":t.onSelectionCreated})}},{key:"_onMouseDown",value:function(t){var e=this._canvas.getPointer(t.e);this.fire(I.MOUSE_DOWN,t.e,e)}},{key:"_onObjectAdded",value:function(t){var e=t.target;e.isType("cropzone")||this._addFabricObject(e)}},{key:"_onObjectRemoved",value:function(t){var e=t.target;this._removeFabricObject(B(e))}},{key:"_onObjectMoved",value:function(t){var e=t.target,n=this.createObjectProperties(e);this.fire(I.OBJECT_MOVED,n)}},{key:"_onObjectScaled",value:function(t){var e=t.target,n=this.createObjectProperties(e);this.fire(I.OBJECT_SCALED,n)}},{key:"_onObjectSelected",value:function(t){var e=t.target,n=this.createObjectProperties(e);this.fire(I.OBJECT_ACTIVATED,n)}},{key:"_onPathCreated",value:function(t){t.path.set(j.default.fObjectOptions.SELECTION_STYLE);var e=this.createObjectProperties(t.path);this.fire(I.ADD_OBJECT,e)}},{key:"_onSelectionCleared",value:function(){this.fire(I.SELECTION_CLEARED)}},{key:"_onSelectionCreated",value:function(t){this.fire(I.SELECTION_CREATED,t.target)}},{key:"discardSelection",value:function(){this._canvas.discardActiveGroup(),this._canvas.discardActiveObject(),this._canvas.renderAll()}},{key:"changeSelectableAll",value:function(t){this._canvas.forEachObject((function(e){e.selectable=t,e.hoverCursor=t?"move":"crosshair"}))}},{key:"createObjectProperties",value:function(t){var e={id:B(t),type:t.type};return R(e,M.default.getProperties(t,["left","top","width","height","fill","stroke","strokeWidth","opacity"])),["i-text","text"].indexOf(t.type)>-1&&R(e,this._createTextProperties(t,e)),e}},{key:"_createTextProperties",value:function(t){var e={};return R(e,M.default.getProperties(t,["text","fontFamily","fontSize","fontStyle","textAlign","textDecoration"])),e}},{key:"_addFabricObject",value:function(t){var e=B(t);return this._objects[e]=t,e}},{key:"_removeFabricObject",value:function(t){delete this._objects[t]}}]),t}();W.mixin(V),t.exports=V},function(t,n){t.exports=e},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(4)),c=h(n(108)),l=h(n(73));function h(t){return t&&t.__esModule?t:{default:t}}var f=l.default.componentNames,d=l.default.rejectMessages,v={padding:0,crossOrigin:"Anonymous"},m=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f.IMAGE_LOADER,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"load",value:function(t,img){var e=this,n=void 0;if(t||img)n=this._setBackgroundImage(img).then((function(n){return e.setCanvasImage(t,n),e.adjustCanvasDimension(),n}));else{var canvas=this.getCanvas();canvas.backgroundImage=null,canvas.renderAll(),n=new o.default((function(t){e.setCanvasImage("",null),t()}))}return n}},{key:"_setBackgroundImage",value:function(img){var t=this;return img?new o.default((function(e,n){var canvas=t.getCanvas();canvas.setBackgroundImage(img,(function(){var t=canvas.backgroundImage;t.getElement()?e(t):n(d.loadingImageFailed)}),v)})):o.default.reject(d.loadImage)}}]),e}(c.default);t.exports=m},function(t,e){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.graphics=n}return n(t,[{key:"fire",value:function(){for(var t=this.graphics,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.graphics.fire.apply(t,n)}},{key:"setCanvasImage",value:function(t,e){this.graphics.setCanvasImage(t,e)}},{key:"getCanvasElement",value:function(){return this.graphics.getCanvasElement()}},{key:"getCanvas",value:function(){return this.graphics.getCanvas()}},{key:"getCanvasImage",value:function(){return this.graphics.getCanvasImage()}},{key:"getImageName",value:function(){return this.graphics.getImageName()}},{key:"getEditor",value:function(){return this.graphics.getEditor()}},{key:"getName",value:function(){return this.name}},{key:"setImageProperties",value:function(t,e){this.graphics.setImageProperties(t,e)}},{key:"setCanvasCssDimension",value:function(t){this.graphics.setCanvasCssDimension(t)}},{key:"setCanvasBackstoreDimension",value:function(t){this.graphics.setCanvasBackstoreDimension(t)}},{key:"adjustCanvasDimension",value:function(){this.graphics.adjustCanvasDimension()}}]),t}();t.exports=r},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(3)),c=v(n(106)),l=v(n(108)),h=v(n(110)),f=n(73),d=n(72);function v(t){return t&&t.__esModule?t:{default:t}}var m={top:-10,left:-10,height:1,width:1},y=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f.componentNames.CROPPER,t));return n._cropzone=null,n._startX=null,n._startY=null,n._withShiftKey=!1,n._listeners={keydown:n._onKeyDown.bind(n),keyup:n._onKeyUp.bind(n),mousedown:n._onFabricMouseDown.bind(n),mousemove:n._onFabricMouseMove.bind(n),mouseup:n._onFabricMouseUp.bind(n)},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(){if(!this._cropzone){var canvas=this.getCanvas();canvas.forEachObject((function(t){t.evented=!1})),this._cropzone=new h.default({left:-10,top:-10,width:1,height:1,strokeWidth:0,cornerSize:10,cornerColor:"black",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0},this.graphics.cropSelectionStyle),canvas.deactivateAll(),canvas.add(this._cropzone),canvas.on("mouse:down",this._listeners.mousedown),canvas.selection=!1,canvas.defaultCursor="crosshair",c.default.util.addListener(document,"keydown",this._listeners.keydown),c.default.util.addListener(document,"keyup",this._listeners.keyup)}}},{key:"end",value:function(){var canvas=this.getCanvas(),t=this._cropzone;t&&(t.remove(),canvas.selection=!0,canvas.defaultCursor="default",canvas.off("mouse:down",this._listeners.mousedown),canvas.forEachObject((function(t){t.evented=!0})),this._cropzone=null,c.default.util.removeListener(document,"keydown",this._listeners.keydown),c.default.util.removeListener(document,"keyup",this._listeners.keyup))}},{key:"_onFabricMouseDown",value:function(t){var canvas=this.getCanvas();if(!t.target){canvas.selection=!1;var e=canvas.getPointer(t.e);this._startX=e.x,this._startY=e.y,canvas.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}},{key:"_onFabricMouseMove",value:function(t){var canvas=this.getCanvas(),e=canvas.getPointer(t.e),n=e.x,r=e.y,o=this._cropzone;Math.abs(n-this._startX)+Math.abs(r-this._startY)>10&&(o.remove(),o.set(this._calcRectDimensionFromPoint(n,r)),canvas.add(o))}},{key:"_calcRectDimensionFromPoint",value:function(t,e){var canvas=this.getCanvas(),n=canvas.getWidth(),r=canvas.getHeight(),o=this._startX,c=this._startY,l=(0,d.clamp)(t,0,o),h=(0,d.clamp)(e,0,c),f=(0,d.clamp)(t,o,n)-l,v=(0,d.clamp)(e,c,r)-h;return this._withShiftKey&&(f>v?v=f:v>f&&(f=v),o>=t&&(l=o-f),c>=e&&(h=c-v)),{left:l,top:h,width:f,height:v}}},{key:"_onFabricMouseUp",value:function(){var t=this._cropzone,e=this._listeners,canvas=this.getCanvas();canvas.setActiveObject(t),canvas.off({"mouse:move":e.mousemove,"mouse:up":e.mouseup})}},{key:"getCroppedImageData",value:function(t){var canvas=this.getCanvas(),e=canvas.contains(this._cropzone);if(!t)return null;e&&this._cropzone.remove();var n={imageName:this.getImageName(),url:canvas.toDataURL(t)};return e&&canvas.add(this._cropzone),n}},{key:"getCropzoneRect",value:function(){var t=this._cropzone;return t.isValid()?{left:t.getLeft(),top:t.getTop(),width:t.getWidth(),height:t.getHeight()}:null}},{key:"setCropzoneRect",value:function(t){var canvas=this.getCanvas(),e=this._cropzone;canvas.deactivateAll(),canvas.selection=!1,e.remove(),e.set(t?this._getPresetCropSizePosition(t):m),canvas.add(e),canvas.selection=!0,t&&canvas.setActiveObject(e)}},{key:"_getPresetCropSizePosition",value:function(t){var canvas=this.getCanvas(),e=canvas.getWidth(),n=canvas.getHeight(),r=e>=n?e:n,c=function(t,e){return t>e?e/t:1},l=r*t,h=r,f=c(l,e),d=o.default.map([l,h],(function(t){return t*f}));l=d[0];var v=c(h=d[1],n),m=o.default.map([l,h],(function(t){return t*v}));return l=m[0],{top:(n-(h=m[1]))/2,left:(e-l)/2,width:l,height:h}}},{key:"_onKeyDown",value:function(t){t.keyCode===f.keyCodes.SHIFT&&(this._withShiftKey=!0)}},{key:"_onKeyUp",value:function(t){t.keyCode===f.keyCodes.SHIFT&&(this._withShiftKey=!1)}}]),e}(l.default);t.exports=y},function(t,e,n){"use strict";var r=l(n(3)),o=l(n(106)),c=n(72);function l(t){return t&&t.__esModule?t:{default:t}}var h=o.default.util.createClass(o.default.Rect,{initialize:function(t,e){(t=r.default.extend(t,e)).type="cropzone",this.callSuper("initialize",t),this.options=t,this.on({moving:this._onMoving,scaling:this._onScaling})},_render:function(t){this.callSuper("_render",t);var e=this.flipX?-1:1,n=this.flipY?-1:1,r=e/this.scaleX,o=n/this.scaleY;t.scale(r,o),this._fillOuterRect(t,"rgba(0, 0, 0, 0.55)"),this.options.lineWidth?(this._fillInnerRect(t),this._strokeBorder(t,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth})):(this._strokeBorder(t,"rgb(0, 0, 0)",{lineDashWidth:7}),this._strokeBorder(t,"rgb(255, 255, 255)",{lineDashWidth:7,lineDashOffset:7})),t.scale(1/r,1/o)},_fillOuterRect:function(t,e){var n=this._getCoordinates(t),r=n.x,o=n.y;t.save(),t.fillStyle=e,t.beginPath(),t.moveTo(r[0]-1,o[0]-1),t.lineTo(r[3]+1,o[0]-1),t.lineTo(r[3]+1,o[3]+1),t.lineTo(r[0]-1,o[3]+1),t.lineTo(r[0]-1,o[0]-1),t.closePath(),t.moveTo(r[1],o[1]),t.lineTo(r[1],o[2]),t.lineTo(r[2],o[2]),t.lineTo(r[2],o[1]),t.lineTo(r[1],o[1]),t.closePath(),t.fill(),t.restore()},_fillInnerRect:function(t){var e=this._getCoordinates(t),n=e.x,r=e.y,o=this._caculateInnerPosition(n,(n[2]-n[1])/3),c=this._caculateInnerPosition(r,(r[2]-r[1])/3);t.save(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=this.options.lineWidth,t.beginPath(),t.moveTo(o[0],c[1]),t.lineTo(o[3],c[1]),t.moveTo(o[0],c[2]),t.lineTo(o[3],c[2]),t.moveTo(o[1],c[0]),t.lineTo(o[1],c[3]),t.moveTo(o[2],c[0]),t.lineTo(o[2],c[3]),t.stroke(),t.closePath(),t.restore()},_caculateInnerPosition:function(t,e){var n=[];return n[0]=t[1],n[1]=t[1]+e,n[2]=t[1]+2*e,n[3]=t[2],n},_getCoordinates:function(t){var e=this.getWidth(),n=this.getHeight(),o=e/2,c=n/2,l=this.getLeft(),h=this.getTop(),f=t.canvas;return{x:r.default.map([-(o+l),-o,o,o+(f.width-l-e)],Math.ceil),y:r.default.map([-(c+h),-c,c,c+(f.height-h-n)],Math.ceil)}},_strokeBorder:function(t,e,n){var r=n.lineDashWidth,o=n.lineDashOffset,c=n.lineWidth,l=this.getWidth()/2,h=this.getHeight()/2;t.save(),t.strokeStyle=e,t.setLineDash&&t.setLineDash([r,r]),o&&(t.lineDashOffset=o),c&&(t.lineWidth=c),t.beginPath(),t.moveTo(-l,-h),t.lineTo(l,-h),t.lineTo(l,h),t.lineTo(-l,h),t.lineTo(-l,-h),t.stroke(),t.restore()},_onMoving:function(){var t=this.getLeft(),e=this.getTop(),n=this.getWidth(),r=this.getHeight(),o=this.canvas.getWidth()-n,l=this.canvas.getHeight()-r;this.setLeft((0,c.clamp)(t,0,o)),this.setTop((0,c.clamp)(e,0,l))},_onScaling:function(t){var e=this.canvas.getPointer(t.e),n=this._calcScalingSizeFromPointer(e);this.scale(1).set(n)},_calcScalingSizeFromPointer:function(t){var e=t.x,n=t.y,r=this._calcTopLeftScalingSizeFromPointer(e,n),o=this._calcBottomRightScalingSizeFromPointer(e,n);return this._makeScalingSettings(r,o)},_calcTopLeftScalingSizeFromPointer:function(t,e){var n=this.getHeight()+this.top,r=this.getWidth()+this.left,o=(0,c.clamp)(e,0,n-1),l=(0,c.clamp)(t,0,r-1);return{top:o,left:l,width:r-l,height:n-o}},_calcBottomRightScalingSizeFromPointer:function(t,e){var n=this.canvas,r=n.width,o=n.height,l=this.left,h=this.top;return{width:(0,c.clamp)(t,l+1,r)-l,height:(0,c.clamp)(e,h+1,o)-h}},_makeScalingSettings:function(t,br){var e=t.width,n=t.height,r=br.height,o=br.width,c=t.left,l=t.top,h=void 0;switch(this.__corner){case"tl":h=t;break;case"tr":h={width:o,height:n,top:l};break;case"bl":h={width:e,height:r,left:c};break;case"br":h=br;break;case"ml":h={width:e,left:c};break;case"mt":h={height:n,top:l};break;case"mr":h={width:o};break;case"mb":h={height:r}}return h},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0}});t.exports=h},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=f(n(3)),c=f(n(4)),l=f(n(108)),h=f(n(73));function f(t){return t&&t.__esModule?t:{default:t}}var d=h.default.componentNames,v=h.default.rejectMessages,m=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d.FLIP,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"getCurrentSetting",value:function(){var t=this.getCanvasImage();return{flipX:t.flipX,flipY:t.flipY}}},{key:"set",value:function(t){var e=this.getCurrentSetting(),n=e.flipX!==t.flipX,r=e.flipY!==t.flipY;return n||r?(o.default.extend(e,t),this.setImageProperties(e,!0),this._invertAngle(n,r),this._flipObjects(n,r),c.default.resolve({flipX:e.flipX,flipY:e.flipY,angle:this.getCanvasImage().angle})):c.default.reject(v.flip)}},{key:"_invertAngle",value:function(t,e){var n=this.getCanvasImage(),r=n.angle;t&&(r*=-1),e&&(r*=-1),n.setAngle(parseFloat(r)).setCoords()}},{key:"_flipObjects",value:function(t,e){var canvas=this.getCanvas();t&&canvas.forEachObject((function(t){t.set({angle:parseFloat(-1*t.angle),flipX:!t.flipX,left:canvas.width-t.left}).setCoords()})),e&&canvas.forEachObject((function(t){t.set({angle:parseFloat(-1*t.angle),flipY:!t.flipY,top:canvas.height-t.top}).setCoords()})),canvas.renderAll()}},{key:"reset",value:function(){return this.set({flipX:!1,flipY:!1})}},{key:"flipX",value:function(){var t=this.getCurrentSetting();return this.set({flipX:!t.flipX,flipY:t.flipY})}},{key:"flipY",value:function(){var t=this.getCurrentSetting();return this.set({flipX:t.flipX,flipY:!t.flipY})}}]),e}(l.default);t.exports=m},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(106)),c=h(n(4)),l=h(n(108));function h(t){return t&&t.__esModule?t:{default:t}}var f=h(n(73)).default.componentNames,d=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f.ROTATION,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"getCurrentAngle",value:function(){return this.getCanvasImage().angle}},{key:"setAngle",value:function(t){var e=this.getCurrentAngle()%360;t%=360;var n=this.getCanvasImage(),r=n.getCenterPoint();n.setAngle(t).setCoords(),this.adjustCanvasDimension();var o=n.getCenterPoint();return this._rotateForEachObject(r,o,t-e),c.default.resolve(t)}},{key:"_rotateForEachObject",value:function(t,e,n){var canvas=this.getCanvas(),r=t.x-e.x,c=t.y-e.y;canvas.forEachObject((function(e){var l=e.getCenterPoint(),h=o.default.util.degreesToRadians(n),f=o.default.util.rotatePoint(l,t,h);e.set({left:f.x-r,top:f.y-c,angle:(e.angle+n)%360}),e.setCoords()})),canvas.renderAll()}},{key:"rotate",value:function(t){var e=this.getCurrentAngle();return this.setAngle(e+t)}}]),e}(l.default);t.exports=d},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(106)),c=h(n(108)),l=h(n(73));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l.default.componentNames.FREE_DRAWING,t));return n.width=12,n.oColor=new o.default.Color("rgba(0, 0, 0, 0.5)"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t){this.getCanvas().isDrawingMode=!0,this.setBrush(t)}},{key:"setBrush",value:function(t){var e=this.getCanvas().freeDrawingBrush;t=t||{},this.width=t.width||this.width,t.color&&(this.oColor=new o.default.Color(t.color)),e.width=this.width,e.color=this.oColor.toRgba()}},{key:"end",value:function(){this.getCanvas().isDrawingMode=!1}}]),e}(c.default);t.exports=f},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=h(n(106)),c=h(n(108)),l=h(n(73));function h(t){return t&&t.__esModule?t:{default:t}}var f=l.default.eventNames,d=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l.default.componentNames.LINE,t));return n._width=12,n._oColor=new o.default.Color("rgba(0, 0, 0, 0.5)"),n._listeners={mousedown:n._onFabricMouseDown.bind(n),mousemove:n._onFabricMouseMove.bind(n),mouseup:n._onFabricMouseUp.bind(n)},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t){var canvas=this.getCanvas();canvas.defaultCursor="crosshair",canvas.selection=!1,this.setBrush(t),canvas.forEachObject((function(t){t.set({evented:!1})})),canvas.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(t){var e=this.getCanvas().freeDrawingBrush;t=t||{},this._width=t.width||this._width,t.color&&(this._oColor=new o.default.Color(t.color)),e.width=this._width,e.color=this._oColor.toRgba()}},{key:"end",value:function(){var canvas=this.getCanvas();canvas.defaultCursor="default",canvas.selection=!0,canvas.forEachObject((function(t){t.set({evented:!0})})),canvas.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(t){var canvas=this.getCanvas(),e=canvas.getPointer(t.e),n=[e.x,e.y,e.x,e.y];this._line=new o.default.Line(n,{stroke:this._oColor.toRgba(),strokeWidth:this._width,evented:!1}),this._line.set(l.default.fObjectOptions.SELECTION_STYLE),canvas.add(this._line),canvas.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}},{key:"_onFabricMouseMove",value:function(t){var canvas=this.getCanvas(),e=canvas.getPointer(t.e);this._line.set({x2:e.x,y2:e.y}),this._line.setCoords(),canvas.renderAll()}},{key:"_onFabricMouseUp",value:function(){var canvas=this.getCanvas(),t=this.graphics.createObjectProperties(this._line);this.fire(f.ADD_OBJECT,t),this._line=null,canvas.off({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}]),e}(c.default);t.exports=d},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(106)),c=v(n(3)),l=v(n(4)),h=v(n(108)),f=v(n(73)),d=v(n(72));function v(t){return t&&t.__esModule?t:{default:t}}var m=f.default.eventNames,y={fill:"#000000",left:0,top:0},_={fill:"#000000",fontStyle:"normal",fontWeight:"normal",textAlign:"left",textDecoraiton:""},x=c.default.browser,w=d.default.makeStyleText({position:"absolute",padding:0,display:"none",border:"1px dotted red",overflow:"hidden",resize:"none",outline:"none","border-radius":0,"background-color":"transparent","-webkit-appearance":"none","z-index":9999,"white-space":"pre"}),C=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f.default.componentNames.TEXT,t));return n._defaultStyles=y,n._isSelected=!1,n._selectedObj={},n._editingObj={},n._listeners={mousedown:n._onFabricMouseDown.bind(n),select:n._onFabricSelect.bind(n),selectClear:n._onFabricSelectClear.bind(n),scaling:n._onFabricScaling.bind(n)},n._textarea=null,n._ratio=1,n._lastClickTime=(new Date).getTime(),n._editingObjInfos={},n.isPrevEditing=!1,n.useItext=t.useItext,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(){var canvas=this.getCanvas();canvas.selection=!1,canvas.defaultCursor="text",canvas.on({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:editing":this._listeners.modify}),this.useItext?canvas.forEachObject((function(t){"i-text"===t.type&&t.set({left:t.left-t.width/2,top:t.top-t.height/2,originX:"left",originY:"top"})})):this._createTextarea(),this.setCanvasRatio()}},{key:"end",value:function(){var canvas=this.getCanvas();canvas.selection=!0,canvas.defaultCursor="default",this.useItext?canvas.forEachObject((function(t){"i-text"===t.type&&(""===t.text?t.remove():t.set({left:t.left+t.width/2,top:t.top+t.height/2,originX:"center",originY:"center"}))})):(canvas.deactivateAllWithDispatch(),this._removeTextarea()),canvas.off({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:editing":this._listeners.modify})}},{key:"add",value:function(text,t){var e=this;return new l.default((function(n){var canvas=e.getCanvas(),r=null,l=f.default.fObjectOptions.SELECTION_STYLE,h=e._defaultStyles;e._setInitPos(t.position),t.styles&&(h=c.default.extend(h,t.styles)),e.useItext?(r=new o.default.IText(text,h),l=c.default.extend({},l,{originX:"left",originY:"top"})):r=new o.default.Text(text,h),r.set(l),r.on({mouseup:e._onFabricMouseUp.bind(e)}),canvas.add(r),canvas.getActiveObject()||canvas.setActiveObject(r),e.isPrevEditing=!0,n(e.graphics.createObjectProperties(r))}))}},{key:"change",value:function(t,text){var e=this;return new l.default((function(n){t.set("text",text),e.getCanvas().renderAll(),n()}))}},{key:"setStyle",value:function(t,e){var n=this;return new l.default((function(r){c.default.forEach(e,(function(n,r){t[r]===n&&(e[r]=_[r]||"")}),n),t.set(e),n.getCanvas().renderAll(),r()}))}},{key:"getText",value:function(t){return t.getText()}},{key:"setSelectedInfo",value:function(t,e){this._selectedObj=t,this._isSelected=e}},{key:"isSelected",value:function(){return this._isSelected}},{key:"getSelectedObj",value:function(){return this._selectedObj}},{key:"setCanvasRatio",value:function(){var t=this.getCanvasElement(),e=parseInt(t.style.maxWidth,10),n=t.width/e;this._ratio=n}},{key:"getCanvasRatio",value:function(){return this._ratio}},{key:"_setInitPos",value:function(t){t=t||this.getCanvasImage().getCenterPoint(),this._defaultStyles.left=t.x,this._defaultStyles.top=t.y}},{key:"_createTextarea",value:function(){var t=this.getCanvasElement().parentNode,textarea=document.createElement("textarea");textarea.className="tui-image-eidtor-textarea",textarea.setAttribute("style",w),textarea.setAttribute("wrap","off"),t.appendChild(textarea),this._textarea=textarea,this._listeners=c.default.extend(this._listeners,{input:this._onInput.bind(this),keydown:this._onKeyDown.bind(this),blur:this._onBlur.bind(this),scroll:this._onScroll.bind(this)}),x.msie&&9===x.version?o.default.util.addListener(textarea,"keydown",this._listeners.keydown):o.default.util.addListener(textarea,"input",this._listeners.input),o.default.util.addListener(textarea,"blur",this._listeners.blur),o.default.util.addListener(textarea,"scroll",this._listeners.scroll)}},{key:"_removeTextarea",value:function(){var t=this.getCanvasElement().parentNode,textarea=t.querySelector("textarea");t.removeChild(textarea),this._textarea=null,x.msie&&x.version<10?o.default.util.removeListener(textarea,"keydown",this._listeners.keydown):o.default.util.removeListener(textarea,"input",this._listeners.input),o.default.util.removeListener(textarea,"blur",this._listeners.blur),o.default.util.removeListener(textarea,"scroll",this._listeners.scroll)}},{key:"_onInput",value:function(){var t=this.getCanvasRatio(),e=this._editingObj,n=this._textarea.style;n.width=Math.ceil(e.getWidth()/t)+"px",n.height=Math.ceil(e.getHeight()/t)+"px"}},{key:"_onKeyDown",value:function(){var t=this,e=this.getCanvasRatio(),n=this._editingObj,r=this._textarea.style;setTimeout((function(){n.setText(t._textarea.value),r.width=Math.ceil(n.getWidth()/e)+"px",r.height=Math.ceil(n.getHeight()/e)+"px"}),0)}},{key:"_onBlur",value:function(){var t=this.getCanvasRatio(),e=this._editingObj,n=this._editingObjInfos,r=this._textarea.value,o=e.getWidth()/t-n.width/t,l=e.getHeight()/t-n.height/t;if(1===t&&(o/=2,l/=2),this._textarea.style.display="none",e.set({left:n.left+o,top:n.top+l}),r.length){this.getCanvas().add(e);var h={id:c.default.stamp(e),type:e.type,text:r};this.fire(m.TEXT_CHANGED,h)}}},{key:"_onScroll",value:function(){this._textarea.scrollLeft=0,this._textarea.scrollTop=0}},{key:"_onFabricScaling",value:function(t){var e=t.target,n=e.getFontSize()*e.getScaleY();e.setFontSize(n),e.setScaleX(1),e.setScaleY(1)}},{key:"_onFabricSelectClear",value:function(t){var e=this.getSelectedObj();this.isPrevEditing=!0,this.setSelectedInfo(t.target,!1),e&&""===e.text&&e.remove()}},{key:"_onFabricSelect",value:function(t){this.isPrevEditing=!0,this.setSelectedInfo(t.target,!0)}},{key:"_onFabricMouseDown",value:function(t){var e=t.target;e&&!e.isType("text")||(this.isPrevEditing?this.isPrevEditing=!1:this._fireAddText(t))}},{key:"_fireAddText",value:function(t){var e=t.target,n=t.e||{},r=this.getCanvas().getPointer(n);e||this.fire(m.ADD_TEXT,{originPosition:{x:r.x,y:r.y},clientPosition:{x:n.clientX||0,y:n.clientY||0}})}},{key:"_onFabricMouseUp",value:function(t){var e=(new Date).getTime();this._isDoubleClick(e)&&(this.useItext||this._changeToEditingMode(t.target),this.fire(m.TEXT_EDITING)),this._lastClickTime=e}},{key:"_isDoubleClick",value:function(t){return t-this._lastClickTime<500}},{key:"_changeToEditingMode",value:function(t){var e=this.getCanvasRatio(),n=this._textarea.style;this.isPrevEditing=!0,t.remove(),this._editingObj=t,this._textarea.value=t.getText(),this._editingObjInfos={left:this._editingObj.getLeft(),top:this._editingObj.getTop(),width:this._editingObj.getWidth(),height:this._editingObj.getHeight()},n.display="block",n.left=t.oCoords.tl.x/e+"px",n.top=t.oCoords.tl.y/e+"px",n.width=Math.ceil(t.getWidth()/e)+"px",n.height=Math.ceil(t.getHeight()/e)+"px",n.transform="rotate("+t.getAngle()+"deg)",n.color=t.getFill(),n["font-size"]=t.getFontSize()/e+"px",n["font-family"]=t.getFontFamily(),n["font-style"]=t.getFontStyle(),n["font-weight"]=t.getFontWeight(),n["text-align"]=t.getTextAlign(),n["line-height"]=t.getLineHeight()+.1,n["transform-origin"]="left top",this._textarea.focus()}}]),e}(h.default);t.exports=C},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=d(n(106)),c=d(n(3)),l=d(n(4)),h=d(n(108)),f=d(n(73));function d(t){return t&&t.__esModule?t:{default:t}}var v=f.default.eventNames,m=f.default.rejectMessages,y={arrow:"M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z",cancel:"M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z"},_=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f.default.componentNames.ICON,t));return n._oColor="#000000",n._pathMap=y,n.useDragAddIcon=t.useDragAddIcon,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"add",value:function(t,e){var n=this;return new l.default((function(r,o){var canvas=n.getCanvas(),path=n._pathMap[t],l=f.default.fObjectOptions.SELECTION_STYLE,h=Object.keys(f.default.defaultIconPath).indexOf(t)>=0,d=n.useDragAddIcon&&h,v=path?n._createIcon(path):null;v||o(m.invalidParameters),v.set(c.default.extend({type:"icon",fill:n._oColor},l,e,n.graphics.controlStyle)),canvas.add(v).setActiveObject(v),d&&n._addWithDragEvent(canvas),r(n.graphics.createObjectProperties(v))}))}},{key:"_addWithDragEvent",value:function(canvas){var t=this;canvas.on({"mouse:move":function(e){canvas.selection=!1,t.fire(v.ICON_CREATE_RESIZE,{moveOriginPointer:canvas.getPointer(e.e)})},"mouse:up":function(e){t.fire(v.ICON_CREATE_END,{moveOriginPointer:canvas.getPointer(e.e)}),canvas.defaultCursor="default",canvas.off("mouse:up"),canvas.off("mouse:move"),canvas.selection=!0}})}},{key:"registerPaths",value:function(t){var e=this;c.default.forEach(t,(function(path,t){e._pathMap[t]=path}),this)}},{key:"setColor",value:function(t,e){this._oColor=t,e&&"icon"===e.get("type")&&(e.setFill(this._oColor),this.getCanvas().renderAll())}},{key:"getColor",value:function(t){return t.fill}},{key:"_createIcon",value:function(path){return new o.default.Path(path)}}]),e}(h.default);t.exports=_},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(3),c=x(n(4)),l=x(n(106)),h=x(n(108)),f=x(n(118)),d=x(n(73)),v=x(n(119)),m=x(n(120)),y=x(n(121)),_=x(n(122));function x(t){return t&&t.__esModule?t:{default:t}}var w=d.default.rejectMessages,C=l.default.Image.filters;C.Mask=f.default,C.Blur=v.default,C.Sharpen=m.default,C.Emboss=y.default,C.ColorFilter=_.default;var S=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d.default.componentNames.FILTER,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"add",value:function(t,e){var n=this;return new c.default((function(r,o){var c=n._getSourceImage(),canvas=n.getCanvas(),l=n._getFilter(c,t);l||(l=n._createFilter(c,t,e)),l||o(w.invalidParameters),n._changeFilterValues(l,e),n._apply(c,(function(){canvas.renderAll(),r({type:t,action:"add"})}))}))}},{key:"remove",value:function(t){var e=this;return new c.default((function(n,r){var o=e._getSourceImage(),canvas=e.getCanvas();o.filters.length||r(w.unsupportedOperation),e._removeFilter(o,t),e._apply(o,(function(){canvas.renderAll(),n({type:t,action:"remove"})}))}))}},{key:"hasFilter",value:function(t){return!!this._getFilter(this._getSourceImage(),t)}},{key:"getOptions",value:function(t){var e=this._getSourceImage(),n=this._getFilter(e,t);return n?(0,o.extend)({},n.options):null}},{key:"_changeFilterValues",value:function(t,e){(0,o.forEach)(e,(function(e,n){(0,o.isUndefined)(t[n])||(t[n]=e)})),(0,o.forEach)(t.options,(function(n,r){(0,o.isUndefined)(e[r])||(t.options[r]=e[r])}))}},{key:"_apply",value:function(t,e){t.applyFilters(e)}},{key:"_getSourceImage",value:function(){return this.getCanvasImage()}},{key:"_createFilter",value:function(t,e,n){var r=void 0,o=this._getFabricFilterType(e),c=l.default.Image.filters[o];return c&&((r=new c(n)).options=n,t.filters.push(r)),r}},{key:"_getFilter",value:function(t,e){var n=null;if(t){var r=this._getFabricFilterType(e),o=t.filters.length,c=void 0,i=void 0;for(i=0;i<o;i+=1)if((c=t.filters[i]).type===r){n=c;break}}return n}},{key:"_removeFilter",value:function(t,e){var n=this._getFabricFilterType(e);t.filters=(0,o.filter)(t.filters,(function(t){return t.type!==n}))}},{key:"_getFabricFilterType",value:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}]),e}(h.default);t.exports=S},function(t,e,n){"use strict";var r,o=n(106),c=(r=o)&&r.__esModule?r:{default:r},l=c.default.util.createClass(c.default.Image.filters.Mask,{applyTo:function(t){if(this.mask){var e=t.width,n=t.height,r=this._createCanvasOfMask(e,n),o=t.getContext("2d"),c=r.getContext("2d"),l=o.getImageData(0,0,e,n);this._drawMask(c,t,o),this._mapData(c,l,e,n),o.putImageData(l,0,0)}},_createCanvasOfMask:function(t,e){var n=c.default.util.createCanvasElement();return n.width=t,n.height=e,n},_drawMask:function(t){var mask=this.mask,e=mask.getElement(),n=mask.getLeft(),r=mask.getTop(),o=mask.getAngle();t.save(),t.translate(n,r),t.rotate(o*Math.PI/180),t.scale(mask.scaleX,mask.scaleY),t.drawImage(e,-e.width/2,-e.height/2),t.restore()},_mapData:function(t,e,n,r){for(var o=e.data,c=t.getImageData(0,0,n,r).data,l=this.channel,h=e.width*e.height*4,i=0;i<h;i+=4)o[i+3]=c[i+l]}});t.exports=l},function(t,e,n){"use strict";var r,o=n(106),c=(r=o)&&r.__esModule?r:{default:r},l=c.default.util.createClass(c.default.Image.filters.Convolute,{type:"Blur",initialize:function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}});t.exports=l},function(t,e,n){"use strict";var r,o=n(106),c=(r=o)&&r.__esModule?r:{default:r},l=c.default.util.createClass(c.default.Image.filters.Convolute,{type:"Sharpen",initialize:function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]}});t.exports=l},function(t,e,n){"use strict";var r,o=n(106),c=(r=o)&&r.__esModule?r:{default:r},l=c.default.util.createClass(c.default.Image.filters.Convolute,{type:"Emboss",initialize:function(){this.matrix=[1,1,1,1,.7,-1,-1,-1,-1]}});t.exports=l},function(t,e,n){"use strict";var r,o=n(106),c=(r=o)&&r.__esModule?r:{default:r},l=c.default.util.createClass(c.default.Image.filters.BaseFilter,{type:"ColorFilter",initialize:function(t){t||(t={}),this.color=t.color||"#FFFFFF",this.threshold=t.threshold||45,this.x=t.x||null,this.y=t.y||null},applyTo:function(t){var e,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=this.threshold,l=c.default.Color.sourceFromHex(this.color),i=void 0;for(this.x&&this.y&&(l=this._getColor(r,this.x,this.y)),i=0,e=data.length;i<e;i+=4)this._isOutsideThreshold(data[i],l[0],o)||this._isOutsideThreshold(data[i+1],l[1],o)||this._isOutsideThreshold(data[i+2],l[2],o)||(data[i]=data[i+1]=data[i+2]=data[i+3]=0);n.putImageData(r,0,0)},_isOutsideThreshold:function(t,e,n){var r=t-e;return Math.abs(r)>n},_getColor:function(t,e,n){var r=[0,0,0,0],data=t.data,o=4*(t.width*n+e);return r[0]=data[o],r[1]=data[o+1],r[2]=data[o+2],r[3]=data[o+3],r}});t.exports=l},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=v(n(106)),c=v(n(4)),l=v(n(108)),h=v(n(73)),f=v(n(124)),d=n(3);function v(t){return t&&t.__esModule?t:{default:t}}var m=h.default.rejectMessages,y=h.default.eventNames,_=h.default.keyCodes,x="rect",w={strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:1,height:1,rx:0,ry:0,lockSkewingX:!0,lockSkewingY:!0,lockUniScaling:!1,bringForward:!0,isRegular:!1},C=["rect","circle","triangle"],S=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h.default.componentNames.SHAPE,t));return n._shapeObj=null,n._type=x,n._options=(0,d.extend)({},w),n._isSelected=!1,n._startPoint={},n._withShiftKey=!1,n._handlers={mousedown:n._onFabricMouseDown.bind(n),mousemove:n._onFabricMouseMove.bind(n),mouseup:n._onFabricMouseUp.bind(n),keydown:n._onKeyDown.bind(n),keyup:n._onKeyUp.bind(n)},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(){var canvas=this.getCanvas();this._isSelected=!1,canvas.defaultCursor="crosshair",canvas.selection=!1,canvas.uniScaleTransform=!0,canvas.on({"mouse:down":this._handlers.mousedown}),o.default.util.addListener(document,"keydown",this._handlers.keydown),o.default.util.addListener(document,"keyup",this._handlers.keyup)}},{key:"end",value:function(){var canvas=this.getCanvas();this._isSelected=!1,canvas.defaultCursor="default",canvas.selection=!0,canvas.uniScaleTransform=!1,canvas.off({"mouse:down":this._handlers.mousedown}),o.default.util.removeListener(document,"keydown",this._handlers.keydown),o.default.util.removeListener(document,"keyup",this._handlers.keyup)}},{key:"setStates",value:function(t,e){this._type=t,e&&(this._options=(0,d.extend)(this._options,e))}},{key:"add",value:function(t,e){var n=this;return new c.default((function(r){var canvas=n.getCanvas();e=n._createOptions(e);var o=n._createInstance(t,e);n._bindEventOnShape(o),canvas.add(o).setActiveObject(o),r(n.graphics.createObjectProperties(o))}))}},{key:"change",value:function(t,e){var n=this;return new c.default((function(r,o){(0,d.inArray)(t.get("type"),C)<0&&o(m.unsupportedType),t.set(e),n.getCanvas().renderAll(),r()}))}},{key:"_createInstance",value:function(t,e){var n=void 0;switch(t){case"rect":n=new o.default.Rect(e);break;case"circle":n=new o.default.Ellipse((0,d.extend)({type:"circle"},e));break;case"triangle":n=new o.default.Triangle(e);break;default:n={}}return n}},{key:"_createOptions",value:function(t){var e=h.default.fObjectOptions.SELECTION_STYLE;return(t=(0,d.extend)({},w,this._options,e,t)).isRegular&&(t.lockUniScaling=!0),t}},{key:"_bindEventOnShape",value:function(t){var e=this,canvas=this.getCanvas();t.on({added:function(){e._shapeObj=this,f.default.setOrigins(e._shapeObj)},selected:function(){e._isSelected=!0,e._shapeObj=this,canvas.uniScaleTransform=!0,canvas.defaultCursor="default",f.default.setOrigins(e._shapeObj)},deselected:function(){e._isSelected=!1,e._shapeObj=null,canvas.defaultCursor="crosshair",canvas.uniScaleTransform=!1},modified:function(){var t=e._shapeObj;f.default.adjustOriginToCenter(t),f.default.setOrigins(t)},scaling:function(t){var n=canvas.getPointer(t.e),r=e._shapeObj;canvas.setCursor("crosshair"),f.default.resize(r,n,!0)}})}},{key:"_onFabricMouseDown",value:function(t){if(t.target||(this._isSelected=!1,this._shapeObj=!1),!this._isSelected&&!this._shapeObj){var canvas=this.getCanvas();this._startPoint=canvas.getPointer(t.e),canvas.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}}},{key:"_onFabricMouseMove",value:function(t){var e=this,canvas=this.getCanvas(),n=canvas.getPointer(t.e),r=this._startPoint.x,o=this._startPoint.y,c=r-n.x,l=o-n.y,h=this._shapeObj;h?(this._shapeObj.set({isRegular:this._withShiftKey}),f.default.resize(h,n),canvas.renderAll()):this.add(this._type,{left:r,top:o,width:c,height:l}).then((function(t){e.fire(y.ADD_OBJECT,t)}))}},{key:"_onFabricMouseUp",value:function(){var canvas=this.getCanvas(),t=this._shapeObj;t&&f.default.adjustOriginToCenter(t),this.fire(y.ADD_OBJECT_AFTER,this.graphics.createObjectProperties(t)),canvas.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}},{key:"_onKeyDown",value:function(t){t.keyCode===_.SHIFT&&(this._withShiftKey=!0,this._shapeObj&&(this._shapeObj.isRegular=!0))}},{key:"_onKeyUp",value:function(t){t.keyCode===_.SHIFT&&(this._withShiftKey=!1,this._shapeObj&&(this._shapeObj.isRegular=!1))}}]),e}(l.default);t.exports=S},function(t,e){"use strict";var n={rect:1,circle:2,triangle:1},r={rect:{w:"width",h:"height"},circle:{w:"rx",h:"ry"},triangle:{w:"width",h:"height"}};function o(t,e,n){var r=t.x,o=t.y,c=e.x,l=e.y,h=n*Math.PI/180;return{originX:r>(c-r)*Math.cos(h)-(l-o)*Math.sin(h)+r?"right":"left",originY:o>(c-r)*Math.sin(h)+(l-o)*Math.cos(h)+o?"bottom":"top"}}t.exports={setOrigins:function(t){var e=t.getPointByOrigin("left","top"),n=t.getPointByOrigin("right","top"),r=t.getPointByOrigin("right","bottom"),o=t.getPointByOrigin("left","bottom");t.origins={lt:e,rt:n,rb:r,lb:o}},resize:function(t,e,c){(function(t){return"center"===t.getOriginX()&&"center"===t.getOriginY()})(t)&&(function(t,e){var n=e.getPointByOrigin("center","center"),r=o(n,t,-e.getAngle()),c=r.originX,l=r.originY,h=e.getPointByOrigin(c,l),f=e.getLeft()-(n.x-h.x),d=e.getTop()-(n.x-h.y);e.set({originX:c,originY:l,left:f,top:d}),e.setCoords()}(e,t),function(t){var e=t.getOriginX(),n=t.getOriginY(),r=e.substring(0,1)+n.substring(0,1);t.startPoint=t.origins[r]}(t)),c?function(t){var e=t.type,n=t.scaleX,o=t.scaleY,c=r[e],l=t[c.w]*n,h=t[c.h]*o;if(t.isRegular){var f=Math.max(n,o);l=t[c.w]*f,h=t[c.h]*f}var d={hasControls:!1,hasBorders:!1,scaleX:1,scaleY:1};d[c.w]=l,d[c.h]=h,t.set(d)}(t):function(t,e){var o=e.type,c=e.strokeWidth,l=e.startPoint,h=n[o],f=r[o],d=!("triangle"!==e.type),v={},m=Math.abs(l.x-t.x)/h,y=Math.abs(l.y-t.y)/h;m>c&&(m-=c/h),y>c&&(y-=c/h),e.isRegular&&(m=y=Math.max(m,y),d&&(y=Math.sqrt(3)/2*m)),v[f.w]=m,v[f.h]=y,e.set(v)}(e,t),function(t,e){var n=e.startPoint,r=o(n,t,-e.getAngle()),c=r.originX,l=r.originY;e.setPositionByOrigin(n,c,l)}(e,t)},adjustOriginToCenter:function(t){var e=t.getPointByOrigin("center","center"),n=t.getOriginX(),r=t.getOriginY(),o=t.getPointByOrigin(n,r),c=t.getLeft()+(e.x-o.x),l=t.getTop()+(e.y-o.y);t.set({hasControls:!0,hasBorders:!0,originX:"center",originY:"center",left:c,top:l}),t.setCoords()}}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=l(n(126)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.drawingModes,f=c.default.componentNames,d=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h.CROPPER))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t){t.getComponent(f.CROPPER).start()}},{key:"end",value:function(t){t.getComponent(f.CROPPER).end()}}]),e}(o.default);t.exports=d},function(t,e,n){"use strict";var r,o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(71),l=(r=c)&&r.__esModule?r:{default:r},h=l.default.create,f=l.default.types,d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e}return o(t,[{key:"getName",value:function(){return this.name}},{key:"start",value:function(){throw new Error(h(f.UN_IMPLEMENTATION,"start"))}},{key:"stop",value:function(){throw new Error(h(f.UN_IMPLEMENTATION,"stop"))}}]),t}();t.exports=d},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=l(n(126)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.drawingModes,f=c.default.componentNames,d=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h.FREE_DRAWING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t,e){t.getComponent(f.FREE_DRAWING).start(e)}},{key:"end",value:function(t){t.getComponent(f.FREE_DRAWING).end()}}]),e}(o.default);t.exports=d},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=l(n(126)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.drawingModes,f=c.default.componentNames,d=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h.LINE_DRAWING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t,e){t.getComponent(f.LINE).start(e)}},{key:"end",value:function(t){t.getComponent(f.LINE).end()}}]),e}(o.default);t.exports=d},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=l(n(126)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.drawingModes,f=c.default.componentNames,d=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h.SHAPE))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t){t.getComponent(f.SHAPE).start()}},{key:"end",value:function(t){t.getComponent(f.SHAPE).end()}}]),e}(o.default);t.exports=d},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=l(n(126)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.drawingModes,f=c.default.componentNames,d=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h.TEXT))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"start",value:function(t){t.getComponent(f.TEXT).start()}},{key:"end",value:function(t){t.getComponent(f.TEXT).end()}}]),e}(o.default);t.exports=d},function(t,e){},,function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.componentNames,f=c.default.commandNames,d=h.ICON,v={name:f.ADD_ICON,execute:function(t,e,n){var r=this;return t.getComponent(d).add(e,n).then((function(e){return r.undoData.object=t.getObject(e.id),e}))},undo:function(t){return t.remove(this.undoData.object),o.default.resolve()}};r.default.register(v),t.exports=v},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(4));function c(t){return t&&t.__esModule?t:{default:t}}var l={name:c(n(73)).default.commandNames.ADD_IMAGE_OBJECT,execute:function(t,e){var n=this;return t.addImageObject(e).then((function(e){return n.undoData.object=t.getObject(e.id),e}))},undo:function(t){return t.remove(this.undoData.object),o.default.resolve()}};r.default.register(l),t.exports=l},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.commandNames,f=c.default.rejectMessages,d={name:h.ADD_OBJECT,execute:function(t,object){return new o.default((function(e,n){t.contains(object)?n(f.addedObject):(t.add(object),e(object))}))},undo:function(t,object){return new o.default((function(e,n){t.contains(object)?(t.remove(object),e(object)):n(f.noObject)}))}};r.default.register(d),t.exports=d},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.componentNames,f=c.default.commandNames,d=h.SHAPE,v={name:f.ADD_SHAPE,execute:function(t,e,n){var r=this;return t.getComponent(d).add(e,n).then((function(e){return r.undoData.object=t.getObject(e.id),e}))},undo:function(t){return t.remove(this.undoData.object),o.default.resolve()}};r.default.register(v),t.exports=v},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.componentNames,f=c.default.commandNames,d=h.TEXT,v={name:f.ADD_TEXT,execute:function(t,text,e){var n=this;return t.getComponent(d).add(text,e).then((function(e){return n.undoData.object=t.getObject(e.id),e}))},undo:function(t){return t.remove(this.undoData.object),o.default.resolve()}};r.default.register(v),t.exports=v},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=o.default.componentNames,h=o.default.rejectMessages,f=o.default.commandNames,d=l.FILTER,v={name:f.APPLY_FILTER,execute:function(t,e,n){var r=t.getComponent(d);if("mask"===e){var o=t.getObject(n.maskObjId);if(!o||!o.isType("image"))return Promise.reject(h.invalidParameters);n={mask:o}}return"mask"===e?(this.undoData.object=n.mask,t.remove(n.mask)):this.undoData.options=r.getOptions(e),r.add(e,n)},undo:function(t,e){var n=t.getComponent(d);if("mask"===e){var mask=this.undoData.object;return t.add(mask),t.setActiveObject(mask),n.remove(e)}return this.undoData.options?n.add(e,this.undoData.options):n.remove(e)}};r.default.register(v),t.exports=v},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.componentNames,f=c.default.rejectMessages,d=c.default.commandNames,v=h.ICON,m={name:d.CHANGE_ICON_COLOR,execute:function(t,e,n){var r=this;return new o.default((function(o,c){var l=t.getComponent(v),h=t.getObject(e);h||c(f.noObject),r.undoData.object=h,r.undoData.color=l.getColor(h),l.setColor(n,h),o()}))},undo:function(t){var e=t.getComponent(v),n=this.undoData.object,r=n.object,c=n.color;return e.setColor(c,r),o.default.resolve()}};r.default.register(m),t.exports=m},function(t,e,n){"use strict";var r=h(n(3)),o=h(n(69)),c=h(n(4)),l=h(n(73));function h(t){return t&&t.__esModule?t:{default:t}}var f=l.default.componentNames,d=l.default.rejectMessages,v=l.default.commandNames,m=f.SHAPE,y={name:v.CHANGE_SHAPE,execute:function(t,e,n){var o=this,l=t.getComponent(m),h=t.getObject(e);return h?(this.undoData.object=h,this.undoData.options={},r.default.forEachOwnProperties(n,(function(t,e){o.undoData.options[e]=h[e]})),l.change(h,n)):c.default.reject(d.noObject)},undo:function(t){var e=t.getComponent(m),n=this.undoData,r=n.object,o=n.options;return e.change(r,o)}};o.default.register(y),t.exports=y},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.componentNames,f=c.default.rejectMessages,d=c.default.commandNames,v=h.TEXT,m={name:d.CHANGE_TEXT,execute:function(t,e,text){var n=t.getComponent(v),r=t.getObject(e);return r?(this.undoData.object=r,this.undoData.text=n.getText(r),n.change(r,text)):o.default.reject(f.noObject)},undo:function(t){var e=t.getComponent(v),n=this.undoData,r=n.object,text=n.text;return e.change(r,text)}};r.default.register(m),t.exports=m},function(t,e,n){"use strict";var r=h(n(3)),o=h(n(69)),c=h(n(4)),l=h(n(73));function h(t){return t&&t.__esModule?t:{default:t}}var f=l.default.componentNames,d=l.default.rejectMessages,v=l.default.commandNames,m=f.TEXT,y={name:v.CHANGE_TEXT_STYLE,execute:function(t,e,n){var o=this,l=t.getComponent(m),h=t.getObject(e);return h?(this.undoData.object=h,this.undoData.styles={},r.default.forEachOwnProperties(n,(function(t,e){o.undoData.styles[e]=h[e]})),l.setStyle(h,n)):c.default.reject(d.noObject)},undo:function(t){var e=t.getComponent(m),n=this.undoData,r=n.object,o=n.styles;return e.setStyle(r,o)}};o.default.register(y),t.exports=y},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(4));function c(t){return t&&t.__esModule?t:{default:t}}var l={name:c(n(73)).default.commandNames.CLEAR_OBJECTS,execute:function(t){var e=this;return new o.default((function(n){e.undoData.objects=t.removeAll(),n()}))},undo:function(t){return t.add(this.undoData.objects),o.default.resolve()}};r.default.register(l),t.exports=l},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=o.default.componentNames,h=o.default.commandNames,f=l.FLIP,d={name:h.FLIP_IMAGE,execute:function(t,e){var n=t.getComponent(f);return this.undoData.setting=n.getCurrentSetting(),n[e]()},undo:function(t){return t.getComponent(f).set(this.undoData.setting)}};r.default.register(d),t.exports=d},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=o.default.componentNames,h=o.default.commandNames,f=l.IMAGE_LOADER,d={name:h.LOAD_IMAGE,execute:function(t,e,n){var r=t.getComponent(f),o=r.getCanvasImage(),c=o?o.width:0,l=o?o.height:0,h=t.removeAll(!0).filter((function(t){return"cropzone"!==t.type}));return h.forEach((function(t){t.evented=!0})),this.undoData={name:r.getImageName(),image:o,objects:h},r.load(e,n).then((function(t){return{oldWidth:c,oldHeight:l,newWidth:t.width,newHeight:t.height}}))},undo:function(t){var e=t.getComponent(f),n=this.undoData,r=n.objects,o=n.name,image=n.image;return t.removeAll(!0),t.add(r),e.load(o,image)}};r.default.register(d),t.exports=d},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=o.default.componentNames,h=o.default.commandNames,f=l.FILTER,d={name:h.REMOVE_FILTER,execute:function(t,e){var n=t.getComponent(f);return this.undoData.options=n.getOptions(e),n.remove(e)},undo:function(t,e){var n=t.getComponent(f),r=this.undoData.options;return n.add(e,r)}};r.default.register(d),t.exports=d},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.commandNames,f=c.default.rejectMessages,d={name:h.REMOVE_OBJECT,execute:function(t,e){var n=this;return new o.default((function(r,o){n.undoData.objects=t.removeObjectById(e),n.undoData.objects.length?r():o(f.noObject)}))},undo:function(t){return t.add(this.undoData.objects),o.default.resolve()}};r.default.register(d),t.exports=d},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(4));function c(t){return t&&t.__esModule?t:{default:t}}var l={name:c(n(73)).default.commandNames.RESIZE_CANVAS_DIMENSION,execute:function(t,e){var n=this;return new o.default((function(r){n.undoData.size={width:t.cssMaxWidth,height:t.cssMaxHeight},t.setCssMaxDimension(e),t.adjustCanvasDimension(),r()}))},undo:function(t){return t.setCssMaxDimension(this.undoData.size),t.adjustCanvasDimension(),o.default.resolve()}};r.default.register(l),t.exports=l},function(t,e,n){"use strict";var r=c(n(69)),o=c(n(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=o.default.componentNames,h=o.default.commandNames,f=l.ROTATION,d={name:h.ROTATE_IMAGE,execute:function(t,e,n){var r=t.getComponent(f);return this.undoData.angle=r.getCurrentAngle(),r[e](n)},undo:function(t){var e=t.getComponent(f),n=this.undoData.angle;return e.setAngle(n)}};r.default.register(d),t.exports=d},function(t,e,n){"use strict";var r=h(n(3)),o=h(n(69)),c=h(n(4)),l=h(n(73));function h(t){return t&&t.__esModule?t:{default:t}}var f=l.default.commandNames,d=l.default.rejectMessages,v={name:f.SET_OBJECT_PROPERTIES,execute:function(t,e,n){var o=this,l=t.getObject(e);return l?(this.undoData.props={},r.default.forEachOwnProperties(n,(function(t,e){o.undoData.props[e]=l[e]})),t.setObjectProperties(e,n),c.default.resolve()):c.default.reject(d.noObject)},undo:function(t,e){var n=this.undoData.props;return t.setObjectProperties(e,n),c.default.resolve()}};o.default.register(v),t.exports=v},function(t,e,n){"use strict";var r=l(n(69)),o=l(n(4)),c=l(n(73));function l(t){return t&&t.__esModule?t:{default:t}}var h=c.default.commandNames,f=c.default.rejectMessages,d={name:h.SET_OBJECT_POSITION,execute:function(t,e,n){return t.getObject(e)?(this.undoData.objectId=e,this.undoData.props=t.getObjectProperties(e,["left","top"]),t.setObjectPosition(e,n),t.renderAll(),o.default.resolve()):o.default.reject(f.noObject)},undo:function(t){var e=this.undoData,n=e.objectId,r=e.props;return t.setObjectProperties(n,r),t.renderAll(),o.default.resolve()}};r.default.register(d),t.exports=d}])},t.exports=r(n(2009),n(2010))},2009:function(t,e,n){var r;r=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}return n.m=t,n.c=e,n.p="dist",n(0)}([function(t,e,n){"use strict";var r={},object=n(1),o=object.extend;o(r,object),o(r,n(3)),o(r,n(2)),o(r,n(4)),o(r,n(5)),o(r,n(6)),o(r,n(7)),o(r,n(8)),o(r,n(9)),r.browser=n(10),r.popup=n(11),r.formatDate=n(12),r.defineClass=n(13),r.defineModule=n(14),r.defineNamespace=n(15),r.CustomEvents=n(16),r.Enum=n(17),r.ExMap=n(18),r.HashMap=n(20),r.Map=n(19),t.exports=r},function(t,e,n){"use strict";var r=n(2),o=n(3),c=0;function l(t,e){var p,n=[],c=[];if(isNaN(t)&&isNaN(e)&&r.isNumber(t)&&r.isNumber(e))return!0;if(t===e)return!0;if(r.isFunction(t)&&r.isFunction(e)||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(o.inArray(t,n)>-1||o.inArray(e,c)>-1)return!1;for(p in e){if(e.hasOwnProperty(p)!==t.hasOwnProperty(p))return!1;if(typeof e[p]!=typeof t[p])return!1}for(p in t){if(e.hasOwnProperty(p)!==t.hasOwnProperty(p))return!1;if(typeof e[p]!=typeof t[p])return!1;if("object"==typeof t[p]||"function"==typeof t[p]){if(n.push(t),c.push(e),!l(t[p],e[p]))return!1;n.pop(),c.pop()}else if(t[p]!==e[p])return!1}return!0}function h(t,e){for(var n=arguments,o=n[0],i=1,c=n.length;i<c;i+=1){if(r.isUndefined(o)||r.isNull(o))return;o=o[n[i]]}return o}t.exports={extend:function(t,e){var source,n,i,r,o=Object.prototype.hasOwnProperty;for(i=1,r=arguments.length;i<r;i+=1)for(n in source=arguments[i])o.call(source,n)&&(t[n]=source[n]);return t},stamp:function(t){return t.__fe_id||(c+=1,t.__fe_id=c),t.__fe_id},hasStamp:function(t){return r.isExisty(h(t,"__fe_id"))},resetLastId:function(){c=0},keys:Object.prototype.keys||function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n},compareJSON:function(object){var t=arguments.length,i=1;if(t<1)return!0;for(;i<t;i+=1)if(!l(object,arguments[i]))return!1;return!0},pick:h}},function(t,e){"use strict";var n=Object.prototype.toString;function r(param){return!o(param)&&!c(param)}function o(t){return void 0===t}function c(t){return null===t}function l(t){return r(t)&&!1!==t}function h(t){return r(t)&&("[object Arguments]"===n.call(t)||!!t.callee)}function f(t){return t instanceof Array}function d(t){return t===Object(t)}function v(t){return t instanceof Function}function m(t){return"string"==typeof t||t instanceof String}function y(t){return!(r(t)&&!function(t){return m(t)&&""===t}(t)&&(f(t)||h(t)?0!==t.length:d(t)&&!v(t)&&function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}(t)))}t.exports={isExisty:r,isUndefined:o,isNull:c,isTruthy:l,isFalsy:function(t){return!l(t)},isArguments:h,isArray:f,isArraySafe:function(t){return"[object Array]"===n.call(t)},isObject:d,isFunction:v,isFunctionSafe:function(t){return"[object Function]"===n.call(t)},isNumber:function(t){return"number"==typeof t||t instanceof Number},isNumberSafe:function(t){return"[object Number]"===n.call(t)},isDate:function(t){return t instanceof Date},isDateSafe:function(t){return"[object Date]"===n.call(t)},isString:m,isStringSafe:function(t){return"[object String]"===n.call(t)},isBoolean:function(t){return"boolean"==typeof t||t instanceof Boolean},isBooleanSafe:function(t){return"[object Boolean]"===n.call(t)},isHTMLNode:function(html){return"object"==typeof HTMLElement?html&&(html instanceof HTMLElement||!!html.nodeType):!(!html||!html.nodeType)},isHTMLTag:function(html){return"object"==typeof HTMLElement?html&&html instanceof HTMLElement:!(!html||!html.nodeType||1!==html.nodeType)},isEmpty:y,isNotEmpty:function(t){return!y(t)}}},function(t,e,n){"use strict";var r,o=n(4),c=n(2),l=Array.prototype.slice;r={inArray:function(t,e,n){var i,r;if(n=n||0,!c.isArray(e))return-1;if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t,n);for(r=e.length,i=n;n>=0&&i<r;i+=1)if(e[i]===t)return i;return-1},range:function(t,e,n){var r,o=[];for(c.isUndefined(e)&&(e=t||0,t=0),e*=r=(n=n||1)<0?-1:1;t*r<e;t+=n)o.push(t);return o},zip:function(){var t=l.call(arguments),e=[];return o.forEach(t,(function(t){o.forEach(t,(function(t,n){e[n]||(e[n]=[]),e[n].push(t)}))})),e}},t.exports=r},function(t,e,n){"use strict";var r=n(2),object=n(1);function o(t,e,n){var r=0,o=t.length;for(n=n||null;r<o&&!1!==e.call(n,t[r],r,t);r+=1);}function c(t,e,n){var r;for(r in n=n||null,t)if(t.hasOwnProperty(r)&&!1===e.call(n,t[r],r,t))break}function l(t,e,n){r.isArray(t)?o(t,e,n):c(t,e,n)}function map(t,e,n){var r=[];return n=n||null,l(t,(function(){r.push(e.apply(n,arguments))})),r}t.exports={forEachOwnProperties:c,forEachArray:o,forEach:l,toArray:function(t){var e;try{e=Array.prototype.slice.call(t)}catch(n){e=[],o(t,(function(t){e.push(t)}))}return e},map:map,reduce:function(t,e,n){var o,c,l,h=0;for(n=n||null,r.isArray(t)?(c=t.length,l=t[h]):(c=(o=object.keys(t)).length,l=t[o[h+=1]]),h+=1;h<c;h+=1)l=e.call(n,l,t[o?o[h]:h]);return l},filter:function(t,e,n){var o,c;if(n=n||null,!r.isObject(t)||!r.isFunction(e))throw new Error("wrong parameter");return r.isArray(t)?(o=[],c=function(t,e){t.push(e[0])}):(o={},c=function(t,e){t[e[1]]=e[0]}),l(t,(function(){e.apply(n,arguments)&&c(o,arguments)}),n),o},pluck:function(t,e){return map(t,(function(t){return t[e]}))}}},function(t,e){"use strict";t.exports={bind:function(t,e){var n,r=Array.prototype.slice;return t.bind?t.bind.apply(t,r.call(arguments,1)):(n=r.call(arguments,2),function(){return t.apply(e,n.length?n.concat(r.call(arguments)):arguments)})}}},function(t,e){"use strict";function n(t){function e(){}return e.prototype=t,new e}t.exports={createObject:n,inherit:function(t,e){var r=n(e.prototype);r.constructor=t,t.prototype=r}}},function(t,e,n){"use strict";var r=n(4),object=n(1);t.exports={decodeHTMLEntity:function(t){var e={"&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&nbsp;":" "};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&nbsp;/g,(function(t){return e[t]?e[t]:t}))},encodeHTMLEntity:function(html){var t={'"':"quot","&":"amp","<":"lt",">":"gt","'":"#39"};return html.replace(/[<>&"']/g,(function(e){return t[e]?"&"+t[e]+";":e}))},hasEncodableString:function(t){return/[<>&"']/.test(t)},getDuplicatedChar:function(t,e){for(var n,i=0,o=t.length,c={};i<o;i+=1)c[n=t.charAt(i)]=1;for(i=0,o=e.length;i<o;i+=1)c[n=e.charAt(i)]&&(c[n]+=1);return c=r.filter(c,(function(t){return t>1})),(c=object.keys(c).sort()).join("")}}},function(t,e){"use strict";var n={},r=Array.prototype.slice;n.timestamp=function(){return Number(new Date)},n.debounce=function(t,e){var n,o;return e=e||0,function(){o=r.call(arguments),window.clearTimeout(n),n=window.setTimeout((function(){t.apply(null,o)}),e)}},n.throttle=function(t,e){var base,o,c,l,h=!0,f=function(e){t.apply(null,e),base=null};function d(){if(l=r.call(arguments),h)return f(l),void(h=!1);c=n.timestamp(),base=base||c,o(l),c-base>=e&&f(l)}return e=e||0,o=n.debounce(f,e),d.reset=function(){h=!0,base=null},d},t.exports=n},function(t,e,n){"use strict";var object=n(1),r=n(4),o=n(2),c=6048e5;function l(t,e){var n=r.map(object.keys(e),(function(t,n){return(0===n?"":"&")+t+"="+e[t]})).join(""),o=document.createElement("img");return o.src=t+"?"+n,o.style.display="none",document.body.appendChild(o),document.body.removeChild(o),o}t.exports={imagePing:l,sendHostname:function(t,e){var n=location.hostname,r="TOAST UI "+t+" for "+n+": Statistics",h=window.localStorage.getItem(r);(o.isUndefined(window.tui)||!1!==window.tui.usageStatistics)&&(h&&!function(t){return(new Date).getTime()-t>c}(h)||(window.localStorage.setItem(r,(new Date).getTime()),setTimeout((function(){"interactive"!==document.readyState&&"complete"!==document.readyState||l("https://www.google-analytics.com/collect",{v:1,t:"event",tid:e,cid:n,dp:n,dh:t,el:t,ec:"use"})}),1e3)))}}},function(t,e){"use strict";var n,r,nav,o,c,l,h,f,d,v,m={chrome:!1,firefox:!1,safari:!1,msie:!1,edge:!1,others:!1,version:0};window&&window.navigator&&(nav=window.navigator,o=nav.appName.replace(/\s/g,"_"),c=nav.userAgent,l=/MSIE\s([0-9]+[.0-9]*)/,h=/Trident.*rv:11\./,f=/Edge\/(\d+)\./,d={firefox:/Firefox\/(\d+)\./,chrome:/Chrome\/(\d+)\./,safari:/Version\/([\d.]+).*Safari\/(\d+)/},(v={Microsoft_Internet_Explorer:function(){var t=c.match(l);t?(m.msie=!0,m.version=parseFloat(t[1])):m.others=!0},Netscape:function(){var t=!1;if(h.exec(c))m.msie=!0,m.version=11,t=!0;else if(f.exec(c))m.edge=!0,m.version=c.match(f)[1],t=!0;else for(n in d)if(d.hasOwnProperty(n)&&(r=c.match(d[n]))&&r.length>1){m[n]=t=!0,m.version=parseFloat(r[1]||0);break}t||(m.others=!0)}})[o]&&v[o]()),t.exports=m},function(t,e,n){"use strict";var r=n(4),o=n(2),c=n(5),l=n(10),object=n(1),h=0;function f(){this.openedPopup={},this.closeWithParentPopup={},this.postBridgeUrl=""}f.prototype.getPopupList=function(t){return o.isExisty(t)?this.openedPopup[t]:this.openedPopup},f.prototype.openPopup=function(t,e){var n,r,f;if((e=object.extend({popupName:"popup_"+h+"_"+Number(new Date),popupOptionStr:"",useReload:!0,closeWithParent:!0,method:"get",param:{}},e||{})).method=e.method.toUpperCase(),this.postBridgeUrl=e.postBridgeUrl||this.postBridgeUrl,f="POST"===e.method&&e.param&&l.msie&&11===l.version,!o.isExisty(t))throw new Error("Popup#open() need popup url.");h+=1,e.param&&("GET"===e.method?t=t+(/\?/.test(t)?"&":"?")+this._parameterize(e.param):"POST"===e.method&&(f||(r=this.createForm(t,e.param,e.method,e.popupName),t="about:blank"))),n=this.openedPopup[e.popupName],o.isExisty(n)?n.closed?this.openedPopup[e.popupName]=n=this._open(f,e.param,t,e.popupName,e.popupOptionStr):(e.useReload&&n.location.replace(t),n.focus()):this.openedPopup[e.popupName]=n=this._open(f,e.param,t,e.popupName,e.popupOptionStr),this.closeWithParentPopup[e.popupName]=e.closeWithParent,(!n||n.closed||o.isUndefined(n.closed))&&alert("please enable popup windows for this website"),e.param&&"POST"===e.method&&!f&&(n&&r.submit(),r.parentNode&&r.parentNode.removeChild(r)),window.onunload=c.bind(this.closeAllPopup,this)},f.prototype.close=function(t,e){var n=e||window;(t=!!o.isExisty(t)&&t)&&(window.onunload=null),n.closed||(n.opener=window.location.href,n.close())},f.prototype.closeAllPopup=function(t){var e=o.isExisty(t);r.forEachOwnProperties(this.openedPopup,(function(t,n){(e&&this.closeWithParentPopup[n]||!e)&&this.close(!1,t)}),this)},f.prototype.focus=function(t){this.getPopupList(t).focus()},f.prototype.parseQuery=function(){var t,e,param={};return t=window.location.search.substr(1),r.forEachArray(t.split("&"),(function(t){e=t.split("="),param[decodeURIComponent(e[0])]=decodeURIComponent(e[1])})),param},f.prototype.createForm=function(t,data,e,n,o){var input,form=document.createElement("form");return o=o||document.body,form.method=e||"POST",form.action=t||"",form.target=n||"",form.style.display="none",r.forEachOwnProperties(data,(function(t,e){(input=document.createElement("input")).name=e,input.type="hidden",input.value=t,form.appendChild(input)})),o.appendChild(form),form},f.prototype._parameterize=function(t){var e=[];return r.forEachOwnProperties(t,(function(t,n){e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})),e.join("&")},f.prototype._open=function(t,param,e,n,r){var o;return t?(o=window.open(this.postBridgeUrl,n,r),setTimeout((function(){o.redirect(e,param)}),100)):o=window.open(e,n,r),o},t.exports=new f},function(t,e,n){"use strict";var r=n(2),object=n(1),o=/[\\]*YYYY|[\\]*YY|[\\]*MMMM|[\\]*MMM|[\\]*MM|[\\]*M|[\\]*DD|[\\]*D|[\\]*HH|[\\]*H|[\\]*A/gi,c=["Invalid month","January","February","March","April","May","June","July","August","September","October","November","December"],l=[0,31,28,31,30,31,30,31,31,30,31,30,31],h={M:function(t){return Number(t.month)},MM:function(t){var e=t.month;return Number(e)<10?"0"+e:e},MMM:function(t){return c[Number(t.month)].substr(0,3)},MMMM:function(t){return c[Number(t.month)]},D:function(t){return Number(t.date)},d:function(t){return h.D(t)},DD:function(t){var e=t.date;return Number(e)<10?"0"+e:e},dd:function(t){return h.DD(t)},YY:function(t){return Number(t.year)%100},yy:function(t){return h.YY(t)},YYYY:function(t){var e="20",n=t.year;return n>69&&n<100&&(e="19"),Number(n)<100?e+String(n):n},yyyy:function(t){return h.YYYY(t)},A:function(t){return t.meridiem},a:function(t){return t.meridiem},hh:function(t){var e=t.hour;return Number(e)<10?"0"+e:e},HH:function(t){return h.hh(t)},h:function(t){return String(Number(t.hour))},H:function(t){return h.h(t)},m:function(t){return String(Number(t.minute))},mm:function(t){var e=t.minute;return Number(e)<10?"0"+e:e}};t.exports=function(form,t,option){var e,n,c=object.pick(option,"meridiemSet","AM")||"AM",f=object.pick(option,"meridiemSet","PM")||"PM";return!!function(t,e,n){var r;return t=Number(t),e=Number(e),n=Number(n),(t>-1&&t<100||t>1969&&t<2070)&&e>0&&e<13&&(r=l[e],2===e&&t%4==0&&(t%100==0&&t%400!=0||(r=29)),n>0&&n<=r)}((n=r.isDate(t)?{year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate(),hour:t.getHours(),minute:t.getMinutes()}:{year:t.year,month:t.month,date:t.date,hour:t.hour,minute:t.minute}).year,n.month,n.date)&&(n.meridiem="",/([^\\]|^)[aA]\b/.test(form)&&(e=n.hour>11?f:c,n.hour>12&&(n.hour%=12),0===n.hour&&(n.hour=12),n.meridiem=e),form.replace(o,(function(t){return t.indexOf("\\")>-1?t.replace(/\\/,""):h[t](n)||""})))}},function(t,e,n){"use strict";var r=n(6).inherit,o=n(1).extend;t.exports=function(t,e){var n;return e||(e=t,t=null),n=e.init||function(){},t&&r(n,t),e.hasOwnProperty("static")&&(o(n,e.static),delete e.static),o(n.prototype,e),n}},function(t,e,n){"use strict";var r=n(15),o=n(2),c="initialize";t.exports=function(t,e){var base=e||{};return o.isFunction(base[c])&&base[c](),r(t,base)}},function(t,e,n){"use strict";var r=n(4),object=n(1);t.exports=function(t,e,n){var o,c,l;return(o=t.split(".")).unshift(window),c=r.reduce(o,(function(t,e){return t[e]=t[e]||{},t[e]})),n?(l=o.pop(),c=object.pick.apply(null,o)[l]=e):object.extend(c,e),c}},function(t,e,n){"use strict";var r=n(4),o=n(2),object=n(1),c=/\s+/g;function l(){this.events=null,this.contexts=null}l.mixin=function(t){object.extend(t.prototype,l.prototype)},l.prototype._getHandlerItem=function(t,e){var n={handler:t};return e&&(n.context=e),n},l.prototype._safeEvent=function(t){var e,n=this.events;return n||(n=this.events={}),t&&((e=n[t])||(e=[],n[t]=e),n=e),n},l.prototype._safeContext=function(){var t=this.contexts;return t||(t=this.contexts=[]),t},l.prototype._indexOfContext=function(t){for(var e=this._safeContext(),n=0;e[n];){if(t===e[n][0])return n;n+=1}return-1},l.prototype._memorizeContext=function(t){var e,n;o.isExisty(t)&&(e=this._safeContext(),(n=this._indexOfContext(t))>-1?e[n][1]+=1:e.push([t,1]))},l.prototype._forgetContext=function(t){var e,n;o.isExisty(t)&&(e=this._safeContext(),(n=this._indexOfContext(t))>-1&&(e[n][1]-=1,e[n][1]<=0&&e.splice(n,1)))},l.prototype._bindEvent=function(t,e,n){var r=this._safeEvent(t);this._memorizeContext(n),r.push(this._getHandlerItem(e,n))},l.prototype.on=function(t,e,n){var l=this;o.isString(t)?(t=t.split(c),r.forEach(t,(function(t){l._bindEvent(t,e,n)}))):o.isObject(t)&&(n=e,r.forEach(t,(function(t,e){l.on(e,t,n)})))},l.prototype.once=function(t,e,n){var c=this;if(o.isObject(t))return n=e,void r.forEach(t,(function(t,e){c.once(e,t,n)}));this.on(t,(function r(){e.apply(n,arguments),c.off(t,r,n)}),n)},l.prototype._spliceMatches=function(t,e){var n,i=0;if(o.isArray(t))for(n=t.length;i<n;i+=1)!0===e(t[i])&&(t.splice(i,1),n-=1,i-=1)},l.prototype._matchHandler=function(t){var e=this;return function(n){var r=t===n.handler;return r&&e._forgetContext(n.context),r}},l.prototype._matchContext=function(t){var e=this;return function(n){var r=t===n.context;return r&&e._forgetContext(n.context),r}},l.prototype._matchHandlerAndContext=function(t,e){var n=this;return function(r){var o=t===r.handler,c=e===r.context,l=o&&c;return l&&n._forgetContext(r.context),l}},l.prototype._offByEventName=function(t,e){var n=this,l=r.forEachArray,h=o.isFunction(e),f=n._matchHandler(e);t=t.split(c),l(t,(function(t){var e=n._safeEvent(t);h?n._spliceMatches(e,f):(l(e,(function(t){n._forgetContext(t.context)})),n.events[t]=[])}))},l.prototype._offByHandler=function(t){var e=this,n=this._matchHandler(t);r.forEach(this._safeEvent(),(function(t){e._spliceMatches(t,n)}))},l.prototype._offByObject=function(t,e){var n,c=this;this._indexOfContext(t)<0?r.forEach(t,(function(t,e){c.off(e,t)})):o.isString(e)?(n=this._matchContext(t),c._spliceMatches(this._safeEvent(e),n)):o.isFunction(e)?(n=this._matchHandlerAndContext(e,t),r.forEach(this._safeEvent(),(function(t){c._spliceMatches(t,n)}))):(n=this._matchContext(t),r.forEach(this._safeEvent(),(function(t){c._spliceMatches(t,n)})))},l.prototype.off=function(t,e){o.isString(t)?this._offByEventName(t,e):arguments.length?o.isFunction(t)?this._offByHandler(t):o.isObject(t)&&this._offByObject(t,e):(this.events={},this.contexts=[])},l.prototype.fire=function(t){this.invoke.apply(this,arguments)},l.prototype.invoke=function(t){var e,n,r,o;if(!this.hasListener(t))return!0;for(e=this._safeEvent(t),n=Array.prototype.slice.call(arguments,1),r=0;e[r];){if(!1===(o=e[r]).handler.apply(o.context,n))return!1;r+=1}return!0},l.prototype.hasListener=function(t){return this.getListenerLength(t)>0},l.prototype.getListenerLength=function(t){return this._safeEvent(t).length},t.exports=l},function(t,e,n){"use strict";var r=n(4),o=n(2),c=function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}(),l=0;function h(t){t&&this.set.apply(this,arguments)}h.prototype.set=function(t){var e=this;o.isArray(t)||(t=r.toArray(arguments)),r.forEach(t,(function(t){e._addItem(t)}))},h.prototype.getName=function(t){var e,n=this;return r.forEach(this,(function(r,o){if(n._isEnumItem(o)&&t===r)return e=o,!1})),e},h.prototype._addItem=function(t){var e;this.hasOwnProperty(t)||(e=this._makeEnumValue(),c?Object.defineProperty(this,t,{enumerable:!0,configurable:!1,writable:!1,value:e}):this[t]=e)},h.prototype._makeEnumValue=function(){var t;return t=l,l+=1,t},h.prototype._isEnumItem=function(t){return o.isNumber(this[t])},t.exports=h},function(t,e,n){"use strict";var r=n(4),o=n(19);function c(t){this._map=new o(t),this.size=this._map.size}r.forEachArray(["get","has","forEach","keys","values","entries"],(function(t){c.prototype[t]=function(){return this._map[t].apply(this._map,arguments)}})),r.forEachArray(["delete","clear"],(function(t){c.prototype[t]=function(){var e=this._map[t].apply(this._map,arguments);return this.size=this._map.size,e}})),c.prototype.set=function(){return this._map.set.apply(this._map,arguments),this.size=this._map.size,this},c.prototype.setObject=function(object){r.forEachOwnProperties(object,(function(t,e){this.set(e,t)}),this)},c.prototype.deleteByKeys=function(t){r.forEachArray(t,(function(t){this.delete(t)}),this)},c.prototype.merge=function(map){map.forEach((function(t,e){this.set(e,t)}),this)},c.prototype.filter=function(t){var e=new c;return this.forEach((function(n,r){t(n,r)&&e.set(r,n)})),e},t.exports=c},function(t,e,n){"use strict";var r=n(4),o=n(2),c=n(3),l=n(10),h=n(5),f={},d={};function v(t,e){this._keys=t,this._valueGetter=e,this._length=this._keys.length,this._index=-1,this._done=!1}function m(t){this._valuesForString={},this._valuesForIndex={},this._keys=[],t&&this._setInitData(t),this.size=0}v.prototype.next=function(){var data={};do{this._index+=1}while(o.isUndefined(this._keys[this._index])&&this._index<this._length);return this._index>=this._length?data.done=!0:(data.done=!1,data.value=this._valueGetter(this._keys[this._index],this._index)),data},m.prototype._setInitData=function(t){if(!o.isArray(t))throw new Error("Only Array is supported.");r.forEachArray(t,(function(t){this.set(t[0],t[1])}),this)},m.prototype._isNaN=function(t){return"number"==typeof t&&t!=t},m.prototype._getKeyIndex=function(t){var e,n=-1;return o.isString(t)?(e=this._valuesForString[t])&&(n=e.keyIndex):n=c.inArray(t,this._keys),n},m.prototype._getOriginKey=function(t){var e=t;return t===f?e=void 0:t===d&&(e=NaN),e},m.prototype._getUniqueKey=function(t){var e=t;return o.isUndefined(t)?e=f:this._isNaN(t)&&(e=d),e},m.prototype._getValueObject=function(t,e){return o.isString(t)?this._valuesForString[t]:(o.isUndefined(e)&&(e=this._getKeyIndex(t)),e>=0?this._valuesForIndex[e]:void 0)},m.prototype._getOriginValue=function(t,e){return this._getValueObject(t,e).origin},m.prototype._getKeyValuePair=function(t,e){return[this._getOriginKey(t),this._getOriginValue(t,e)]},m.prototype._createValueObject=function(t,e){return{keyIndex:e,origin:t}},m.prototype.set=function(t,e){var n,r=this._getUniqueKey(t),c=this._getKeyIndex(r);return c<0&&(c=this._keys.push(r)-1,this.size+=1),n=this._createValueObject(e,c),o.isString(t)?this._valuesForString[t]=n:this._valuesForIndex[c]=n,this},m.prototype.get=function(t){var e=this._getUniqueKey(t),n=this._getValueObject(e);return n&&n.origin},m.prototype.keys=function(){return new v(this._keys,h.bind(this._getOriginKey,this))},m.prototype.values=function(){return new v(this._keys,h.bind(this._getOriginValue,this))},m.prototype.entries=function(){return new v(this._keys,h.bind(this._getKeyValuePair,this))},m.prototype.has=function(t){return!!this._getValueObject(t)},m.prototype.delete=function(t){var e;o.isString(t)?this._valuesForString[t]&&(e=this._valuesForString[t].keyIndex,delete this._valuesForString[t]):(e=this._getKeyIndex(t))>=0&&delete this._valuesForIndex[e],e>=0&&(delete this._keys[e],this.size-=1)},m.prototype.forEach=function(t,e){e=e||this,r.forEachArray(this._keys,(function(n){o.isUndefined(n)||t.call(e,this._getValueObject(n).origin,n,this)}),this)},m.prototype.clear=function(){m.call(this)},window.Map&&(l.firefox&&l.version>=37||l.chrome&&l.version>=42)&&(m=window.Map),t.exports=m},function(t,e,n){"use strict";var r=n(4),o=n(2);function c(t){this.length=0,t&&this.setObject(t)}c.prototype.set=function(t,e){2===arguments.length?this.setKeyValue(t,e):this.setObject(t)},c.prototype.setKeyValue=function(t,e){this.has(t)||(this.length+=1),this[this.encodeKey(t)]=e},c.prototype.setObject=function(t){var e=this;r.forEachOwnProperties(t,(function(t,n){e.setKeyValue(n,t)}))},c.prototype.merge=function(t){var e=this;t.each((function(t,n){e.setKeyValue(n,t)}))},c.prototype.encodeKey=function(t){return"å"+t},c.prototype.decodeKey=function(t){var e=t.split("å");return e[e.length-1]},c.prototype.get=function(t){return this[this.encodeKey(t)]},c.prototype.has=function(t){return this.hasOwnProperty(this.encodeKey(t))},c.prototype.remove=function(t){return arguments.length>1&&(t=r.toArray(arguments)),o.isArray(t)?this.removeByKeyArray(t):this.removeByKey(t)},c.prototype.removeByKey=function(t){var data=this.has(t)?this.get(t):null;return null!==data&&(delete this[this.encodeKey(t)],this.length-=1),data},c.prototype.removeByKeyArray=function(t){var data=[],e=this;return r.forEach(t,(function(t){data.push(e.removeByKey(t))})),data},c.prototype.removeAll=function(){var t=this;this.each((function(e,n){t.remove(n)}))},c.prototype.each=function(t){var e,n=this;r.forEachOwnProperties(this,(function(r,o){if("å"===o.charAt(0)&&(e=t(r,n.decodeKey(o))),!1===e)return e}))},c.prototype.keys=function(){var t=[],e=this;return this.each((function(n,r){t.push(e.decodeKey(r))})),t},c.prototype.find=function(t){var e=[];return this.each((function(n,r){t(n,r)&&e.push(n)})),e},c.prototype.toArray=function(){var t=[];return this.each((function(e){t.push(e)})),t},t.exports=c}])},t.exports=r()},2010:function(module,exports,__webpack_require__){(function(Buffer,process){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,fabric=fabric||{version:"1.6.7"},global,sqrt,atan2,pow,abs,PiBy180,slice,apply,Dummy,parseEl,supportsOpacity,supportsFilters,reOpacity,setOpacity,cursorOffset,addListener,removeListener,min,max,supportQuality,degreesToRadians,originXOffset,originYOffset,clone,toFixed,NUM_FRACTION_DIGITS,override;exports.fabric=fabric,"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=__webpack_require__(2011).jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode=void 0!==Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function t(t,e){if(this.__eventListeners[t]){var n=this.__eventListeners[t];e?n[n.indexOf(e)]=!1:fabric.util.array.fill(n,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var n in t)this.on(n,t[n]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function n(e,n){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var r in e)t.call(this,r,e[r]);else t.call(this,e,n);return this}}function r(t,e){if(this.__eventListeners){var n=this.__eventListeners[t];if(n){for(var i=0,r=n.length;i<r;i++)n[i]&&n[i].call(this,e||{});return this.__eventListeners[t]=n.filter((function(t){return!1!==t})),this}}}fabric.Observable={observe:e,stopObserving:n,fire:r,on:e,off:n,trigger:r}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var i=0,t=arguments.length;i<t;i++)this._onObjectAdded(arguments[i]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(object,t,e){var n=this.getObjects();return e?n[t]=object:n.splice(t,0,object),this._onObjectAdded&&this._onObjectAdded(object),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),n=!1,i=0,r=arguments.length;i<r;i++)-1!==(t=e.indexOf(arguments[i]))&&(n=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&n&&this.renderAll(),this},forEachObject:function(t,e){for(var n=this.getObjects(),i=0,r=n.length;i<r;i++)t.call(e,n[i],i,n);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter((function(e){return e.type===t}))},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(object){return this.getObjects().indexOf(object)>-1},complexity:function(){return this.getObjects().reduce((function(t,e){return t+=e.complexity?e.complexity():0}),0)}},global=exports,sqrt=Math.sqrt,atan2=Math.atan2,pow=Math.pow,abs=Math.abs,PiBy180=Math.PI/180,fabric.util={removeFromArray:function(t,e){var n=t.indexOf(e);return-1!==n&&t.splice(n,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*PiBy180},radiansToDegrees:function(t){return t/PiBy180},rotatePoint:function(t,e,n){t.subtractEquals(e);var r=fabric.util.rotateVector(t,n);return new fabric.Point(r.x,r.y).addEquals(e)},rotateVector:function(t,e){var n=Math.sin(e),r=Math.cos(e);return{x:t.x*r-t.y*n,y:t.x*n+t.y*r}},transformPoint:function(p,t,e){return e?new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y):new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],n=fabric.util.array.min(e),r=fabric.util.array.max(e),o=Math.abs(n-r),c=[t[0].y,t[1].y,t[2].y,t[3].y],l=fabric.util.array.min(c),h=fabric.util.array.max(c);return{left:n,top:l,width:o,height:Math.abs(l-h)}},invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),e=[a*t[3],-a*t[1],-a*t[2],a*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},e,!0);return e[4]=-n.x,e[5]=-n.y,e},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var n=/\D{0,2}$/.exec(t),r=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),n[0]){case"mm":return r*fabric.DPI/25.4;case"cm":return r*fabric.DPI/2.54;case"in":return r*fabric.DPI;case"pt":return r*fabric.DPI/72;case"pc":return r*fabric.DPI/72*12;case"em":return r*e;default:return r}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(t){if(!t)return fabric;var i,e=t.split("."),n=e.length,r=global||fabric.window;for(i=0;i<n;++i)r=r[e[i]];return r},loadImage:function(t,e,n,r){if(t){var img=fabric.util.createImage();img.onload=function(){e&&e.call(n,img),img=img.onload=img.onerror=null},img.onerror=function(){fabric.log("Error loading "+img.src),e&&e.call(n,null,!0),img=img.onload=img.onerror=null},0!==t.indexOf("data")&&r&&(img.crossOrigin=r),img.src=t}else e&&e.call(n,t)},enlivenObjects:function(t,e,n,r){function o(){++l===h&&e&&e(c)}var c=[],l=0,h=(t=t||[]).length;h?t.forEach((function(t,e){if(t&&t.type){var l=fabric.util.getKlass(t.type,n);l.async?l.fromObject(t,(function(n,l){l||(c[e]=n,r&&r(t,c[e])),o()})):(c[e]=l.fromObject(t),r&&r(t,c[e]),o())}else o()})):e&&e(c)},groupSVGElements:function(t,e,path){var object;return object=new fabric.PathGroup(t,e),void 0!==path&&object.setSourcePath(path),object},populateWithProperties:function(source,t,e){if(e&&"[object Array]"===Object.prototype.toString.call(e))for(var i=0,n=e.length;i<n;i++)e[i]in source&&(t[e[i]]=source[e[i]])},drawDashedLine:function(t,e,n,r,o,c){var l=r-e,h=o-n,f=sqrt(l*l+h*h),d=atan2(h,l),v=c.length,m=0,y=!0;for(t.save(),t.translate(e,n),t.moveTo(0,0),t.rotate(d),e=0;f>e;)(e+=c[m++%v])>f&&(e=f),t[y?"lineTo":"moveTo"](e,0),y=!y;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(__webpack_require__(912).Image):fabric.document.createElement("img")},createAccessors:function(t){var i,e,n,r,o,c=t.prototype;for(i=c.stateProperties.length;i--;)r="set"+(n=(e=c.stateProperties[i]).charAt(0).toUpperCase()+e.slice(1)),c[o="get"+n]||(c[o]=new Function('return this.get("'+e+'")')),c[r]||(c[r]=function(t){return new Function("value",'return this.set("'+t+'", value)')}(e))},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(a,b,t){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],t?0:a[0]*b[4]+a[2]*b[5]+a[4],t?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var t=atan2(a[1],a[0]),e=pow(a[0],2)+pow(a[1],2),n=sqrt(e),r=(a[0]*a[3]-a[2]*a[1])/n,o=atan2(a[0]*a[2]+a[1]*a[3],e);return{angle:t/PiBy180,scaleX:n,scaleY:r,skewX:o/PiBy180,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(t,e,n){var r=[1,0,abs(Math.tan(n*PiBy180)),1],o=[abs(t),0,0,abs(e)];return fabric.util.multiplyTransformMatrices(o,r,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.setAngle(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,n,r){r>0&&(e>r?e-=r:e=0,n>r?n-=r:n=0);var i,o=!0,c=t.getImageData(e,n,2*r||1,2*r||1),l=c.data.length;for(i=3;i<l&&!1!=(o=c.data[i]<=0);i+=4);return c=null,o},parsePreserveAspectRatioAttribute:function(t){var e,n="meet",r=t.split(" ");return r&&r.length&&("meet"!==(n=r.pop())&&"slice"!==n?(e=n,n="meet"):r.length&&(e=r.pop())),{meetOrSlice:n,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}}},function(){var t={},e={},n={},r=Array.prototype.join;function o(e,n,o,h,f,d,v){var m=r.call(arguments);if(t[m])return t[m];var y=Math.PI,th=v*y/180,_=Math.sin(th),x=Math.cos(th),w=0,C=0,S=-x*e*.5-_*n*.5,k=-x*n*.5+_*e*.5,O=(o=Math.abs(o))*o,E=(h=Math.abs(h))*h,T=k*k,j=S*S,M=O*E-O*T-E*j,P=0;if(M<0){var s=Math.sqrt(1-M/(O*E));o*=s,h*=s}else P=(f===d?-1:1)*Math.sqrt(M/(O*T+E*j));var A=P*o*k/h,I=-P*h*S/o,D=x*A-_*I+.5*e,L=_*A+x*I+.5*n,R=l(1,0,(S-A)/o,(k-I)/h),B=l((S-A)/o,(k-I)/h,(-S-A)/o,(-k-I)/h);0===d&&B>0?B-=2*y:1===d&&B<0&&(B+=2*y);for(var F=Math.ceil(Math.abs(B/y*2)),N=[],z=B/F,X=8/3*Math.sin(z/4)*Math.sin(z/4)/Math.sin(z/2),W=R+z,i=0;i<F;i++)N[i]=c(R,W,x,_,o,h,D,L,X,w,C),w=N[i][4],C=N[i][5],R=W,W+=z;return t[m]=N,N}function c(t,n,o,c,l,h,f,d,v,m,y){var _=r.call(arguments);if(e[_])return e[_];var x=Math.cos(t),w=Math.sin(t),C=Math.cos(n),S=Math.sin(n),k=o*l*C-c*h*S+f,O=c*l*C+o*h*S+d,E=m+v*(-o*l*w-c*h*x),T=y+v*(-c*l*w+o*h*x),j=k+v*(o*l*S+c*h*C),M=O+v*(c*l*S-o*h*C);return e[_]=[E,T,j,M,k,O],e[_]}function l(t,e,n,r){var o=Math.atan2(e,t),c=Math.atan2(r,n);return c>=o?c-o:2*Math.PI-(o-c)}function h(t,e,o,c,l,h,f,d){var v=r.call(arguments);if(n[v])return n[v];var a,b,m,y,_,x,w,C,S=Math.sqrt,k=Math.min,O=Math.max,E=Math.abs,T=[],j=[[],[]];b=6*t-12*o+6*l,a=-3*t+9*o-9*l+3*f,m=3*o-3*t;for(var i=0;i<2;++i)if(i>0&&(b=6*e-12*c+6*h,a=-3*e+9*c-9*h+3*d,m=3*c-3*e),E(a)<1e-12){if(E(b)<1e-12)continue;0<(y=-m/b)&&y<1&&T.push(y)}else(w=b*b-4*m*a)<0||(0<(_=(-b+(C=S(w)))/(2*a))&&_<1&&T.push(_),0<(x=(-b-C)/(2*a))&&x<1&&T.push(x));for(var M,P,A,I=T.length,D=I;I--;)M=(A=1-(y=T[I]))*A*A*t+3*A*A*y*o+3*A*y*y*l+y*y*y*f,j[0][I]=M,P=A*A*A*e+3*A*A*y*c+3*A*y*y*h+y*y*y*d,j[1][I]=P;j[0][D]=t,j[1][D]=e,j[0][D+1]=f,j[1][D+1]=d;var L=[{x:k.apply(null,j[0]),y:k.apply(null,j[1])},{x:O.apply(null,j[0]),y:O.apply(null,j[1])}];return n[v]=L,L}fabric.util.drawArc=function(t,e,n,r){for(var c=r[0],l=r[1],h=r[2],f=r[3],d=r[4],v=[[],[],[],[]],m=o(r[5]-e,r[6]-n,c,l,f,d,h),i=0,y=m.length;i<y;i++)v[i][0]=m[i][0]+e,v[i][1]=m[i][1]+n,v[i][2]=m[i][2]+e,v[i][3]=m[i][3]+n,v[i][4]=m[i][4]+e,v[i][5]=m[i][5]+n,t.bezierCurveTo.apply(t,v[i])},fabric.util.getBoundsOfArc=function(t,e,n,r,c,l,f,d,v){for(var m,y=0,_=0,x=[],w=o(d-t,v-e,n,r,l,f,c),i=0,C=w.length;i<C;i++)m=h(y,_,w[i][0],w[i][1],w[i][2],w[i][3],w[i][4],w[i][5]),x.push({x:m[0].x+t,y:m[0].y+e}),x.push({x:m[1].x+t,y:m[1].y+e}),y=w[i][4],_=w[i][5];return x},fabric.util.getBoundsOfCurve=h}(),function(){var t=Array.prototype.slice;function e(t,e,n){if(t&&0!==t.length){var i=t.length-1,r=e?t[i][e]:t[i];if(e)for(;i--;)n(t[i][e],r)&&(r=t[i][e]);else for(;i--;)n(t[i],r)&&(r=t[i]);return r}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>0&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==Number.POSITIVE_INFINITY&&r!==Number.NEGATIVE_INFINITY&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var o=r>=0?r:Math.max(n-Math.abs(r),0);o<n;o++)if(o in e&&e[o]===t)return o;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var n=[],i=0,r=this.length>>>0;i<r;i++)i in this&&(n[i]=t.call(e,this[i],i,this));return n}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var n,r=[],i=0,o=this.length>>>0;i<o;i++)i in this&&(n=this[i],t.call(e,n,i,this)&&r.push(n));return r}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,n=this.length>>>0,i=0;if(arguments.length>1)e=arguments[1];else for(;;){if(i in this){e=this[i++];break}if(++i>=n)throw new TypeError}for(;i<n;i++)i in this&&(e=t.call(null,e,this[i],i,this));return e}),fabric.util.array={fill:function(t,e){for(var n=t.length;n--;)t[n]=e;return t},invoke:function(e,n){for(var r=t.call(arguments,2),o=[],i=0,c=e.length;i<c;i++)o[i]=r.length?e[i][n].apply(e[i],r):e[i][n].call(e[i]);return o},min:function(t,n){return e(t,n,(function(t,e){return t<e}))},max:function(t,n){return e(t,n,(function(t,e){return t>=e}))}}}(),function(){function t(t,source,n){if(n)if(!fabric.isLikelyNode&&source instanceof Element)t=source;else if(source instanceof Array)t=source.map((function(t){return e(t,n)}));else if(source instanceof Object)for(var r in source)t[r]=e(source[r],n);else t=source;else for(var r in source)t[r]=source[r];return t}function e(object,e){return t({},object,e)}fabric.util.object={extend:t,clone:e}}(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,(function(t,e){return e?e.toUpperCase():""}))},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},slice=Array.prototype.slice,apply=Function.prototype.apply,Dummy=function(){},Function.prototype.bind||(Function.prototype.bind=function(t){var e,n=this,r=slice.call(arguments,1);return e=r.length?function(){return apply.call(n,this instanceof Dummy?this:t,r.concat(slice.call(arguments)))}:function(){return apply.call(n,this instanceof Dummy?this:t,arguments)},Dummy.prototype=this.prototype,e.prototype=new Dummy,e}),function(){var t=Array.prototype.slice,e=function(){},n=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0}(),r=function(t,source,e){for(var r in source)r in t.prototype&&"function"==typeof t.prototype[r]&&(source[r]+"").indexOf("callSuper")>-1?t.prototype[r]=function(t){return function(){var n=this.constructor.superclass;this.constructor.superclass=e;var r=source[t].apply(this,arguments);if(this.constructor.superclass=n,"initialize"!==t)return r}}(r):t.prototype[r]=source[r],n&&(source.toString!==Object.prototype.toString&&(t.prototype.toString=source.toString),source.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=source.valueOf))};function o(){}function c(e){var n=this.constructor.superclass.prototype[e];return arguments.length>1?n.apply(this,t.call(arguments,1)):n.call(this)}fabric.util.createClass=function(){var n=null,l=t.call(arguments,0);function h(){this.initialize.apply(this,arguments)}"function"==typeof l[0]&&(n=l.shift()),h.superclass=n,h.subclasses=[],n&&(o.prototype=n.prototype,h.prototype=new o,n.subclasses.push(h));for(var i=0,f=l.length;i<f;i++)r(h,l[i],n);return h.prototype.initialize||(h.prototype.initialize=e),h.prototype.constructor=h,h.prototype.callSuper=c,h}}(),function(){var t="unknown";function e(object){var t,i,e=Array.prototype.slice.call(arguments,1),n=e.length;for(i=0;i<n;i++)if(t=typeof object[e[i]],!/^(?:function|object|unknown)$/.test(t))return!1;return!0}var n,r,o,c,l=(o=0,function(element){return element.__uniqueID||(element.__uniqueID="uniqueID__"+o++)});function h(t,e){return function(r){e.call(n(t),r||fabric.window.event)}}c={},n=function(t){return c[t]},r=function(t,element){c[t]=element};var f,d,v=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),m=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),y={},_={};v?(f=function(element,t,e){element.addEventListener(t,e,!1)},d=function(element,t,e){element.removeEventListener(t,e,!1)}):m?(f=function(element,t,e){var n=l(element);r(n,element),y[n]||(y[n]={}),y[n][t]||(y[n][t]=[]);var o=function(t,e){return{handler:e,wrappedHandler:h(t,e)}}(n,e);y[n][t].push(o),element.attachEvent("on"+t,o.wrappedHandler)},d=function(element,t,e){var n,r=l(element);if(y[r]&&y[r][t])for(var i=0,o=y[r][t].length;i<o;i++)(n=y[r][t][i])&&n.handler===e&&(element.detachEvent("on"+t,n.wrappedHandler),y[r][t][i]=null)}):(f=function(element,t,e){var n=l(element);if(_[n]||(_[n]={}),!_[n][t]){_[n][t]=[];var r=element["on"+t];r&&_[n][t].push(r),element["on"+t]=function(t,e){return function(n){if(_[t]&&_[t][e])for(var r=_[t][e],i=0,o=r.length;i<o;i++)r[i].call(this,n||fabric.window.event)}}(n,t)}_[n][t].push(e)},d=function(element,t,e){var n=l(element);if(_[n]&&_[n][t])for(var r=_[n][t],i=0,o=r.length;i<o;i++)r[i]===e&&r.splice(i,1)}),fabric.util.addListener=f,fabric.util.removeListener=d;var x=function(e){return typeof e.clientX!==t?e.clientX:0},w=function(e){return typeof e.clientY!==t?e.clientY:0};function C(t,e,n){var r="touchend"===t.type?"changedTouches":"touches";return t[r]&&t[r][0]&&t[r][0][e]-(t[r][0][e]-t[r][0][n])||t[n]}fabric.isTouchSupported&&(x=function(t){return C(t,"pageX","clientX")},w=function(t){return C(t,"pageY","clientY")}),fabric.util.getPointer=function(e){e||(e=fabric.window.event);var element=e.target||(typeof e.srcElement!==t?e.srcElement:null),n=fabric.util.getScrollLeftTop(element);return{x:x(e)+n.left,y:w(e)+n.top}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),parseEl=fabric.document.createElement("div"),supportsOpacity="string"==typeof parseEl.style.opacity,supportsFilters="string"==typeof parseEl.style.filter,reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element},supportsOpacity?setOpacity=function(element,t){return element.style.opacity=t,element}:supportsFilters&&(setOpacity=function(element,t){var e=element.style;return element.currentStyle&&!element.currentStyle.hasLayout&&(e.zoom=1),reOpacity.test(e.filter)?(t=t>=.9999?"":"alpha(opacity="+100*t+")",e.filter=e.filter.replace(reOpacity,t)):e.filter+=" alpha(opacity="+100*t+")",element}),fabric.util.setStyle=function(element,t){var e=element.style;if(!e)return element;if("string"==typeof t)return element.style.cssText+=";"+t,t.indexOf("opacity")>-1?setOpacity(element,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;for(var n in t)"opacity"===n?setOpacity(element,t[n]):e["float"===n||"cssFloat"===n?void 0===e.styleFloat?"cssFloat":"styleFloat":n]=t[n];return element},function(){var t=Array.prototype.slice;var e,n,style,r,o=function(e){return t.call(e,0)};try{e=o(fabric.document.childNodes)instanceof Array}catch(t){}function c(t,e){var n=fabric.document.createElement(t);for(var r in e)"class"===r?n.className=e[r]:"for"===r?n.htmlFor=e[r]:n.setAttribute(r,e[r]);return n}function l(element){for(var t=0,e=0,n=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};element&&(element.parentNode||element.host)&&((element=element.parentNode||element.host)===fabric.document?(t=body.scrollLeft||n.scrollLeft||0,e=body.scrollTop||n.scrollTop||0):(t+=element.scrollLeft||0,e+=element.scrollTop||0),1!==element.nodeType||"fixed"!==fabric.util.getElementStyle(element,"position")););return{left:t,top:e}}e||(o=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),n=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(element,t){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[t]:void 0}:function(element,t){var e=element.style[t];return!e&&element.currentStyle&&(e=element.currentStyle[t]),e},style=fabric.document.documentElement.style,r="userSelect"in style?"userSelect":"MozUserSelect"in style?"MozUserSelect":"WebkitUserSelect"in style?"WebkitUserSelect":"KhtmlUserSelect"in style?"KhtmlUserSelect":"",fabric.util.makeElementUnselectable=function(element){return void 0!==element.onselectstart&&(element.onselectstart=fabric.util.falseFunction),r?element.style[r]="none":"string"==typeof element.unselectable&&(element.unselectable="on"),element},fabric.util.makeElementSelectable=function(element){return void 0!==element.onselectstart&&(element.onselectstart=null),r?element.style[r]="":"string"==typeof element.unselectable&&(element.unselectable=""),element},fabric.util.getScript=function(t,e){var n=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),o=!0;r.onload=r.onreadystatechange=function(t){if(o){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;o=!1,e(t||fabric.window.event),r=r.onload=r.onreadystatechange=null}},r.src=t,n.appendChild(r)},fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=o,fabric.util.makeElement=c,fabric.util.addClass=function(element,t){element&&-1===(" "+element.className+" ").indexOf(" "+t+" ")&&(element.className+=(element.className?" ":"")+t)},fabric.util.wrapElement=function(element,t,e){return"string"==typeof t&&(t=c(t,e)),element.parentNode&&element.parentNode.replaceChild(t,element),t.appendChild(element),t},fabric.util.getScrollLeftTop=l,fabric.util.getElementOffset=function(element){var t,e,r=element&&element.ownerDocument,o={left:0,top:0},c={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return c;for(var f in h)c[h[f]]+=parseInt(n(element,f),10)||0;return t=r.documentElement,void 0!==element.getBoundingClientRect&&(o=element.getBoundingClientRect()),e=l(element),{left:o.left+e.left-(t.clientLeft||0)+c.left,top:o.top+e.top-(t.clientTop||0)+c.top}},fabric.util.getElementStyle=n}(),function(){var t=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],i=t.length;i--;)try{if(t[i]())return t[i]}catch(t){}}();function e(){}fabric.util.request=function(n,r){r||(r={});var o=r.method?r.method.toUpperCase():"GET",c=r.onComplete||function(){},l=t(),body=r.body||r.parameters;return l.onreadystatechange=function(){4===l.readyState&&(c(l),l.onreadystatechange=e)},"GET"===o&&(body=null,"string"==typeof r.parameters&&(n=function(t,param){return t+(/\?/.test(t)?"&":"?")+param}(n,r.parameters))),l.open(o,n,!0),"POST"!==o&&"PUT"!==o||l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(body),l}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach((function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})})),function(){var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};function e(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(t){e((function(n){t||(t={});var time,r=n||+new Date,o=t.duration||500,c=r+o,l=t.onChange||function(){},h=t.abort||function(){return!1},f=t.easing||function(t,b,e,n){return-e*Math.cos(t/n*(Math.PI/2))+e+b},d="startValue"in t?t.startValue:0,v="endValue"in t?t.endValue:100,m=t.byValue||v-d;t.onStart&&t.onStart(),function n(v){var y=(time=v||+new Date)>c?o:time-r;h()?t.onComplete&&t.onComplete():(l(f(y,d,m,o)),time>c?t.onComplete&&t.onComplete():e(n))}(r)}))},fabric.util.requestAnimFrame=e}(),function(){function t(a,t,p,s){return a<Math.abs(t)?(a=t,s=p/4):s=0===t&&0===a?p/(2*Math.PI)*Math.asin(1):p/(2*Math.PI)*Math.asin(t/a),{a:a,c:t,p:p,s:s}}function e(t,e,n){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*n-t.s)*(2*Math.PI)/t.p)}function n(t,b,e,n){return e-r(n-t,0,e,n)+b}function r(t,b,e,n){return(t/=n)<1/2.75?e*(7.5625*t*t)+b:t<2/2.75?e*(7.5625*(t-=1.5/2.75)*t+.75)+b:t<2.5/2.75?e*(7.5625*(t-=2.25/2.75)*t+.9375)+b:e*(7.5625*(t-=2.625/2.75)*t+.984375)+b}fabric.util.ease={easeInQuad:function(t,b,e,n){return e*(t/=n)*t+b},easeOutQuad:function(t,b,e,n){return-e*(t/=n)*(t-2)+b},easeInOutQuad:function(t,b,e,n){return(t/=n/2)<1?e/2*t*t+b:-e/2*(--t*(t-2)-1)+b},easeInCubic:function(t,b,e,n){return e*(t/=n)*t*t+b},easeOutCubic:function(t,b,e,n){return e*((t=t/n-1)*t*t+1)+b},easeInOutCubic:function(t,b,e,n){return(t/=n/2)<1?e/2*t*t*t+b:e/2*((t-=2)*t*t+2)+b},easeInQuart:function(t,b,e,n){return e*(t/=n)*t*t*t+b},easeOutQuart:function(t,b,e,n){return-e*((t=t/n-1)*t*t*t-1)+b},easeInOutQuart:function(t,b,e,n){return(t/=n/2)<1?e/2*t*t*t*t+b:-e/2*((t-=2)*t*t*t-2)+b},easeInQuint:function(t,b,e,n){return e*(t/=n)*t*t*t*t+b},easeOutQuint:function(t,b,e,n){return e*((t=t/n-1)*t*t*t*t+1)+b},easeInOutQuint:function(t,b,e,n){return(t/=n/2)<1?e/2*t*t*t*t*t+b:e/2*((t-=2)*t*t*t*t+2)+b},easeInSine:function(t,b,e,n){return-e*Math.cos(t/n*(Math.PI/2))+e+b},easeOutSine:function(t,b,e,n){return e*Math.sin(t/n*(Math.PI/2))+b},easeInOutSine:function(t,b,e,n){return-e/2*(Math.cos(Math.PI*t/n)-1)+b},easeInExpo:function(t,b,e,n){return 0===t?b:e*Math.pow(2,10*(t/n-1))+b},easeOutExpo:function(t,b,e,n){return t===n?b+e:e*(1-Math.pow(2,-10*t/n))+b},easeInOutExpo:function(t,b,e,n){return 0===t?b:t===n?b+e:(t/=n/2)<1?e/2*Math.pow(2,10*(t-1))+b:e/2*(2-Math.pow(2,-10*--t))+b},easeInCirc:function(t,b,e,n){return-e*(Math.sqrt(1-(t/=n)*t)-1)+b},easeOutCirc:function(t,b,e,n){return e*Math.sqrt(1-(t=t/n-1)*t)+b},easeInOutCirc:function(t,b,e,n){return(t/=n/2)<1?-e/2*(Math.sqrt(1-t*t)-1)+b:e/2*(Math.sqrt(1-(t-=2)*t)+1)+b},easeInElastic:function(n,b,r,o){var p=0;return 0===n?b:1===(n/=o)?b+r:(p||(p=.3*o),-e(t(r,r,p,1.70158),n,o)+b)},easeOutElastic:function(e,b,n,r){var p=0;if(0===e)return b;if(1===(e/=r))return b+n;p||(p=.3*r);var o=t(n,n,p,1.70158);return o.a*Math.pow(2,-10*e)*Math.sin((e*r-o.s)*(2*Math.PI)/o.p)+o.c+b},easeInOutElastic:function(n,b,r,o){var p=0;if(0===n)return b;if(2===(n/=o/2))return b+r;p||(p=o*(.3*1.5));var c=t(r,r,p,1.70158);return n<1?-.5*e(c,n,o)+b:c.a*Math.pow(2,-10*(n-=1))*Math.sin((n*o-c.s)*(2*Math.PI)/c.p)*.5+c.c+b},easeInBack:function(t,b,e,n,s){return void 0===s&&(s=1.70158),e*(t/=n)*t*((s+1)*t-s)+b},easeOutBack:function(t,b,e,n,s){return void 0===s&&(s=1.70158),e*((t=t/n-1)*t*((s+1)*t+s)+1)+b},easeInOutBack:function(t,b,e,n,s){return void 0===s&&(s=1.70158),(t/=n/2)<1?e/2*(t*t*((1+(s*=1.525))*t-s))+b:e/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+b},easeInBounce:n,easeOutBounce:r,easeInOutBounce:function(t,b,e,o){return t<o/2?.5*n(2*t,0,e,o)+b:.5*r(2*t-o,0,e,o)+.5*e+b}}}(),function(t){"use strict";var e,n,r,o,c,l,h=t.fabric||(t.fabric={}),f=h.util.object.extend,d=h.util.string.capitalize,v=h.util.object.clone,m=h.util.toFixed,y=h.util.parseUnit,_=h.util.multiplyTransformMatrices,x=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,w=/^(symbol|image|marker|pattern|view|svg)$/i,C=/^(?:pattern|defs|symbol|metadata)$/i,S=/^(symbol|g|a|svg)$/i,k={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},O={stroke:"strokeOpacity",fill:"fillOpacity"};function E(t){return t in k?k[t]:t}function T(t,e,n,r){var o,c="[object Array]"===Object.prototype.toString.call(e);return"fill"!==t&&"stroke"!==t||"none"!==e?"strokeDashArray"===t?e=e.replace(/,/g," ").split(/\s+/).map((function(t){return parseFloat(t)})):"transformMatrix"===t?e=n&&n.transformMatrix?_(n.transformMatrix,h.parseTransformAttribute(e)):h.parseTransformAttribute(e):"visible"===t?(e="none"!==e&&"hidden"!==e,n&&!1===n.visible&&(e=!1)):"originX"===t?e="start"===e?"left":"end"===e?"right":"center":o=c?e.map(y):y(e,r):e="",!c&&isNaN(o)?e:o}function j(t,e){for(var n,r,o=[],i=0;i<e.length;i++)n=e[i],r=t.getElementsByTagName(n),o=o.concat(Array.prototype.slice.call(r));return o}function M(element,t){var e,n=!0;return(e=P(element,t.pop()))&&t.length&&(n=function(element,t){var e,n=!0;for(;element.parentNode&&1===element.parentNode.nodeType&&t.length;)n&&(e=t.pop()),element=element.parentNode,n=P(element,e);return 0===t.length}(element,t)),e&&n&&0===t.length}function P(element,t){var e,n=element.nodeName,r=element.getAttribute("class"),o=element.getAttribute("id");if(e=new RegExp("^"+n,"i"),t=t.replace(e,""),o&&t.length&&(e=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),t=t.replace(e,"")),r&&t.length)for(var i=(r=r.split(" ")).length;i--;)e=new RegExp("\\."+r[i]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(e,"");return 0===t.length}function A(t,e){var n;if(t.getElementById&&(n=t.getElementById(e)),n)return n;var r,i,o=t.getElementsByTagName("*");for(i=0;i<o.length;i++)if(e===(r=o[i]).getAttribute("id"))return r}h.cssRules={},h.gradientDefs={},h.parseTransformAttribute=(e=[1,0,0,1,0,0],n=h.reNum,o="(?:(?:(matrix)\\s*\\(\\s*("+n+")"+(r="(?:\\s+,?\\s*|,\\s*)")+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\)))",c=new RegExp("^\\s*(?:(?:"+o+"(?:"+r+"*"+o+")*)?)\\s*$"),l=new RegExp(o,"g"),function(t){var n=e.concat(),r=[];if(!t||t&&!c.test(t))return n;t.replace(l,(function(t){var c=new RegExp(o).exec(t).filter((function(t){return!!t})),l=c[1],f=c.slice(2).map(parseFloat);switch(l){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(n,f);break;case"rotate":f[0]=h.util.degreesToRadians(f[0]),function(t,e){var n=e[0],r=3===e.length?e[1]:0,o=3===e.length?e[2]:0;t[0]=Math.cos(n),t[1]=Math.sin(n),t[2]=-Math.sin(n),t[3]=Math.cos(n),t[4]=r-(t[0]*r+t[2]*o),t[5]=o-(t[1]*r+t[3]*o)}(n,f);break;case"scale":!function(t,e){var n=e[0],r=2===e.length?e[1]:e[0];t[0]=n,t[3]=r}(n,f);break;case"skewX":!function(t,e){t[2]=Math.tan(h.util.degreesToRadians(e[0]))}(n,f);break;case"skewY":!function(t,e){t[1]=Math.tan(h.util.degreesToRadians(e[0]))}(n,f);break;case"matrix":n=f}r.push(n.concat()),n=e.concat()}));for(var f=r[0];r.length>1;)r.shift(),f=h.util.multiplyTransformMatrices(f,r[0]);return f});var I=new RegExp("^\\s*("+h.reNum+"+)\\s*,?\\s*("+h.reNum+"+)\\s*,?\\s*("+h.reNum+"+)\\s*,?\\s*("+h.reNum+"+)\\s*$");function D(element){var t,e,n,r,o,c,l=element.getAttribute("viewBox"),f=1,d=1,v=element.getAttribute("width"),m=element.getAttribute("height"),_=element.getAttribute("x")||0,x=element.getAttribute("y")||0,C=element.getAttribute("preserveAspectRatio")||"",S=!l||!w.test(element.nodeName)||!(l=l.match(I)),k=!v||!m||"100%"===v||"100%"===m,O=S&&k,E={},T="";if(E.width=0,E.height=0,E.toBeParsed=O,O)return E;if(S)return E.width=y(v),E.height=y(m),E;if(t=-parseFloat(l[1]),e=-parseFloat(l[2]),n=parseFloat(l[3]),r=parseFloat(l[4]),k?(E.width=n,E.height=r):(E.width=y(v),E.height=y(m),f=E.width/n,d=E.height/r),"none"!==(C=h.util.parsePreserveAspectRatioAttribute(C)).alignX&&(d=f=f>d?d:f),1===f&&1===d&&0===t&&0===e&&0===_&&0===x)return E;if((_||x)&&(T=" translate("+y(_)+" "+y(x)+") "),o=T+" matrix("+f+" 0 0 "+d+" "+t*f+" "+e*d+") ","svg"===element.nodeName){for(c=element.ownerDocument.createElement("g");element.firstChild;)c.appendChild(element.firstChild);element.appendChild(c)}else o=(c=element).getAttribute("transform")+o;return c.setAttribute("transform",o),E}h.parseSVGDocument=function(t,e,n){if(t){!function(t){for(var e=j(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,o,c,l=e[i],h=l.getAttribute("xlink:href").substr(1),f=l.getAttribute("x")||0,d=l.getAttribute("y")||0,v=A(t,h).cloneNode(!0),m=(v.getAttribute("transform")||"")+" translate("+f+", "+d+")",y=e.length;if(D(v),/^svg$/i.test(v.nodeName)){var _=v.ownerDocument.createElement("g");for(r=0,c=(o=v.attributes).length;r<c;r++)n=o.item(r),_.setAttribute(n.nodeName,n.nodeValue);for(;v.firstChild;)_.appendChild(v.firstChild);v=_}for(r=0,c=(o=l.attributes).length;r<c;r++)"x"!==(n=o.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&("transform"===n.nodeName?m=n.nodeValue+" "+m:v.setAttribute(n.nodeName,n.nodeValue));v.setAttribute("transform",m),v.setAttribute("instantiated_by_use","1"),v.removeAttribute("id"),l.parentNode.replaceChild(v,l),e.length===y&&i++}}(t);var r=new Date,o=h.Object.__uid++,c=D(t),l=h.util.toArray(t.getElementsByTagName("*"));if(c.svgUid=o,0===l.length&&h.isLikelyNode){for(var f=[],i=0,d=(l=t.selectNodes('//*[name(.)!="svg"]')).length;i<d;i++)f[i]=l[i];l=f}var m=l.filter((function(t){return D(t),x.test(t.nodeName.replace("svg:",""))&&!function(element,t){for(;element&&(element=element.parentNode);)if(element.nodeName&&t.test(element.nodeName.replace("svg:",""))&&!element.getAttribute("instantiated_by_use"))return!0;return!1}(t,C)}));!m||m&&!m.length?e&&e([],{}):(h.gradientDefs[o]=h.getGradientDefs(t),h.cssRules[o]=h.getCSSRules(t),h.parseElements(m,(function(t){h.documentParsingTime=new Date-r,e&&e(t,c)}),v(c),n))}};var L={has:function(t,e){e(!1)},get:function(){},set:function(){}};function R(t,canvas,e){canvas[e]&&canvas[e].toSVG&&t.push('\t<pattern x="0" y="0" id="',e,'Pattern" ','width="',canvas[e].source.width,'" height="',canvas[e].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',canvas[e].source.width,'" height="',canvas[e].source.height,'" xlink:href="',canvas[e].source.src,'"></image>\n\t</pattern>\n')}var B=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+h.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+h.reNum+"))?\\s+(.*)");f(h,{parseFontDeclaration:function(t,e){var n=t.match(B);if(n){var r=n[1],o=n[3],c=n[4],l=n[5],h=n[6];r&&(e.fontStyle=r),o&&(e.fontWeight=isNaN(parseFloat(o))?o:parseFloat(o)),c&&(e.fontSize=y(c)),h&&(e.fontFamily=h),l&&(e.lineHeight="normal"===l?1:l)}},getGradientDefs:function(t){var e,n,r,o=j(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),c=0,l={},h={};for(c=o.length;c--;)r=(e=o[c]).getAttribute("xlink:href"),n=e.getAttribute("id"),r&&(h[n]=r.substr(1)),l[n]=e;for(n in h){var f=l[h[n]].cloneNode(!0);for(e=l[n];f.firstChild;)e.appendChild(f.firstChild)}return l},parseAttributes:function(element,t,e){if(element){var n,r,o={};void 0===e&&(e=element.getAttribute("svgUid")),element.parentNode&&S.test(element.parentNode.nodeName)&&(o=h.parseAttributes(element.parentNode,t,e)),r=o&&o.fontSize||element.getAttribute("font-size")||h.Text.DEFAULT_SVG_FONT_SIZE;var c=t.reduce((function(t,e){return(n=element.getAttribute(e))&&(e=E(e),n=T(e,n,o,r),t[e]=n),t}),{});return(c=f(c,f(function(element,t){var e={};for(var n in h.cssRules[t])if(M(element,n.split(" ")))for(var r in h.cssRules[t][n])e[r]=h.cssRules[t][n][r];return e}(element,e),h.parseStyleAttribute(element)))).font&&h.parseFontDeclaration(c.font,c),function(t){for(var e in O)if(void 0!==t[O[e]]&&""!==t[e]){if(void 0===t[e]){if(!h.Object.prototype[e])continue;t[e]=h.Object.prototype[e]}if(0!==t[e].indexOf("url(")){var n=new h.Color(t[e]);t[e]=n.setAlpha(m(n.getAlpha()*t[O[e]],2)).toRgba()}}return t}(f(o,c))}},parseElements:function(t,e,n,r){new h.ElementsParser(t,e,n,r).parse()},parseStyleAttribute:function(element){var t={},style=element.getAttribute("style");return style?("string"==typeof style?function(style,t){var e,n;style.replace(/;\s*$/,"").split(";").forEach((function(r){var o=r.split(":");e=E(o[0].trim().toLowerCase()),n=T(e,o[1].trim()),t[e]=n}))}(style,t):function(style,t){var e,n;for(var r in style)void 0!==style[r]&&(n=T(e=E(r.toLowerCase()),style[r]),t[e]=n)}(style,t),t):t},parsePointsAttribute:function(t){if(!t)return null;var i,e,n=[];for(i=0,e=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;i<e;i+=2)n.push({x:parseFloat(t[i]),y:parseFloat(t[i+1])});return n},getCSSRules:function(t){for(var e=t.getElementsByTagName("style"),n={},i=0,r=e.length;i<r;i++){var o=e[i].textContent||e[i].text;""!==(o=o.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&o.match(/[^{]*\{[\s\S]*?\}/g).map((function(t){return t.trim()})).forEach((function(t){for(var e=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},o=e[2].trim().replace(/;$/,"").split(/\s*;\s*/),i=0,c=o.length;i<c;i++){var l=o[i].split(/\s*:\s*/),f=E(l[0]),d=T(f,l[1],l[0]);r[f]=d}(t=e[1]).split(",").forEach((function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(n[t]?h.util.object.extend(n[t],r):n[t]=h.util.object.clone(r))}))}))}return n},loadSVGFromURL:function(t,e,n){function r(r){var o=r.responseXML;o&&!o.documentElement&&h.window.ActiveXObject&&r.responseText&&((o=new ActiveXObject("Microsoft.XMLDOM")).async="false",o.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),o&&o.documentElement||e&&e(null),h.parseSVGDocument(o.documentElement,(function(n,r){L.set(t,{objects:h.util.array.invoke(n,"toObject"),options:r}),e&&e(n,r)}),n)}t=t.replace(/^\n\s*/,"").trim(),L.has(t,(function(n){n?L.get(t,(function(t){var n,r,o,c=(r=(n=t).objects,o=n.options,{objects:r=r.map((function(t){return h[d(t.type)].fromObject(t)})),options:o});e(c.objects,c.options)})):new h.util.request(t,{method:"get",onComplete:r})}))},loadSVGFromString:function(t,e,n){var r;if(t=t.trim(),"undefined"!=typeof DOMParser){var o=new DOMParser;o&&o.parseFromString&&(r=o.parseFromString(t,"text/xml"))}else h.window.ActiveXObject&&((r=new ActiveXObject("Microsoft.XMLDOM")).async="false",r.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));h.parseSVGDocument(r.documentElement,(function(t,n){e(t,n)}),n)},createSVGFontFacesMarkup:function(t){for(var e,n,style,r,o,c,l="",f={},d=h.fontPaths,i=0,v=t.length;i<v;i++)if(n=(e=t[i]).fontFamily,-1!==e.type.indexOf("text")&&!f[n]&&d[n]&&(f[n]=!0,e.styles))for(o in style=e.styles)for(c in r=style[o])!f[n=r[c].fontFamily]&&d[n]&&(f[n]=!0);for(var m in f)l+=["\t\t@font-face {\n","\t\t\tfont-family: '",m,"';\n","\t\t\tsrc: url('",d[m],"');\n","\t\t}\n"].join("");return l&&(l=['\t<style type="text/css">',"<![CDATA[\n",l,"]]>","</style>\n"].join("")),l},createSVGRefElementsMarkup:function(canvas){var t=[];return R(t,canvas,"backgroundColor"),R(t,canvas,"overlayColor"),t.join("")}})}(exports),fabric.ElementsParser=function(t,e,n,r){this.elements=t,this.callback=e,this.options=n,this.reviver=r,this.svgUid=n&&n.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var i=0,t=this.elements.length;i<t;i++)this.elements[i].setAttribute("svgUid",this.svgUid),function(t,i){setTimeout((function(){t.createObject(t.elements[i],i)}),0)}(this,i)},fabric.ElementsParser.prototype.createObject=function(t,e){var n=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(n&&n.fromElement)try{this._createObject(n,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,n){if(t.async)t.fromElement(e,this.createCallback(n,e),this.options);else{var r=t.fromElement(e,this.options);this.resolveGradient(r,"fill"),this.resolveGradient(r,"stroke"),this.reviver&&this.reviver(e,r),this.instances[n]=r,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var n=this;return function(r){n.resolveGradient(r,"fill"),n.resolveGradient(r,"stroke"),n.reviver&&n.reviver(e,r),n.instances[t]=r,n.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var n=t.get(e);if(/^url\(/.test(n)){var r=n.slice(5,n.length-1);fabric.gradientDefs[this.svgUid][r]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][r],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter((function(t){return null!=t})),this.callback(this.instances))},function(t){"use strict";var e=t.fabric||(t.fabric={});function n(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=n,n.prototype={type:"point",constructor:n,add:function(t){return new n(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new n(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new n(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new n(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new n(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new n(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new n(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new n(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new n(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,n=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=n},clone:function(){return new n(this.x,this.y)}})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function n(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=n,e.Intersection.prototype={constructor:n,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,r,o,c){var l,h=(c.x-o.x)*(t.y-o.y)-(c.y-o.y)*(t.x-o.x),f=(r.x-t.x)*(t.y-o.y)-(r.y-t.y)*(t.x-o.x),d=(c.y-o.y)*(r.x-t.x)-(c.x-o.x)*(r.y-t.y);if(0!==d){var v=h/d,m=f/d;0<=v&&v<=1&&0<=m&&m<=1?(l=new n("Intersection")).appendPoint(new e.Point(t.x+v*(r.x-t.x),t.y+v*(r.y-t.y))):l=new n}else l=new n(0===h||0===f?"Coincident":"Parallel");return l},e.Intersection.intersectLinePolygon=function(t,e,r){for(var o,c,l,h=new n,f=r.length,i=0;i<f;i++)o=r[i],c=r[(i+1)%f],l=n.intersectLineLine(t,e,o,c),h.appendPoints(l.points);return h.points.length>0&&(h.status="Intersection"),h},e.Intersection.intersectPolygonPolygon=function(t,e){for(var r=new n,o=t.length,i=0;i<o;i++){var c=t[i],l=t[(i+1)%o],h=n.intersectLinePolygon(c,l,e);r.appendPoints(h.points)}return r.points.length>0&&(r.status="Intersection"),r},e.Intersection.intersectPolygonRectangle=function(t,r,o){var c=r.min(o),l=r.max(o),h=new e.Point(l.x,c.y),f=new e.Point(c.x,l.y),d=n.intersectLinePolygon(c,h,t),v=n.intersectLinePolygon(h,l,t),m=n.intersectLinePolygon(l,f,t),y=n.intersectLinePolygon(f,c,t),_=new n;return _.appendPoints(d.points),_.appendPoints(v.points),_.appendPoints(m.points),_.appendPoints(y.points),_.points.length>0&&(_.status="Intersection"),_})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function n(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function r(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}e.Color?e.warn("fabric.Color is already defined."):(e.Color=n,e.Color.prototype={_tryParsingColor:function(t){var source;t in n.colorNameMap&&(t=n.colorNameMap[t]),"transparent"===t&&(source=[255,255,255,0]),source||(source=n.sourceFromHex(t)),source||(source=n.sourceFromRgb(t)),source||(source=n.sourceFromHsl(t)),source||(source=[0,0,0,1]),source&&this.setSource(source)},_rgbToHsl:function(t,g,b){t/=255,g/=255,b/=255;var n,s,r,o=e.util.array.max([t,g,b]),c=e.util.array.min([t,g,b]);if(r=(o+c)/2,o===c)n=s=0;else{var l=o-c;switch(s=r>.5?l/(2-o-c):l/(o+c),o){case t:n=(g-b)/l+(g<b?6:0);break;case g:n=(b-t)/l+2;break;case b:n=(t-g)/l+4}n/=6}return[Math.round(360*n),Math.round(100*s),Math.round(100*r)]},getSource:function(){return this._source},setSource:function(source){this._source=source},toRgb:function(){var source=this.getSource();return"rgb("+source[0]+","+source[1]+","+source[2]+")"},toRgba:function(){var source=this.getSource();return"rgba("+source[0]+","+source[1]+","+source[2]+","+source[3]+")"},toHsl:function(){var source=this.getSource(),t=this._rgbToHsl(source[0],source[1],source[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var source=this.getSource(),t=this._rgbToHsl(source[0],source[1],source[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+source[3]+")"},toHex:function(){var t,g,b,source=this.getSource();return t=1===(t=source[0].toString(16)).length?"0"+t:t,g=1===(g=source[1].toString(16)).length?"0"+g:g,b=1===(b=source[2].toString(16)).length?"0"+b:b,t.toUpperCase()+g.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var source=this.getSource();return source[3]=t,this.setSource(source),this},toGrayscale:function(){var source=this.getSource(),t=parseInt((.3*source[0]+.59*source[1]+.11*source[2]).toFixed(0),10),e=source[3];return this.setSource([t,t,t,e]),this},toBlackWhite:function(t){var source=this.getSource(),e=(.3*source[0]+.59*source[1]+.11*source[2]).toFixed(0),n=source[3];return t=t||127,e=Number(e)<Number(t)?0:255,this.setSource([e,e,e,n]),this},overlayWith:function(t){t instanceof n||(t=new n(t));for(var e=[],r=this.getAlpha(),source=this.getSource(),o=t.getSource(),i=0;i<3;i++)e.push(Math.round(.5*source[i]+.5*o[i]));return e[3]=r,this.setSource(e),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},e.Color.fromRgb=function(t){return n.fromSource(n.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(n.reRGBa);if(e){var r=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),g=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),b=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=n.fromRgb,e.Color.fromHsl=function(t){return n.fromSource(n.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(n.reHSLa);if(e){var o,g,b,c=(parseFloat(e[1])%360+360)%360/360,s=parseFloat(e[2])/(/%$/.test(e[2])?100:1),l=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===s)o=g=b=l;else{var q=l<=.5?l*(s+1):l+s-l*s,p=2*l-q;o=r(p,q,c+1/3),g=r(p,q,c),b=r(p,q,c-1/3)}return[Math.round(255*o),Math.round(255*g),Math.round(255*b),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=n.fromHsl,e.Color.fromHex=function(t){return n.fromSource(n.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(n.reHex)){var e=t.slice(t.indexOf("#")+1),r=3===e.length||4===e.length,o=8===e.length||4===e.length,c=r?e.charAt(0)+e.charAt(0):e.substring(0,2),g=r?e.charAt(1)+e.charAt(1):e.substring(2,4),b=r?e.charAt(2)+e.charAt(2):e.substring(4,6),a=o?r?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(c,16),parseInt(g,16),parseInt(b,16),parseFloat((parseInt(a,16)/255).toFixed(2))]}},e.Color.fromSource=function(source){var t=new n;return t.setSource(source),t})}(exports),function(){function t(t){var e,n,r,style=t.getAttribute("style"),o=t.getAttribute("offset")||0;if(o=(o=parseFloat(o)/(/%$/.test(o)?100:1))<0?0:o>1?1:o,style){var c=style.split(/\s*;\s*/);""===c[c.length-1]&&c.pop();for(var i=c.length;i--;){var l=c[i].split(/\s*:\s*/),h=l[0].trim(),f=l[1].trim();"stop-color"===h?e=f:"stop-opacity"===h&&(r=f)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=t.getAttribute("stop-opacity")),n=(e=new fabric.Color(e)).getAlpha(),r=isNaN(parseFloat(r))?1:parseFloat(r),r*=n,{offset:o,color:e.toRgb(),opacity:r}}function e(object,t,e){var n,r=0,o=1,c="";for(var l in t)"Infinity"===t[l]?t[l]=1:"-Infinity"===t[l]&&(t[l]=0),n=parseFloat(t[l],10),o="string"==typeof t[l]&&/^\d+%$/.test(t[l])?.01:1,"x1"===l||"x2"===l||"r2"===l?(o*="objectBoundingBox"===e?object.width:1,r="objectBoundingBox"===e&&object.left||0):"y1"!==l&&"y2"!==l||(o*="objectBoundingBox"===e?object.height:1,r="objectBoundingBox"===e&&object.top||0),t[l]=n*o+r;if("ellipse"===object.type&&null!==t.r2&&"objectBoundingBox"===e&&object.rx!==object.ry){var h=object.ry/object.rx;c=" scale(1, "+h+")",t.y1&&(t.y1/=h),t.y2&&(t.y2/=h)}return c}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var n=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:n.toRgb(),opacity:n.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(object){var t,e,n=fabric.util.object.clone(this.coords);if(this.colorStops.sort((function(a,b){return a.offset-b.offset})),!object.group||"path-group"!==object.group.type)for(var r in n)"x1"===r||"x2"===r||"r2"===r?n[r]+=this.offsetX-object.width/2:"y1"!==r&&"y2"!==r||(n[r]+=this.offsetY-object.height/2);e='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(e+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?t=["<linearGradient ",e,' x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">\n']:"radial"===this.type&&(t=["<radialGradient ",e,' cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">\n']);for(var i=0;i<this.colorStops.length;i++)t.push("<stop ",'offset="',100*this.colorStops[i].offset+"%",'" style="stop-color:',this.colorStops[i].color,null!==this.colorStops[i].opacity?";stop-opacity: "+this.colorStops[i].opacity:";",'"/>\n');return t.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),t.join("")},toLive:function(t,object){var e,n,r=fabric.util.object.clone(this.coords);if(this.type){if(object.group&&"path-group"===object.group.type)for(n in r)"x1"===n||"x2"===n?r[n]+=-this.offsetX+object.width/2:"y1"!==n&&"y2"!==n||(r[n]+=-this.offsetY+object.height/2);"linear"===this.type?e=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(e=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2));for(var i=0,o=this.colorStops.length;i<o;i++){var c=this.colorStops[i].color,l=this.colorStops[i].opacity,h=this.colorStops[i].offset;void 0!==l&&(c=new fabric.Color(c).setAlpha(l).toRgba()),e.addColorStop(parseFloat(h),c)}return e}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(n,r){var o,c,l,h=n.getElementsByTagName("stop"),f=n.getAttribute("gradientUnits")||"objectBoundingBox",d=n.getAttribute("gradientTransform"),v=[];"linear"===(o="linearGradient"===n.nodeName||"LINEARGRADIENT"===n.nodeName?"linear":"radial")?c=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(n):"radial"===o&&(c=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(n));for(var i=h.length;i--;)v.push(t(h[i]));l=e(r,c,f);var m=new fabric.Gradient({type:o,coords:c,colorStops:v,offsetX:-r.left,offsetY:-r.top});return(d||""!==l)&&(m.gradientTransform=fabric.parseTransformAttribute((d||"")+l)),m},forObject:function(t,n){return n||(n={}),e(t,n.coords,"userSpaceOnUse"),new fabric.Gradient(n)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,(function(img){e.source=img}))}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var source;return"function"==typeof this.source?source=String(this.source):"string"==typeof this.source.src?source=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(source=this.source.toDataURL()),{source:source,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(object){var t="function"==typeof this.source?this.source():this.source,e=t.width/object.getWidth(),n=t.height/object.getHeight(),r=this.offsetX/object.getWidth(),o=this.offsetY/object.getHeight(),c="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(e=1),t.src?c=t.src:t.toDataURL&&(c=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+e+'" height="'+n+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+c+'"></image>\n</pattern>\n'},toLive:function(t){var source="function"==typeof this.source?this.source():this.source;if(!source)return"";if(void 0!==source.src){if(!source.complete)return"";if(0===source.naturalWidth||0===source.naturalHeight)return""}return t.createPattern(source,this.repeat)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var n in"string"==typeof t&&(t=this._parseShadow(t)),t)this[n]=t[n];this.id=e.Object.__uid++},_parseShadow:function(shadow){var t=shadow.trim(),n=e.Shadow.reOffsetsAndBlur.exec(t)||[];return{color:(t.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(object){var t=40,r=40,o=e.Object.NUM_FRACTION_DIGITS,c=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-object.angle));return object.width&&object.height&&(t=100*n((Math.abs(c.x)+this.blur)/object.width,o)+20,r=100*n((Math.abs(c.y)+this.blur)/object.height,o)+20),object.flipX&&(c.x*=-1),object.flipY&&(c.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+t+'%" width="'+(100+2*t)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+n(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+n(c.x,o)+'" dy="'+n(c.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var t={},n=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach((function(e){this[e]!==n[e]&&(t[e]=this[e])}),this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}(exports),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=fabric.util.toFixed,o=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(t,e){var n=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,n),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,n),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,n),e.overlayColor&&this.setOverlayColor(e.overlayColor,n),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(image,t,e){return this.__setBgOverlayImage("overlayImage",image,t,e)},setBackgroundImage:function(image,t,e){return this.__setBgOverlayImage("backgroundImage",image,t,e)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,image,e,n){return"string"==typeof image?fabric.util.loadImage(image,(function(img){img&&(this[t]=new fabric.Image(img,n)),e&&e(img)}),this,n&&n.crossOrigin):(n&&image.setOptions(n),this[t]=image,e&&e(image)),this},__setBgOverlayColor:function(t,e,n){if(e&&e.source){var r=this;fabric.util.loadImage(e.source,(function(img){r[t]=new fabric.Pattern({source:img,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),n&&n()}))}else this[t]=e,n&&n();return this},_createCanvasElement:function(t){var element=fabric.util.createCanvasElement(t);if(element.style||(element.style={}),!element)throw o;if(void 0===element.getContext)throw o;return element},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(t),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var n;for(var r in e=e||{},t)n=t[r],e.cssOnly||(this._setBackstoreDimension(r,t[r]),n+="px"),e.backstoreOnly||this._setCssDimension(r,n);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(t){var object,e=this._activeGroup;this.viewportTransform=t;for(var i=0,n=this._objects.length;i<n;i++)(object=this._objects[i]).group||object.setCoords();return e&&e.setCoords(),this.renderAll(),this},zoomToPoint:function(t,e){var n=t,r=this.viewportTransform.slice(0);t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),r[0]=e,r[3]=e;var o=fabric.util.transformPoint(t,r);return r[4]+=n.x-o.x,r[5]+=n.y-o.y,this.setViewportTransform(r)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderCanvas:function(t,e){this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){for(var i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var object=this[e+"Color"];object&&(t.fillStyle=object.toLive?object.toLive(t):object,t.fillRect(object.offsetX||0,object.offsetY||0,this.width,this.height)),(object=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),object.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y))},centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top))},centerObject:function(object){var t=this.getCenter();return this._centerObject(object,new fabric.Point(t.left,t.top))},viewportCenterObject:function(object){var t=this.getVpCenter();return this._centerObject(object,t)},viewportCenterObjectH:function(object){var t=this.getVpCenter();return this._centerObject(object,new fabric.Point(t.x,object.getCenterPoint().y)),this},viewportCenterObjectV:function(object){var t=this.getVpCenter();return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,t.y))},getVpCenter:function(){var t=this.getCenter(),e=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:t.left,y:t.top},e)},_centerObject:function(object,t){return object.setPositionByOrigin(t,"center","center"),this.renderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,n){var data={objects:this._toObjects(e,n)};return t(data,this.__serializeBgOverlay(e,n)),fabric.util.populateWithProperties(this,data,n),data},_toObjects:function(t,e){return this.getObjects().filter((function(object){return!object.excludeFromExport})).map((function(n){return this._toObject(n,t,e)}),this)},_toObject:function(t,e,n){var r;this.includeDefaultValues||(r=t.includeDefaultValues,t.includeDefaultValues=!1);var object=t[e](n);return this.includeDefaultValues||(t.includeDefaultValues=r),object},__serializeBgOverlay:function(t,e){var data={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor};return this.overlayColor&&(data.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),this.backgroundImage&&(data.backgroundImage=this._toObject(this.backgroundImage,t,e)),this.overlayImage&&(data.overlayImage=this._toObject(this.overlayImage,t,e)),data},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var n=[];return this._setSVGPreamble(n,t),this._setSVGHeader(n,t),this._setSVGBgOverlayColor(n,"backgroundColor"),this._setSVGBgOverlayImage(n,"backgroundImage",e),this._setSVGObjects(n,e),this._setSVGBgOverlayColor(n,"overlayColor"),this._setSVGBgOverlayImage(n,"overlayImage",e),n.push("</svg>"),n.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var n,o=e.width||this.width,c=e.height||this.height,l='viewBox="0 0 '+this.width+" "+this.height+'" ',h=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?l='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(n=this.viewportTransform,l='viewBox="'+r(-n[4]/n[0],h)+" "+r(-n[5]/n[3],h)+" "+r(this.width/n[0],h)+" "+r(this.height/n[3],h)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',o,'" ','height="',c,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,l,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(t,e){for(var n,i=0,r=this.getObjects(),o=r.length;i<o;i++)(n=r[i]).excludeFromExport||this._setSVGObject(t,n,e)},_setSVGObject:function(t,e,n){t.push(e.toSVG(n))},_setSVGBgOverlayImage:function(t,e,n){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(n))},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>\n"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>\n")},sendToBack:function(object){if(!object)return this;var i,t,e,r=this._activeGroup;if(object===r)for(i=(e=r._objects).length;i--;)t=e[i],n(this._objects,t),this._objects.unshift(t);else n(this._objects,object),this._objects.unshift(object);return this.renderAll&&this.renderAll()},bringToFront:function(object){if(!object)return this;var i,t,e,r=this._activeGroup;if(object===r)for(e=r._objects,i=0;i<e.length;i++)t=e[i],n(this._objects,t),this._objects.push(t);else n(this._objects,object),this._objects.push(object);return this.renderAll&&this.renderAll()},sendBackwards:function(object,t){if(!object)return this;var i,e,r,o,c,l=this._activeGroup;if(object===l)for(c=l._objects,i=0;i<c.length;i++)e=c[i],0!==(r=this._objects.indexOf(e))&&(o=r-1,n(this._objects,e),this._objects.splice(o,0,e));else 0!==(r=this._objects.indexOf(object))&&(o=this._findNewLowerIndex(object,r,t),n(this._objects,object),this._objects.splice(o,0,object));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(object,t,e){var n;if(e){n=t;for(var i=t-1;i>=0;--i){if(object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object)){n=i;break}}}else n=t-1;return n},bringForward:function(object,t){if(!object)return this;var i,e,r,o,c,l=this._activeGroup;if(object===l)for(i=(c=l._objects).length;i--;)e=c[i],(r=this._objects.indexOf(e))!==this._objects.length-1&&(o=r+1,n(this._objects,e),this._objects.splice(o,0,e));else(r=this._objects.indexOf(object))!==this._objects.length-1&&(o=this._findNewUpperIndex(object,r,t),n(this._objects,object),this._objects.splice(o,0,object));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(object,t,e){var n;if(e){n=t;for(var i=t+1;i<this._objects.length;++i){if(object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object)){n=i;break}}}else n=t+1;return n},moveTo:function(object,t){return n(this._objects,object),this._objects.splice(t,0,object),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var n=e.getContext("2d");if(!n)return null;switch(t){case"getImageData":return void 0!==n.getImageData;case"setLineDash":return void 0!==n.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(canvas){this.canvas=canvas,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var p=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(p),this.canvas.contextTop.moveTo(p.x,p.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,n=this._points[0],r=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y&&(n.x-=.5,r.x+=.5),t.moveTo(n.x,n.y);for(var i=1,o=this._points.length;i<o;i++){var c=n.midPointFrom(r);t.quadraticCurveTo(n.x,n.y,c.x,c.y),n=this._points[i],r=this._points[i+1]}t.lineTo(n.x,n.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var path=[],e=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);path.push("M ",t[0].x," ",t[0].y," ");for(var i=1,r=t.length;i<r;i++){var o=e.midPointFrom(n);path.push("Q ",e.x," ",e.y," ",o.x," ",o.y," "),e=new fabric.Point(t[i].x,t[i].y),i+1<t.length&&(n=new fabric.Point(t[i+1].x,t[i+1].y))}return path.push("L ",e.x," ",e.y," "),path},createPath:function(t){var path=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,path.setShadow(this.shadow)),path},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var path=this.createPath(t);this.canvas.add(path),path.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:path})}else this.canvas.renderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(canvas){this.canvas=canvas,this.points=[]},drawDot:function(t){var e=this.addPoint(t),n=this.canvas.contextTop,r=this.canvas.viewportTransform;n.save(),n.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.fillStyle=e.fill,n.beginPath(),n.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),n.closePath(),n.fill(),n.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;i<n;i++){var r=this.points[i],circle=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&circle.setShadow(this.shadow),e.push(circle)}var o=new fabric.Group(e,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),n=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=n,e.fill=r,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(canvas){this.canvas=canvas,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],o=0,c=r.length;o<c;o++){var rect=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&rect.setShadow(this.shadow),e.push(rect)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var l=new fabric.Group(e,{originX:"center",originY:"center"});l.canvas=this.canvas,this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,n={},i=0,r=t.length;i<r;i++)n[e=t[i].left+""+t[i].top]||(n[e]=t[i]);var o=[];for(e in n)o.push(n[e]);return o},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,n=this.sprayChunkPoints.length;i<n;i++){var r=this.sprayChunkPoints[i];void 0!==r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,n,r,o=this.width/2,i=0;i<this.density;i++){e=fabric.util.getRandomInt(t.x-o,t.x+o),n=fabric.util.getRandomInt(t.y-o,t.y+o),r=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var c=new fabric.Point(e,n);c.width=r,this.randomOpacity&&(c.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var path=this.callSuper("createPath",t),e=path._getLeftTopCoords().scalarAdd(path.strokeWidth/2);return path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-e.x,offsetY:-e.y}),path}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,n=fabric.util.radiansToDegrees,r=Math.atan2,o=Math.abs,c=fabric.StaticCanvas.supports("setLineDash");for(var l in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var object,t=this.getActiveGroup(),e=this.getActiveObject(),n=[],r=[];if(!t&&!e||this.preserveObjectStacking)n=this._objects;else{for(var i=0,o=this._objects.length;i<o;i++)object=this._objects[i],t&&t.contains(object)||object===e?r.push(object):n.push(object);t&&(t._set("_objects",r),n.push(t)),e&&n.push(e)}return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,n){var r,o=n||this.getPointer(t,!0);return r=e.group&&e.group===this.getActiveGroup()?this._normalizePointer(e.group,o):{x:o.x,y:o.y},e.containsPoint(r)||e._findTargetCorner(o)},_normalizePointer:function(object,t){var e=object.calcTransformMatrix(),n=fabric.util.invertTransform(e),r=this.viewportTransform,o=this.restorePointerVpt(t),p=fabric.util.transformPoint(o,n);return fabric.util.transformPoint(p,r)},isTargetTransparent:function(t,e,n){var r=t.hasBorders,o=t.transparentCorners,c=this.contextCache,l=t.selectionBackgroundColor;t.hasBorders=t.transparentCorners=!1,t.selectionBackgroundColor="",c.save(),c.transform.apply(c,this.viewportTransform),t.render(c),c.restore(),t.active&&t._renderControls(c),t.hasBorders=r,t.transparentCorners=o,t.selectionBackgroundColor=l;var h=fabric.util.isTransparent(c,e,n,this.targetFindTolerance);return this.clearContext(c),h},_shouldClearSelection:function(t,e){var n=this.getActiveGroup(),r=this.getActiveObject();return!e||e&&n&&!n.contains(e)&&n!==e&&!t[this.selectionKey]||e&&!e.evented||e&&!e.selectable&&r&&r!==e},_shouldCenterTransform:function(t){if(t){var e,n=this._currentTransform;return"scale"===n.action||"scaleX"===n.action||"scaleY"===n.action?e=this.centeredScaling||t.centeredScaling:"rotate"===n.action&&(e=this.centeredRotation||t.centeredRotation),e?!n.altKey:n.altKey}},_getOriginFromCorner:function(t,e){var n={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?n.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(n.x="left"),"tl"===e||"mt"===e||"tr"===e?n.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(n.y="top"),n},_getActionFromCorner:function(t,e,n){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return n[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return n[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,n){if(n){var r=this.getPointer(t),o=n._findTargetCorner(this.getPointer(t,!0)),c=this._getActionFromCorner(n,o,t),l=this._getOriginFromCorner(n,o);this._currentTransform={target:n,action:c,corner:o,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:r.x-n.left,offsetY:r.y-n.top,originX:l.x,originY:l.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,left:n.left,top:n.top,theta:e(n.angle),width:n.width*n.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:n.left,top:n.top,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,originX:l.x,originY:l.y},this._resetCurrentTransform()}},_translateObject:function(t,e){var n=this._currentTransform,r=n.target,o=t-n.offsetX,c=e-n.offsetY,l=!r.get("lockMovementX")&&r.left!==o,h=!r.get("lockMovementY")&&r.top!==c;return l&&r.set("left",o),h&&r.set("top",c),l||h},_changeSkewTransformOrigin:function(t,e,n){var r="originX",o={0:"center"},c=e.target.skewX,l="left",h="right",f="mt"===e.corner||"ml"===e.corner?1:-1,d=1;t=t>0?1:-1,"y"===n&&(c=e.target.skewY,l="top",h="bottom",r="originY"),o[-1]=l,o[1]=h,e.target.flipX&&(d*=-1),e.target.flipY&&(d*=-1),0===c?(e.skewSign=-f*t*d,e[r]=o[-t]):(c=c>0?1:-1,e.skewSign=c,e[r]=o[c*f*d])},_skewObject:function(t,e,n){var r,o=this._currentTransform,c=o.target,l=c.get("lockSkewingX"),h=c.get("lockSkewingY");if(l&&"x"===n||h&&"y"===n)return!1;var f,d,v=c.getCenterPoint(),m=c.toLocalPoint(new fabric.Point(t,e),"center","center")[n],y=c.toLocalPoint(new fabric.Point(o.lastX,o.lastY),"center","center")[n],_=c._getTransformedDimensions();return this._changeSkewTransformOrigin(m-y,o,n),f=c.toLocalPoint(new fabric.Point(t,e),o.originX,o.originY)[n],d=c.translateToOriginPoint(v,o.originX,o.originY),r=this._setObjectSkew(f,o,n,_),o.lastX=t,o.lastY=e,c.setPositionByOrigin(d,o.originX,o.originY),r},_setObjectSkew:function(t,e,n,r){var o,c,l,h,f,d,v,m,y,_,x=e.target,w=e.skewSign;return"x"===n?(f="y",d="Y",v="X",y=0,_=x.skewY):(f="x",d="X",v="Y",y=x.skewX,_=0),h=x._getTransformedDimensions(y,_),(m=2*Math.abs(t)-h[n])<=2?o=0:(o=w*Math.atan(m/x["scale"+v]/(h[f]/x["scale"+d])),o=fabric.util.radiansToDegrees(o)),c=x["skew"+v]!==o,x.set("skew"+v,o),0!==x["skew"+d]&&(l=x._getTransformedDimensions(),o=r[f]/l[f]*x["scale"+d],x.set("scale"+d,o)),c},_scaleObject:function(t,e,n){var r=this._currentTransform,o=r.target,c=o.get("lockScalingX"),l=o.get("lockScalingY"),h=o.get("lockScalingFlip");if(c&&l)return!1;var f,d=o.translateToOriginPoint(o.getCenterPoint(),r.originX,r.originY),v=o.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY),m=o._getTransformedDimensions();return this._setLocalMouse(v,r),f=this._setObjectScale(v,r,c,l,n,h,m),o.setPositionByOrigin(d,r.originX,r.originY),f},_setObjectScale:function(t,e,n,r,o,c,l){var h,f,d,v,m=e.target,y=!1,_=!1,x=!1;return d=t.x*m.scaleX/l.x,v=t.y*m.scaleY/l.y,h=m.scaleX!==d,f=m.scaleY!==v,c&&d<=0&&d<m.scaleX&&(y=!0),c&&v<=0&&v<m.scaleY&&(_=!0),"equally"!==o||n||r?o?"x"!==o||m.get("lockUniScaling")?"y"!==o||m.get("lockUniScaling")||_||r||m.set("scaleY",v)&&(x=x||f):y||n||m.set("scaleX",d)&&(x=x||h):(y||n||m.set("scaleX",d)&&(x=x||h),_||r||m.set("scaleY",v)&&(x=x||f)):y||_||(x=this._scaleObjectEqually(t,m,e,l)),e.newScaleX=d,e.newScaleY=v,y||_||this._flipObject(e,o),x},_scaleObjectEqually:function(t,e,n,r){var o,c=t.y+t.x,l=r.y*n.original.scaleY/e.scaleY+r.x*n.original.scaleX/e.scaleX;return n.newScaleX=n.original.scaleX*c/l,n.newScaleY=n.original.scaleY*c/l,o=n.newScaleX!==e.scaleX||n.newScaleY!==e.scaleY,e.set("scaleX",n.newScaleX),e.set("scaleY",n.newScaleY),o},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var n=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),o(t.x)>n.padding?t.x<0?t.x+=n.padding:t.x-=n.padding:t.x=0,o(t.y)>n.padding?t.y<0?t.y+=n.padding:t.y-=n.padding:t.y=0},_rotateObject:function(t,e){var o=this._currentTransform;if(o.target.get("lockRotation"))return!1;var c=r(o.ey-o.top,o.ex-o.left),l=r(e-o.top,t-o.left),h=n(l-c+o.theta),f=!0;if(h<0&&(h=360+h),h%=360,o.target.snapAngle>0){var d=o.target.snapAngle,v=o.target.snapThreshold||d,m=Math.ceil(h/d)*d,y=Math.floor(h/d)*d;Math.abs(h-y)<v?h=y:Math.abs(h-m)<v&&(h=m),o.target.angle===h&&(f=!1)}return o.target.angle=h,f},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.setAngle(0)},_drawSelection:function(t){var e=this._groupSelector,n=e.left,r=e.top,l=o(n),h=o(r);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(n>0?0:-n),e.ey-(r>0?0:-r),l,h)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!c){var f=e.ex+.5-(n>0?0:l),d=e.ey+.5-(r>0?0:h);t.beginPath(),fabric.util.drawDashedLine(t,f,d,f+l,d,this.selectionDashArray),fabric.util.drawDashedLine(t,f,d+h-1,f+l,d+h-1,this.selectionDashArray),fabric.util.drawDashedLine(t,f,d,f,d+h,this.selectionDashArray),fabric.util.drawDashedLine(t,f+l-1,d,f+l-1,d+h,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(n>0?0:l),e.ey+.5-(r>0?0:h),l,h)},findTarget:function(t,e){if(!this.skipTargetFind){var n,r=this.getPointer(t,!0),o=this.getActiveGroup(),c=this.getActiveObject();if(o&&!e&&this._checkTarget(r,o))return this._fireOverOutEvents(o,t),o;if(c&&c._findTargetCorner(r))return this._fireOverOutEvents(c,t),c;if(c&&this._checkTarget(r,c)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(c,t),c;n=c}this.targets=[];var l=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&l&&n&&l!==n&&(l=n),this._fireOverOutEvents(l,t),l}},_fireOverOutEvents:function(t,e){t?this._hoveredTarget!==t&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:t,e:e}),t.fire("mouseover"),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var n,r,o,i=t.length;i--;)if(this._checkTarget(e,t[i])){"group"===(n=t[i]).type&&n.subTargetCheck&&(r=this._normalizePointer(n,e),(o=this._searchPossibleTargets(n._objects,r))&&this.targets.push(o));break}return n},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,n,r){r||(r=this.upperCanvasEl);var o,c=t(e),l=r.getBoundingClientRect(),h=l.width||0,f=l.height||0;return h&&f||("top"in l&&"bottom"in l&&(f=Math.abs(l.top-l.bottom)),"right"in l&&"left"in l&&(h=Math.abs(l.right-l.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,n||(c=this.restorePointerVpt(c)),o=0===h||0===f?{width:1,height:1}:{width:r.width/h,height:r.height/f},{x:c.x*o.width,y:c.y*o.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(element){var t=this.getWidth()||element.width,e=this.getHeight()||element.height;fabric.util.setStyle(element,{position:"absolute",width:t+"px",height:e+"px",left:0,top:0}),element.width=t,element.height=e,fabric.util.makeElementUnselectable(element)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(object){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=object,object.set("active",!0)},setActiveObject:function(object,t){return this._setActiveObject(object),this.renderAll(),this.fire("object:selected",{target:object,e:t}),object.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this.callSuper("_onObjectRemoved",t)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;return this.fire("before:selection:cleared",{target:e,e:t}),this._discardActiveObject(),this.fire("selection:cleared",{e:t}),e&&e.fire("deselected",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var g=this.getActiveGroup();g&&g.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){var g=this.getActiveGroup();return this.fire("before:selection:cleared",{e:t,target:g}),this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),i=0,e=t.length;i<e;i++)t[i].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup(),n=this.getActiveObject();return(n||e)&&this.fire("before:selection:cleared",{target:n||e,e:t}),this.deactivateAll(),(n||e)&&(this.fire("selection:cleared",{e:t,target:n}),n&&n.fire("deselected")),this},dispose:function(){this.callSuper("dispose");var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this.getActiveGroup();e?e._renderControls(t):this._drawObjectsControls(t)},_drawObjectsControls:function(t){for(var i=0,e=this._objects.length;i<e;++i)this._objects[i]&&this._objects[i].active&&this._objects[i]._renderControls(t)},_toObject:function(t,e,n){var r=this._realizeGroupTransformOnObject(t),object=this.callSuper("_toObject",t,e,n);return this._unwindGroupTransformOnObject(t,r),object},_realizeGroupTransformOnObject:function(t){if(t.group&&t.group===this.getActiveGroup()){var e={};return["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach((function(n){e[n]=t[n]})),this.getActiveGroup().realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,n){var r;r=this._realizeGroupTransformOnObject(e),this.callSuper("_setSVGObject",t,e,n),this._unwindGroupTransformOnObject(e,r)}}),fabric.StaticCanvas)"prototype"!==l&&(fabric.Canvas[l]=fabric.StaticCanvas[l]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),cursorOffset={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},addListener=fabric.util.addListener,removeListener=fabric.util.removeListener,fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),addListener(fabric.window,"resize",this._onResize),addListener(this.upperCanvasEl,"mousedown",this._onMouseDown),addListener(this.upperCanvasEl,"mousemove",this._onMouseMove),addListener(this.upperCanvasEl,"mouseout",this._onMouseOut),addListener(this.upperCanvasEl,"mouseenter",this._onMouseEnter),addListener(this.upperCanvasEl,"wheel",this._onMouseWheel),addListener(this.upperCanvasEl,"contextmenu",this._onContextMenu),addListener(this.upperCanvasEl,"touchstart",this._onMouseDown),addListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){removeListener(fabric.window,"resize",this._onResize),removeListener(this.upperCanvasEl,"mousedown",this._onMouseDown),removeListener(this.upperCanvasEl,"mousemove",this._onMouseMove),removeListener(this.upperCanvasEl,"mouseout",this._onMouseOut),removeListener(this.upperCanvasEl,"mouseenter",this._onMouseEnter),removeListener(this.upperCanvasEl,"wheel",this._onMouseWheel),removeListener(this.upperCanvasEl,"contextmenu",this._onContextMenu),removeListener(this.upperCanvasEl,"touchstart",this._onMouseDown),removeListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onMouseDown:function(t){this.__onMouseDown(t),addListener(fabric.document,"touchend",this._onMouseUp),addListener(fabric.document,"touchmove",this._onMouseMove),removeListener(this.upperCanvasEl,"mousemove",this._onMouseMove),removeListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?removeListener(this.upperCanvasEl,"mousedown",this._onMouseDown):(addListener(fabric.document,"mouseup",this._onMouseUp),addListener(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),removeListener(fabric.document,"mouseup",this._onMouseUp),removeListener(fabric.document,"touchend",this._onMouseUp),removeListener(fabric.document,"mousemove",this._onMouseMove),removeListener(fabric.document,"touchmove",this._onMouseMove),addListener(this.upperCanvasEl,"mousemove",this._onMouseMove),addListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var e=this;setTimeout((function(){addListener(e.upperCanvasEl,"mousedown",e._onMouseDown)}),400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var n=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==n)||!t&&n||!t&&!n&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e,n=!0,r=this._currentTransform,o=this._groupSelector,c=!o||0===o.left&&0===o.top;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else{r&&(this._finalizeCurrentTransform(),n=!r.actionPerformed),e=n?this.findTarget(t,!0):r.target;var l=this._shouldRender(e,this.getPointer(t));e||!c?this._maybeGroupObjects(t):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._handleCursorAndEvent(t,e,"up"),e&&(e.__corner=0),l&&this.renderAll()}},_handleCursorAndEvent:function(t,e,n){this._setCursorFromEvent(t,e),this._handleEvent(t,n,e||null)},_handleEvent:function(t,e,n){var r=void 0===typeof n?this.findTarget(t):n,o=this.targets||[],c={e:t,target:r,subTargets:o};this.fire("mouse:"+e,c),r&&r.fire("mouse"+e,c);for(var i=0;i<o.length;i++)o[i].fire("mouse"+e,c)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(t.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e}),e.fire("modified"))},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){var e=this.findTarget(t),n=this.getPointer(t,!0);if("which"in t?3===t.which:2===t.button)this.fireRightClick&&this._handleEvent(t,"down",e||null);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){this._previousPointer=n;var r=this._shouldRender(e,n),o=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this._clearSelection(t,e,n):o&&(this._handleGrouping(t,e),e=this.getActiveGroup()),e&&(!e.selectable||!e.__corner&&o||(this._beforeTransform(t,e),this._setupCurrentTransform(t,e)),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),e.selectable&&this.setActiveObject(e,t))),this._handleEvent(t,"down",e||null),r&&this.renderAll()}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_clearSelection:function(t,e,n){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:n.x,ey:n.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,n;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&t.touches.length>1)){var r=this._groupSelector;r?(n=this.getPointer(t,!0),r.left=n.x-r.ex,r.top=n.y-r.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e)),this._handleEvent(t,"move",e||null)}},__onMouseWheel:function(t){this.fire("mouse:wheel",{e:t})},_transformObject:function(t){var e=this.getPointer(t),n=this._currentTransform;n.reset=!1,n.target.isMoving=!0,this._beforeScaleTransform(t,n),this._performTransformAction(t,n,e),n.actionPerformed&&this.renderAll()},_performTransformAction:function(t,e,n){var r=n.x,o=n.y,c=e.target,l=e.action,h=!1;"rotate"===l?(h=this._rotateObject(r,o))&&this._fire("rotating",c,t):"scale"===l?(h=this._onScale(t,e,r,o))&&this._fire("scaling",c,t):"scaleX"===l?(h=this._scaleObject(r,o,"x"))&&this._fire("scaling",c,t):"scaleY"===l?(h=this._scaleObject(r,o,"y"))&&this._fire("scaling",c,t):"skewX"===l?(h=this._skewObject(r,o,"x"))&&this._fire("skewing",c,t):"skewY"===l?(h=this._skewObject(r,o,"y"))&&this._fire("skewing",c,t):(h=this._translateObject(r,o))&&(this._fire("moving",c,t),this.setCursor(c.moveCursor||this.moveCursor)),e.actionPerformed=h},_fire:function(t,e,n){this.fire("object:"+t,{target:e,e:n}),e.fire(t,{e:n})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var n=this._shouldCenterTransform(e.target);(n&&("center"!==e.originX||"center"!==e.originY)||!n&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,n,r){return!t[this.uniScaleKey]&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(n,r,"equally")):(e.currentAction="scale",this._scaleObject(n,r))},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var n=e.hoverCursor||this.hoverCursor;if(e.selectable){var r=this.getActiveGroup(),o=e._findTargetCorner&&(!r||!r.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));o?this._setCornerCursor(o,e,t):this.setCursor(n)}else this.setCursor(n);return!0},_setCornerCursor:function(t,e,n){if(t in cursorOffset)this.setCursor(this._getRotatedCornerCursor(t,e,n));else{if("mtr"!==t||!e.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(t,e,n){var r=Math.round(e.getAngle()%360/45);return r<0&&(r+=8),r+=cursorOffset[t],n[this.altActionKey]&&cursorOffset[t]%2==0&&(r+=2),r%=8,this.cursorMap[r]}}),min=Math.min,max=Math.max,fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var n=this.getActiveObject();return t[this.selectionKey]&&e&&e.selectable&&(this.getActiveGroup()||n&&n!==e)&&this.selection},_handleGrouping:function(t,e){var n=this.getActiveGroup();(e!==n||(e=this.findTarget(t,!0)))&&(n?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var n=this.getActiveGroup();if(n.contains(t)){if(n.removeWithUpdate(t),t.set("active",!1),1===n.size())return this.discardActiveGroup(e),void this.setActiveObject(n.item(0))}else n.addWithUpdate(t);this.fire("selection:created",{target:n,e:e}),n.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var n=this._createGroup(t);n.addWithUpdate(),this.setActiveGroup(n),this._activeObject=null,this.fire("selection:created",{target:n,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),n=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(n,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&((e=new fabric.Group(e.reverse(),{canvas:this})).addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var t,e=[],n=this._groupSelector.ex,r=this._groupSelector.ey,o=n+this._groupSelector.left,c=r+this._groupSelector.top,l=new fabric.Point(min(n,o),min(r,c)),h=new fabric.Point(max(n,o),max(r,c)),f=n===o&&r===c,i=this._objects.length;i--&&!((t=this._objects[i])&&t.selectable&&t.visible&&(t.intersectsWithRect(l,h)||t.isContainedWithinRect(l,h)||t.containsPoint(l)||t.containsPoint(h))&&(t.set("active",!0),e.push(t),f)););return e},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}}),supportQuality=fabric.StaticCanvas.supports("toDataURLWithQuality"),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",n=t.quality||1,r=t.multiplier||1,o={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,n,o,r)},__toDataURLWithMultiplier:function(t,e,n,r){var o=this.getWidth(),c=this.getHeight(),l=(n.width||this.getWidth())*r,h=(n.height||this.getHeight())*r,f=this.getZoom()*r,d=this.viewportTransform,v=[f,0,0,f,(d[4]-n.left)*r,(d[5]-n.top)*r],m=this.interactive;this.viewportTransform=v,this.interactive&&(this.interactive=!1),o!==l||c!==h?this.setDimensions({width:l,height:h}):this.renderAll();var data=this.__toDataURL(t,e,n);return m&&(this.interactive=m),this.viewportTransform=d,this.setDimensions({width:o,height:c}),data},__toDataURL:function(t,e){var n=this.contextContainer.canvas;return"jpg"===t&&(t="jpeg"),supportQuality?n.toDataURL("image/"+t,e):n.toDataURL("image/"+t)},toDataURLWithMultiplier:function(t,e,n){return this.toDataURL({format:t,multiplier:e,quality:n})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,n){return this.loadFromJSON(t,e,n)},loadFromJSON:function(t,e,n){if(t){var r="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t);this.clear();var o=this;return this._enlivenObjects(r.objects,(function(){o._setBgOverlay(r,(function(){for(var t in delete r.objects,delete r.backgroundImage,delete r.overlayImage,delete r.background,delete r.overlay,r)o[t]=r[t];e&&e()}))}),n),this}},_setBgOverlay:function(t,e){var n=this,r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var o=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&(n.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,r,o),this.__setBgOverlay("overlayImage",t.overlayImage,r,o),this.__setBgOverlay("backgroundColor",t.background,r,o),this.__setBgOverlay("overlayColor",t.overlay,r,o),o()}else e&&e()},__setBgOverlay:function(t,e,n,r){var o=this;e?"backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,(function(img){o[t]=img,n[t]=!0,r&&r()})):this["set"+fabric.util.string.capitalize(t,!0)](e,(function(){n[t]=!0,r&&r()})):n[t]=!0},_enlivenObjects:function(t,e,n){var r=this;if(t&&0!==t.length){var o=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,(function(t){t.forEach((function(t,e){r.insertAt(t,e)})),r.renderOnAddRemove=o,e&&e()}),null,n)}else e&&e()},_toDataURL:function(t,e){this.clone((function(n){e(n.toDataURL(t))}))},_toDataURLWithMultiplier:function(t,e,n){this.clone((function(r){n(r.toDataURLWithMultiplier(t,e))}))},clone:function(t,e){var data=JSON.stringify(this.toJSON(e));this.cloneWithoutData((function(e){e.loadFromJSON(data,(function(){t&&t(e)}))}))},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var n=new fabric.Canvas(e);n.clipTo=this.clipTo,this.backgroundImage?(n.setBackgroundImage(this.backgroundImage.src,(function(){n.renderAll(),t&&t(n)})),n.backgroundImageOpacity=this.backgroundImageOpacity,n.backgroundImageStretch=this.backgroundImageStretch):t&&t(n)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.util.toFixed,o=e.util.string.capitalize,c=e.util.degreesToRadians,l=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill)),!t.stroke||!t.stroke.colorStops||t.stroke instanceof e.Gradient||this.set("stroke",new e.Gradient(t.stroke))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof e.Pattern||this.set("fill",new e.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var n=e.util.getFunctionBody(t.clipTo);void 0!==n&&(this.clipTo=new Function("ctx",n))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(t);var n=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(n.x,n.y),t.rotate(c(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),t.transform(1,0,Math.tan(c(this.skewX)),1,0,0),t.transform(1,Math.tan(c(this.skewY)),0,1,0,0)},toObject:function(t){var n=e.Object.NUM_FRACTION_DIGITS,object={type:this.type,originX:this.originX,originY:this.originY,left:r(this.left,n),top:r(this.top,n),width:r(this.width,n),height:r(this.height,n),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,n),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,n),scaleX:r(this.scaleX,n),scaleY:r(this.scaleY,n),angle:r(this.getAngle(),n),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,n),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:r(this.skewX,n),skewY:r(this.skewY,n)};return e.util.populateWithProperties(this,object,t),this.includeDefaultValues||(object=this._removeDefaultValues(object)),object},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(object){var t=e.util.getKlass(object.type).prototype;return t.stateProperties.forEach((function(e){object[e]===t[e]&&delete object[e],"[object Array]"===Object.prototype.toString.call(object[e])&&"[object Array]"===Object.prototype.toString.call(t[e])&&0===object[e].length&&0===t[e].length&&delete object[e]})),object},toString:function(){return"#<fabric."+o(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var n=this.group.getObjectScaling();t*=n.scaleX,e*=n.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,n){return("scaleX"===t||"scaleY"===t)&&(n=this._constrainScale(n)),"scaleX"===t&&n<0?(this.flipX=!this.flipX,n*=-1):"scaleY"===t&&n<0?(this.flipY=!this.flipY,n*=-1):"shadow"!==t||!n||n instanceof e.Shadow||(n=new e.Shadow(n)),this[t]=n,"width"!==t&&"height"!==t||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,n){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),n||this.transform(t),this._setOpacity(t),this._setShadow(t),this._renderBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this._render(t,n),this.clipTo&&t.restore(),t.restore())},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor,t.fillRect(-this.width/2,-this.height/2,this.width,this.height),this._removeShadow(t))},_setOpacity:function(t){this.group&&this.group._setOpacity(t),t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_setLineDash:function(t,e,n){e&&(1&e.length&&e.push.apply(e,e),l?t.setLineDash(e):n&&n(t))},_renderControls:function(t,n){if(!(!this.active||n||this.group&&this.group!==this.canvas.getActiveGroup())){var r,o=this.getViewportTransform(),l=this.calcTransformMatrix();l=e.util.multiplyTransformMatrices(o,l),r=e.util.qrDecompose(l),t.save(),t.translate(r.translateX,r.translateY),t.lineWidth=1*this.borderScaleFactor,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.group&&this.group===this.canvas.getActiveGroup()?(t.rotate(c(r.angle)),this.drawBordersInGroup(t,r)):(t.rotate(c(this.angle)),this.drawBorders(t)),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var n=this.canvas&&this.canvas.viewportTransform[0]||1,r=this.canvas&&this.canvas.viewportTransform[3]||1,o=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(n*=e.devicePixelRatio,r*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(n+r)*(o.scaleX+o.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*n*o.scaleX,t.shadowOffsetY=this.shadow.offsetY*r*o.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var g=this.fill.gradientTransform;t.transform.apply(t,g)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore()}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var g=this.stroke.gradientTransform;t.transform.apply(t,g)}this.stroke.toLive&&t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),t.stroke(),t.restore()}},clone:function(t,n){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(n),t):new e.Object(this.toObject(n))},cloneAsImage:function(t,n){var r=this.toDataURL(n);return e.util.loadImage(r,(function(img){t&&t(new e.Image(img))})),this},toDataURL:function(t){t||(t={});var n=e.util.createCanvasElement(),r=this.getBoundingRect();n.width=r.width,n.height=r.height,e.util.wrapElement(n,"div");var canvas=new e.StaticCanvas(n,{enableRetinaScaling:t.enableRetinaScaling});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(canvas.backgroundColor="#fff");var o={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(canvas.getWidth()/2,canvas.getHeight()/2),"center","center");var c=this.canvas;canvas.add(this);var data=canvas.toDataURL(t);return this.set(o).setCoords(),this.canvas=c,canvas.dispose(),canvas=null,data},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,n){n||(n={});var r={colorStops:[]};for(var o in r.type=n.type||(n.r1||n.r2?"radial":"linear"),r.coords={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2},(n.r1||n.r2)&&(r.coords.r1=n.r1,r.coords.r2=n.r2),n.gradientTransform&&(r.gradientTransform=n.gradientTransform),n.colorStops){var c=new e.Color(n.colorStops[o]);r.colorStops.push({offset:o,color:c.toRgb(),opacity:c.getAlpha()})}return this.set(t,e.Gradient.forObject(this,r))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(t,n){n=n||this.canvas.getPointer(t);var r=new e.Point(n.x,n.y),o=this._getLeftTopCoords();return this.angle&&(r=e.util.rotatePoint(r,o,e.util.degreesToRadians(-this.angle))),{x:r.x-o.x,y:r.y-o.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,n(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}(exports),degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-.5,center:0,right:.5},originYOffset={top:-.5,center:0,bottom:.5},fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,e,n,r,o){var c,l,h,f=t.x,d=t.y;return"string"==typeof e?e=originXOffset[e]:e-=.5,"string"==typeof r?r=originXOffset[r]:r-=.5,"string"==typeof n?n=originYOffset[n]:n-=.5,"string"==typeof o?o=originYOffset[o]:o-=.5,l=o-n,((c=r-e)||l)&&(h=this._getTransformedDimensions(),f=t.x+c*h.x,d=t.y+l*h.y),new fabric.Point(f,d)},translateToCenterPoint:function(t,e,n){var p=this.translateToGivenOrigin(t,e,n,"center","center");return this.angle?fabric.util.rotatePoint(p,t,degreesToRadians(this.angle)):p},translateToOriginPoint:function(t,e,n){var p=this.translateToGivenOrigin(t,"center","center",e,n);return this.angle?fabric.util.rotatePoint(p,t,degreesToRadians(this.angle)):p},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var n=this.getCenterPoint();return this.translateToOriginPoint(n,t,e)},toLocalPoint:function(t,e,n){var p,r,o=this.getCenterPoint();return p=void 0!==e&&void 0!==n?this.translateToGivenOrigin(o,"center","center",e,n):new fabric.Point(this.left,this.top),r=new fabric.Point(t.x,t.y),this.angle&&(r=fabric.util.rotatePoint(r,o,-degreesToRadians(this.angle))),r.subtractEquals(p)},setPositionByOrigin:function(t,e,n){var r=this.translateToCenterPoint(t,e,n),o=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(t){var e,n,r=degreesToRadians(this.angle),o=this.getWidth(),c=Math.cos(r)*o,l=Math.sin(r)*o;e="string"==typeof this.originX?originXOffset[this.originX]:this.originX-.5,n="string"==typeof t?originXOffset[t]:t-.5,this.left+=c*(n-e),this.top+=l*(n-e),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){function t(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var e=fabric.util.degreesToRadians,n=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,n){var r=t(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(r,e,n).status},intersectsWithObject:function(e){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords)).status||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){for(var n=t(this.oCoords),i=0;i<4;i++)if(!e.containsPoint(n[i]))return!1;return!0},isContainedWithinRect:function(t,e){var n=this.getBoundingRect();return n.left>=t.x&&n.left+n.width<=e.x&&n.top>=t.y&&n.top+n.height<=e.y},containsPoint:function(t){this.oCoords||this.setCoords();var e=this._getImageLines(this.oCoords),n=this._findCrossPoints(t,e);return 0!==n&&n%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var n,r,o,c=0;for(var l in e)if(!((o=e[l]).o.y<t.y&&o.d.y<t.y||o.o.y>=t.y&&o.d.y>=t.y||(o.o.x===o.d.x&&o.o.x>=t.x?r=o.o.x:(0,n=(o.d.y-o.o.y)/(o.d.x-o.o.x),r=-(t.y-0*t.x-(o.o.y-n*o.o.x))/(0-n)),r>=t.x&&(c+=1),2!==c)))break;return c},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return(t=this._constrainScale(t))<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=e(this.angle),n=this.getViewportTransform(),r=this._calculateCurrentDimensions(),o=r.x,c=r.y;o<0&&(o=Math.abs(o));var l=Math.sin(t),h=Math.cos(t),f=o>0?Math.atan(c/o):0,d=o/Math.cos(f)/2,v=Math.cos(f+t)*d,m=Math.sin(f+t)*d,y=fabric.util.transformPoint(this.getCenterPoint(),n),_=new fabric.Point(y.x-v,y.y-m),tr=new fabric.Point(_.x+o*h,_.y+o*l),x=new fabric.Point(_.x-c*l,_.y+c*h),br=new fabric.Point(y.x+v,y.y+m),w=new fabric.Point((_.x+x.x)/2,(_.y+x.y)/2),C=new fabric.Point((tr.x+_.x)/2,(tr.y+_.y)/2),S=new fabric.Point((br.x+tr.x)/2,(br.y+tr.y)/2),k=new fabric.Point((br.x+x.x)/2,(br.y+x.y)/2),O=new fabric.Point(C.x+l*this.rotatingPointOffset,C.y-h*this.rotatingPointOffset);return this.oCoords={tl:_,tr:tr,br:br,bl:x,ml:w,mt:C,mr:S,mb:k,mtr:O},this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),n=Math.cos(t),r=Math.sin(t);return[n,r,-r,n,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],r=this._calcRotateMatrix(),o=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),c=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return c=n(c,e),c=n(c,r),c=n(c,o)},_calcDimensionsTransformMatrix:function(t,r,o){var c=[1,0,Math.tan(e(t)),1],l=[1,Math.tan(e(r)),0,1],h=this.scaleX*(o&&this.flipX?-1:1),f=this.scaleY*(o&&this.flipY?-1:1),d=n([h,0,0,f],c,!0);return n(d,l,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var n=new fabric.Color(e),r=t+": "+n.toRgb()+"; ",o=n.getAlpha();return 1!==o&&(r+=t+"-opacity: "+o.toString()+"; "),r}return t+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(e){var n=this.fillRule,r=this.strokeWidth?this.strokeWidth:"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeLineCap?this.strokeLineCap:"butt",l=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",f=void 0!==this.opacity?this.opacity:"1",d=this.visible?"":" visibility: hidden;",filter=e?"":this.getSvgFilter(),v=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",c,"; ","stroke-linejoin: ",l,"; ","stroke-miterlimit: ",h,"; ",v,"fill-rule: ",n,"; ","opacity: ",f,";",filter,d].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),n=this.getSkewX()%360,r=this.getSkewY()%360,o=this.getCenterPoint(),c=fabric.Object.NUM_FRACTION_DIGITS,l="path-group"===this.type?"":"translate("+t(o.x,c)+" "+t(o.y,c)+")",h=0!==e?" rotate("+t(e,c)+")":"",f=1===this.scaleX&&1===this.scaleY?"":" scale("+t(this.scaleX,c)+" "+t(this.scaleY,c)+")",d=0!==n?" skewX("+t(n,c)+")":"",v=0!==r?" skewY("+t(r,c)+")":"",m="path-group"===this.type?this.width:0,y=this.flipX?" matrix(-1 0 0 1 "+m+" 0) ":"",_="path-group"===this.type?this.height:0;return[l,h,f,y,this.flipY?" matrix(1 0 0 -1 0 "+_+")":"",d,v].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}})}(),function(){var t=fabric.util.object.extend;function e(e,n,r){var o={};r.forEach((function(t){o[t]=e[t]})),t(e[n],o,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return!function t(e,n){if(!fabric.isLikelyNode&&e instanceof Element)return e===n;if(e instanceof Array){if(e.length!==n.length)return!1;var r=n.concat().sort();return!e.concat().sort().some((function(e,i){return!t(r[i],e)}))}if(e instanceof Object){for(var o in e)if(!t(e[o],n[o]))return!1;return!0}return e===n}(this.originalState,this)},saveState:function(t){return e(this,"originalState",this.stateProperties),t&&t.stateProperties&&e(this,"originalState",t.stateProperties),this},setupState:function(t){return this.originalState={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,n,r=t.x,o=t.y;for(var i in this.__corner=0,this.oCoords)if(this.isControlVisible(i)&&("mtr"!==i||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==i&&"mr"!==i&&"mb"!==i&&"ml"!==i)&&(n=this._getImageLines(this.oCoords[i].corner),0!==(e=this._findCrossPoints({x:r,y:o},n))&&e%2==1))return this.__corner=i,i;return!1},_setCornerCoords:function(){var e,n,r=this.oCoords,o=t(45-this.angle),c=.707106*this.cornerSize,l=c*Math.cos(o),h=c*Math.sin(o);for(var f in r)e=r[f].x,n=r[f].y,r[f].corner={tl:{x:e-h,y:n-l},tr:{x:e+l,y:n-h},bl:{x:e-l,y:n+h},br:{x:e+h,y:n+l}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,n=this.height,r=!0,o=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(o=e,r=n),o&&(n+=n<0?-t:t),r&&(e+=e<0?-t:t),{x:e,y:n}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,n,r=this._getNonTransformedDimensions(),o=r.x/2,c=r.y/2,l=[{x:-o,y:-c},{x:o,y:-c},{x:-o,y:c},{x:o,y:c}],h=this._calcDimensionsTransformMatrix(t,e,!1);for(i=0;i<l.length;i++)l[i]=fabric.util.transformPoint(l[i],h);return{x:(n=fabric.util.makeBoundingBoxFromPoints(l)).width,y:n.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),n=e.x,r=e.y;return fabric.util.transformPoint(new fabric.Point(n,r),t,!0).scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active)return this;e.save();var n=this.getCenterPoint(),r=this._calculateCurrentDimensions(),o=this.canvas.viewportTransform;return e.translate(n.x,n.y),e.scale(1/o[0],1/o[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-r.x/2,-r.y/2,r.x,r.y),e.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this;var e=this._calculateCurrentDimensions(),n=1/this.borderScaleFactor,r=e.x+n,o=e.y+n;if(t.save(),t.strokeStyle=this.borderColor,this._setLineDash(t,this.borderDashArray,null),t.strokeRect(-r/2,-o/2,r,o),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var c=-o/2;t.beginPath(),t.moveTo(0,c),t.lineTo(0,c-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e){if(!this.hasBorders)return this;var p=this._getNonTransformedDimensions(),n=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),r=fabric.util.transformPoint(p,n),o=1/this.borderScaleFactor,c=r.x+o+2*this.padding,l=r.y+o+2*this.padding;return t.save(),this._setLineDash(t,this.borderDashArray,null),t.strokeStyle=this.borderColor,t.strokeRect(-c/2,-l/2,c,l),t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(),n=e.x,r=e.y,o=this.cornerSize,c=-(n+o)/2,l=-(r+o)/2,h=this.transparentCorners?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,h,c,l),this._drawControl("tr",t,h,c+n,l),this._drawControl("bl",t,h,c,l+r),this._drawControl("br",t,h,c+n,l+r),this.get("lockUniScaling")||(this._drawControl("mt",t,h,c+n/2,l),this._drawControl("mb",t,h,c+n/2,l+r),this._drawControl("mr",t,h,c+n,l+r/2),this._drawControl("ml",t,h,c,l+r/2)),this.hasRotatingPoint&&this._drawControl("mtr",t,h,c+n/2,l-this.rotatingPointOffset),t.restore(),this},_drawControl:function(t,e,n,r,o){if(this.isControlVisible(t)){var c=this.cornerSize,l=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":e.beginPath(),e.arc(r+c/2,o+c/2,c/2,0,2*Math.PI,!1),e[n](),l&&e.stroke();break;default:"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(r,o,c,c),e[n+"Rect"](r,o,c,c),l&&e.strokeRect(r,o,c,c)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var p in t||(t={}),t)this.setControlVisible(p,t[p]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,t){var e=function(){},n=(t=t||{}).onComplete||e,r=t.onChange||e,o=this;return fabric.util.animate({startValue:object.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){object.set("left",t),o.renderAll(),r()},onComplete:function(){object.setCoords(),n()}}),this},fxCenterObjectV:function(object,t){var e=function(){},n=(t=t||{}).onComplete||e,r=t.onChange||e,o=this;return fabric.util.animate({startValue:object.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){object.set("top",t),o.renderAll(),r()},onComplete:function(){object.setCoords(),n()}}),this},fxRemove:function(object,t){var e=function(){},n=(t=t||{}).onComplete||e,r=t.onChange||e,o=this;return fabric.util.animate({startValue:object.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){object.set("active",!1)},onChange:function(t){object.set("opacity",t),o.renderAll(),r()},onComplete:function(){o.remove(object),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,n=[];for(t in arguments[0])n.push(t);for(var i=0,r=n.length;i<r;i++)t=n[i],e=i!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,n,r){var o,c=this;e=e.toString(),n=n?fabric.util.object.clone(n):{},~t.indexOf(".")&&(o=t.split("."));var l=o?this.get(o[0])[o[1]]:this.get(t);"from"in n||(n.from=l),e=~e.indexOf("=")?l+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:n.from,endValue:e,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(){return n.abort.call(c)},onChange:function(e){o?c[o[0]][o[1]]=e:c.set(t,e),r||n.onChange&&n.onChange()},onComplete:function(){r||(c.setCoords(),n.onComplete&&n.onComplete())}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},o=e.StaticCanvas.supports("setLineDash");function c(t,e){var n=t.origin,r=t.axis1,o=t.axis2,c=t.dimension,l=e.nearest,h=e.center,f=e.farthest;return function(){switch(this.get(n)){case l:return Math.min(this.get(r),this.get(o));case h:return Math.min(this.get(r),this.get(o))+.5*this.get(c);case f:return Math.max(this.get(r),this.get(o))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var n=this.getCenterPoint();t.translate(n.x-this.strokeWidth/2,n.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&o){var p=this.calcLinePoints();t.moveTo(p.x1,p.y1),t.lineTo(p.x2,p.y2)}t.lineWidth=this.strokeWidth;var r=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r},_renderDashedStroke:function(t){var p=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,p.x1,p.y1,p.x2,p.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return n(this.callSuper("toObject",t),this.calcLinePoints())},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,n=t*this.width*.5,r=e*this.height*.5;return{x1:n,x2:t*this.width*-.5,y1:r,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),p={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(p=this.calcLinePoints()),e.push("<line ",this.getSvgId(),'x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(element,t){var r=e.parseAttributes(element,e.Line.ATTRIBUTE_NAMES),o=[r.x1||0,r.y1||0,r.x2||0,r.y2||0];return new e.Line(o,n(r,t))},e.Line.fromObject=function(object,t){var n=[object.x1,object.y1,object.x2,object.y2],line=new e.Line(n,object);return t&&t(line),line})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=Math.PI,r=e.util.object.extend;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*n,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("radius",t.radius||0),this.startAngle=t.startAngle||this.startAngle,this.endAngle=t.endAngle||this.endAngle},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),r=0,o=0,c=(this.endAngle-this.startAngle)%(2*n);if(0===c)this.group&&"path-group"===this.group.type&&(r=this.left+this.radius,o=this.top+this.radius),e.push("<circle ",this.getSvgId(),'cx="'+r+'" cy="'+o+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var l=Math.cos(this.startAngle)*this.radius,h=Math.sin(this.startAngle)*this.radius,f=Math.cos(this.endAngle)*this.radius,d=Math.sin(this.endAngle)*this.radius,v=c>n?"1":"0";e.push('<path d="M '+l+" "+h," A "+this.radius+" "+this.radius," 0 ",+v+" 1"," "+f+" "+d,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(element,t){t||(t={});var n,o=e.parseAttributes(element,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=o)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");o.left=o.left||0,o.top=o.top||0;var c=new e.Circle(r(o,t));return c.left-=c.radius,c.top-=c.radius,c},e.Circle.fromObject=function(object,t){var circle=new e.Circle(object);return t&&t(circle),circle})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,n),t.lineTo(0,-n),t.lineTo(e,n),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var n=this.width/2,r=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-n,r,0,-r,this.strokeDashArray),e.util.drawDashedLine(t,0,-r,n,r,this.strokeDashArray),e.util.drawDashedLine(t,n,r,-n,r,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),n=this.width/2,r=this.height/2,o=[-n+" "+r,"0 "+-r,n+" "+r].join(",");return e.push("<polygon ",this.getSvgId(),'points="',o,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Triangle.fromObject=function(object,t){var n=new e.Triangle(object);return t&&t(n),n})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=2*Math.PI,r=e.util.object.extend;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),n=0,r=0;return this.group&&"path-group"===this.group.type&&(n=this.left+this.rx,r=this.top+this.ry),e.push("<ellipse ",this.getSvgId(),'cx="',n,'" cy="',r,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,n,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(element,t){t||(t={});var n=e.parseAttributes(element,e.Ellipse.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0;var ellipse=new e.Ellipse(r(n,t));return ellipse.top-=ellipse.ry,ellipse.left-=ellipse.rx,ellipse},e.Ellipse.fromObject=function(object,t){var ellipse=new e.Ellipse(object);return t&&t(ellipse),ellipse})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend;if(e.Rect)e.warn("fabric.Rect is already defined");else{var r=e.Object.prototype.stateProperties.concat();r.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:r,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1!==this.width||1!==this.height){var n=this.rx?Math.min(this.rx,this.width/2):0,r=this.ry?Math.min(this.ry,this.height/2):0,o=this.width,c=this.height,l=e?this.left:-this.width/2,h=e?this.top:-this.height/2,f=0!==n||0!==r,d=.4477152502;t.beginPath(),t.moveTo(l+n,h),t.lineTo(l+o-n,h),f&&t.bezierCurveTo(l+o-d*n,h,l+o,h+d*r,l+o,h+r),t.lineTo(l+o,h+c-r),f&&t.bezierCurveTo(l+o,h+c-d*r,l+o-d*n,h+c,l+o-n,h+c),t.lineTo(l+n,h+c),f&&t.bezierCurveTo(l+d*n,h+c,l,h+c-d*r,l,h+c-r),t.lineTo(l,h+r),f&&t.bezierCurveTo(l,h+d*r,l+d*n,h,l+n,h),t.closePath(),this._renderFill(t),this._renderStroke(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var n=-this.width/2,r=-this.height/2,o=this.width,c=this.height;t.beginPath(),e.util.drawDashedLine(t,n,r,n+o,r,this.strokeDashArray),e.util.drawDashedLine(t,n+o,r,n+o,r+c,this.strokeDashArray),e.util.drawDashedLine(t,n+o,r+c,n,r+c,this.strokeDashArray),e.util.drawDashedLine(t,n,r+c,n,r,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),n=this.left,r=this.top;return this.group&&"path-group"===this.group.type||(n=-this.width/2,r=-this.height/2),e.push("<rect ",this.getSvgId(),'x="',n,'" y="',r,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(element,t){if(!element)return null;t=t||{};var r=e.parseAttributes(element,e.Rect.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var rect=new e.Rect(n(t?e.util.object.clone(t):{},r));return rect.visible=rect.visible&&rect.width>0&&rect.height>0,rect},e.Rect.fromObject=function(object,t){var rect=new e.Rect(object);return t&&t(rect),rect}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,n){return e.Polygon.prototype.initialize.call(this,t,n)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return e.Polygon.prototype.toSVG.call(this,t)},_render:function(t,n){e.Polygon.prototype.commonRender.call(this,t,n)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var n,r;t.beginPath();for(var i=0,o=this.points.length;i<o;i++)n=this.points[i],r=this.points[i+1]||n,e.util.drawDashedLine(t,n.x,n.y,r.x,r.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(element,t){if(!element)return null;t||(t={});var n=e.parsePointsAttribute(element.getAttribute("points")),r=e.parseAttributes(element,e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(n,e.util.object.extend(r,t))},e.Polyline.fromObject=function(object,t){var polyline=new e.Polyline(object.points,object);return t&&t(polyline),polyline})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.util.array.min,o=e.util.array.max,c=e.util.toFixed;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var t=this.points,e=r(t,"x"),n=r(t,"y"),c=o(t,"x"),l=o(t,"y");this.width=c-e||0,this.height=l-n||0,this.minX=e||0,this.minY=n||0},toObject:function(t){return n(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e,n=[],r=this._createBaseSVGMarkup(),i=0,o=this.points.length;i<o;i++)n.push(c(this.points[i].x,2),",",c(this.points[i].y,2)," ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),r.push("<",this.type," ",this.getSvgId(),'points="',n.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(r.join("")):r.join("")},_render:function(t,e){this.commonRender(t,e)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t,e){var n,r=this.points.length;if(!r||isNaN(this.points[r-1].y))return!1;e||t.translate(-this.pathOffset.x,-this.pathOffset.y),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=0;i<r;i++)n=this.points[i],t.lineTo(n.x,n.y);return!0},_renderDashedStroke:function(t){e.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(element,t){if(!element)return null;t||(t={});var r=e.parsePointsAttribute(element.getAttribute("points")),o=e.parseAttributes(element,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(r,n(o,t))},e.Polygon.fromObject=function(object,t){var polygon=new e.Polygon(object.points,object);return t&&t(polygon),polygon})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.array.min,r=e.util.array.max,o=e.util.object.extend,c=Object.prototype.toString,l=e.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},f={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(path,t){t=t||{},this.setOptions(t),path||(path=[]);var e="[object Array]"===c.call(path);this.path=e?path:path.match&&path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(e||(this.path=this._parsePath()),this._setPositionDimensions(t),t.sourcePath&&this.setSourcePath(t.sourcePath))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),void 0===t.top&&(this.top=e.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,n,r,o=null,c=0,h=0,f=0,d=0,v=0,m=0,y=-this.pathOffset.x,_=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(y=0,_=0),t.beginPath();for(var i=0,x=this.path.length;i<x;++i){switch((e=this.path[i])[0]){case"l":f+=e[1],d+=e[2],t.lineTo(f+y,d+_);break;case"L":f=e[1],d=e[2],t.lineTo(f+y,d+_);break;case"h":f+=e[1],t.lineTo(f+y,d+_);break;case"H":f=e[1],t.lineTo(f+y,d+_);break;case"v":d+=e[1],t.lineTo(f+y,d+_);break;case"V":d=e[1],t.lineTo(f+y,d+_);break;case"m":c=f+=e[1],h=d+=e[2],t.moveTo(f+y,d+_);break;case"M":c=f=e[1],h=d=e[2],t.moveTo(f+y,d+_);break;case"c":n=f+e[5],r=d+e[6],v=f+e[3],m=d+e[4],t.bezierCurveTo(f+e[1]+y,d+e[2]+_,v+y,m+_,n+y,r+_),f=n,d=r;break;case"C":f=e[5],d=e[6],v=e[3],m=e[4],t.bezierCurveTo(e[1]+y,e[2]+_,v+y,m+_,f+y,d+_);break;case"s":n=f+e[3],r=d+e[4],null===o[0].match(/[CcSs]/)?(v=f,m=d):(v=2*f-v,m=2*d-m),t.bezierCurveTo(v+y,m+_,f+e[1]+y,d+e[2]+_,n+y,r+_),v=f+e[1],m=d+e[2],f=n,d=r;break;case"S":n=e[3],r=e[4],null===o[0].match(/[CcSs]/)?(v=f,m=d):(v=2*f-v,m=2*d-m),t.bezierCurveTo(v+y,m+_,e[1]+y,e[2]+_,n+y,r+_),f=n,d=r,v=e[1],m=e[2];break;case"q":n=f+e[3],r=d+e[4],v=f+e[1],m=d+e[2],t.quadraticCurveTo(v+y,m+_,n+y,r+_),f=n,d=r;break;case"Q":n=e[3],r=e[4],t.quadraticCurveTo(e[1]+y,e[2]+_,n+y,r+_),f=n,d=r,v=e[1],m=e[2];break;case"t":n=f+e[1],r=d+e[2],null===o[0].match(/[QqTt]/)?(v=f,m=d):(v=2*f-v,m=2*d-m),t.quadraticCurveTo(v+y,m+_,n+y,r+_),f=n,d=r;break;case"T":n=e[1],r=e[2],null===o[0].match(/[QqTt]/)?(v=f,m=d):(v=2*f-v,m=2*d-m),t.quadraticCurveTo(v+y,m+_,n+y,r+_),f=n,d=r;break;case"a":l(t,f+y,d+_,[e[1],e[2],e[3],e[4],e[5],e[6]+f+y,e[7]+d+_]),f+=e[6],d+=e[7];break;case"A":l(t,f+y,d+_,[e[1],e[2],e[3],e[4],e[5],e[6]+y,e[7]+_]),f=e[6],d=e[7];break;case"z":case"Z":f=c,d=h,t.closePath()}o=e}},_render:function(t){this._renderPathCommands(t),this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return o(this.callSuper("toObject",["sourcePath","pathOffset"].concat(t)),{path:this.path.map((function(t){return t.slice()}))})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],n=this._createBaseSVGMarkup(),r="",i=0,o=this.path.length;i<o;i++)e.push(this.path[i].join(" "));var path=e.join(" ");return this.group&&"path-group"===this.group.type||(r=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),n.push("<path ",this.getSvgId(),'d="',path,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),r,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(n.join("")):n.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,n,r,o,c=[],l=[],d=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,i=0,v=this.path.length;i<v;i++){for(r=(t=this.path[i]).slice(1).trim(),l.length=0;n=d.exec(r);)l.push(n[0]);o=[t.charAt(0)];for(var m=0,y=l.length;m<y;m++)e=parseFloat(l[m]),isNaN(e)||o.push(e);var _=o[0],x=h[_.toLowerCase()],w=f[_]||_;if(o.length-1>x)for(var C=1,S=o.length;C<S;C+=x)c.push([_].concat(o.slice(C,C+x))),_=w;else c.push(o)}return c},_parseDimensions:function(){for(var t,o,c,l,h=[],f=[],d=null,v=0,m=0,y=0,_=0,x=0,w=0,i=0,C=this.path.length;i<C;++i){switch((t=this.path[i])[0]){case"l":y+=t[1],_+=t[2],l=[];break;case"L":y=t[1],_=t[2],l=[];break;case"h":y+=t[1],l=[];break;case"H":y=t[1],l=[];break;case"v":_+=t[1],l=[];break;case"V":_=t[1],l=[];break;case"m":v=y+=t[1],m=_+=t[2],l=[];break;case"M":v=y=t[1],m=_=t[2],l=[];break;case"c":o=y+t[5],c=_+t[6],x=y+t[3],w=_+t[4],l=e.util.getBoundsOfCurve(y,_,y+t[1],_+t[2],x,w,o,c),y=o,_=c;break;case"C":y=t[5],_=t[6],x=t[3],w=t[4],l=e.util.getBoundsOfCurve(y,_,t[1],t[2],x,w,y,_);break;case"s":o=y+t[3],c=_+t[4],null===d[0].match(/[CcSs]/)?(x=y,w=_):(x=2*y-x,w=2*_-w),l=e.util.getBoundsOfCurve(y,_,x,w,y+t[1],_+t[2],o,c),x=y+t[1],w=_+t[2],y=o,_=c;break;case"S":o=t[3],c=t[4],null===d[0].match(/[CcSs]/)?(x=y,w=_):(x=2*y-x,w=2*_-w),l=e.util.getBoundsOfCurve(y,_,x,w,t[1],t[2],o,c),y=o,_=c,x=t[1],w=t[2];break;case"q":o=y+t[3],c=_+t[4],x=y+t[1],w=_+t[2],l=e.util.getBoundsOfCurve(y,_,x,w,x,w,o,c),y=o,_=c;break;case"Q":x=t[1],w=t[2],l=e.util.getBoundsOfCurve(y,_,x,w,x,w,t[3],t[4]),y=t[3],_=t[4];break;case"t":o=y+t[1],c=_+t[2],null===d[0].match(/[QqTt]/)?(x=y,w=_):(x=2*y-x,w=2*_-w),l=e.util.getBoundsOfCurve(y,_,x,w,x,w,o,c),y=o,_=c;break;case"T":o=t[1],c=t[2],null===d[0].match(/[QqTt]/)?(x=y,w=_):(x=2*y-x,w=2*_-w),l=e.util.getBoundsOfCurve(y,_,x,w,x,w,o,c),y=o,_=c;break;case"a":l=e.util.getBoundsOfArc(y,_,t[1],t[2],t[3],t[4],t[5],t[6]+y,t[7]+_),y+=t[6],_+=t[7];break;case"A":l=e.util.getBoundsOfArc(y,_,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),y=t[6],_=t[7];break;case"z":case"Z":y=v,_=m}d=t,l.forEach((function(t){h.push(t.x),f.push(t.y)})),h.push(y),f.push(_)}var S=n(h)||0,k=n(f)||0;return{left:S,top:k,width:(r(h)||0)-S,height:(r(f)||0)-k}}}),e.Path.fromObject=function(object,t){var path;if("string"!=typeof object.path)return path=new e.Path(object.path,object),t&&t(path),path;e.loadSVGFromURL(object.path,(function(n){var r=object.path;path=n[0],delete object.path,e.util.object.extend(path,object),path.setSourcePath(r),t&&t(path)}))},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(element,t,n){var r=e.parseAttributes(element,e.Path.ATTRIBUTE_NAMES);t&&t(new e.Path(r.d,o(r,n)))},e.Path.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.util.array.invoke,o=e.Object.prototype.toObject;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},parseDimensionsFromPaths:function(t){for(var n,p,path,r,o,c,l=[],h=[],f=this.paths.length;f--;){r=(path=this.paths[f]).height+path.strokeWidth,o=path.width+path.strokeWidth,n=[{x:path.left,y:path.top},{x:path.left+o,y:path.top},{x:path.left,y:path.top+r},{x:path.left+o,y:path.top+r}],c=this.paths[f].transformMatrix;for(var i=0;i<n.length;i++)p=n[i],c&&(p=e.util.transformPoint(p,c,!1)),l.push(p.x),h.push(p.y)}t.width=Math.max.apply(null,l),t.height=Math.max.apply(null,h)},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),t.translate(-this.width/2,-this.height/2);for(var i=0,n=this.paths.length;i<n;++i)this.paths[i].render(t,!0);this.clipTo&&t.restore(),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){return n(o.call(this,["sourcePath"].concat(t)),{paths:r(this.getObjects(),"toObject",t)})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){var e=this.getObjects(),p=this.getPointByOrigin("left","top"),n="translate("+p.x+" "+p.y+")",r=this._createBaseSVGMarkup();r.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n");for(var i=0,o=e.length;i<o;i++)r.push("\t",e[i].toSVG(t));return r.push("</g>\n"),t?t(r.join("")):r.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=this.getObjects()[0].get("fill")||"";return"string"==typeof t&&(t=t.toLowerCase(),this.getObjects().every((function(path){var e=path.get("fill")||"";return"string"==typeof e&&e.toLowerCase()===t})))},complexity:function(){return this.paths.reduce((function(t,path){return t+(path&&path.complexity?path.complexity():0)}),0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(object,t){"string"==typeof object.paths?e.loadSVGFromURL(object.paths,(function(n){var r=object.paths;delete object.paths;var o=e.util.groupSVGElements(n,object,r);t(o)})):e.util.enlivenObjects(object.paths,(function(n){delete object.paths,t(new e.PathGroup(n,object))}))},e.PathGroup.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.util.array.min,o=e.util.array.max,c=e.util.array.invoke;if(!e.Group){var l={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(t,e,n){e=e||{},this._objects=[],n&&this.callSuper("initialize",e),this._objects=t||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;this.originalState={},e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),n?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(t){for(var i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],t)},_updateObjectCoords:function(object,t){if(object.__origHasControls=object.hasControls,object.hasControls=!1,!t){var e=object.getLeft(),n=object.getTop(),r=this.getCenterPoint();object.set({originalLeft:e,originalTop:n,left:e-r.x,top:n-r.y}),object.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(object){return this._restoreObjectsState(),e.util.resetObjectTransform(this),object&&(this._objects.push(object),object.group=this,object._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(object){object.set("active",!0),object.group=this},removeWithUpdate:function(object){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(object),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(object){object.group=this,object._set("canvas",this.canvas)},_onObjectRemoved:function(object){delete object.group,object.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){var i=this._objects.length;if(this.delegatedProperties[t]||"canvas"===t)for(;i--;)this._objects[i].set(t,e);else for(;i--;)this._objects[i].setOnGroup(t,e);this.callSuper("_set",t,e)},toObject:function(t){return n(this.callSuper("toObject",t),{objects:c(this._objects,"toObject",t)})},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),this._transformDone=!0;for(var i=0,n=this._objects.length;i<n;i++)this._renderObject(this._objects[i],t);this.clipTo&&t.restore(),t.restore(),this._transformDone=!1}},_renderControls:function(t,e){this.callSuper("_renderControls",t,e);for(var i=0,n=this._objects.length;i<n;i++)this._objects[i]._renderControls(t)},_renderObject:function(object,t){if(object.visible){var e=object.hasRotatingPoint;object.hasRotatingPoint=!1,object.render(t),object.hasRotatingPoint=e}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(object){var t=object.calcTransformMatrix(),n=e.util.qrDecompose(t),r=new e.Point(n.translateX,n.translateY);return object.scaleX=n.scaleX,object.scaleY=n.scaleY,object.skewX=n.skewX,object.skewY=n.skewY,object.angle=n.angle,object.flipX=!1,object.flipY=!1,object.setPositionByOrigin(r,"center","center"),object},_restoreObjectState:function(object){return this.realizeTransform(object),object.setCoords(),object.hasControls=object.__origHasControls,delete object.__origHasControls,object.set("active",!1),delete object.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject((function(object){object.setCoords()})),this},_calcBounds:function(t){for(var e,n,r,o=[],c=[],l=["tr","br","bl","tl"],i=0,h=this._objects.length,f=l.length;i<h;++i)for((e=this._objects[i]).setCoords(),r=0;r<f;r++)n=l[r],o.push(e.oCoords[n].x),c.push(e.oCoords[n].y);this.set(this._getBounds(o,c,t))},_getBounds:function(t,n,c){var l=e.util.invertTransform(this.getViewportTransform()),h=e.util.transformPoint(new e.Point(r(t),r(n)),l),f=e.util.transformPoint(new e.Point(o(t),o(n)),l),d={width:f.x-h.x||0,height:f.y-h.y||0};return c||(d.left=h.x||0,d.top=h.y||0,"center"===this.originX&&(d.left+=d.width/2),"right"===this.originX&&(d.left+=d.width),"center"===this.originY&&(d.top+=d.height/2),"bottom"===this.originY&&(d.top+=d.height)),d},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in l){if(this[t])return this[t];for(var i=0,e=this._objects.length;i<e;i++)if(this._objects[i][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(object,t){e.util.enlivenObjects(object.objects,(function(n){delete object.objects,t&&t(new e.Group(n,object,!0))}))},e.Group.async=!0}}(exports),function(t){"use strict";var e=fabric.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image)fabric.warn("fabric.Image is already defined.");else{var n=fabric.Object.prototype.stateProperties.concat();n.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:n,initialize:function(element,t,e){t||(t={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",t),this._initElement(element,t,e)},getElement:function(){return this._element},setElement:function(element,t,e){var n,r;return this._element=element,this._originalElement=element,this._initConfig(e),0===this.resizeFilters.length?n=t:(r=this,n=function(){r.applyFilters(t,r.resizeFilters,r._filteredEl||r._originalElement,!0)}),0!==this.filters.length?this.applyFilters(n):n&&n(this),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var element=this.getElement();return{width:element.width,height:element.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,-n),t.lineTo(e,-n),t.lineTo(e,n),t.lineTo(-e,n),t.lineTo(-e,-n),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,n=-this.height/2,r=this.width,o=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,n,e+r,n,this.strokeDashArray),fabric.util.drawDashedLine(t,e+r,n,e+r,n+o,this.strokeDashArray),fabric.util.drawDashedLine(t,e+r,n+o,e,n+o,this.strokeDashArray),fabric.util.drawDashedLine(t,e,n+o,e,n,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var n=[],r=[],o=1,c=1;this.filters.forEach((function(t){t&&("Resize"===t.type&&(o*=t.scaleX,c*=t.scaleY),n.push(t.toObject()))})),this.resizeFilters.forEach((function(t){t&&r.push(t.toObject())}));var object=e(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(t)),{src:this.getSrc(),filters:n,resizeFilters:r});return object.width/=o,object.height/=c,object},toSVG:function(t){var e=this._createBaseSVGMarkup(),n=-this.width/2,r=-this.height/2,o="none";if(this.group&&"path-group"===this.group.type&&(n=this.left,r=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(o="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',n,'" y="',r,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',o,'"',"></image>\n"),this.stroke||this.strokeDashArray){var c=this.fill;this.fill=null,e.push("<rect ",'x="',n,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=c}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){var element=t?this._element:this._originalElement;return element?fabric.isLikelyNode?element._src:element.src:this.src||""},setSrc:function(t,e,n){fabric.util.loadImage(t,(function(img){return this.setElement(img,e,n)}),this,n&&n.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(t,e,n,r){if(e=e||this.filters,n=n||this._originalElement){var o,c,l=fabric.util.createImage(),h=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,f=this.minimumScaleTrigger/h,d=this;if(0===e.length)return this._element=n,t&&t(this),n;var v=fabric.util.createCanvasElement();return v.width=n.width,v.height=n.height,v.getContext("2d").drawImage(n,0,0,n.width,n.height),e.forEach((function(filter){filter&&(r?(o=d.scaleX<f?d.scaleX:1,c=d.scaleY<f?d.scaleY:1,o*h<1&&(o*=h),c*h<1&&(c*=h)):(o=filter.scaleX,c=filter.scaleY),filter.applyTo(v,o,c),r||"Resize"!==filter.type||(d.width*=filter.scaleX,d.height*=filter.scaleY))})),l.width=v.width,l.height=v.height,fabric.isLikelyNode?(l.src=v.toBuffer(void 0,fabric.Image.pngCompression),d._element=l,!r&&(d._filteredEl=l),t&&t(d)):(l.onload=function(){d._element=l,!r&&(d._filteredEl=l),t&&t(d),l.onload=v=null},l.src=v.toDataURL("image/png")),v}},_render:function(t,e){var n,r,o,c=this._findMargins();n=e?this.left:-this.width/2,r=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(n,r,this.width,this.height),t.clip()),!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,o=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):o=this._element,o&&t.drawImage(o,n+c.marginX,r+c.marginY,c.width,c.height),this._stroke(t),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,n=this.width,r=this.height,o=0,c=0;return"none"===this.alignX&&"none"===this.alignY||(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),n=this._element.width*e,r=this._element.height*e,"Mid"===this.alignX&&(o=(this.width-n)/2),"Max"===this.alignX&&(o=this.width-n),"Mid"===this.alignY&&(c=(this.height-r)/2),"Max"===this.alignY&&(c=this.height-r)),{width:n,height:r,marginX:o,marginY:c}},_resetWidthHeight:function(){var element=this.getElement();this.set("width",element.width),this.set("height",element.height)},_initElement:function(element,t,e){this.setElement(fabric.util.getById(element),e,t),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,(function(t){e&&e(t)}),"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height="height"in t?t.height:this.getElement()&&this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(object,t){fabric.util.loadImage(object.src,(function(img){fabric.Image.prototype._initFilters.call(object,object.filters,(function(e){object.filters=e||[],fabric.Image.prototype._initFilters.call(object,object.resizeFilters,(function(e){return object.resizeFilters=e||[],new fabric.Image(img,object,t)}))}))}),null,object.crossOrigin)},fabric.Image.fromURL=function(t,e,n){fabric.util.loadImage(t,(function(img){e&&e(new fabric.Image(img,n))}),null,n&&n.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(element,t,n){var r,o=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES);o.preserveAspectRatio&&(r=fabric.util.parsePreserveAspectRatioAttribute(o.preserveAspectRatio),e(o,r)),fabric.Image.fromURL(o["xlink:href"],t,e(n?fabric.util.object.clone(n):{},o))},fabric.Image.async=!0,fabric.Image.pngCompression=1}}(exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},n=(t=t||{}).onComplete||e,r=t.onChange||e,o=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){o.setAngle(t),r()},onComplete:function(){o.setCoords(),n()},onStart:function(){o.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(object){return object.straighten(),this.renderAll(),this},fxStraightenObject:function(object){return object.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Brightness=o(r.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),n=e.getImageData(0,0,t.width,t.height),data=n.data,r=this.brightness,i=0,o=data.length;i<o;i+=4)data[i]+=r,data[i+1]+=r,data[i+2]+=r;e.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(object){return new e.Image.filters.Brightness(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Convolute=o(r.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(t){for(var e,g,b,a,n,r,o,c,l,h=this.matrix,f=t.getContext("2d"),d=f.getImageData(0,0,t.width,t.height),v=Math.round(Math.sqrt(h.length)),m=Math.floor(v/2),y=d.data,_=d.width,x=d.height,output=f.createImageData(_,x),w=output.data,C=this.opaque?1:0,S=0;S<x;S++)for(var k=0;k<_;k++){n=4*(S*_+k),e=0,g=0,b=0,a=0;for(var O=0;O<v;O++)for(var E=0;E<v;E++)r=k+E-m,(o=S+O-m)<0||o>x||r<0||r>_||(c=4*(o*_+r),l=h[O*v+E],e+=y[c]*l,g+=y[c+1]*l,b+=y[c+2]*l,a+=y[c+3]*l);w[n]=e,w[n+1]=g,w[n+2]=b,w[n+3]=a+C*(255-a)}f.putImageData(output,0,0)},toObject:function(){return n(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(object){return new e.Image.filters.Convolute(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.GradientTransparency=o(r.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),n=e.getImageData(0,0,t.width,t.height),data=n.data,r=this.threshold,o=data.length,i=0,c=data.length;i<c;i+=4)data[i+3]=r+255*(o-i)/o;e.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(object){return new e.Image.filters.GradientTransparency(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.Image.filters,r=e.util.createClass;n.Grayscale=r(n.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=r.width*r.height*4,c=0;c<o;)e=(data[c]+data[c+1]+data[c+2])/3,data[c]=e,data[c+1]=e,data[c+2]=e,c+=4;n.putImageData(r,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.Image.filters,r=e.util.createClass;n.Invert=r(n.BaseFilter,{type:"Invert",applyTo:function(t){var i,e=t.getContext("2d"),n=e.getImageData(0,0,t.width,t.height),data=n.data,r=data.length;for(i=0;i<r;i+=4)data[i]=255-data[i],data[i+1]=255-data[i+1],data[i+2]=255-data[i+2];e.putImageData(n,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Mask=o(r.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=[0,1,2,3].indexOf(t.channel)>-1?t.channel:0},applyTo:function(t){if(this.mask){var i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=this.mask.getElement(),c=e.util.createCanvasElement(),l=this.channel,h=r.width*r.height*4;c.width=t.width,c.height=t.height,c.getContext("2d").drawImage(o,0,0,t.width,t.height);var f=c.getContext("2d").getImageData(0,0,t.width,t.height).data;for(i=0;i<h;i+=4)data[i+3]=f[i+l];n.putImageData(r,0,0)}},toObject:function(){return n(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),e.Image.filters.Mask.fromObject=function(object,t){e.util.loadImage(object.mask.src,(function(img){object.mask=new e.Image(img,object.mask),t&&t(new e.Image.filters.Mask(object))}))},e.Image.filters.Mask.async=!0}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Noise=o(r.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=this.noise,i=0,c=data.length;i<c;i+=4)e=(.5-Math.random())*o,data[i]+=e,data[i+1]+=e,data[i+2]+=e;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(object){return new e.Image.filters.Noise(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Pixelate=o(r.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,n,r,g,b,a,o=t.getContext("2d"),c=o.getImageData(0,0,t.width,t.height),data=c.data,l=c.height,h=c.width;for(i=0;i<l;i+=this.blocksize)for(n=0;n<h;n+=this.blocksize){r=data[e=4*i*h+4*n],g=data[e+1],b=data[e+2],a=data[e+3];for(var f=i,d=i+this.blocksize;f<d;f++)for(var v=n,m=n+this.blocksize;v<m;v++)data[e=4*f*h+4*v]=r,data[e+1]=g,data[e+2]=b,data[e+3]=a}o.putImageData(c,0,0)},toObject:function(){return n(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(object){return new e.Image.filters.Pixelate(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.RemoveWhite=o(r.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,g,b,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=this.threshold,c=this.distance,l=255-o,h=Math.abs,i=0,f=data.length;i<f;i+=4)e=data[i],g=data[i+1],b=data[i+2],e>l&&g>l&&b>l&&h(e-g)<c&&h(e-b)<c&&h(g-b)<c&&(data[i+3]=0);n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(object){return new e.Image.filters.RemoveWhite(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.Image.filters,r=e.util.createClass;n.Sepia=r(n.BaseFilter,{type:"Sepia",applyTo:function(t){var i,e,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=data.length;for(i=0;i<o;i+=4)e=.3*data[i]+.59*data[i+1]+.11*data[i+2],data[i]=e+100,data[i+1]=e+50,data[i+2]=e+255;n.putImageData(r,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.Image.filters,r=e.util.createClass;n.Sepia2=r(n.BaseFilter,{type:"Sepia2",applyTo:function(t){var i,e,g,b,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=data.length;for(i=0;i<o;i+=4)e=data[i],g=data[i+1],b=data[i+2],data[i]=(.393*e+.769*g+.189*b)/1.351,data[i+1]=(.349*e+.686*g+.168*b)/1.203,data[i+2]=(.272*e+.534*g+.131*b)/2.14;n.putImageData(r,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Tint=o(r.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new e.Color(this.color).getAlpha()},applyTo:function(t){var i,n,r,o,c,g,b,l,source,h=t.getContext("2d"),f=h.getImageData(0,0,t.width,t.height),data=f.data,d=data.length;for(n=(source=new e.Color(this.color).getSource())[0]*this.opacity,r=source[1]*this.opacity,o=source[2]*this.opacity,l=1-this.opacity,i=0;i<d;i+=4)c=data[i],g=data[i+1],b=data[i+2],data[i]=n+c*l,data[i+1]=r+g*l,data[i+2]=o+b*l;h.putImageData(f,0,0)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),e.Image.filters.Tint.fromObject=function(object){return new e.Image.filters.Tint(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Multiply=o(r.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var i,source,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=data.length;for(source=new e.Color(this.color).getSource(),i=0;i<o;i+=4)data[i]*=source[0]/255,data[i+1]*=source[1]/255,data[i+2]*=source[2]/255;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color})}}),e.Image.filters.Multiply.fromObject=function(object){return new e.Image.filters.Multiply(object)}}(exports),function(t){"use strict";var e=t.fabric,n=e.Image.filters,r=e.util.createClass;n.Blend=r(n.BaseFilter,{type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var tr,n,r,o,g,b,c,l,h,source,f=t.getContext("2d"),d=f.getImageData(0,0,t.width,t.height),data=d.data,v=!1;if(this.image){v=!0;var m=e.util.createCanvasElement();m.width=this.image.width,m.height=this.image.height;var y=new e.StaticCanvas(m);y.add(this.image),source=y.getContext("2d").getImageData(0,0,y.width,y.height).data}else tr=(source=new e.Color(this.color).getSource())[0]*this.alpha,n=source[1]*this.alpha,r=source[2]*this.alpha;for(var i=0,_=data.length;i<_;i+=4)switch(o=data[i],g=data[i+1],b=data[i+2],v&&(tr=source[i]*this.alpha,n=source[i+1]*this.alpha,r=source[i+2]*this.alpha),this.mode){case"multiply":data[i]=o*tr/255,data[i+1]=g*n/255,data[i+2]=b*r/255;break;case"screen":data[i]=1-(1-o)*(1-tr),data[i+1]=1-(1-g)*(1-n),data[i+2]=1-(1-b)*(1-r);break;case"add":data[i]=Math.min(255,o+tr),data[i+1]=Math.min(255,g+n),data[i+2]=Math.min(255,b+r);break;case"diff":case"difference":data[i]=Math.abs(o-tr),data[i+1]=Math.abs(g-n),data[i+2]=Math.abs(b-r);break;case"subtract":c=o-tr,l=g-n,h=b-r,data[i]=c<0?0:c,data[i+1]=l<0?0:l,data[i+2]=h<0?0:h;break;case"darken":data[i]=Math.min(o,tr),data[i+1]=Math.min(g,n),data[i+2]=Math.min(b,r);break;case"lighten":data[i]=Math.max(o,tr),data[i+1]=Math.max(g,n),data[i+2]=Math.max(b,r)}f.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.Blend.fromObject=function(object){return new e.Image.filters.Blend(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=Math.pow,r=Math.floor,o=Math.sqrt,c=Math.abs,l=Math.max,h=Math.round,f=Math.sin,d=Math.ceil,v=e.Image.filters,m=e.util.createClass;v.Resize=m(v.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,n){if(1!==e||1!==n){this.rcpScaleX=1/e,this.rcpScaleY=1/n;var r,o=t.width,c=t.height,l=h(o*e),f=h(c*n);"sliceHack"===this.resizeType&&(r=this.sliceByTwo(t,o,c,l,f)),"hermite"===this.resizeType&&(r=this.hermiteFastResize(t,o,c,l,f)),"bilinear"===this.resizeType&&(r=this.bilinearFiltering(t,o,c,l,f)),"lanczos"===this.resizeType&&(r=this.lanczosResize(t,o,c,l,f)),t.width=l,t.height=f,t.getContext("2d").putImageData(r,0,0)}},sliceByTwo:function(t,n,o,c,h){var f,d=t.getContext("2d"),v=.5,m=.5,y=1,_=1,x=!1,w=!1,C=n,S=o,k=e.util.createCanvasElement(),O=k.getContext("2d");for(c=r(c),h=r(h),k.width=l(c,n),k.height=l(h,o),c>n&&(v=2,y=-1),h>o&&(m=2,_=-1),f=d.getImageData(0,0,n,o),t.width=l(c,n),t.height=l(h,o),d.putImageData(f,0,0);!x||!w;)n=C,o=S,c*y<r(C*v*y)?C=r(C*v):(C=c,x=!0),h*_<r(S*m*_)?S=r(S*m):(S=h,w=!0),f=d.getImageData(0,0,n,o),O.putImageData(f,0,0),d.clearRect(0,0,C,S),d.drawImage(k,0,0,n,o,0,0,C,S);return d.getImageData(0,0,c,h)},lanczosResize:function(t,e,l,h,v){var m,y=t.getContext("2d"),_=y.getImageData(0,0,e,l),x=y.getImageData(0,0,h,v),w=_.data,C=x.data,S=(m=this.lanczosLobes,function(t){if(t>m)return 0;if(t*=Math.PI,c(t)<1e-16)return 1;var e=t/m;return f(t)*f(e)/t/e}),k=this.rcpScaleX,O=this.rcpScaleY,E=2/this.rcpScaleX,T=2/this.rcpScaleY,j=d(k*this.lanczosLobes/2),M=d(O*this.lanczosLobes/2),P={},A={},I={};return function t(u){var f,i,d,m,a,y,_,D,L,R,B;for(A.x=(u+.5)*k,I.x=r(A.x),f=0;f<v;f++){for(A.y=(f+.5)*O,I.y=r(A.y),a=0,y=0,_=0,D=0,L=0,i=I.x-j;i<=I.x+j;i++)if(!(i<0||i>=e)){R=r(1e3*c(i-A.x)),P[R]||(P[R]={});for(var F=I.y-M;F<=I.y+M;F++)F<0||F>=l||(B=r(1e3*c(F-A.y)),P[R][B]||(P[R][B]=S(o(n(R*E,2)+n(B*T,2))/1e3)),(d=P[R][B])>0&&(a+=d,y+=d*w[m=4*(F*e+i)],_+=d*w[m+1],D+=d*w[m+2],L+=d*w[m+3]))}C[m=4*(f*h+u)]=y/a,C[m+1]=_/a,C[m+2]=D/a,C[m+3]=L/a}return++u<h?t(u):x}(0)},bilinearFiltering:function(t,e,n,o,c){var l,h,i,f,d,v,m,y,_,x=0,w=this.rcpScaleX,C=this.rcpScaleY,S=t.getContext("2d"),k=4*(e-1),O=S.getImageData(0,0,e,n).data,E=S.getImageData(0,0,o,c),T=E.data;for(i=0;i<c;i++)for(f=0;f<o;f++)for(d=w*f-(l=r(w*f)),v=C*i-(h=r(C*i)),_=4*(h*e+l),m=0;m<4;m++)y=O[_+m]*(1-d)*(1-v)+O[_+4+m]*d*(1-v)+O[_+k+m]*v*(1-d)+O[_+k+4+m]*d*v,T[x++]=y;return E},hermiteFastResize:function(t,e,n,l,h){for(var f=this.rcpScaleX,v=this.rcpScaleY,m=d(f/2),y=d(v/2),_=t.getContext("2d"),data=_.getImageData(0,0,e,n).data,x=_.getImageData(0,0,l,h),w=x.data,C=0;C<h;C++)for(var i=0;i<l;i++){for(var S=4*(i+C*l),k=0,O=0,E=0,T=0,j=0,M=0,P=0,A=(C+.5)*v,I=r(C*v);I<(C+1)*v;I++)for(var D=c(A-(I+.5))/y,L=(i+.5)*f,R=D*D,B=r(i*f);B<(i+1)*f;B++){var F=c(L-(B+.5))/m,N=o(R+F*F);N>1&&N<-1||(k=2*N*N*N-3*N*N+1)>0&&(P+=k*data[(F=4*(B+I*e))+3],E+=k,data[F+3]<255&&(k=k*data[F+3]/250),T+=k*data[F],j+=k*data[F+1],M+=k*data[F+2],O+=k)}w[S]=T/O,w[S+1]=j/O,w[S+2]=M/O,w[S+3]=P/E}return x},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=function(object){return new e.Image.filters.Resize(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.ColorMatrix=o(r.BaseFilter,{type:"ColorMatrix",initialize:function(t){t||(t={}),this.matrix=t.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(t){var i,e,g,b,a,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=data.length,c=this.matrix;for(i=0;i<o;i+=4)e=data[i],g=data[i+1],b=data[i+2],a=data[i+3],data[i]=e*c[0]+g*c[1]+b*c[2]+a*c[3]+c[4],data[i+1]=e*c[5]+g*c[6]+b*c[7]+a*c[8]+c[9],data[i+2]=e*c[10]+g*c[11]+b*c[12]+a*c[13]+c[14],data[i+3]=e*c[15]+g*c[16]+b*c[17]+a*c[18]+c[19];n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),e.Image.filters.ColorMatrix.fromObject=function(object){return new e.Image.filters.ColorMatrix(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Contrast=o(r.BaseFilter,{type:"Contrast",initialize:function(t){t=t||{},this.contrast=t.contrast||0},applyTo:function(t){for(var e=t.getContext("2d"),n=e.getImageData(0,0,t.width,t.height),data=n.data,r=259*(this.contrast+255)/(255*(259-this.contrast)),i=0,o=data.length;i<o;i+=4)data[i]=r*(data[i]-128)+128,data[i+1]=r*(data[i+1]-128)+128,data[i+2]=r*(data[i+2]-128)+128;e.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{contrast:this.contrast})}}),e.Image.filters.Contrast.fromObject=function(object){return new e.Image.filters.Contrast(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.extend,r=e.Image.filters,o=e.util.createClass;r.Saturate=o(r.BaseFilter,{type:"Saturate",initialize:function(t){t=t||{},this.saturate=t.saturate||0},applyTo:function(t){for(var e,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),data=r.data,o=.01*-this.saturate,i=0,c=data.length;i<c;i+=4)e=Math.max(data[i],data[i+1],data[i+2]),data[i]+=e!==data[i]?(e-data[i])*o:0,data[i+1]+=e!==data[i+1]?(e-data[i+1])*o:0,data[i+2]+=e!==data[i+2]?(e-data[i+2])*o:0;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{saturate:this.saturate})}}),e.Image.filters.Saturate.fromObject=function(object){return new e.Image.filters.Saturate(object)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.clone,r=e.util.toFixed,o=e.Object.NUM_FRACTION_DIGITS;if(e.Text)e.warn("fabric.Text is already defined");else{var c=e.Object.prototype.stateProperties.concat();c.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,text:!0,charSpacing:!0,textAlign:!0,strokeWidth:!1},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:c,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(text,t){t=t||{},this.text=text,this.__skipDimension=!0,this.setOptions(t),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(t)||this.cursorWidth||2,this.height=this._getTextHeight(t))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this.clipTo&&e.util.clipContext(this,t),this._setOpacity(t),this._setShadow(t),this._setupCompositeOperation(t),this._renderTextBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this._renderText(t),this._renderTextDecoration(t),this.clipTo&&t.restore()},_renderText:function(t){this._renderTextFill(t),this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic",t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,n=this._textLines.length;i<n;i++){var r=this._getLineWidth(t,i);r>e&&(e=r)}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,n,r,o){var c,l,h=t.slice(0,-4);if(this[h].toLive){var f=-this.width/2+this[h].offsetX||0,d=-this.height/2+this[h].offsetY||0;e.save(),e.translate(f,d),r-=f,o-=d}if(0!==this.charSpacing)for(var v=this._getWidthOfCharSpacing(),i=0,m=(n=n.split("")).length;i<m;i++)c=n[i],l=e.measureText(c).width+v,e[t](c,r,o),r+=l>0?l:0;else e[t](n,r,o);this[h].toLive&&e.restore()},_renderTextLine:function(t,e,line,n,r,o){r-=this.fontSize*this._fontSizeFraction;var c=this._getLineWidth(e,o);if("justify"!==this.textAlign||this.width<c)this._renderChars(t,e,line,n,r,o);else for(var l,h=line.split(/\s+/),f=0,d=this._getWidthOfWords(e,h.join(" "),o,0),v=this.width-d,m=h.length-1,y=m>0?v/m:0,_=0,i=0,x=h.length;i<x;i++){for(;" "===line[f]&&f<line.length;)f++;l=h[i],this._renderChars(t,e,l,n+_,r,o,f),_+=this._getWidthOfWords(e,l,o,f)+y,f+=l.length}},_getWidthOfWords:function(t,e){var n=t.measureText(e).width;return 0!==this.charSpacing&&(n+=e.split("").length*this._getWidthOfCharSpacing()),n>0?n:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(t,e){for(var n=0,r=this._getLeftOffset(),o=this._getTopOffset(),i=0,c=this._textLines.length;i<c;i++){var l=this._getHeightOfLine(t,i),h=l/this.lineHeight,f=this._getLineWidth(t,i),d=this._getLineLeftOffset(f);this._renderTextLine(e,t,this._textLines[i],r+d,o+n+h,i),n+=l}},_renderTextFill:function(t){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokedashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextBackground:function(t){this._renderBackground(t),this._renderTextLinesBackground(t)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor){var e,n,r,o=0;t.fillStyle=this.textBackgroundColor;for(var i=0,c=this._textLines.length;i<c;i++)e=this._getHeightOfLine(t,i),(n=this._getLineWidth(t,i))>0&&(r=this._getLineLeftOffset(n),t.fillRect(this._getLeftOffset()+r,this._getTopOffset()+o,n,e/this.lineHeight)),o+=e;this._removeShadow(t)}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearCache:function(){var t=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var e in this._dimensionAffectingProps)this["__"+e]!==this[e]&&(this["__"+e]=this[e],t=!0);return t},_getLineWidth:function(t,e){if(this.__lineWidths[e])return-1===this.__lineWidths[e]?this.width:this.__lineWidths[e];var n,line=this._textLines[e];return n=""===line?0:this._measureLine(t,e),this.__lineWidths[e]=n,n&&"justify"===this.textAlign&&line.split(/\s+/).length>1&&(this.__lineWidths[e]=-1),n},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(t,e){var n,line=this._textLines[e],r=t.measureText(line).width,o=0;return 0!==this.charSpacing&&(o=(line.split("").length-1)*this._getWidthOfCharSpacing()),(n=r+o)>0?n:0},_renderTextDecoration:function(t){if(this.textDecoration){var e=this.height/2,n=this,r=[];this.textDecoration.indexOf("underline")>-1&&r.push(.85),this.textDecoration.indexOf("line-through")>-1&&r.push(.43),this.textDecoration.indexOf("overline")>-1&&r.push(-.12),r.length>0&&function(r){var i,o,c,l,h,f,d,v=0;for(i=0,o=n._textLines.length;i<o;i++){for(h=n._getLineWidth(t,i),f=n._getLineLeftOffset(h),d=n._getHeightOfLine(t,i),c=0,l=r.length;c<l;c++)t.fillRect(n._getLeftOffset()+f,v+(n._fontSizeMult-1+r[c])*n.fontSize-e,h,n.fontSize/15);v+=d}}(r)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(t.save(),this._setTextStyles(t),this._shouldClearCache()&&this._initDimensions(t),this.drawSelectionBackground(t),e||this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._render(t),t.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(t);return this.callSuper("toObject",e)},toSVG:function(t){this.ctx||(this.ctx=e.util.createCanvasElement().getContext("2d"));var n=this._createBaseSVGMarkup(),r=this._getSVGLeftTopOffsets(this.ctx),o=this._getSVGTextAndBg(r.textTop,r.textLeft);return this._wrapSVGTextAndBg(n,o),t?t(n.join("")):n.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){var filter=this.getSvgFilter(),style=""===filter?"":' style="'+filter+'"';t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',style,">\n",e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',e.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var n=[],r=[],o=0;this._setSVGBg(r);for(var i=0,c=this._textLines.length;i<c;i++)this.textBackgroundColor&&this._setSVGTextLineBg(r,i,e,t,o),this._setSVGTextLineText(i,n,o,e,t,r),o+=this._getHeightOfLine(this.ctx,i);return{textSpans:n,textBgRects:r}},_setSVGTextLineText:function(i,t,n,c,l){var h=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-l+n-this.height/2;"justify"!==this.textAlign?t.push('\t\t\t<tspan x="',r(c+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),o),'" ','y="',r(h,o),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[i]),"</tspan>\n"):this._setSVGTextLineJustifed(i,t,h,c)},_setSVGTextLineJustifed:function(i,t,n,c){var l=e.util.createCanvasElement().getContext("2d");this._setTextStyles(l);var h,f,d=this._textLines[i].split(/\s+/),v=this._getWidthOfWords(l,d.join("")),m=this.width-v,y=d.length-1,_=y>0?m/y:0,x=this._getFillAttributes(this.fill);for(c+=this._getLineLeftOffset(this._getLineWidth(l,i)),i=0,f=d.length;i<f;i++)h=d[i],t.push('\t\t\t<tspan x="',r(c,o),'" ','y="',r(n,o),'" ',x,">",e.util.string.escapeXml(h),"</tspan>\n"),c+=this._getWidthOfWords(l,h)+_},_setSVGTextLineBg:function(t,i,e,n,c){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',r(e+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),o),'" y="',r(c-this.height/2,o),'" width="',r(this._getLineWidth(this.ctx,i),o),'" height="',r(this._getHeightOfLine(this.ctx,i)/this.lineHeight,o),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,o),'" y="',r(-this.height/2,o),'" width="',r(this.width,o),'" height="',r(this.height,o),'"></rect>\n')},_getFillAttributes:function(t){var n=t&&"string"==typeof t?new e.Color(t):"";return n&&n.getSource()&&1!==n.getAlpha()?'opacity="'+n.getAlpha()+'" fill="'+n.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(element,t){if(!element)return null;var n=e.parseAttributes(element,e.Text.ATTRIBUTE_NAMES);(t=e.util.object.extend(t?e.util.object.clone(t):{},n)).top=t.top||0,t.left=t.left||0,"dx"in n&&(t.left+=n.dx),"dy"in n&&(t.top+=n.dy),"fontSize"in t||(t.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE),t.originX||(t.originX="left");var r="";"textContent"in element?r=element.textContent:"firstChild"in element&&null!==element.firstChild&&"data"in element.firstChild&&null!==element.firstChild.data&&(r=element.firstChild.data),r=r.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var text=new e.Text(r,t),o=text.getHeight()/text.height,c=((text.height+text.strokeWidth)*text.lineHeight-text.height)*o,l=text.getHeight()+c,h=0;return"left"===text.originX&&(h=text.getWidth()/2),"right"===text.originX&&(h=-text.getWidth()/2),text.set({left:text.getLeft()+h,top:text.getTop()-l/2+text.fontSize*(.18+text._fontSizeFraction)/text.lineHeight}),text},e.Text.fromObject=function(object,t){var text=new e.Text(object.text,n(object));return t&&t(text),text},e.util.createAccessors(e.Text)}}(exports),clone=fabric.util.object.clone,fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(text,t){this.styles=t&&t.styles||{},this.callSuper("initialize",text,t),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var n in t[e])for(var r in t[e][n])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(t,e){if(2===arguments.length){for(var n=[],i=t;i<e;i++)n.push(this.getSelectionStyles(i));return n}var r=this.get2DCursorLocation(t),style=this._getStyleDeclaration(r.lineIndex,r.charIndex);return style||{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var i=this.selectionStart;i<this.selectionEnd;i++)this._extendStyles(i,t);return this._forceClearCache=!0,this},_extendStyles:function(t,e){var n=this.get2DCursorLocation(t);this._getLineStyle(n.lineIndex)||this._setLineStyle(n.lineIndex,{}),this._getStyleDeclaration(n.lineIndex,n.charIndex)||this._setStyleDeclaration(n.lineIndex,n.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(n.lineIndex,n.charIndex),e)},render:function(t,e){this.clearContextTop(),this.callSuper("render",t,e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.cursorOffsetCache={},this.renderCursorOrSelection()},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop;t.save(),t.transform.apply(t,this.canvas.viewportTransform),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),t.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var t,e,n=this.text.split("");this.canvas&&this.canvas.contextTop?((e=this.canvas.contextTop).save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e)):(e=this.ctx).save(),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(n,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(n,"selection"),this.renderSelection(n,t,e)),e.restore()}},_clearTextArea:function(t){var e=this.width+4,n=this.height+4;t.clearRect(-e/2,-n/2,e,n)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0;i<e;i++){if(t<=this._textLines[i].length)return{lineIndex:i,charIndex:t};t-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<t?this._textLines[i-1].length:t}},getCurrentCharStyle:function(t,e){var style=this._getStyleDeclaration(t,0===e?0:e-1);return{fontSize:style&&style.fontSize||this.fontSize,fill:style&&style.fill||this.fill,textBackgroundColor:style&&style.textBackgroundColor||this.textBackgroundColor,textDecoration:style&&style.textDecoration||this.textDecoration,fontFamily:style&&style.fontFamily||this.fontFamily,fontWeight:style&&style.fontWeight||this.fontWeight,fontStyle:style&&style.fontStyle||this.fontStyle,stroke:style&&style.stroke||this.stroke,strokeWidth:style&&style.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){var style=this._getStyleDeclaration(t,0===e?0:e-1);return style&&style.fontSize?style.fontSize:this.fontSize},getCurrentCharColor:function(t,e){var style=this._getStyleDeclaration(t,0===e?0:e-1);return style&&style.fill?style.fill:this.cursorColor},_getCursorBoundaries:function(t,e){var n=Math.round(this._getLeftOffset()),r=this._getTopOffset(),o=this._getCursorBoundariesOffsets(t,e);return{left:n,top:r,leftOffset:o.left+o.lineLeft,topOffset:o.top}},_getCursorBoundariesOffsets:function(t,e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var n,r=0,o=0,c=0,l=0,h=0,i=0;i<this.selectionStart;i++)"\n"===t[i]?(h=0,l+=this._getHeightOfLine(this.ctx,o),o++,c=0):(h+=this._getWidthOfChar(this.ctx,t[i],o,c),c++),r=this._getLineLeftOffset(this._getLineWidth(this.ctx,o));return"cursor"===e&&(l+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,o)/this.lineHeight-this.getCurrentCharFontSize(o,c)*(1-this._fontSizeFraction)),0!==this.charSpacing&&c===this._textLines[o].length&&(h-=this._getWidthOfCharSpacing()),n={top:l,left:h>0?h:0,lineLeft:r},this.cursorOffsetCache=n,this.cursorOffsetCache},renderCursor:function(t,e){var n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex,c=this.getCurrentCharFontSize(r,o),l=0===r&&0===o?this._getLineLeftOffset(this._getLineWidth(e,r)):t.leftOffset,h=this.scaleX*this.canvas.getZoom(),f=this.cursorWidth/h;e.fillStyle=this.getCurrentCharColor(r,o),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+l-f/2,t.top+t.topOffset,f,c)},renderSelection:function(t,e,n){n.fillStyle=this.selectionColor;for(var r=this.get2DCursorLocation(this.selectionStart),o=this.get2DCursorLocation(this.selectionEnd),c=r.lineIndex,l=o.lineIndex,i=c;i<=l;i++){var h,f=this._getLineLeftOffset(this._getLineWidth(n,i))||0,d=this._getHeightOfLine(this.ctx,i),v=0,line=this._textLines[i];if(i===c){for(var m=0,y=line.length;m<y;m++)m>=r.charIndex&&(i!==l||m<o.charIndex)&&(v+=this._getWidthOfChar(n,line[m],i,m)),m<r.charIndex&&(f+=this._getWidthOfChar(n,line[m],i,m));m===line.length&&(v-=this._getWidthOfCharSpacing())}else if(i>c&&i<l)v+=this._getLineWidth(n,i)||5;else if(i===l){for(var _=0,x=o.charIndex;_<x;_++)v+=this._getWidthOfChar(n,line[_],i,_);o.charIndex===line.length&&(v-=this._getWidthOfCharSpacing())}h=d,(this.lineHeight<1||i===l&&this.lineHeight>1)&&(d/=this.lineHeight),n.fillRect(e.left+f,e.top+e.topOffset,v>0?v:0,d),e.topOffset+=h}},_renderChars:function(t,e,line,n,r,o,c){if(this.isEmptyStyles())return this._renderCharsFast(t,e,line,n,r);c=c||0;var l,h,f=this._getHeightOfLine(e,o),d="";e.save(),r-=f/this.lineHeight*this._fontSizeFraction;for(var i=c,v=line.length+c;i<=v;i++)l=l||this.getCurrentCharStyle(o,i),h=this.getCurrentCharStyle(o,i+1),(this._hasStyleChanged(l,h)||i===v)&&(this._renderChar(t,e,o,i-1,d,n,r,f),d="",l=h),d+=line[i-c];e.restore()},_renderCharsFast:function(t,e,line,n,r){"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,line,n,r),"strokeText"===t&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,line,n,r)},_renderChar:function(t,e,n,i,r,o,c,l){var h,f,d,v,m,y,_,x,w,C=this._getStyleDeclaration(n,i);if(C?(f=this._getHeightOfChar(e,r,n,i),v=C.stroke,d=C.fill,y=C.textDecoration):f=this.fontSize,v=(v||this.stroke)&&"strokeText"===t,d=(d||this.fill)&&"fillText"===t,C&&e.save(),h=this._applyCharStylesGetWidth(e,r,n,i,C||null),y=y||this.textDecoration,C&&C.textBackgroundColor&&this._removeShadow(e),0!==this.charSpacing){x=this._getWidthOfCharSpacing(),h=0;for(var S,k=0,O=(_=r.split("")).length;k<O;k++)S=_[k],d&&e.fillText(S,o+h,c),v&&e.strokeText(S,o+h,c),h+=(w=e.measureText(S).width+x)>0?w:0}else d&&e.fillText(r,o,c),v&&e.strokeText(r,o,c);(y||""!==y)&&(m=this._fontSizeFraction*l/this.lineHeight,this._renderCharDecoration(e,y,o,c,m,h,f)),C&&e.restore(),e.translate(h,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,n,r,o,c,l){if(e){var i,h,f=l/15,d={underline:r+l/10,"line-through":r-l*(this._fontSizeFraction+this._fontSizeMult-1)+f,overline:r-(this._fontSizeMult-this._fontSizeFraction)*l},v=["underline","line-through","overline"];for(i=0;i<v.length;i++)h=v[i],e.indexOf(h)>-1&&t.fillRect(n,d[h],c,f)}},_renderTextLine:function(t,e,line,n,r,o){this.isEmptyStyles()||(r+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,line,n,r,o)},_renderTextDecoration:function(t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",t)},_renderTextLinesBackground:function(t){this.callSuper("_renderTextLinesBackground",t);for(var e,n,r,line,o,style,c=0,l=this._getLeftOffset(),h=this._getTopOffset(),i=0,f=this._textLines.length;i<f;i++)if(e=this._getHeightOfLine(t,i),""!==(line=this._textLines[i])&&this.styles&&this._getLineStyle(i)){n=this._getLineWidth(t,i),r=this._getLineLeftOffset(n);for(var d=0,v=line.length;d<v;d++)(style=this._getStyleDeclaration(i,d))&&style.textBackgroundColor&&(o=line[d],t.fillStyle=style.textBackgroundColor,t.fillRect(l+r+this._getWidthOfCharsAt(t,i,d),h+c,this._getWidthOfChar(t,o,i,d),e/this.lineHeight));c+=e}else c+=e},_getCacheProp:function(t,e){return t+e.fontSize+e.fontWeight+e.fontStyle},_getFontCache:function(t){return fabric.charWidthsCache[t]||(fabric.charWidthsCache[t]={}),fabric.charWidthsCache[t]},_applyCharStylesGetWidth:function(t,e,n,r,o){var c,l,h,f=o||this._getStyleDeclaration(n,r),d=clone(f);if(this._applyFontStyles(d),h=this._getFontCache(d.fontFamily),l=this._getCacheProp(e,d),!f&&h[l]&&this.caching)return h[l];"string"==typeof d.shadow&&(d.shadow=new fabric.Shadow(d.shadow));var v=d.fill||this.fill;return t.fillStyle=v.toLive?v.toLive(t,this):v,d.stroke&&(t.strokeStyle=d.stroke&&d.stroke.toLive?d.stroke.toLive(t,this):d.stroke),t.lineWidth=d.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(d),d.shadow&&(d.scaleX=this.scaleX,d.scaleY=this.scaleY,d.canvas=this.canvas,d.getObjectScaling=this.getObjectScaling,this._setShadow.call(d,t)),this.caching&&h[l]?h[l]:(c=t.measureText(e).width,this.caching&&(h[l]=c),c)},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,e,n){return n?this.styles[t]&&this.styles[t][e]?clone(this.styles[t][e]):{}:this.styles[t]&&this.styles[t][e]?this.styles[t][e]:null},_setStyleDeclaration:function(t,e,style){this.styles[t][e]=style},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,style){this.styles[t]=style},_deleteLineStyle:function(t){delete this.styles[t]},_getWidthOfChar:function(t,e,n,r){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(e))return this._getWidthOfSpace(t,n);t.save();var o=this._applyCharStylesGetWidth(t,e,n,r);return 0!==this.charSpacing&&(o+=this._getWidthOfCharSpacing()),t.restore(),o>0?o:0},_getHeightOfChar:function(t,e,n){var style=this._getStyleDeclaration(e,n);return style&&style.fontSize?style.fontSize:this.fontSize},_getWidthOfCharsAt:function(t,e,n){var i,r,o=0;for(i=0;i<n;i++)r=this._textLines[e][i],o+=this._getWidthOfChar(t,r,e,i);return o},_measureLine:function(t,e){this._isMeasuring=!0;var n=this._getWidthOfCharsAt(t,e,this._textLines[e].length);return 0!==this.charSpacing&&(n-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,n>0?n:0},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var line=this._textLines[e],n=this._getWidthOfWords(t,line,e,0),r=this.width-n,o=line.length-line.replace(this._reSpacesAndTabs,"").length,c=Math.max(r/o,t.measureText(" ").width);return this.__widthOfSpace[e]=c,c},_getWidthOfWords:function(t,line,e,n){for(var r=0,o=0;o<line.length;o++){var c=line[o];c.match(/\s/)||(r+=this._getWidthOfChar(t,c,e,o+n))}return r},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var line=this._textLines[e],n=this._getHeightOfChar(t,e,0),i=1,r=line.length;i<r;i++){var o=this._getHeightOfChar(t,e,i);o>n&&(n=o)}return this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e,n=0,i=0,r=this._textLines.length;i<r;i++)e=this._getHeightOfLine(t,i),n+=i===r-1?e/this.lineHeight:e;return n},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:clone(this.styles,!0)})}}),fabric.IText.fromObject=function(object,t){var e=new fabric.IText(object.text,clone(object));return t&&t(e),e},function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",(function(){var t=this;setTimeout((function(){t.selected=!0}),100)}))},initAddedHandler:function(){var t=this;this.on("added",(function(){var canvas=t.canvas;canvas&&(canvas._hasITextHandlers||(canvas._hasITextHandlers=!0,t._initCanvasHandlers(canvas)),canvas._iTextInstances=canvas._iTextInstances||[],canvas._iTextInstances.push(t))}))},initRemovedHandler:function(){var t=this;this.on("removed",(function(){var canvas=t.canvas;canvas&&(canvas._iTextInstances=canvas._iTextInstances||[],fabric.util.removeFromArray(canvas._iTextInstances,t),0===canvas._iTextInstances.length&&(canvas._hasITextHandlers=!1,t._removeCanvasHandlers(canvas)))}))},_initCanvasHandlers:function(canvas){canvas._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(canvas)}.bind(this),canvas._mouseUpITextHandler=function(){canvas._iTextInstances&&canvas._iTextInstances.forEach((function(t){t.__isMousedown=!1}))}.bind(this),canvas.on("selection:cleared",canvas._canvasITextSelectionClearedHanlder),canvas.on("object:selected",canvas._canvasITextSelectionClearedHanlder),canvas.on("mouse:up",canvas._mouseUpITextHandler)},_removeCanvasHandlers:function(canvas){canvas.off("selection:cleared",canvas._canvasITextSelectionClearedHanlder),canvas.off("object:selected",canvas._canvasITextSelectionClearedHanlder),canvas.off("mouse:up",canvas._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,n,r){var o;return o={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:n,onComplete:function(){o.isAborted||t[r]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return o.isAborted}}),o},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout((function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")}),100)},initDelayedCursor:function(t){var e=this,n=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout((function(){e._tick()}),n)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,n=t-1;if(this._reSpace.test(this.text.charAt(n)))for(;this._reSpace.test(this.text.charAt(n));)e++,n--;for(;/\S/.test(this.text.charAt(n))&&n>-1;)e++,n--;return t-e},findWordBoundaryRight:function(t){var e=0,n=t;if(this._reSpace.test(this.text.charAt(n)))for(;this._reSpace.test(this.text.charAt(n));)e++,n++;for(;/\S/.test(this.text.charAt(n))&&n<this.text.length;)e++,n++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,n=t-1;!/\n/.test(this.text.charAt(n))&&n>-1;)e++,n--;return t-e},findLineBoundaryRight:function(t){for(var e=0,n=t;!/\n/.test(this.text.charAt(n))&&n<this.text.length;)e++,n++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.length;i<n;i++)"\n"===t[i]&&e++;return e},searchWordBoundary:function(t,e){for(var n=this._reSpace.test(this.text.charAt(t))?t-1:t,r=this.text.charAt(n),o=/[ \n\.,;!\?\-]/;!o.test(r)&&n>0&&n<this.text.length;)n+=e,r=this.text.charAt(n);return o.test(r)&&"\n"!==r&&(n+=1===e?0:1),n},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),n=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),n=this.findLineBoundaryRight(t);this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll(),this):this},exitEditingOnOthers:function(canvas){canvas._iTextInstances&&canvas._iTextInstances.forEach((function(t){t.selected=!1,t.isEditing&&t.exitEditing()}))},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),n=this.selectionStart,r=this.selectionEnd;e!==this.__selectionStartOnMouseDown&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===n&&this.selectionEnd===r||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var style=this._calcTextareaPosition();this.hiddenTextarea.style.left=style.left,this.hiddenTextarea.style.top=style.top,this.hiddenTextarea.style.fontSize=style.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.text.split(""),e=this._getCursorBoundaries(t,"cursor"),n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex,c=this.getCurrentCharFontSize(r,o),l=0===r&&0===o?this._getLineLeftOffset(this._getLineWidth(this.ctx,r)):e.leftOffset,h=this.calcTransformMatrix(),p={x:e.left+l,y:e.top+e.topOffset+c},f=this.canvas.upperCanvasEl,d=f.width-c,v=f.height-c;return p=fabric.util.transformPoint(p,h),(p=fabric.util.transformPoint(p,this.canvas.viewportTransform)).x<0&&(p.x=0),p.x>d&&(p.x=d),p.y<0&&(p.y=0),p.y>v&&(p.y=v),p.x+=this.canvas._offset.left,p.y+=this.canvas._offset.top,{left:p.x+"px",top:p.y+"px",fontSize:c}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(;e!==t;)this._removeSingleCharAndStyle(t+1),e--;this.selectionStart=t,this.selectionEnd=t},_removeSingleCharAndStyle:function(t){var e="\n"===this.text[t-1],n=e?t:t-1;this.removeStyleObject(e,n),this.text=this.text.slice(0,t-1)+this.text.slice(t),this._textLines=this._splitTextIntoLines()},insertChars:function(t,e){var style;if(this.selectionEnd-this.selectionStart>1&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),e||!this.isEmptyStyles())for(var i=0,n=t.length;i<n;i++)e&&(style=fabric.copiedTextStyle[i]),this.insertChar(t[i],i<n-1,style);else this.insertChar(t,!1)},insertChar:function(t,e,n){var r="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(t,r,n),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,e||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(e,n,r){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var o={},c={};if(this.styles[e]&&this.styles[e][n-1]&&(o=this.styles[e][n-1]),r)c[0]=t(o),this.styles[e+1]=c;else{for(var l in this.styles[e])parseInt(l,10)>=n&&(c[parseInt(l,10)-n]=this.styles[e][l],delete this.styles[e][l]);this.styles[e+1]=c}this._forceClearCache=!0},insertCharStyleObject:function(e,n,style){var r=this.styles[e],o=t(r);for(var c in 0!==n||style||(n=1),o){var l=parseInt(c,10);l>=n&&(r[l+1]=o[l],o[l-1]||delete r[l])}this.styles[e][n]=style||t(r[n-1]),this._forceClearCache=!0},insertStyleObjects:function(t,e,n){var r=this.get2DCursorLocation(),o=r.lineIndex,c=r.charIndex;this._getLineStyle(o)||this._setLineStyle(o,{}),"\n"===t?this.insertNewlineStyleObject(o,c,e):this.insertCharStyleObject(o,c,n)},shiftLineStyles:function(e,n){var r=t(this.styles);for(var line in this.styles){var o=parseInt(line,10);o>e&&(this.styles[o+n]=r[o],r[o-n]||delete this.styles[o])}},removeStyleObject:function(t,e){var n=this.get2DCursorLocation(e),r=n.lineIndex,o=n.charIndex;this._removeStyleObject(t,n,r,o)},_getTextOnPreviousLine:function(t){return this._textLines[t-1]},_removeStyleObject:function(e,n,r,o){if(e){var c=this._getTextOnPreviousLine(n.lineIndex),l=c?c.length:0;for(o in this.styles[r-1]||(this.styles[r-1]={}),this.styles[r])this.styles[r-1][parseInt(o,10)+l]=this.styles[r][o];this.shiftLineStyles(n.lineIndex,-1)}else{var h=this.styles[r];h&&delete h[o];var f=t(h);for(var i in f){var d=parseInt(i,10);d>=o&&0!==d&&(h[d-1]=f[d],delete h[d])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(t,e,n){n<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=n):n>t&&n<e?"right"===this._selectionDirection?this.selectionEnd=n:this.selectionStart=n:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=n)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",(function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))})),this.on("tripleclick",(function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))}))},initMousedownHandler:function(){this.on("mousedown",(function(t){if(this.editable){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}}))},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",(function(t){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(t.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)}))},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),n=this.selectionStart,r=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(n,r,e):(this.selectionStart=e,this.selectionEnd=e),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(t){for(var line,e=this.getLocalPointer(t),n=0,r=0,o=0,c=0,i=0,l=this._textLines.length;i<l;i++){line=this._textLines[i],o+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var h=this._getLineWidth(this.ctx,i);r=this._getLineLeftOffset(h)*this.scaleX;for(var f=0,d=line.length;f<d;f++){if(n=r,r+=this._getWidthOfChar(this.ctx,line[f],i,this.flipX?d-f:f)*this.scaleX,!(o<=e.y||r<=e.x))return this._getNewSelectionStartFromOffset(e,n,r,c+i,d);c++}if(e.y<o)return this._getNewSelectionStartFromOffset(e,n,r,c+i-1,d)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,n,r,o){var c=t.x-e,l=r+(n-t.x>c?0:1);return this.flipX&&(l=o-l),l>this.text.length&&(l=this.text.length),l}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var style=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+style.top+"; left: "+style.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(t){this.isEditing&&!this._copyDone?t.keyCode in this._ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this._ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()):this._copyDone=!1},onInput:function(t){if(this.isEditing&&!this.inCompositionMode){var e,n,r,o=this.selectionStart||0,c=this.selectionEnd||0,l=this.text.length,h=this.hiddenTextarea.value.length;h>l?(r="left"===this._selectionDirection?c:o,e=h-l,n=this.hiddenTextarea.value.slice(r,r+e)):(e=h-l+c-o,n=this.hiddenTextarea.value.slice(o,o+e)),this.insertChars(n),t.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){var data=t.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(data,!1),this.prevCompositionLength=data.length},forwardDelete:function(t){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(t)}this.removeChars(t)},copy:function(t){if(this.selectionStart!==this.selectionEnd){var e=this.getSelectedText(),n=this._getClipboardData(t);n&&n.setData("text",e),fabric.copiedText=e,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),t.stopImmediatePropagation(),t.preventDefault(),this._copyDone=!0}},paste:function(t){var e=null,n=this._getClipboardData(t),r=!0;n?(e=n.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===e||(r=!1)):e=fabric.copiedText,e&&this.insertChars(e,r),t.stopImmediatePropagation(),t.preventDefault()},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(t),this.removeChars(t))},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){for(var n,r=this._textLines[t].slice(0,e),o=this._getLineWidth(this.ctx,t),c=this._getLineLeftOffset(o),i=0,l=r.length;i<l;i++)n=r[i],c+=this._getWidthOfChar(this.ctx,n,t,i);return c},getDownCursorOffset:function(t,e){var n=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(n),o=r.lineIndex;if(o===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-n;var c=r.charIndex,l=this._getWidthBeforeCursor(o,c),h=this._getIndexOnLine(o+1,l);return this._textLines[o].slice(c).length+h+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var n=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(n),o=r.lineIndex;if(0===o||t.metaKey||33===t.keyCode)return-n;var c=r.charIndex,l=this._getWidthBeforeCursor(o,c),h=this._getIndexOnLine(o-1,l),f=this._textLines[o].slice(0,c);return-this._textLines[o-1].length+h-f.length},_getIndexOnLine:function(t,e){for(var n,r=this._getLineWidth(this.ctx,t),o=this._textLines[t],c=this._getLineLeftOffset(r),l=0,h=0,f=o.length;h<f;h++){var d=o[h],v=this._getWidthOfChar(this.ctx,d,t,h);if((c+=v)>e){n=!0;var m=c-v,y=c,_=Math.abs(m-e);l=Math.abs(y-e)<_?h:h-1;break}}return n||(l=o.length-1),l},moveCursorDown:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var n=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),0!==n&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,n){var r;if(t.altKey)r=this["findWordBoundary"+n](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===n?-1:1,!0;r=this["findLineBoundary"+n](this[e])}if(void 0!==typeof r&&this[e]!==r)return this[e]=r,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var n="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?n+="Shift":n+="outShift",this[n](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var n=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(n,this.selectionStart),this.setSelectionStart(n)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),toFixed=fabric.util.toFixed,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,n,r,o,c){this._getLineStyle(t)?this._setSVGTextLineChars(t,e,n,r,c):fabric.Text.prototype._setSVGTextLineText.call(this,t,e,n,r,o)},_setSVGTextLineChars:function(t,e,n,r,o){for(var c=this._textLines[t],l=0,h=this._getLineLeftOffset(this._getLineWidth(this.ctx,t))-this.width/2,f=this._getSVGLineTopOffset(t),d=this._getHeightOfLine(this.ctx,t),i=0,v=c.length;i<v;i++){var m=this._getStyleDeclaration(t,i)||{};e.push(this._createTextCharSpan(c[i],m,h,f.lineTop+f.offset,l));var y=this._getWidthOfChar(this.ctx,c[i],t,i);m.textBackgroundColor&&o.push(this._createTextCharBg(m,h,f.lineTop,d,y,l)),l+=y}},_getSVGLineTopOffset:function(t){for(var e,n=0,r=0;r<t;r++)n+=this._getHeightOfLine(this.ctx,r);return e=this._getHeightOfLine(this.ctx,r),{lineTop:n,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(t,e,n,r,o,c){return['\t\t<rect fill="',t.textBackgroundColor,'" x="',toFixed(e+c,NUM_FRACTION_DIGITS),'" y="',toFixed(n-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(o,NUM_FRACTION_DIGITS),'" height="',toFixed(r/this.lineHeight,NUM_FRACTION_DIGITS),'"></rect>\n'].join("")},_createTextCharSpan:function(t,e,n,r,o){var c=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},e));return['\t\t\t<tspan x="',toFixed(n+o,NUM_FRACTION_DIGITS),'" y="',toFixed(r-this.height/2,NUM_FRACTION_DIGITS),'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?'text-decoration="'+e.textDecoration+'" ':"",'style="',c,'">',fabric.util.string.escapeXml(t),"</tspan>\n"].join("")}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),n=e.util.object.clone;e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,initialize:function(text,t){this.ctx=e.util.createCanvasElement().getContext("2d"),this.callSuper("initialize",text,t),this.setControlsVisibility(e.Textbox.getTextboxControlVisibility()),this._dimensionAffectingProps.width=!0},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(t))},_generateStyleMap:function(){for(var t=0,e=0,n=0,map={},i=0;i<this._textLines.length;i++)"\n"===this.text[n]&&i>0?(e=0,n++,t++):" "===this.text[n]&&i>0&&(e++,n++),map[i]={line:t,offset:e},n+=this._textLines[i].length,e+=this._textLines[i].length;return map},_getStyleDeclaration:function(t,e,n){if(this._styleMap){var map=this._styleMap[t];if(!map)return n?{}:null;t=map.line,e=map.offset+e}return this.callSuper("_getStyleDeclaration",t,e,n)},_setStyleDeclaration:function(t,e,style){var map=this._styleMap[t];t=map.line,e=map.offset+e,this.styles[t][e]=style},_deleteStyleDeclaration:function(t,e){var map=this._styleMap[t];t=map.line,e=map.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var map=this._styleMap[t];return this.styles[map.line]},_setLineStyle:function(t,style){var map=this._styleMap[t];this.styles[map.line]=style},_deleteLineStyle:function(t){var map=this._styleMap[t];delete this.styles[map.line]},_wrapText:function(t,text){var i,e=text.split(this._reNewline),n=[];for(i=0;i<e.length;i++)n=n.concat(this._wrapLine(t,e[i],i));return n},_measureText:function(t,text,e,n){var r=0;n=n||0;for(var i=0,o=text.length;i<o;i++)r+=this._getWidthOfChar(t,text[i],e,i+n);return r},_wrapLine:function(t,text,e){for(var n=0,r=[],line="",o=text.split(" "),c="",l=0,h=0,f=0,d=0,v=!0,m=this._getWidthOfCharSpacing(),i=0;i<o.length;i++)c=o[i],h=this._measureText(t,c,e,l),l+=c.length,(n+=f+h-m)>=this.width&&!v?(r.push(line),line="",n=h,v=!0):n+=m,v||(line+=" "),line+=c,f=this._measureText(t," ",e,l),l++,v=!1,h>d&&(d=h);return i&&r.push(line),d>this.dynamicMinWidth&&(this.dynamicMinWidth=d-m),r},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save(),this._setTextStyles(this.ctx),this.textAlign="left";var e=this._wrapText(this.ctx,this.text);return this.textAlign=t,this.ctx.restore(),this._textLines=e,this._styleMap=this._generateStyleMap(),e},setOnGroup:function(t,e){"scaleX"===t&&(this.set("scaleX",Math.abs(1/e)),this.set("width",this.get("width")*e/(void 0===this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=e)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,n=0,i=0;i<e;i++){var r=this._textLines[i].length;if(t<=n+r)return{lineIndex:i,charIndex:t-n};n+=r,"\n"!==this.text[n]&&" "!==this.text[n]||n++}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(t,e){for(var n=0,r=0,o=this.get2DCursorLocation(),c=this._textLines[o.lineIndex].split(""),l=this._getLineLeftOffset(this._getLineWidth(this.ctx,o.lineIndex)),i=0;i<o.charIndex;i++)r+=this._getWidthOfChar(this.ctx,c[i],o.lineIndex,i);for(i=0;i<o.lineIndex;i++)n+=this._getHeightOfLine(this.ctx,i);return"cursor"===e&&(n+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,o.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(o.lineIndex,o.charIndex)*(1-this._fontSizeFraction)),{top:n,left:r,lineLeft:l}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),e.Textbox.fromObject=function(object,t){var r=new e.Textbox(object.text,n(object));return t&&t(r),r},e.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}(exports),function(){var t=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(e,n,r,o,c,l,h){var f=n.target;if(!(f instanceof fabric.Textbox))return t.call(fabric.Canvas.prototype,e,n,r,o,c,l,h);var d=f.width*(e.x/n.scaleX/(f.width+f.strokeWidth));return d>=f.getMinWidth()?(f.set("width",d),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if(void 0!==fabric.Textbox)for(var i=this._objects.length;i--;)if(this._objects[i]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};var e=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]},insertCharStyleObject:function(t,e,style){var map=this._styleMap[t];t=map.line,e=map.offset+e,fabric.IText.prototype.insertCharStyleObject.apply(this,[t,e,style])},insertNewlineStyleObject:function(t,e,n){var map=this._styleMap[t];t=map.line,e=map.offset+e,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[t,e,n])},shiftLineStyles:function(t,n){var r=e(this.styles),map=this._styleMap[t];for(var line in t=map.line,this.styles){var o=parseInt(line,10);o>t&&(this.styles[o+n]=r[o],r[o-n]||delete this.styles[o])}},_getTextOnPreviousLine:function(t){for(var e=this._textLines[t-1];this._styleMap[t-2]&&this._styleMap[t-2].line===this._styleMap[t-1].line;)e=this._textLines[t-2]+e,t--;return e},removeStyleObject:function(t,e){var n=this.get2DCursorLocation(e),map=this._styleMap[n.lineIndex],r=map.line,o=map.offset+n.charIndex;this._removeStyleObject(t,n,r,o)}})}(),override=fabric.IText.prototype._getNewSelectionStartFromOffset,fabric.IText.prototype._getNewSelectionStartFromOffset=function(t,e,n,r,o){r=override.call(this,t,e,n,r,o);for(var c=0,l=0,i=0;i<this._textLines.length&&!((c+=this._textLines[i].length)+l>=r);i++)"\n"!==this.text[c+l]&&" "!==this.text[c+l]||l++;return r-i+l},function(){if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=__webpack_require__(2012).DOMParser,URL=__webpack_require__(890),HTTP=__webpack_require__(1073),HTTPS=__webpack_require__(1072),Canvas=__webpack_require__(912),Image=__webpack_require__(912).Image;fabric.util.loadImage=function(t,e,n){function r(data){data?(img.src=new Buffer(data,"binary"),img._src=t,e&&e.call(n,img)):(img=null,e&&e.call(n,null,!0))}var img=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(img.src=img._src=t,e&&e.call(n,img)):t&&0!==t.indexOf("http")?requestFs(t,r):t?request(t,"binary",r):e&&e.call(n,t)},fabric.loadSVGFromURL=function(t,e,n){0!==(t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim()).indexOf("http")?requestFs(t,(function(body){fabric.loadSVGFromString(body.toString(),e,n)})):request(t,"",(function(body){fabric.loadSVGFromString(body,e,n)}))},fabric.loadSVGFromString=function(t,e,n){var r=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(r.documentElement,(function(t,n){e&&e(t,n)}),n)},fabric.util.getScript=function(url,callback){request(url,"",(function(body){eval(body),callback&&callback()}))},fabric.createCanvasForNode=function(t,e,n,r){r=r||n;var o=fabric.document.createElement("canvas"),c=new Canvas(t||600,e||600,r),l=new Canvas(t||600,e||600,r);o.style={},o.width=c.width,o.height=c.height,(n=n||{}).nodeCanvas=c,n.nodeCacheCanvas=l;var h=new(fabric.Canvas||fabric.StaticCanvas)(o,n);return h.nodeCanvas=c,h.nodeCacheCanvas=l,h.contextContainer=c.getContext("2d"),h.contextCache=l.getContext("2d"),h.Font=Canvas.Font,h};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(t,e){t=t||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(t.width,t.height),this.nodeCacheCanvas=new Canvas(t.width,t.height),originaInitStatic.call(this,t,e),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(t,e){return origSetBackstoreDimension.call(this,t,e),this.nodeCanvas[t]=e,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}function request(t,e,n){var r=URL.parse(t);r.port||(r.port=0===r.protocol.indexOf("https:")?443:80);var o=(0===r.protocol.indexOf("https:")?HTTPS:HTTP).request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},(function(t){var body="";e&&t.setEncoding(e),t.on("end",(function(){n(body)})),t.on("data",(function(e){200===t.statusCode&&(body+=e)}))}));o.on("error",(function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(t.message),n(null)})),o.end()}function requestFs(path,t){__webpack_require__(2013).readFile(path,(function(e,data){if(e)throw fabric.log(e),e;t(data)}))}}(),window.fabric=fabric,__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return fabric}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this,__webpack_require__(783).Buffer,__webpack_require__(111))}}]);