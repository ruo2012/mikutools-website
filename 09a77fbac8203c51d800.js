(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{2317:function(t,e,n){"use strict";var o=n(972);n.n(o).a},2318:function(t,e,n){(e=n(10)(!1)).push([t.i,".user-index .aff-link{cursor:pointer}.user-index .nya-loading{margin:2.5rem auto}",""]),t.exports=e},2489:function(t,e,n){"use strict";n.r(e);n(71);var o=n(35),r=n.n(o),c={name:"UserIndex",head:function(){return{titleTemplate:"用户中心 - %s"}},data:function(){return{data:{},cardKey:"",cardLoading:!1,transformAffLoading:!1}},watch:{"$store.state.user":function(t){t.id||this.$router.replace("/")}},mounted:function(){var t=this;setTimeout((function(){var e=t.$store.state,n=e.user,o=e.verify;!n.id&&o?(t.$message.error("请先登录"),t.$router.replace("/")):t.getInfo()}),0)},methods:{VerifyMail:function(){var t=this;this.$confirm("是否重新发送验证邮件？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.commit("loadingComponent",!0),t.$axios.post("/user/verify_mail",{mail:t.data.mail}).then((function(){t.$notify.success({title:"发送成功",message:"请查看收件箱或垃圾箱"}),t.$store.commit("loadingComponent",!1)})).catch((function(e){t.$notify.error({title:"发送失败",message:e}),t.$store.commit("loadingComponent",!1)}))})).catch((function(){}))},logout:function(){var t=this;this.$store.state.user.id&&this.$confirm("是否退出登陆","确认信息").then((function(){t.$router.replace("/"),t.$store.commit("SET_STORE",{key:"user",value:{id:"",token:""}}),t.$store.commit("SET_STORE",{key:"vip",value:!1}),t.$message.success("退出成功")})).catch((function(){}))},getInfo:function(){var t=this;this.$axios.post("/user/info").then((function(e){t.data=e.data.data,t.data.verify||t.$notify.warning({title:"提示",message:"您的邮箱还未验证，请尽快验证，以免影响使用"})})).catch((function(e){t.$notify.error({title:"获取用户信息失败",message:e}),t.$store.commit("SET_STORE",{key:"user",value:{}})}))},formatDate:function(t){return r()(t).format("YYYY-MM-DD")},activateCard:function(){var t=this;return!this.cardLoading&&(!!this.cardKey&&(this.cardLoading=!0,void this.$axios.post("/user/vip",{key:this.cardKey}).then((function(){t.cardLoading=!1,alert("激活成功，感谢您的支持"),t.$message.success("激活成功，感谢您的支持"),t.getInfo()})).catch((function(e){t.cardLoading=!1,alert("激活失败，可能是卡密输入错误或已使用过卡密，可查看VIP到期时间判断"),t.$notify.error({title:"激活失败",message:e})}))))},transformAff:function(){var t=this,e=Math.floor((this.data.aff-this.data.transform_aff)/5);return e<1?this.$notify.error({title:"兑换失败",message:"可兑换人数不足5人，无法兑换"}):!this.transformAffLoading&&void this.$confirm("预计可转换为".concat(e,"个月VIP"),"是否继续",{confirmButtonText:"确认转换",cancelButtonText:"取消",type:"warning"}).then((function(){t.transformAffLoading=!0,t.$axios.post("/user/transform_aff").then((function(e){t.transformAffLoading=!1,t.$notify.success({title:"转换成功",message:"获得".concat(e.data.data,"个月VIP")}),t.getInfo()})).catch((function(e){t.transformAffLoading=!1,t.$notify.error({title:"转换失败",message:e})}))})).catch((function(){}))},copy:function(text){var t=this;this.$copyText(text).then((function(){t.$message.success("复制成功")}),(function(){t.$message.error("复制失败，可手动进行复制")}))}}},f=(n(2317),n(5)),component=Object(f.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-index"},[n("nya-container",{attrs:{title:"用户中心"}},[t.data.mail?n("div",{staticClass:"content"},[n("p",[n("b",[t._v("注册时间：")]),t._v(t._s(t.formatDate(t.data.unix)))]),t._v(" "),n("p",[n("b",[t._v("ID：")]),n("el-tag",{staticClass:"cursor-pointer",attrs:{size:"small"},on:{click:function(e){return t.copy(t.data.id)}}},[t._v("\n                    "+t._s(t.data.id)+"\n                ")])],1),t._v(" "),n("p",[n("b",[t._v("邮箱：")]),t._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:t.data.verify?"已验证，点击复制":"未验证，点击重新发送验证邮件",placement:"bottom"}},[n("el-tag",{staticClass:"cursor-pointer",attrs:{type:t.data.verify?"success":"danger",size:"small"},on:{click:function(e){t.data.verify?t.copy(t.data.mail):t.VerifyMail()}}},[t._v("\n                        "+t._s(t.data.mail)+"\n                    ")])],1)],1),t._v(" "),n("p",[n("b",[t._v("VIP到期时间：")]),n("span",{staticStyle:{color:"red"}},[t._v(t._s(t.data.vip?t.formatDate(t.data.vip):"未开通"))])]),t._v(" "),n("p",[n("b",[t._v("邀请人数 "),n("el-tooltip",{attrs:{effect:"dark",content:"每邀请5名用户可转换为1个月VIP会员",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",round:"",loading:t.transformAffLoading},on:{click:t.transformAff}},[t._v(t._s(t.transformAffLoading?"转换中":"转换为VIP"))])],1),t._v("：\n                ")],1),t._v("共邀请了\n                "),n("b",{staticClass:"nya-c-theme"},[t._v(t._s(t.data.aff))]),t._v("\n                人，剩余可兑换VIP人数："),n("b",{staticClass:"nya-c-theme"},[t._v(t._s(t.data.aff-t.data.transform_aff))])]),t._v(" "),n("p",{staticClass:"mb-0"},[n("b",[t._v("邀请链接：")]),t._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"点击复制",placement:"bottom"}},[n("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.copy("https://tools.miku.ac/?aff="+t.data.id+"&ref=aff")}}},[t._v("\n                        "+t._s("https://tools.miku.ac/?aff="+t.data.id+"&ref=aff")+"\n                    ")])],1)],1),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("你可以通过"),n("b",[t._v(" 邀请用户注册 ")]),t._v("或"),n("b",[t._v(" 充值 ")]),t._v(" 成为本站VIP")]),t._v(" "),n("div",{staticClass:"nya-subtitle"},[t._v("\n                输入 VIP 卡密激活 "),n("a",{attrs:{href:"http://pr.kuaifaka.com/item/N5Dgj",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击购买卡密")])]),t._v(" "),n("el-input",{staticClass:"mb-15",attrs:{autofocus:"",label:"",autocomplete:"off"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.activateCard(e)}},model:{value:t.cardKey,callback:function(e){t.cardKey="string"==typeof e?e.trim():e},expression:"cardKey"}},[n("el-button",{attrs:{slot:"append",loading:t.cardLoading},on:{click:t.activateCard},slot:"append"},[t._v("\n                    "+t._s(t.cardLoading?"激活中":"激活卡密")+"\n                ")])],1)],1):n("nya-loading"),t._v(" "),t.$store.state.user.token?n("el-button",{attrs:{type:"primary",round:""},on:{click:t.logout}},[t._v("\n            退出登陆\n        ")]):t._e()],1),t._v(" "),n("nya-container",{attrs:{title:"帮助"}},[n("ul",{staticClass:"nya-list"},[n("li",[t._v("卡密激活失败：仔细核对是否正确输入了卡密，请不要手动输入，直接复制粘贴即可")]),t._v(" "),n("li",[t._v("激活后没有任何反应：可查看VIP到期时间，或刷新页面")]),t._v(" "),n("li",[t._v("邮箱无法验证该怎么办：无需验证邮箱也可以正常使用，无需担心")]),t._v(" "),n("li",[t._v("卡密忘记如何查询："),n("a",{attrs:{href:"https://card.mikutools.dio.cx/product/query/?zlkbmethod=contact",target:"_blank",rel:"noopener noreferrer"}},[t._v("旧版查询地址（最近一个月订单）")]),t._v(" 或者 "),n("a",{attrs:{href:"https://www.kuaifaka.com/order_sel",target:"_blank",rel:"noopener noreferrer"}},[t._v("新版查询地址")])])])])],1)}),[],!1,null,null,null);e.default=component.exports},972:function(t,e,n){var content=n(2318);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(11).default)("a282b73a",content,!0,{sourceMap:!1})}}]);